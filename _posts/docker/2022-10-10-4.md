---
title:  "[Docker] ec2 + docker-compose + spring boot + mysql ë°°í¬ "
# excerpt: "sprintfì— ëŒ€í•´ ì•Œì•„ë³´ì"

categories:
  - Docker
tags:
  - [Docker]

toc: true
toc_sticky: true
 
date: 2022-10-10 16:58:17
last_modified_at: 2022-10-10 16:58:19
---
## 1. git clone
```bash
$ git clone https://github.com/minju412/docker-test.git
```

## 2. docker-compose ì„¤ì¹˜
```bash
$ sudo apt  install docker-compose
```

## 3. `docker-compose.yml` ì‘ì„±
```yml
version: '3'

services:
  database:
    container_name: mysql_db
    image: mysql/mysql-server:5.7
    environment:
      MYSQL_DATABASE: users_db
      MYSQL_ROOT_HOST: '%'
      MYSQL_ROOT_PASSWORD: 1234
      TZ: 'Asia/Seoul'
    ports:
      - "3306:3306"
    command:
      - "mysqld"
      - "--character-set-server=utf8mb4"
      - "--collation-server=utf8mb4_unicode_ci"
    networks:
      - test_network

  application:
    container_name: docker-compose-test
    build:
      context: ./
      dockerfile: Dockerfile
    ports:
      - "9000:9000"
    environment:
      SPRING_APPLICATION_JSON: '{
              "spring.datasource.url"  : "jdbc:mysql://mysql_db:3306/users_db?useSSL=false&serverTimezone=UTC&useLegacyDatetimeCode=false",
              "spring.datasource.username" : "root",
              "spring.datasource.password" : "1234",
              "spring.jpa.properties.hibernate.dialect" : "org.hibernate.dialect.MySQL8Dialect",
              "spring.jpa.hibernate.ddl-auto" : "create"
            }'
    depends_on:
      - database
    networks:
      - test_network

networks:
  test_network:
```

> ì´ ë•Œ ip ì£¼ì†Œ ë¶€ë¶„ì— ip ì£¼ì†Œê°€ ì•„ë‹Œ, service ì´ë¦„ìœ¼ë¡œ ì ì–´ì•¼ í•œë‹¤.

## 4. aws ë³´ì•ˆ ì„¤ì •
<img width="1079" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-10 á„‹á…©á„’á…® 5 03 50" src="https://user-images.githubusercontent.com/59405576/194822202-796cb015-4f93-47c0-8a81-9e945bcd222b.png">

## 5. ì‹¤í–‰
```bash
# ë¹Œë“œ
docker-compose up --build

# ì‹¤í–‰
$ sudo docker-compose up -d

# ì‹¤í–‰ í™•ì¸
$ sudo docker-compose ps -a
```

### Trouble Shooting - 1
<img width="678" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-07 á„‹á…©á„’á…® 11 40 06" src="https://user-images.githubusercontent.com/59405576/194580181-b9d86621-24c1-4eae-b81c-ec301dd171b0.png"><br>
ë‹¤ì–‘í•œ ì›ì¸ì´ ìˆê² ì§€ë§Œ, ë‚´ ê²½ìš°ì—ëŠ” ì²˜ìŒì— `sudo`ë¥¼ ë¶™ì´ì§€ ì•Šì•„ì„œ ë°œìƒí•œ ì˜¤ë¥˜ì˜€ë‹¤.

### Trouble Shooting - 2
ì•„ë˜ì™€ ê°™ì´ `Access denied for user 'root'@'172.18.0.3'` ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤ë©´, <br>
mysqlì— ì ‘ì†í•´ í•´ë‹¹ ìœ ì €ë¥¼ ìƒì„±í•œ ë’¤, ê¶Œí•œì„ ë¶€ì—¬í•˜ë©´ ëœë‹¤.<br> 
(mysqlì— ì ‘ì†í•˜ê¸° ì „ì— mysql containerë¥¼ ì‹¤í–‰í•´ë‘ì–´ì•¼ í•œë‹¤.)
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-10 á„‹á…©á„’á…® 4 04 31](https://user-images.githubusercontent.com/59405576/194813886-c50adee5-d631-41df-a335-2bfeba81ece6.png)
```bash
# ë„ì»¤ ì»¨í…Œì´ë„ˆ ì ‘ì†
$ docker exec -it mysql_db bash 

# mysql ì ‘ì†
bash# mysql -u root -p; 

# mysql db ì‚¬ìš©
mysql> use mysql; 

# user ì¡°íšŒ
mysql> select host, user from user; 

# ê³„ì • ìƒì„±
mysql> create user root@172.18.0.3 identified by 'ë¹„ë°€ë²ˆí˜¸'; 

# ê¶Œí•œ ë¶€ì—¬
mysql> GRANT ALL PRIVILEGES ON *.* TO 'root'@'172.18.0.3';

# ë©”ëª¨ë¦¬ì— ë°˜ì˜
mysql> flush privileges;

# ê¶Œí•œ í™•ì¸
mysql> show grants for root@172.18.0.3;
```
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-10 á„‹á…©á„’á…® 4 44 04](https://user-images.githubusercontent.com/59405576/194819196-f1421719-e71f-45bd-8275-c216ef53c569.png)<br>

## 6. ì„±ê³µ!
<img width="405" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-10 á„‹á…©á„’á…® 5 23 54" src="https://user-images.githubusercontent.com/59405576/194825209-904f409b-a236-442f-82c7-2203b326f3ac.png">


# Ref
- [https://velog.io/@mooh2jj/AWS-EC2-Docker-%EC%84%A4%EC%B9%98](https://velog.io/@mooh2jj/AWS-EC2-Docker-%EC%84%A4%EC%B9%98) - ë„ì»¤ ì„¤ì¹˜







***
<br>


    ğŸ’› ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ğŸ‘»

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}