---
title:  "[Docker] docker-composeë¥¼ ì´ìš©í•œ Spring boot, MySQL ë°°í¬ í™˜ê²½ êµ¬ì„± + .envë¥¼ í†µí•œ ë¯¼ê°ì •ë³´ ìˆ¨ê¸°ê¸° "
# excerpt: "sprintfì— ëŒ€í•´ ì•Œì•„ë³´ì"

categories:
  - Docker
tags:
  - [Docker]

toc: true
toc_sticky: true
 
date: 2022-07-10 23:43:55
last_modified_at: 2022-07-10 23:43:58
---
# 1. jar íŒŒì¼ ì¤€ë¹„
## bootJar ë¹Œë“œ
ì¸í…”ë¦¬ì œì´ ìš°ì¸¡ ìƒë‹¨ì— Gradle íƒ­ > Tasks > build > bootJar ë¥¼ ë§ˆìš°ìŠ¤ ìš°í´ë¦­ í•˜ì—¬ Run í•œë‹¤.<br>
<img width="297" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-07-09 á„‹á…©á„Œá…¥á†« 12 55 41" src="https://user-images.githubusercontent.com/59405576/178027833-ac0f3c07-a789-4f24-9e49-40d26fe0528c.png"><br>

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-07-09 á„‹á…©á„Œá…¥á†« 1 00 20](https://user-images.githubusercontent.com/59405576/178028584-10298668-08d2-4d64-a16e-32ab3338579b.png)

## jar íŒŒì¼ ìƒì„± í™•ì¸
ë¹Œë“œê°€ ì„±ê³µí•˜ë©´ ì¢Œì¸¡ í”„ë¡œì íŠ¸ build > libs ê²½ë¡œì— jar íŒŒì¼ì´ ìƒì„±ëœë‹¤.<br>
<img width="276" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-07-09 á„‹á…©á„Œá…¥á†« 12 57 50" src="https://user-images.githubusercontent.com/59405576/178028160-a7e26615-0e5d-46e2-9faf-63877bfd72c6.png">

# 2. `Dockerfile` ì‘ì„±
```
FROM openjdk:11
ARG JAR_FILE=build/libs/server-0.0.1-SNAPSHOT.jar
COPY ${JAR_FILE} app.jar
EXPOSE 8080
ENTRYPOINT ["java", "-jar", "/app.jar"]
```
- FROM: ì´ë¯¸ì§€ë¥¼ ìƒì„±í•  ë•Œ ì‚¬ìš©í•  ê¸°ë°˜ ì´ë¯¸ì§€ì…ë‹ˆë‹¤. openjdk:8-jdk-alpine ì´ë¯¸ì§€ì—ì„œ ë ˆì´ì–´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
- ARG: ë³€ìˆ˜ ì„ ì–¸<br>
ì´ë•Œ, `JAR_FILE` ìš°ì¸¡ì— ì´ì „ì— ìƒì„±í•œ jar íŒŒì¼ ê²½ë¡œë¥¼ ì ì–´ì¤€ë‹¤. <br>
(`ARG JAR_FILE=build/libs/*.jar`ë¡œ ì ì–´ë„ ë¬´ë°©í•˜ë‹¤.)
- COPY ì‹¤í–‰í•  jaríŒŒì¼ì„ ë„ì»¤ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì— myboot.jarë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ë³µì‚¬í•©ë‹ˆë‹¤. ìƒëŒ€ ê²½ë¡œë¡œ ìœ„ì¹˜ë„ ê°™ì´ ì„¤ì • ê°€ëŠ¥í•©ë‹ˆë‹¤.
- ENTRYPOINT ì»¨í…Œì´ë„ˆê°€ ì‹œì‘ë  ë•Œ ì‹¤í–‰í•  ìŠ¤í¬ë¦½íŠ¸ í˜¹ì€ ëª…ë ¹ì„ ì •ì˜í•©ë‹ˆë‹¤.

# 3. ë„ì»¤ ë„¤íŠ¸ì›Œí¬ ìƒì„±
ë„ì»¤ í™˜ê²½ì—ì„œ ì—¬ëŸ¬ ì»¨í…Œì´ë„ˆë¥¼ ë™ì¼í•œ í™˜ê²½ì—ì„œ ì—°ë™ì‹œí‚¤ê¸° ìœ„í•´ì„œ ë„¤íŠ¸ì›Œí¬ ì„¤ì •ì´ í•„ìš”í•˜ë‹¤.<br>
ì—¬ê¸°ì„œëŠ” MySQL ê³¼ springboot appì´ ë™ì¼í•œ ë„¤íŠ¸ì›Œí¬ì—ì„œ êµ¬ë™ë˜ë„ë¡ í•´ì£¼ì–´ì•¼ í•œë‹¤.<br><br>
ì¼ë‹¨ ë„¤íŠ¸ì›Œí¬ë¶€í„° í•˜ë‚˜ ìƒì„±í•´ì¤€ë‹¤.
```
docker network create springboot-mysql-net
```
ìƒì„±ëœ ë„¤íŠ¸ì›Œí¬ëŠ” ì•„ë˜ ëª…ë ¹ì–´ë¡œ í™•ì¸ ê°€ëŠ¥í•˜ë‹¤.
```
docker network ls
```

<img width="467" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-07-09 á„‹á…©á„’á…® 4 30 57" src="https://user-images.githubusercontent.com/59405576/178096395-6aab9f69-5ef5-422b-9c55-c2eb61c1b4d5.png">

# 4. `docker-compose.yml` ì‘ì„±
```yml
version: "3.8"

services:
  db-mysql:
    container_name: naem_database
    image: mysql
    env_file: ./.env
    environment:
      - MYSQL_ROOT_PASSWORD=$MYSQLDB_ROOT_PASSWORD
      - MYSQL_DATABASE=$MYSQLDB_DATABASE
    ports:
      - $MYSQLDB_LOCAL_PORT:$MYSQLDB_DOCKER_PORT
    networks:
      - springboot-mysql-net

  application:
    container_name: naem_application
    build:
      context: ./
      dockerfile: Dockerfile
    env_file: ./.env
    ports:
      - $SPRING_LOCAL_PORT:$SPRING_DOCKER_PORT
    environment:
      SPRING_APPLICATION_JSON: '{
          "spring.datasource.url"  : "jdbc:mysql://localhost:$MYSQLDB_DOCKER_PORT/$MYSQLDB_DATABASE?serverTimezone=UTC&characterEncoding=UTF-8",
          "spring.datasource.username" : "$MYSQLDB_USER",
          "spring.datasource.password" : "$MYSQLDB_ROOT_PASSWORD",
          "spring.jpa.properties.hibernate.dialect" : "org.hibernate.dialect.MySQL8Dialect",
          "spring.jpa.hibernate.ddl-auto" : "create"
        }'
    depends_on:
      - db-mysql
    networks:
      - springboot-mysql-net

networks:
  springboot-mysql-net:
    driver: bridge
```

## `.env` íŒŒì¼
```
MYSQLDB_USER=testuser
MYSQLDB_ROOT_PASSWORD=testpassword
MYSQLDB_DATABASE=testdb
MYSQLDB_LOCAL_PORT=3306
MYSQLDB_DOCKER_PORT=3306

SPRING_LOCAL_PORT=8080
SPRING_DOCKER_PORT=8080
```
ğŸŒŸ `.env` íŒŒì¼ì—ëŠ” ë¯¼ê° ì •ë³´ë“¤ì´ ìˆê¸° ë•Œë¬¸ì— `.gitignore`ì— ë“±ë¡í•´ ê¹ƒí—™ì— ì˜¬ë¼ê°€ì§€ ì•Šë„ë¡ í•´ì•¼í•œë‹¤!

## ğŸ˜¡ Trouble Shooting - 1
ì •ë§ ê³ ìƒí•œ ì—ëŸ¬ì˜€ë‹¤..<br>
[Full Error]<br>
<img width="1289" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-07-10 á„‹á…©á„’á…® 11 25 13" src="https://user-images.githubusercontent.com/59405576/178149019-68969ca0-7d1b-4d02-acc9-d5a091e8a0a5.png"><br>

<img width="1290" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-07-10 á„‹á…©á„’á…® 11 25 36" src="https://user-images.githubusercontent.com/59405576/178149027-1d433ba3-5cf2-475c-a55f-d814c3927006.png"><br>

<img width="1289" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-07-10 á„‹á…©á„’á…® 11 26 19" src="https://user-images.githubusercontent.com/59405576/178149042-d10c0823-3fd4-4ea6-ba86-9b60143707a1.png"><br>

<img width="1286" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-07-10 á„‹á…©á„’á…® 11 26 39" src="https://user-images.githubusercontent.com/59405576/178149051-0c6ed960-e9c8-4df8-8519-fb3f8b59eb11.png"><br>

ëˆˆì— ë„ê²Œ í™•ì¸í•  ìˆ˜ ìˆëŠ” ì—ëŸ¬ëŠ” ì•„ë˜ì™€ ê°™ì•˜ë‹¤.
- Caused by: com.mysql.cj.exceptions.CJCommunicationsException: Communications link failure
- Caused by: java.net.ConnectException: Connection refused (Connection refused)
- Caused by: org.hibernate.service.spi.ServiceException: Unable to create requested service [org.hibernate.engine.jdbc.env.spi.JdbcEnvironment]
- Caused by: org.hibernate.HibernateException: Access to DialectResolutionInfo cannot be null when 'hibernate.dialect' not set

ìˆ˜ë§ì€ ë˜í¼ëŸ°ìŠ¤ë¥¼ ì°¾ì•„ ì „ë¶€ ì‹œë„í•´ë³´ì•˜ì§€ë§Œ ì—ëŸ¬ëŠ” í•´ê²°ë˜ì§€ ì•Šì•˜ë‹¤.<br>
ê²°ë¡ ì ìœ¼ë¡œ ì•„ë˜ ê¸€ì„ ì°¸ê³ í•˜ì—¬ ì—ëŸ¬ë¥¼ í•´ê²°í–ˆë‹¤.

> í•´ê²° ë˜í¼ëŸ°ìŠ¤<br>
[https://morioh.com/p/b28dc1625aba](https://morioh.com/p/b28dc1625aba)

ì›ë˜ëŠ” `application.yml` íŒŒì¼ì— db ì—°ê²° ì •ë³´ë¥¼ ë„£ì—ˆì—ˆëŠ”ë°, ìœ„ ê¸€ì„ ì°¸ê³ í•˜ì—¬ `docker-compose.yml` íŒŒì¼ì˜ `environment` ë¶€ë¶„ì— ì—°ê²° ì •ë³´ë¥¼ ëª¨ë‘ ë„£ì—ˆë‹¤.

# 5. ë„ì»¤ ëª…ë ¹ ì‹¤í–‰
```
docker-compose up --build
docker-compose up -d
docker-compose ps
```
`docker-compose ps` ëª…ë ¹ìœ¼ë¡œ êµ¬ë™ì¤‘ì¸ ì»¨í…Œì´ë„ˆë¥¼ ë³´ë©´, ì•„ë˜ì™€ ê°™ì´ mysqlê³¼ springboot ë‘ ê°œ ì»¨í…Œì´ë„ˆê°€ êµ¬ë™ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.<br>
<img width="1029" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-07-10 á„‹á…©á„’á…® 11 39 45" src="https://user-images.githubusercontent.com/59405576/178149535-1a6cf47f-16b7-41a8-9676-6a754dfdbf3b.png"><br>

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-07-10 á„‹á…©á„’á…® 11 40 03](https://user-images.githubusercontent.com/59405576/178149580-84b5d9cb-a320-4e90-8d46-44ed403eeefd.png)

## ì•Œì•„ë‘ì–´ì•¼ í•˜ëŠ” docker-compose ëª…ë ¹
- `docker-compose up --build `: ì»¨í…Œì´ë„ˆ ì‹œì‘ ì‹œ Dockerfileì„ ë¹Œë“œí•˜ê¸°
- `docker compose up -d`: ì»¨í…Œì´ë„ˆë¥¼ ë°±ê·¸ë¼ìš´ë“œë¡œ ì‹¤í–‰í•˜ê¸°
- `docker-compose down`: ì»¨í…Œì´ë„ˆ ì¤‘ì§€í•˜ê¸°
- `docker-compose ps`: ì‹¤í–‰ì¤‘ì¸ ì»¨í…Œì´ë„ˆ ëª©ë¡ í™•ì¸í•˜ê¸°<br><br>

- `docker-compose start`: ì—¬ëŸ¬ ê°œì˜ ì„œë¹„ìŠ¤ë¥¼ ì¼ê´„ ì‹œì‘
- `docker-compose stop`: ì—¬ëŸ¬ ê°œì˜ ì„œë¹„ìŠ¤ë¥¼ ì¼ê´„ ì •ì§€
- `docker-compose restart`: ì—¬ëŸ¬ ê°œì˜ ì„œë¹„ìŠ¤ë¥¼ ì¼ê´„ ì¬ì‹œì‘
- `docker-compose stop server_a`: íŠ¹ì • ì»¨í…Œì´ë„ˆ ì •ì§€ (ë§¨ ë§ˆì§€ë§‰ ì¸ìˆ˜ëŠ” "ì„œë¹„ìŠ¤ëª…")


## ì•Œì•„ë‘ì–´ì•¼ í•˜ëŠ” docker ëª…ë ¹
- `docker ps -a`: ì‹¤í–‰ì¤‘ì¸ ì»¨í…Œì´ë„ˆ í™•ì¸í•˜ê¸°
- `docker stop [ì»¨í…Œì´ë„ˆID]`: ì»¨í…Œì´ë„ˆ ì¢…ë£Œ
- `docker rm [ì»¨í…Œì´ë„ˆID]`: ì»¨í…Œì´ë„ˆ ì‚­ì œ
- `docker images`: ë„ì»¤ ì´ë¯¸ì§€ í™•ì¸í•˜ê¸°
- `docker rmi [ì´ë¯¸ì§€ID]`: ì´ë¯¸ì§€ ì‚­ì œí•˜ê¸°


## ğŸ˜¡ Trouble Shooting - 2
ì•„ë˜ì™€ ê°™ì€ ì—ëŸ¬ê°€ ë°œìƒí–ˆë‹¤..<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-07-09 á„‹á…©á„Œá…¥á†« 1 20 08](https://user-images.githubusercontent.com/59405576/178031461-3cb89e99-6602-4341-a0ef-35a50e3b4433.png)<br><br>
3306 í¬íŠ¸ê°€ ì´ë¯¸ ì‹¤í–‰ì¤‘ì´ë¼ëŠ” ê²ƒ ê°™ì•„ ì•„ë˜ì²˜ëŸ¼ 3306 í¬íŠ¸ë¥¼ ì‚¬ìš©ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤ë¥¼ ì°¾ì•„ kill í–ˆë‹¤.
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-07-09 á„‹á…©á„Œá…¥á†« 1 20 27](https://user-images.githubusercontent.com/59405576/178031501-b9005e61-0a8e-44d3-a243-73bf8397ec52.png)<br><br>
ê·¸ëŸ°ë° ì•„ë˜ì™€ ê°™ì€ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆë‹¤.. ì•„ë¬´ë˜ë„ 83717ì€ kill í•˜ë©´ ì•ˆë˜ëŠ”ê±´ê°€ë³´ë‹¤..<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-07-09 á„‹á…©á„Œá…¥á†« 1 20 42](https://user-images.githubusercontent.com/59405576/178031540-cd878611-a5b8-495d-bd22-0486b2fe9cdb.png)<br><br>
ì•„ë˜ ëª…ë ¹ìœ¼ë¡œ ë„ì»¤ë¥¼ ë‹¤ì‹œ ì‹¤í–‰í•˜ë‹ˆ ìœ„ ì—ëŸ¬ê°€ ë°œìƒí•˜ì§€ ì•Šì•˜ë‹¤.ğŸ˜Œ<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-07-09 á„‹á…©á„Œá…¥á†« 1 21 16](https://user-images.githubusercontent.com/59405576/178031618-97f5af56-0e21-4b1b-87b7-95125ebef22b.png)<br>

> ìœ ì‚¬ ì¼€ì´ìŠ¤<br>
[https://github.com/docker/compose/issues/7896](https://github.com/docker/compose/issues/7896)





# 7. Volume ë§ˆìš´íŠ¸






# Ref
- [https://ssyoni.tistory.com/m/22](https://ssyoni.tistory.com/m/22): jar íŒŒì¼ ì¤€ë¹„
- [https://velog.io/@dhk22/Springboot-MySQL-Docker-Volume-%EB%B3%BC%EB%A5%A8-%EB%A7%88%EC%9A%B4%ED%8A%B8](https://velog.io/@dhk22/Springboot-MySQL-Docker-Volume-%EB%B3%BC%EB%A5%A8-%EB%A7%88%EC%9A%B4%ED%8A%B8): ë³¼ë¥¨ ë§ˆìš´íŠ¸










***
<br>


    ğŸ’› ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ğŸ‘»

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}