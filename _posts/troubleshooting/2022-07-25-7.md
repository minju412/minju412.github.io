---
title:  "[Trouble Shooting] HikariPool-1 - Thread starvation or clock leap detected í•´ê²° "

categories:
  - TroubleShooting
tags:
  - [TroubleShooting]

toc: true
toc_sticky: true
 
date: 2022-07-25 14:20:39
last_modified_at: 2022-07-25 14:20:42
---

# ë¬¸ì œ ìƒí™©
Spring Boot ì„œë²„ë¥¼ ì‹¤í–‰í•´ë†“ê³  ë‹¤ìŒ ë‚  í™•ì¸í•´ë³´ë‹ˆ ì•„ë˜ì™€ ê°™ì€ ë¡œê·¸ê°€ ì°í˜€ìˆì—ˆë‹¤.
```
2018-11-28 02:44:21.892Â  WARN 2135 --- [ool housekeeper] com.zaxxer.hikari.pool.HikariPoolÂ  Â  Â  Â  : api-dev-conn-pool - Thread starvation or clock leap detected (housekeeper delta=2h28s701ms).
2018-11-28 02:45:46.788Â  WARN 2135 --- [ool housekeeper] com.zaxxer.hikari.pool.HikariPoolÂ  Â  Â  Â  : api-dev-conn-pool - Thread starvation or clock leap detected (housekeeper delta=54s902ms).
2018-11-28 02:47:41.700Â  WARN 2135 --- [ool housekeeper] com.zaxxer.hikari.pool.HikariPoolÂ  Â  Â  Â  : api-dev-conn-pool - Thread starvation or clock leap detected (housekeeper delta=54s904ms).
2018-11-28 02:49:06.617Â  WARN 2135 --- [ool housekeeper] com.zaxxer.hikari.pool.HikariPoolÂ  Â  Â  Â  : api-dev-conn-pool - Thread starvation or clock leap detected (housekeeper delta=54s915ms).
2018-11-28 02:51:01.900Â  WARN 2135 --- [ool housekeeper] com.zaxxer.hikari.pool.HikariPoolÂ  Â  Â  Â  : api-dev-conn-pool - Thread starvation or clock leap detected (housekeeper delta=55s269ms).
2018-11-28 02:52:26.821Â  WARN 2135 --- [ool housekeeper] com.zaxxer.hikari.pool.HikariPoolÂ  Â  Â  Â  : api-dev-conn-pool - Thread starvation or clock leap detected (housekeeper delta=54s910ms).
2018-11-28 02:54:21.733Â  WARN 2135 --- [ool housekeeper] com.zaxxer.hikari.pool.HikariPoolÂ  Â  Â  Â  : api-dev-conn-pool - Thread starvation or clock leap detected (housekeeper delta=54s905ms).
2018-11-28 04:55:20.700Â  WARN 2135 --- [ool housekeeper] com.zaxxer.hikari.pool.HikariPoolÂ  Â  Â  Â  : api-dev-conn-pool - Thread starvation or clock leap detected (housekeeper delta=2h28s965ms).
```

êµ¬ê¸€ë§í•´ë³´ë‹ˆ 1. ë©íƒ‘ ê°™ì€ ê²½ìš° ì ë“¤ê¸° ëª¨ë“œì— ë“¤ì–´ê°€ë©´ ë°œìƒí•  ìˆ˜ ìˆë‹¤ëŠ” ê¸€ë„ ìˆì—ˆê³ , 2. `Connection`ì´ ë¶€ì¡±í•´ì„œ `Thread Starvation` ìƒí™©ì´ ë°œìƒí•œ ê²ƒì´ë¼ëŠ” ê¸€ë„ ìˆì—ˆë‹¤.<br>

ì •í™•í•œ ì´ìœ ëŠ” ëª¨ë¥´ì§€ë§Œ ë‘ ë²ˆì§¸ ìƒí™©ì´ë¼ê³  ê°€ì •í•˜ê³  í•´ê²°í•˜ì˜€ë‹¤.
> [HikarilCP](https://github.com/brettwooldridge/HikariCP/wiki/About-Pool-Sizing)ì—ì„œ ì œê³µí•˜ëŠ” ìµœì ì˜ Maximum Pool Sizeë¥¼ êµ¬í•˜ëŠ” ê³µì‹<br>
pool size = Tn x (Cm - 1) + 1

ìŠ¤í”„ë§ í”„ë¡œì íŠ¸ì˜ Threadìˆ˜ëŠ” 10ê°œì´ë‹¤. <br>
í•œ Threadê°€ ì‘ì—…ì„ í•˜ë©´ì„œ í•„ìš”ë¡œ í•˜ëŠ” Connectionì˜ ìˆ˜ëŠ” 2ê°œì´ë‹¤. <br>
ìœ„ ê³µì‹ì— ëŒ€ì…í•˜ë©´ ìš°ë¦¬ í”„ë¡œì íŠ¸ì˜ ìµœì  pool sizeëŠ” 10*(2-1)+1ë¡œ 11ê°œì´ë‹¤. <br>
11ê°œ ì´ìƒì˜ Connectionì„ ì œê³µí•˜ë©´ ì˜¤ë¥˜ê°€ í•´ê²°ë  ê²ƒì´ë‹¤.

# í•´ê²° ë°©ë²•
`application.yml`ì— ì•„ë˜ ì½”ë“œë¥¼ ì¶”ê°€í•˜ì—¬ `Connection`ì˜ ìˆ˜ë¥¼ ëŠ˜ë¦°ë‹¤.
```yml
spring:
  datasource:
    hikari:
      maximum-pool-size: 20
```

+) í•´ë‹¹ ì½”ë“œë¥¼ ì¶”ê°€í•´ë„ ê°™ì€ ë¡œê·¸ê°€ ì°íˆëŠ” ê²ƒì„ ë³´ë‹ˆ 1ë²ˆì´ ì´ìœ ì˜€ë˜ ê²ƒ ê°™ë‹¤.

# Ref.
- [https://velog.io/@mbsik6082/Thread-starvation-or-clock-leap-detected-Dead-Lock-hikari-%EC%98%A4%EB%A5%98](https://velog.io/@mbsik6082/Thread-starvation-or-clock-leap-detected-Dead-Lock-hikari-%EC%98%A4%EB%A5%98)
- [https://velog.io/@morningstar/server-bumb](https://velog.io/@morningstar/server-bumb)
- [https://namocom.tistory.com/592](https://namocom.tistory.com/592)

***
<br>

    ğŸ’› ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ğŸ‘»

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}