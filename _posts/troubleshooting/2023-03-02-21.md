---
title:  "[Trouble Shooting] Could not write JSON: Infinite recursion (StackOverflowError) í•´ê²° "

categories:
  - TroubleShooting
tags:
  - [TroubleShooting]

toc: true
toc_sticky: true
 
date: 2023-03-02 20:46:39
last_modified_at: 2023-03-02 20:46:42
---

## ë¬¸ì œ ìƒí™©
ìŠ¤í”„ë§ ê¸°ë°˜ API ì„œë²„ë¥¼ êµ¬í˜„ í”„ë¡œì íŠ¸ì—ì„œ Controller í…ŒìŠ¤íŠ¸ë¥¼ í•˜ëŠ” ë„ì¤‘ ì•„ë˜ì™€ ê°™ì€ ì—ëŸ¬ê°€ ë°œìƒí–ˆë‹¤.
```
nested exception is org.springframework.http.converter.HttpMessageNotWritableException: Could not write JSON: Infinite recursion (StackOverflowError); 
nested exception is com.fasterxml.jackson.databind.JsonMappingException: Infinite recursion (StackOverflowError)
```

## ë¬¸ì œ ì›ì¸
- JPA ì—°ê´€ê´€ê³„ì—ì„œ ì–‘ë°©í–¥ ë§¤í•‘ì„ ì„ ì–¸í•œ ê²½ìš° ë°œìƒ
- Jackson lib ì˜ ObjectMapper ê°ì²´ì— ì˜í•´ ì»¨íŠ¸ë¡¤ëŸ¬ ë‹¨ì—ì„œ JSON íƒ€ì…ì„ ë³€í™˜í•˜ëŠ” ë„ì¤‘ì— ë³€í™˜ë˜ëŠ” ì—”í‹°í‹°ì˜ í•„ë“œê°€ ë‹¤ë¥¸ ì—”í‹°í‹°ë¥¼ ì°¸ì¡°í•˜ê³  ê·¸ ì—”í‹°í‹° í´ë˜ìŠ¤ì˜ í•„ë“œê°€ ë˜ ë‹¤ë¥¸ ì—”í‹°í‹°ë¥¼ ì°¸ì¡°í•˜ê³  ... ë¬´í•œë£¨í”„

`Diary`ë¥¼ ë‹¨ê±´ ì¡°íšŒí•˜ëŠ” ê³¼ì •ì—ì„œ `DiaryDetailResDto` ì•ˆì— ì—”í‹°í‹° ìì²´ë¥¼ ì‘ë‹µ ê²°ê³¼ë¡œ ë¦¬í„´í•˜ë ¤ë‹¤ë³´ë‹ˆ ë°œìƒí•œ ì—ëŸ¬ì˜€ë‹¤.<br>
ì—”í‹°í‹° ìì²´ê°€ ì•„ë‹Œ, String íƒ€ì…ìœ¼ë¡œ ë¦¬í„´í•˜ë‹ˆ í•´ê²°ë˜ì—ˆë‹¤.<br><br>
(ë‘ ì—”í‹°í‹°ê°€ ì–‘ë°©í–¥ ì—°ê´€ ê´€ê³„ì— ë†“ì—¬ìˆì–´ JSONìœ¼ë¡œ í¬ë§·íŒ…í•˜ëŠ” ê³¼ì •ì—ì„œ ë¬´í•œ ìˆœí™˜ ì°¸ì¡°ê°€ ë˜ëŠ” ê²ƒì´ ì£¼ìš” ì›ì¸ì´ì—ˆë‹¤.)

 


## í•´ê²° ë°©ë²•
> [ì´ ê¸€](https://bellog.tistory.com/149)ê³¼ [ì´ ê¸€](https://pasudo123.tistory.com/350)ì„ ì°¸ê³ í–ˆë‹¤.

`DiaryDetailResDto` ë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ë³€ê²½í•˜ì˜€ë‹¤. (âœ… í‘œì‹œë¥¼ í™•ì¸í•˜ì!)<br><br>

ë³€ê²½ ì „
```java
@Getter
@Setter
@NoArgsConstructor
@AllArgsConstructor
@Slf4j
public class DiaryDetailResDto {

    private String title;
    private String content;
    private Pet pet; // âœ…
    private List<String> imgUrls = new ArrayList<>();
    private List<Stamp> stamps = new ArrayList<>(); // âœ…
    private LocalDate createdAt;

    public DiaryDetailResDto(Diary entity) {
        this.title = entity.getTitle();
        this.content = entity.getContent();
        this.pet = entity.getPet(); // âœ…

        for (DiaryImage image : entity.getImages()) {
            this.imgUrls.add(image.getImgUrl());
        }

        for (DiaryStamp diaryStamp : entity.getStamps()) {
            this.stamps.add(Stamp.getStamp(diaryStamp));
        } // âœ…

        this.createdAt = entity.getCreatedAt();
    }
}
```


ë³€ê²½ í›„
```java
@Getter
@Setter
@NoArgsConstructor
@AllArgsConstructor
@Slf4j
public class DiaryDetailResDto {

    private String title;
    private String content;
    private String petName; // âœ…
    private List<String> imgUrls = new ArrayList<>();
    private List<String> stampTypes = new ArrayList<>(); // âœ…
    private LocalDate createdAt;

    public DiaryDetailResDto(Diary entity) {
        this.title = entity.getTitle();
        this.content = entity.getContent();
        this.petName = entity.getPet().getPetName(); // âœ…

        for (DiaryImage image : entity.getImages()) {
            this.imgUrls.add(image.getImgUrl());
        }

        for (DiaryStamp diaryStamp : entity.getStamps()) {
            this.stampTypes.add(Stamp.getStamp(diaryStamp).getStampType().toString());
        } // âœ…

        this.createdAt = entity.getCreatedAt();
    }
}

```








***
<br>

    ğŸ’› ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ğŸ‘»

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}