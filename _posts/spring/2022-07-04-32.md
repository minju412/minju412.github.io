---
title:  "[SPRING] Bean Validation "

categories:
  - Spring
tags:
  - [Framework, Spring, Java]

toc: true
toc_sticky: true
 
date: 2022-07-04 13:11:44
last_modified_at: 2022-07-04 13:11:48
---

# ì†Œê°œ
ê²€ì¦ ê¸°ëŠ¥ì„ ì§€ê¸ˆì²˜ëŸ¼ ë§¤ë²ˆ ì½”ë“œë¡œ ì‘ì„±í•˜ëŠ” ê²ƒì€ ìƒë‹¹íˆ ë²ˆê±°ë¡­ë‹¤. <br>
íŠ¹íˆ íŠ¹ì • í•„ë“œì— ëŒ€í•œ ê²€ì¦ ë¡œì§ì€ ëŒ€ë¶€ë¶„ ë¹ˆ ê°’ì¸ì§€ ì•„ë‹Œì§€, íŠ¹ì • í¬ê¸°ë¥¼ ë„˜ëŠ”ì§€ ì•„ë‹Œì§€ì™€ ê°™ì´ ë§¤ìš° ì¼ë°˜ì ì¸ ë¡œì§ì´ë‹¤. <br><br>
ì´ëŸ° ê²€ì¦ ë¡œì§ì„ ëª¨ë“  í”„ë¡œì íŠ¸ì— ì ìš©í•  ìˆ˜ ìˆê²Œ ê³µí†µí™”í•˜ê³ , í‘œì¤€í™” í•œ ê²ƒì´ ë°”ë¡œ Bean Validation ì´ë‹¤.<br>
Bean Validationì„ ì˜ í™œìš©í•˜ë©´, ì• ë…¸í…Œì´ì…˜ í•˜ë‚˜ë¡œ ê²€ì¦ ë¡œì§ì„ ë§¤ìš° í¸ë¦¬í•˜ê²Œ ì ìš©í•  ìˆ˜ ìˆë‹¤.<br><br>
Bean Validation ì´ë€?<br>
ë¨¼ì € Bean Validationì€ ê²€ì¦ ì• ë…¸í…Œì´ì…˜ê³¼ ì—¬ëŸ¬ ì¸í„°í˜ì´ìŠ¤ì˜ ëª¨ìŒì´ë‹¤. <br>
Bean Validationì„ êµ¬í˜„í•œ ê¸°ìˆ ì¤‘ì— ì¼ë°˜ì ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” êµ¬í˜„ì²´ëŠ” í•˜ì´ë²„ë„¤ì´íŠ¸ Validatorì´ë‹¤. (ì´ë¦„ì´ í•˜ì´ë²„ë„¤ì´íŠ¸ê°€ ë¶™ì–´ì„œ ê·¸ë ‡ì§€ ORMê³¼ëŠ” ê´€ë ¨ì´ ì—†ë‹¤.)

> í•˜ì´ë²„ë„¤ì´íŠ¸ Validator ê´€ë ¨ ë§í¬<br>
- ê³µì‹ ì‚¬ì´íŠ¸: [http://hibernate.org/validator/](http://hibernate.org/validator/)
- ê³µì‹ ë©”ë‰´ì–¼: [https://docs.jboss.org/hibernate/validator/6.2/reference/en-US/html_single/](https://docs.jboss.org/hibernate/validator/6.2/reference/en-US/html_single/)
- ê²€ì¦ ì• ë…¸í…Œì´ì…˜ ëª¨ìŒ: [https://docs.jboss.org/hibernate/validator/6.2/reference/en-US/html_single/#validator-defineconstraints-spec](https://docs.jboss.org/hibernate/validator/6.2/reference/en-US/html_single/#validator-defineconstraints-spec)<br>
(`@Email` ë“±ë“± ë‹¤ì–‘í•œ ì• ë…¸í…Œì´ì…˜ ì¡´ì¬)

# ì¤€ë¹„
## Bean Validation ì˜ì¡´ê´€ê³„ ì¶”ê°€
Bean Validationì„ ì‚¬ìš©í•˜ë ¤ë©´ `build.gradle`ì—ì„œ ë‹¤ìŒ ì˜ì¡´ê´€ê³„ë¥¼ ì¶”ê°€í•´ì•¼ í•œë‹¤.
```
implementation 'org.springframework.boot:spring-boot-starter-validation'
```
`spring-boot-starter-validation` ì˜ì¡´ê´€ê³„ë¥¼ ì¶”ê°€í•˜ë©´ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì¶”ê°€ ëœë‹¤.

## Item - Bean Validation ì• ë…¸í…Œì´ì…˜ ì ìš©
`src/main/java/hello/itemservice/domain/item/Item`
```java
import org.hibernate.validator.constraints.Range;

import javax.validation.constraints.Max;
import javax.validation.constraints.NotBlank;
import javax.validation.constraints.NotNull;

@Data
public class Item {

    private Long id;

    @NotBlank(message = "ê³µë°±X")
    private String itemName;

    @NotNull
    @Range(min = 1000, max = 1000000)
    private Integer price;

    @NotNull
    @Max(9999)
    private Integer quantity;

    public Item() {
    }

    public Item(String itemName, Integer price, Integer quantity) {
        this.itemName = itemName;
        this.price = price;
        this.quantity = quantity;
    }
}
```

### ê²€ì¦ ì• ë…¸í…Œì´ì…˜
- `@NotBlank` : ë¹ˆê°’ + ê³µë°±ë§Œ ìˆëŠ” ê²½ìš°ë¥¼ í—ˆìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.
- `@NotNull` : null ì„ í—ˆìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.
- `@Range(min = 1000, max = 1000000)` : ë²”ìœ„ ì•ˆì˜ ê°’ì´ì–´ì•¼ í•œë‹¤. 
- `@Max(9999)` : ìµœëŒ€ 9999ê¹Œì§€ë§Œ í—ˆìš©í•œë‹¤.

# ğŸ¥œ Bean Validation - ìŠ¤í”„ë§ ì ìš©
## ì»¨íŠ¸ë¡¤ëŸ¬ - `ValidationItemControllerV3`
### `addItem()` 
```java
@Slf4j
@Controller
@RequestMapping("/validation/v3/items")
@RequiredArgsConstructor
public class ValidationItemControllerV3 {
    ...
    @PostMapping("/add")
    public String addItem(@Validated @ModelAttribute Item item, BindingResult bindingResult, RedirectAttributes redirectAttributes, Model model) {

        // ê²€ì¦ì— ì‹¤íŒ¨í•˜ë©´ ë‹¤ì‹œ ì…ë ¥ í¼ìœ¼ë¡œ
        if (bindingResult.hasErrors()){
            log.info("errors={}", bindingResult);
            return "validation/v3/addForm";
        }

        // ì„±ê³µ ë¡œì§
        Item savedItem = itemRepository.save(item);
        redirectAttributes.addAttribute("itemId", savedItem.getId());
        redirectAttributes.addAttribute("status", true);
        return "redirect:/validation/v3/items/{itemId}";
    }
...
}
```
ì‹¤í–‰í•´ë³´ë©´ ì• ë…¸í…Œì´ì…˜ ê¸°ë°˜ì˜ Bean Validationì´ ì •ìƒ ë™ì‘í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

> ì°¸ê³ <br>
íŠ¹ì • í•„ë“œì˜ ë²”ìœ„ë¥¼ ë„˜ì–´ì„œëŠ” ê²€ì¦(ê°€ê²© * ìˆ˜ëŸ‰ì˜ í•©ì€ 10,000ì› ì´ìƒ) ê¸°ëŠ¥ì´ ë¹ ì¡ŒëŠ”ë°, ì´ ë¶€ë¶„ì€ ì¡°ê¸ˆ ë’¤ì— ì„¤ëª…í•œë‹¤.

## ìŠ¤í”„ë§ MVCëŠ” ì–´ë–»ê²Œ Bean Validatorë¥¼ ì‚¬ìš©?
ìŠ¤í”„ë§ ë¶€íŠ¸ê°€ `spring-boot-starter-validation` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë„£ìœ¼ë©´ ìë™ìœ¼ë¡œ Bean Validatorë¥¼ ì¸ì§€í•˜ê³  ìŠ¤í”„ë§ì— í†µí•©í•œë‹¤.
## ìŠ¤í”„ë§ ë¶€íŠ¸ëŠ” ìë™ìœ¼ë¡œ ê¸€ë¡œë²Œ Validatorë¡œ ë“±ë¡í•œë‹¤.
`LocalValidatorFactoryBean` ì„ ê¸€ë¡œë²Œ Validatorë¡œ ë“±ë¡í•œë‹¤. <br>
ì´ `Validator`ëŠ” `@NotNull` ê°™ì€ ì• ë…¸í…Œì´ì…˜ì„ ë³´ê³  ê²€ì¦ì„ ìˆ˜í–‰í•œë‹¤. ì´ë ‡ê²Œ ê¸€ë¡œë²Œ `Validator`ê°€ ì ìš©ë˜ì–´ ìˆê¸° ë•Œë¬¸ì—, `@Valid` , `@Validated` ë§Œ ì ìš©í•˜ë©´ ëœë‹¤.<br>
ê²€ì¦ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´, `FieldError` , `ObjectError` ë¥¼ ìƒì„±í•´ì„œ `BindingResult` ì— ë‹´ì•„ì¤€ë‹¤.

## ê²€ì¦ ìˆœì„œ
1. `@ModelAttribute` ê°ê°ì˜ í•„ë“œì— íƒ€ì… ë³€í™˜ ì‹œë„ <br>1-1. ì„±ê³µí•˜ë©´ ë‹¤ìŒìœ¼ë¡œ<br>1-2. ì‹¤íŒ¨í•˜ë©´ `typeMismatch` ë¡œ `FieldError` ì¶”ê°€ 
2. Validator ì ìš©

## ë°”ì¸ë”©ì— ì„±ê³µí•œ í•„ë“œë§Œ Bean Validation ì ìš©
BeanValidatorëŠ” ë°”ì¸ë”©ì— ì‹¤íŒ¨í•œ í•„ë“œëŠ” BeanValidationì„ ì ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.<br>
ìƒê°í•´ë³´ë©´ íƒ€ì… ë³€í™˜ì— ì„±ê³µí•´ì„œ ë°”ì¸ë”©ì— ì„±ê³µí•œ í•„ë“œì—¬ì•¼ BeanValidation ì ìš©ì´ ì˜ë¯¸ ìˆë‹¤.<br> (ì¼ë‹¨ ëª¨ë¸ ê°ì²´ì— ë°”ì¸ë”© ë°›ëŠ” ê°’ì´ ì •ìƒìœ¼ë¡œ ë“¤ì–´ì™€ì•¼ ê²€ì¦ë„ ì˜ë¯¸ê°€ ìˆë‹¤.)<br><br>
`@ModelAttribute` ê°ê°ì˜ í•„ë“œ íƒ€ì… ë³€í™˜ì‹œë„ -> ë³€í™˜ì— ì„±ê³µí•œ í•„ë“œë§Œ BeanValidation ì ìš©<br><br>
ì˜ˆ)<br>
- `itemName` ì— ë¬¸ì "A" ì…ë ¥ íƒ€ì… ë³€í™˜ ì„±ê³µ `itemName` í•„ë“œì— BeanValidation ì ìš© 
- `price` ì— ë¬¸ì "A" ì…ë ¥ -> "A"ë¥¼ ìˆ«ì íƒ€ì… ë³€í™˜ ì‹œë„ ì‹¤íŒ¨ -> typeMismatch FieldError ì¶”ê°€ -> `price` í•„ë“œëŠ” BeanValidation ì ìš© X

# ğŸ¥œ Bean Validation - ì—ëŸ¬ ì½”ë“œ
Bean Validationì´ ê¸°ë³¸ìœ¼ë¡œ ì œê³µí•˜ëŠ” ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ ì¢€ ë” ìì„¸íˆ ë³€ê²½í•˜ê³  ì‹¶ìœ¼ë©´ ì–´ë–»ê²Œ í•˜ë©´ ë ê¹Œ?

## @NotBlank
- NotBlank.item.itemName 
- NotBlank.itemName 
- NotBlank.java.lang.String 
- NotBlank

## @Range
- Range.item.price 
- Range.price 
- Range.java.lang.Integer 
- Range

## `errors.properties` - ë©”ì‹œì§€ ë“±ë¡
ì´ì œ ë©”ì‹œì§€ë¥¼ ë“±ë¡í•´ë³´ì.
```
#Bean Validation ì¶”ê°€

NotBlank.item.itemName=ìƒí’ˆ ì´ë¦„ì„ ì ì–´ì£¼ì„¸ìš”.

NotBlank={0} ê³µë°±X
Range={0}, {2} ~ {1} í—ˆìš©
Max={0}, ìµœëŒ€ {1}
```
`NotBlank.item.itemName`ì²˜ëŸ¼ ì„¸ì„¸í•˜ê²Œ ì ìœ¼ë©´ ìš°ì„ ìˆœìœ„(Level)ê°€ ë†’ì•„ì§„ë‹¤.<br>
`{0}` ì€ í•„ë“œëª…ì´ê³ , `{1}` , `{2}` ...ì€ ê° ì• ë…¸í…Œì´ì…˜ ë§ˆë‹¤ ë‹¤ë¥´ë‹¤.

## BeanValidation ë©”ì‹œì§€ ì°¾ëŠ” ìˆœì„œ
1. ìƒì„±ëœ ë©”ì‹œì§€ ì½”ë“œ ìˆœì„œëŒ€ë¡œ `messageSource` ì—ì„œ ë©”ì‹œì§€ ì°¾ê¸°
2. ì• ë…¸í…Œì´ì…˜ì˜ `message` ì†ì„± ì‚¬ìš© -> `@NotBlank(message = "ê³µë°±! {0}") `
3. ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì œê³µí•˜ëŠ” ê¸°ë³¸ ê°’ ì‚¬ìš© -> ê³µë°±ì¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

# ğŸ¥œ Bean Validation - ì˜¤ë¸Œì íŠ¸ ì˜¤ë¥˜
Bean Validationì—ì„œ íŠ¹ì • í•„ë“œ( `FieldError` )ê°€ ì•„ë‹Œ í•´ë‹¹ ì˜¤ë¸Œì íŠ¸ ê´€ë ¨ ì˜¤ë¥˜( `ObjectError` )ëŠ” ì–´ë–»ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆì„ê¹Œ?<br>
ë‘ ê°€ì§€ ë°©ë²•ì´ ì¡´ì¬í•œë‹¤.
## 1) `@ScriptAssert`
`src/main/java/hello/itemservice/domain/item/Item`
```java
@Data
@ScriptAssert(lang = "javascript", script = "_this.price * _this.quantity >= 10000", message = "ì´ ê¸ˆì•¡ì´ 10000ì›ì´ ë„˜ë„ë¡ ì£¼ë¬¸í•´ì£¼ì„¸ìš”.") // ğŸŒŸ ì¶”ê°€
public class Item {

    private Long id;

    @NotBlank(message = "ê³µë°±X")
    private String itemName;

    @NotNull
    @Range(min = 1000, max = 1000000)
    private Integer price;

    @NotNull
    @Max(9999)
    private Integer quantity;

    public Item() {
    }

    public Item(String itemName, Integer price, Integer quantity) {
        this.itemName = itemName;
        this.price = price;
        this.quantity = quantity;
    }
}
```
ê·¸ëŸ°ë° ì‹¤ì œ ì‚¬ìš©í•´ë³´ë©´ ì œì•½ì´ ë§ê³  ë³µì¡í•˜ë‹¤. ê·¸ë¦¬ê³  ì‹¤ë¬´ì—ì„œëŠ” ê²€ì¦ ê¸°ëŠ¥ì´ í•´ë‹¹ ê°ì²´ì˜ ë²”ìœ„ë¥¼ ë„˜ì–´ì„œëŠ” ê²½ìš°ë“¤ë„ ì¢…ì¢… ë“±ì¥í•˜ëŠ”ë°, ê·¸ëŸ° ê²½ìš° ëŒ€ì‘ì´ ì–´ë µë‹¤.<br>
ë”°ë¼ì„œ ì˜¤ë¸Œì íŠ¸ ì˜¤ë¥˜(ê¸€ë¡œë²Œ ì˜¤ë¥˜)ì˜ ê²½ìš° `@ScriptAssert` ì„ ì–µì§€ë¡œ ì‚¬ìš©í•˜ëŠ” ê²ƒ ë³´ë‹¤ëŠ” ì•„ë˜ê³¼ ê°™ì´ ì˜¤ë¸Œì íŠ¸ ì˜¤ë¥˜ ê´€ë ¨ ë¶€ë¶„ë§Œ ì§ì ‘ ìë°” ì½”ë“œë¡œ ì‘ì„±í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•œë‹¤.


## 2) ìë°” ì½”ë“œë¡œ ì§ì ‘ ì‘ì„±
### ì»¨íŠ¸ë¡¤ëŸ¬ - `ValidationItemControllerV3`
#### `addItem()` - ì˜¤ë¸Œì íŠ¸ ì˜¤ë¥˜ ì¶”ê°€
```java
@Slf4j
@Controller
@RequestMapping("/validation/v3/items")
@RequiredArgsConstructor
public class ValidationItemControllerV3 {
    ...
    @PostMapping("/add")
    public String addItem(@Validated @ModelAttribute Item item, BindingResult bindingResult, RedirectAttributes redirectAttributes, Model model) {
         
        // ì˜¤ë¸Œì íŠ¸ ì˜¤ë¥˜ (ê¸€ë¡œë²Œ ì˜¤ë¥˜) ê²€ì¦ ğŸŒŸ
        if (item.getPrice()!=null && item.getQuantity()!=null){
            int resultPrice = item.getPrice() * item.getQuantity();
            if (resultPrice<10000){
                bindingResult.reject("totalPriceMin", new Object[]{10000, resultPrice}, null);
            }
        }

        // ê²€ì¦ì— ì‹¤íŒ¨í•˜ë©´ ë‹¤ì‹œ ì…ë ¥ í¼ìœ¼ë¡œ
        if (bindingResult.hasErrors()){
            log.info("errors={}", bindingResult);
            return "validation/v3/addForm";
        }

        // ì„±ê³µ ë¡œì§
        Item savedItem = itemRepository.save(item);
        redirectAttributes.addAttribute("itemId", savedItem.getId());
        redirectAttributes.addAttribute("status", true);
        return "redirect:/validation/v3/items/{itemId}";
    }
...
}
```

# ğŸ¥œ Bean Validation - í•œê³„
ë°ì´í„°ë¥¼ ë“±ë¡í•  ë•Œì™€ ìˆ˜ì •í•  ë•ŒëŠ” ìš”êµ¬ì‚¬í•­ì´ ë‹¤ë¥¼ ìˆ˜ ìˆë‹¤.<br><br>
ë“±ë¡ì‹œ ê¸°ì¡´ ìš”êµ¬ì‚¬í•­<br>
- íƒ€ì… ê²€ì¦<br>
â€¢ ê°€ê²©, ìˆ˜ëŸ‰ì— ë¬¸ìê°€ ë“¤ì–´ê°€ë©´ ê²€ì¦ ì˜¤ë¥˜ ì²˜ë¦¬
- í•„ë“œ ê²€ì¦<br>
â€¢ ìƒí’ˆëª…: í•„ìˆ˜, ê³µë°±X<br>
â€¢ ê°€ê²©: 1000ì› ì´ìƒ, 1ë°±ë§Œì› ì´í•˜<br>
â€¢ ìˆ˜ëŸ‰: ìµœëŒ€ 9999
- íŠ¹ì • í•„ë“œì˜ ë²”ìœ„ë¥¼ ë„˜ì–´ì„œëŠ” ê²€ì¦<br>
â€¢ ê°€ê²© * ìˆ˜ëŸ‰ì˜ í•©ì€ 10,000ì› ì´ìƒ<br><br>

ìˆ˜ì •ì‹œ ìš”êµ¬ì‚¬í•­<br>
- ë“±ë¡ì‹œì—ëŠ” `quantity` ìˆ˜ëŸ‰ì„ ìµœëŒ€ 9999ê¹Œì§€ ë“±ë¡í•  ìˆ˜ ìˆì§€ë§Œ ìˆ˜ì •ì‹œì—ëŠ” ìˆ˜ëŸ‰ì„ ë¬´ì œí•œìœ¼ë¡œ ë³€ê²½í•  ìˆ˜ ìˆë‹¤.
- ë“±ë¡ì‹œì—ëŠ” `id` ì— ê°’ì´ ì—†ì–´ë„ ë˜ì§€ë§Œ, ìˆ˜ì •ì‹œì—ëŠ” `id` ê°’ì´ í•„ìˆ˜ì´ë‹¤.

`item`ì— ìˆ˜ì • ìš”êµ¬ì‚¬í•­ì„ ì ìš©í•˜ë©´, ìˆ˜ì •ì€ ì˜ ë™ì‘í•˜ì§€ë§Œ ë“±ë¡ì—ì„œ ë¬¸ì œê°€ ë°œìƒí•œë‹¤.<br>
ë“±ë¡ì‹œì—ëŠ” id ì— ê°’ì´ ì—†ë‹¤. ë”°ë¼ì„œ `@NotNull` `id` ë¥¼ ì ìš©í•œ ê²ƒ ë•Œë¬¸ì— ê²€ì¦ì— ì‹¤íŒ¨í•˜ê³  ë‹¤ì‹œ í¼ í™”ë©´ìœ¼ë¡œ ë„˜ì–´ì˜¨ë‹¤. <br>
ë˜í•œ `quantity` ìˆ˜ëŸ‰ ì œí•œ ìµœëŒ€ ê°’ì¸ 9999ë„ ì ìš©ë˜ì§€ ì•ŠëŠ” ë¬¸ì œê°€ ë°œìƒí•œë‹¤.<br>
ê²°êµ­ ë“±ë¡ ìì²´ë„ ë¶ˆê°€ëŠ¥í•˜ê³ , ìˆ˜ëŸ‰ ì œí•œë„ ê±¸ì§€ ëª»í•œë‹¤.<br><br>
ê²°ê³¼ì ìœ¼ë¡œ `item` ì€ ë“±ë¡ê³¼ ìˆ˜ì •ì—ì„œ ê²€ì¦ ì¡°ê±´ì˜ ì¶©ëŒì´ ë°œìƒí•˜ê³ , ë“±ë¡ê³¼ ìˆ˜ì •ì€ ê°™ì€ `BeanValidation` ì„ ì ìš©í•  ìˆ˜ ì—†ë‹¤. <br>
ì´ ë¬¸ì œë¥¼ ì–´ë–»ê²Œ í•´ê²°í•  ìˆ˜ ìˆì„ê¹Œ?

# ğŸ¥œ Bean Validation - groups
ë™ì¼í•œ ëª¨ë¸ ê°ì²´ë¥¼ ë“±ë¡í•  ë•Œì™€ ìˆ˜ì •í•  ë•Œ ê°ê° ë‹¤ë¥´ê²Œ ê²€ì¦í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë³´ì.<br>
ë‘ ê°€ì§€ ë°©ë²•ì´ ì¡´ì¬í•œë‹¤.

## 1) BeanValidation groups ê¸°ëŠ¥ ì‚¬ìš©
ì´ëŸ° ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ Bean Validationì€ groupsë¼ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.<br>
ì˜ˆë¥¼ ë“¤ì–´ì„œ ë“±ë¡ì‹œì— ê²€ì¦í•  ê¸°ëŠ¥ê³¼ ìˆ˜ì •ì‹œì— ê²€ì¦í•  ê¸°ëŠ¥ì„ ê°ê° ê·¸ë£¹ìœ¼ë¡œ ë‚˜ëˆ„ì–´ ì ìš©í•  ìˆ˜ ìˆë‹¤.

### ì €ì¥ìš© groups ìƒì„± (ì¸í„°í˜ì´ìŠ¤)
`src/main/java/hello/itemservice/domain/item/SaveCheck`
```java
public interface SaveCheck {
}
```

### ìˆ˜ì •ìš© groups ìƒì„± (ì¸í„°í˜ì´ìŠ¤)
`src/main/java/hello/itemservice/domain/item/UpdateCheck`
```java
public interface UpdateCheck {
}
```

### `Item` - groups ì ìš©
`src/main/java/hello/itemservice/domain/item/Item`
```java
@Data
public class Item {

    @NotNull(groups = UpdateCheck.class) // ğŸŒŸ groups ì ìš©
    private Long id;

    @NotBlank(groups = {SaveCheck.class, UpdateCheck.class}) // ğŸŒŸ groups ì ìš©
    private String itemName;

    @NotNull(groups = {SaveCheck.class, UpdateCheck.class}) // ğŸŒŸ groups ì ìš©
    @Range(min = 1000, max = 1000000, groups = {SaveCheck.class, UpdateCheck.class}) // ğŸŒŸ groups ì ìš©
    private Integer price;

    @NotNull(groups = {SaveCheck.class, UpdateCheck.class}) // ğŸŒŸ groups ì ìš©
    @Max(value = 9999, groups = SaveCheck.class) // ğŸŒŸ groups ì ìš©
    private Integer quantity;

    public Item() {
    }

    public Item(String itemName, Integer price, Integer quantity) {
        this.itemName = itemName;
        this.price = price;
        this.quantity = quantity;
    }
}
```

### ì»¨íŠ¸ë¡¤ëŸ¬ - `ValidationItemControllerV3`
#### `addItemV2()` - groups ì ìš©
```java
@Slf4j
@Controller
@RequestMapping("/validation/v3/items")
@RequiredArgsConstructor
public class ValidationItemControllerV3 {
    ...
     @PostMapping("/add")
    public String addItemV2(@Validated(SaveCheck.class) @ModelAttribute Item item, BindingResult bindingResult, RedirectAttributes redirectAttributes) { // ğŸŒŸ groups ì ìš©

        // ì˜¤ë¸Œì íŠ¸ ì˜¤ë¥˜ (ê¸€ë¡œë²Œ ì˜¤ë¥˜) ê²€ì¦
        if (item.getPrice()!=null && item.getQuantity()!=null){
            int resultPrice = item.getPrice() * item.getQuantity();
            if (resultPrice<10000){
                bindingResult.reject("totalPriceMin", new Object[]{10000, resultPrice}, null);
            }
        }

        // ê²€ì¦ì— ì‹¤íŒ¨í•˜ë©´ ë‹¤ì‹œ ì…ë ¥ í¼ìœ¼ë¡œ
        if (bindingResult.hasErrors()){
            log.info("errors={}", bindingResult);
            return "validation/v3/addForm";
        }

        // ì„±ê³µ ë¡œì§
        Item savedItem = itemRepository.save(item);
        redirectAttributes.addAttribute("itemId", savedItem.getId());
        redirectAttributes.addAttribute("status", true);
        return "redirect:/validation/v3/items/{itemId}";
    }
...
}
```

#### `editV2()` - groups ì ìš©
```java
@Slf4j
@Controller
@RequestMapping("/validation/v3/items")
@RequiredArgsConstructor
public class ValidationItemControllerV3 {
    ...
    @PostMapping("/{itemId}/edit")
    public String editV2(@PathVariable Long itemId, @Validated(UpdateCheck.class) @ModelAttribute Item item, BindingResult bindingResult) { // ğŸŒŸ groups ì ìš©

        // ì˜¤ë¸Œì íŠ¸ ì˜¤ë¥˜ (ê¸€ë¡œë²Œ ì˜¤ë¥˜) ê²€ì¦
        if (item.getPrice()!=null && item.getQuantity()!=null){
            int resultPrice = item.getPrice() * item.getQuantity();
            if (resultPrice<10000){
                bindingResult.reject("totalPriceMin", new Object[]{10000, resultPrice}, null);
            }
        }

        // ê²€ì¦ì— ì‹¤íŒ¨í•˜ë©´ ë‹¤ì‹œ ì…ë ¥ í¼ìœ¼ë¡œ
        if (bindingResult.hasErrors()){
            log.info("errors={}", bindingResult);
            return "validation/v3/editForm";
        }

        itemRepository.update(itemId, item);
        return "redirect:/validation/v3/items/{itemId}";
    }
...
}
```

> ì°¸ê³ <br>
`@Valid` ì—ëŠ” groupsë¥¼ ì ìš©í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì´ ì—†ë‹¤. ë”°ë¼ì„œ groupsë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ `@Validated` ë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

groups ê¸°ëŠ¥ì„ ì‚¬ìš©í•´ì„œ ë“±ë¡ê³¼ ìˆ˜ì •ì‹œì— ê°ê° ë‹¤ë¥´ê²Œ ê²€ì¦ì„ í•  ìˆ˜ ìˆì—ˆë‹¤. <br>
ê·¸ëŸ°ë° groups ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ë‹ˆ `Item` ì€ ë¬¼ë¡ ì´ê³ , ì „ë°˜ì ìœ¼ë¡œ ë³µì¡ë„ê°€ ì˜¬ë¼ê°”ë‹¤.<br>
ì‚¬ì‹¤ groups ê¸°ëŠ¥ì€ ì‹¤ì œ ì˜ ì‚¬ìš©ë˜ì§€ëŠ” ì•ŠëŠ”ë°, ê·¸ ì´ìœ ëŠ” ì‹¤ë¬´ì—ì„œëŠ” ì£¼ë¡œ ë‹¤ìŒì— ë“±ì¥í•˜ëŠ” ë“±ë¡ìš© í¼ ê°ì²´ì™€ ìˆ˜ì •ìš© í¼ ê°ì²´ë¥¼ ë¶„ë¦¬í•´ì„œ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì´ë‹¤.


## 2) Form ì „ì†¡ ê°ì²´ ë¶„ë¦¬ 

### ì†Œê°œ
ë“±ë¡ì‹œ í¼ì—ì„œ ì „ë‹¬í•˜ëŠ” ë°ì´í„°ê°€ `Item` ë„ë©”ì¸ ê°ì²´ì™€ ë”± ë§ì§€ ì•Šê¸° ë•Œë¬¸ì— ì‹¤ë¬´ì—ì„œëŠ” groupsë¥¼ ì˜ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.<br>
ì‹¤ë¬´ì—ì„œëŠ” íšŒì› ë“±ë¡ì‹œ íšŒì›ê³¼ ê´€ë ¨ëœ ë°ì´í„°ë§Œ ì „ë‹¬ë°›ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ì•½ê´€ ì •ë³´ë„ ì¶”ê°€ë¡œ ë°›ëŠ” ë“± `Item` ê³¼ ê´€ê³„ì—†ëŠ” ìˆ˜ ë§ì€ ë¶€ê°€ ë°ì´í„°ê°€ ë„˜ì–´ì˜¨ë‹¤.<br>
ê·¸ë˜ì„œ ë³´í†µ `Item` ì„ ì§ì ‘ ì „ë‹¬ë°›ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ë³µì¡í•œ í¼ì˜ ë°ì´í„°ë¥¼ ì»¨íŠ¸ë¡¤ëŸ¬ê¹Œì§€ ì „ë‹¬í•  ë³„ë„ì˜ ê°ì²´ë¥¼ ë§Œë“¤ì–´ì„œ ì „ë‹¬í•œë‹¤.<br><br>
ì˜ˆë¥¼ ë“¤ë©´ `ItemSaveForm` ì´ë¼ëŠ” í¼ì„ ì „ë‹¬ë°›ëŠ” ì „ìš© ê°ì²´ë¥¼ ë§Œë“¤ì–´ì„œ `@ModelAttribute` ë¡œ ì‚¬ìš©í•œë‹¤. <br>
ì´ê²ƒì„ í†µí•´ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ í¼ ë°ì´í„°ë¥¼ ì „ë‹¬ ë°›ê³ , ì´í›„ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ í•„ìš”í•œ ë°ì´í„°ë¥¼ ì‚¬ìš©í•´ì„œ `Item` ì„ ìƒì„±í•œë‹¤.

#### í¼ ë°ì´í„° ì „ë‹¬ì— Item ë„ë©”ì¸ ê°ì²´ ì‚¬ìš©
`HTML Form -> Item -> Controller -> Item -> Repository`
- ì¥ì : Item ë„ë©”ì¸ ê°ì²´ë¥¼ ì»¨íŠ¸ë¡¤ëŸ¬, ë¦¬í¬ì§€í† ë¦¬ ê¹Œì§€ ì§ì ‘ ì „ë‹¬í•´ì„œ ì¤‘ê°„ì— `Item`ì„ ë§Œë“œëŠ” ê³¼ì •ì´ ì—†ì–´ì„œ ê°„ë‹¨í•˜ë‹¤.
- ë‹¨ì : ê°„ë‹¨í•œ ê²½ìš°ì—ë§Œ ì ìš©í•  ìˆ˜ ìˆë‹¤. ìˆ˜ì •ì‹œ ê²€ì¦ì´ ì¤‘ë³µë  ìˆ˜ ìˆê³ , groupsë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

#### í¼ ë°ì´í„° ì „ë‹¬ì„ ìœ„í•œ ë³„ë„ì˜ ê°ì²´ ì‚¬ìš©
`HTML Form -> ItemSaveForm -> Controller -> Item ìƒì„± -> Repository`
- ì¥ì : ì „ì†¡í•˜ëŠ” í¼ ë°ì´í„°ê°€ ë³µì¡í•´ë„ ê±°ê¸°ì— ë§ì¶˜ ë³„ë„ì˜ í¼ ê°ì²´ë¥¼ ì‚¬ìš©í•´ì„œ ë°ì´í„°ë¥¼ ì „ë‹¬ ë°›ì„ ìˆ˜ ìˆë‹¤. <br>
ë³´í†µ ë“±ë¡ê³¼, ìˆ˜ì •ìš©ìœ¼ë¡œ ë³„ë„ì˜ í¼ ê°ì²´ë¥¼ ë§Œë“¤ê¸° ë•Œë¬¸ì— ê²€ì¦ì´ ì¤‘ë³µë˜ì§€ ì•ŠëŠ”ë‹¤. 
- ë‹¨ì : í¼ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ `Item` ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ë³€í™˜ ê³¼ì •ì´ ì¶”ê°€ëœë‹¤.

Item ë„ë©”ì¸ ê°ì²´ë¥¼ í¼ ì „ë‹¬ ë°ì´í„°ë¡œ ì‚¬ìš©í•˜ê³ , ê·¸ëŒ€ë¡œ ì­‰ ë„˜ê¸°ë©´ í¸ë¦¬í•˜ê² ì§€ë§Œ, ì•ì—ì„œ ì„¤ëª…í•œ ê²ƒê³¼ ê°™ì´ ì‹¤ë¬´ì—ì„œëŠ” `Item` ì˜ ë°ì´í„°ë§Œ ë„˜ì–´ì˜¤ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ë¬´ìˆ˜í•œ ì¶”ê°€ ë°ì´í„°ê°€ ë„˜ì–´ì˜¨ë‹¤. <br>
ê·¸ë¦¬ê³  ë” ë‚˜ì•„ê°€ì„œ `Item` ì„ ìƒì„±í•˜ëŠ”ë° í•„ìš”í•œ ì¶”ê°€ ë°ì´í„°ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ë‚˜ ë‹¤ë¥¸ ê³³ì—ì„œ ì°¾ì•„ì™€ì•¼ í•  ìˆ˜ë„ ìˆë‹¤.<br>
ë”°ë¼ì„œ ì´ë ‡ê²Œ í¼ ë°ì´í„° ì „ë‹¬ì„ ìœ„í•œ ë³„ë„ì˜ ê°ì²´ë¥¼ ì‚¬ìš©í•˜ê³ , ë“±ë¡, ìˆ˜ì •ìš© í¼ ê°ì²´ë¥¼ ë‚˜ëˆ„ë©´ ë“±ë¡, ìˆ˜ì •ì´ ì™„ì „íˆ ë¶„ë¦¬ë˜ê¸° ë•Œë¬¸ì— groupsë¥¼ ì ìš©í•  ì¼ì€ ë“œë¬¼ë‹¤.

> Q. ì´ë¦„ì€ ì–´ë–»ê²Œ ì§€ì–´ì•¼ í•˜ë‚˜ìš”?<br>
ì´ë¦„ì€ ì˜ë¯¸ìˆê²Œ ì§€ìœ¼ë©´ ëœë‹¤. `ItemSave` ë¼ê³  í•´ë„ ë˜ê³ , `ItemSaveForm` , `ItemSaveRequest` , `ItemSaveDto` ë“±ìœ¼ë¡œ ì‚¬ìš©í•´ë„ ëœë‹¤. <br>
ì¤‘ìš”í•œ ê²ƒì€ ì¼ê´€ì„±ì´ë‹¤.

### ê°œë°œ
#### `Item` - ì›ë³µ
`src/main/java/hello/itemservice/domain/item/Item`
```java
@Data
public class Item {

    private Long id;
    private String itemName;
    private Integer price;
    private Integer quantity;

    public Item() {
    }

    public Item(String itemName, Integer price, Integer quantity) {
        this.itemName = itemName;
        this.price = price;
        this.quantity = quantity;
    }
}
```

#### `ItemSaveForm` - `item` ì €ì¥ìš© í¼
`src/main/java/hello/itemservice/web/validation/form/ItemSaveForm`
```java
@Data
public class ItemSaveForm {

    @NotBlank
    private String itemName;

    @NotNull
    @Range(min = 1000, max = 1000000)
    private Integer price;

    @NotNull
    @Max(9999)
    private Integer quantity;
}
```
#### `ItemUpdateForm` - `item` ìˆ˜ì •ìš© í¼
`src/main/java/hello/itemservice/web/validation/form/ItemUpdateForm`
```java
@Data
public class ItemUpdateForm {

    @NotNull
    private Long id;

    @NotBlank
    private String itemName;

    @NotNull
    @Range(min = 1000, max = 1000000)
    private Integer price;

    // ìˆ˜ì • ì‹œì—ëŠ” ìˆ˜ëŸ‰ì„ ììœ ë¡­ê²Œ ë³€ê²½í•  ìˆ˜ ìˆë‹¤.
    private Integer quantity;
}
```

#### ì»¨íŠ¸ë¡¤ëŸ¬ - `ValidationItemControllerV4`
##### `addItem()`
```java
@Slf4j
@Controller
@RequestMapping("/validation/v4/items")
@RequiredArgsConstructor
public class ValidationItemControllerV4 {
    ...
    @PostMapping("/add")
    public String addItem(@Validated @ModelAttribute("item") ItemSaveForm form, BindingResult bindingResult, RedirectAttributes redirectAttributes) { // ğŸŒŸ Item -> ItemServiceForm ë³€ê²½

        // ì˜¤ë¸Œì íŠ¸ ì˜¤ë¥˜ (ê¸€ë¡œë²Œ ì˜¤ë¥˜) ê²€ì¦
        if (form.getPrice()!=null && form.getQuantity()!=null){
            int resultPrice = form.getPrice() * form.getQuantity();
            if (resultPrice<10000){
                bindingResult.reject("totalPriceMin", new Object[]{10000, resultPrice}, null);
            }
        }

        // ê²€ì¦ì— ì‹¤íŒ¨í•˜ë©´ ë‹¤ì‹œ ì…ë ¥ í¼ìœ¼ë¡œ
        if (bindingResult.hasErrors()){
            log.info("errors={}", bindingResult);
            return "validation/v4/addForm";
        }

        // ì„±ê³µ ë¡œì§ 
        // ğŸŒŸ í¼ ê°ì²´ë¥¼ Itemìœ¼ë¡œ ë³€í™˜
        Item item = new Item();
        item.setItemName(form.getItemName());
        item.setPrice(form.getPrice());
        item.setQuantity(form.getQuantity());

        Item savedItem = itemRepository.save(item);
        redirectAttributes.addAttribute("itemId", savedItem.getId());
        redirectAttributes.addAttribute("status", true);
        return "redirect:/validation/v4/items/{itemId}";
    }
...
}
```
- `Item` ëŒ€ì‹ ì— `ItemSaveform` ì„ ì „ë‹¬ ë°›ëŠ”ë‹¤. ê·¸ë¦¬ê³ ` @Validated` ë¡œ ê²€ì¦ë„ ìˆ˜í–‰í•˜ê³ , `BindingResult`ë¡œ ê²€ì¦ ê²°ê³¼ë„ ë°›ëŠ”ë‹¤.<br>
- í¼ ê°ì²´ì˜ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ `Item` ê°ì²´ë¥¼ ìƒì„±í•œë‹¤. ì´ë ‡ê²Œ í¼ ê°ì²´ ì²˜ëŸ¼ ì¤‘ê°„ì— ë‹¤ë¥¸ ê°ì²´ê°€ ì¶”ê°€ë˜ë©´ ë³€í™˜í•˜ëŠ” ê³¼ì •ì´ ì¶”ê°€ëœë‹¤.

> ì£¼ì˜ ğŸš¨<br>
`@ModelAttribute("item")` ì— `item` ì´ë¦„ì„ ë„£ì–´ì¤€ ë¶€ë¶„ì„ ì£¼ì˜í•˜ì. <br>
ì´ê²ƒì„ ë„£ì§€ ì•Šìœ¼ë©´ `ItemSaveForm` ì˜ ê²½ìš° ê·œì¹™ì— ì˜í•´ `itemSaveForm` ì´ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ MVC Modelì— ë‹´ê¸°ê²Œ ëœë‹¤. <br>
ì´ë ‡ê²Œ ë˜ë©´ ë·° í…œí”Œë¦¿ì—ì„œ ì ‘ê·¼í•˜ëŠ” `th:object` ì´ë¦„ë„ í•¨ê»˜ ë³€ê²½í•´ì£¼ì–´ì•¼ í•œë‹¤.

##### `edit()`
```java
@Slf4j
@Controller
@RequestMapping("/validation/v4/items")
@RequiredArgsConstructor
public class ValidationItemControllerV4 {
    ...
    @PostMapping("/{itemId}/edit")
    public String edit(@PathVariable Long itemId, @Validated @ModelAttribute("item") ItemUpdateForm form, BindingResult bindingResult) { // ğŸŒŸ Item -> ItemUpdateForm ë³€ê²½

        // ì˜¤ë¸Œì íŠ¸ ì˜¤ë¥˜ (ê¸€ë¡œë²Œ ì˜¤ë¥˜) ê²€ì¦
        if (form.getPrice()!=null && form.getQuantity()!=null){
            int resultPrice = form.getPrice() * form.getQuantity();
            if (resultPrice<10000){
                bindingResult.reject("totalPriceMin", new Object[]{10000, resultPrice}, null);
            }
        }

        // ê²€ì¦ì— ì‹¤íŒ¨í•˜ë©´ ë‹¤ì‹œ ì…ë ¥ í¼ìœ¼ë¡œ
        if (bindingResult.hasErrors()){
            log.info("errors={}", bindingResult);
            return "validation/v4/editForm";
        }

        // ì„±ê³µ ë¡œì§ 
        // ğŸŒŸ í¼ ê°ì²´ë¥¼ Itemìœ¼ë¡œ ë³€í™˜
        Item itemParam = new Item();
        itemParam.setItemName(form.getItemName());
        itemParam.setPrice(form.getPrice());
        itemParam.setQuantity(form.getQuantity());

        itemRepository.update(itemId, itemParam);
        return "redirect:/validation/v4/items/{itemId}";
    }
...
}
```
- ìˆ˜ì •ì˜ ê²½ìš°ë„ ë“±ë¡ê³¼ ê°™ë‹¤. ê·¸ë¦¬ê³  í¼ ê°ì²´ë¥¼ `Item` ê°ì²´ë¡œ ë³€í™˜í•˜ëŠ” ê³¼ì •ì„ ê±°ì¹œë‹¤.

# ğŸ¥œ Bean Validation - HTTP ë©”ì‹œì§€ ì»¨ë²„í„°





















***
<br>

    ğŸ’› ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ğŸ‘»

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}