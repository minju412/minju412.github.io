---
title:  "[SPRING] Bean Validation "

categories:
  - Spring
tags:
  - [Framework, Spring, Java]

toc: true
toc_sticky: true
 
date: 2022-07-04 13:11:44
last_modified_at: 2022-07-04 13:11:48
---

# ì†Œê°œ
ê²€ì¦ ê¸°ëŠ¥ì„ ì§€ê¸ˆì²˜ëŸ¼ ë§¤ë²ˆ ì½”ë“œë¡œ ì‘ì„±í•˜ëŠ” ê²ƒì€ ìƒë‹¹íˆ ë²ˆê±°ë¡­ë‹¤. <br>
íŠ¹íˆ íŠ¹ì • í•„ë“œì— ëŒ€í•œ ê²€ì¦ ë¡œì§ì€ ëŒ€ë¶€ë¶„ ë¹ˆ ê°’ì¸ì§€ ì•„ë‹Œì§€, íŠ¹ì • í¬ê¸°ë¥¼ ë„˜ëŠ”ì§€ ì•„ë‹Œì§€ì™€ ê°™ì´ ë§¤ìš° ì¼ë°˜ì ì¸ ë¡œì§ì´ë‹¤. <br><br>
ì´ëŸ° ê²€ì¦ ë¡œì§ì„ ëª¨ë“  í”„ë¡œì íŠ¸ì— ì ìš©í•  ìˆ˜ ìˆê²Œ ê³µí†µí™”í•˜ê³ , í‘œì¤€í™” í•œ ê²ƒì´ ë°”ë¡œ Bean Validation ì´ë‹¤.<br>
Bean Validationì„ ì˜ í™œìš©í•˜ë©´, ì• ë…¸í…Œì´ì…˜ í•˜ë‚˜ë¡œ ê²€ì¦ ë¡œì§ì„ ë§¤ìš° í¸ë¦¬í•˜ê²Œ ì ìš©í•  ìˆ˜ ìˆë‹¤.<br><br>
Bean Validation ì´ë€?<br>
ë¨¼ì € Bean Validationì€ ê²€ì¦ ì• ë…¸í…Œì´ì…˜ê³¼ ì—¬ëŸ¬ ì¸í„°í˜ì´ìŠ¤ì˜ ëª¨ìŒì´ë‹¤. <br>
Bean Validationì„ êµ¬í˜„í•œ ê¸°ìˆ ì¤‘ì— ì¼ë°˜ì ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” êµ¬í˜„ì²´ëŠ” í•˜ì´ë²„ë„¤ì´íŠ¸ Validatorì´ë‹¤. (ì´ë¦„ì´ í•˜ì´ë²„ë„¤ì´íŠ¸ê°€ ë¶™ì–´ì„œ ê·¸ë ‡ì§€ ORMê³¼ëŠ” ê´€ë ¨ì´ ì—†ë‹¤.)

> í•˜ì´ë²„ë„¤ì´íŠ¸ Validator ê´€ë ¨ ë§í¬<br>
- ê³µì‹ ì‚¬ì´íŠ¸: [http://hibernate.org/validator/](http://hibernate.org/validator/)
- ê³µì‹ ë©”ë‰´ì–¼: [https://docs.jboss.org/hibernate/validator/6.2/reference/en-US/html_single/](https://docs.jboss.org/hibernate/validator/6.2/reference/en-US/html_single/)
- ê²€ì¦ ì• ë…¸í…Œì´ì…˜ ëª¨ìŒ: [https://docs.jboss.org/hibernate/validator/6.2/reference/en-US/html_single/#validator-defineconstraints-spec](https://docs.jboss.org/hibernate/validator/6.2/reference/en-US/html_single/#validator-defineconstraints-spec)<br>
(`@Email` ë“±ë“± ë‹¤ì–‘í•œ ì• ë…¸í…Œì´ì…˜ ì¡´ì¬)

# ì¤€ë¹„
## Bean Validation ì˜ì¡´ê´€ê³„ ì¶”ê°€
Bean Validationì„ ì‚¬ìš©í•˜ë ¤ë©´ `build.gradle`ì—ì„œ ë‹¤ìŒ ì˜ì¡´ê´€ê³„ë¥¼ ì¶”ê°€í•´ì•¼ í•œë‹¤.
```
implementation 'org.springframework.boot:spring-boot-starter-validation'
```
`spring-boot-starter-validation` ì˜ì¡´ê´€ê³„ë¥¼ ì¶”ê°€í•˜ë©´ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì¶”ê°€ ëœë‹¤.

## Item - Bean Validation ì• ë…¸í…Œì´ì…˜ ì ìš©
`src/main/java/hello/itemservice/domain/item/Item`
```java
import org.hibernate.validator.constraints.Range;

import javax.validation.constraints.Max;
import javax.validation.constraints.NotBlank;
import javax.validation.constraints.NotNull;

@Data
public class Item {

    private Long id;

    @NotBlank
    private String itemName;

    @NotNull
    @Range(min = 1000, max = 1000000)
    private Integer price;

    @NotNull
    @Max(9999)
    private Integer quantity;

    public Item() {
    }

    public Item(String itemName, Integer price, Integer quantity) {
        this.itemName = itemName;
        this.price = price;
        this.quantity = quantity;
    }
}
```

### ê²€ì¦ ì• ë…¸í…Œì´ì…˜
- `@NotBlank` : ë¹ˆê°’ + ê³µë°±ë§Œ ìˆëŠ” ê²½ìš°ë¥¼ í—ˆìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.
- `@NotNull` : null ì„ í—ˆìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.
- `@Range(min = 1000, max = 1000000)` : ë²”ìœ„ ì•ˆì˜ ê°’ì´ì–´ì•¼ í•œë‹¤. 
- `@Max(9999)` : ìµœëŒ€ 9999ê¹Œì§€ë§Œ í—ˆìš©í•œë‹¤.

# Bean Validation - ìŠ¤í”„ë§ ì ìš©
## ì»¨íŠ¸ë¡¤ëŸ¬ - `ValidationItemControllerV3`
### `addItem` 
```java
@Slf4j
@Controller
@RequestMapping("/validation/v3/items")
@RequiredArgsConstructor
public class ValidationItemControllerV3 {
    ...
    @PostMapping("/add")
    public String addItem(@Validated @ModelAttribute Item item, BindingResult bindingResult, RedirectAttributes redirectAttributes, Model model) {

        // ê²€ì¦ì— ì‹¤íŒ¨í•˜ë©´ ë‹¤ì‹œ ì…ë ¥ í¼ìœ¼ë¡œ
        if (bindingResult.hasErrors()){
            log.info("errors={}", bindingResult);
            return "validation/v3/addForm";
        }

        // ì„±ê³µ ë¡œì§
        Item savedItem = itemRepository.save(item);
        redirectAttributes.addAttribute("itemId", savedItem.getId());
        redirectAttributes.addAttribute("status", true);
        return "redirect:/validation/v3/items/{itemId}";
    }
...
}
```
ì‹¤í–‰í•´ë³´ë©´ ì• ë…¸í…Œì´ì…˜ ê¸°ë°˜ì˜ Bean Validationì´ ì •ìƒ ë™ì‘í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

> ì°¸ê³ <br>
íŠ¹ì • í•„ë“œì˜ ë²”ìœ„ë¥¼ ë„˜ì–´ì„œëŠ” ê²€ì¦(ê°€ê²© * ìˆ˜ëŸ‰ì˜ í•©ì€ 10,000ì› ì´ìƒ) ê¸°ëŠ¥ì´ ë¹ ì¡ŒëŠ”ë°, ì´ ë¶€ë¶„ì€ ì¡°ê¸ˆ ë’¤ì— ì„¤ëª…í•œë‹¤.

## ìŠ¤í”„ë§ MVCëŠ” ì–´ë–»ê²Œ Bean Validatorë¥¼ ì‚¬ìš©?
ìŠ¤í”„ë§ ë¶€íŠ¸ê°€ `spring-boot-starter-validation` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë„£ìœ¼ë©´ ìë™ìœ¼ë¡œ Bean Validatorë¥¼ ì¸ì§€í•˜ê³  ìŠ¤í”„ë§ì— í†µí•©í•œë‹¤.
## ìŠ¤í”„ë§ ë¶€íŠ¸ëŠ” ìë™ìœ¼ë¡œ ê¸€ë¡œë²Œ Validatorë¡œ ë“±ë¡í•œë‹¤.
`LocalValidatorFactoryBean` ì„ ê¸€ë¡œë²Œ Validatorë¡œ ë“±ë¡í•œë‹¤. <br>
ì´ `Validator`ëŠ” `@NotNull` ê°™ì€ ì• ë…¸í…Œì´ì…˜ì„ ë³´ê³  ê²€ì¦ì„ ìˆ˜í–‰í•œë‹¤. ì´ë ‡ê²Œ ê¸€ë¡œë²Œ `Validator`ê°€ ì ìš©ë˜ì–´ ìˆê¸° ë•Œë¬¸ì—, `@Valid` , `@Validated` ë§Œ ì ìš©í•˜ë©´ ëœë‹¤.<br>
ê²€ì¦ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´, `FieldError` , `ObjectError` ë¥¼ ìƒì„±í•´ì„œ `BindingResult` ì— ë‹´ì•„ì¤€ë‹¤.

## ê²€ì¦ ìˆœì„œ
1. `@ModelAttribute` ê°ê°ì˜ í•„ë“œì— íƒ€ì… ë³€í™˜ ì‹œë„ <br>1-1. ì„±ê³µí•˜ë©´ ë‹¤ìŒìœ¼ë¡œ<br>1-2. ì‹¤íŒ¨í•˜ë©´ `typeMismatch` ë¡œ `FieldError` ì¶”ê°€ 
2. Validator ì ìš©

## ë°”ì¸ë”©ì— ì„±ê³µí•œ í•„ë“œë§Œ Bean Validation ì ìš©
BeanValidatorëŠ” ë°”ì¸ë”©ì— ì‹¤íŒ¨í•œ í•„ë“œëŠ” BeanValidationì„ ì ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.<br>
ìƒê°í•´ë³´ë©´ íƒ€ì… ë³€í™˜ì— ì„±ê³µí•´ì„œ ë°”ì¸ë”©ì— ì„±ê³µí•œ í•„ë“œì—¬ì•¼ BeanValidation ì ìš©ì´ ì˜ë¯¸ ìˆë‹¤.<br> (ì¼ë‹¨ ëª¨ë¸ ê°ì²´ì— ë°”ì¸ë”© ë°›ëŠ” ê°’ì´ ì •ìƒìœ¼ë¡œ ë“¤ì–´ì™€ì•¼ ê²€ì¦ë„ ì˜ë¯¸ê°€ ìˆë‹¤.)<br><br>
`@ModelAttribute` ê°ê°ì˜ í•„ë“œ íƒ€ì… ë³€í™˜ì‹œë„ -> ë³€í™˜ì— ì„±ê³µí•œ í•„ë“œë§Œ BeanValidation ì ìš©<br><br>
ì˜ˆ)<br>
- `itemName` ì— ë¬¸ì "A" ì…ë ¥ íƒ€ì… ë³€í™˜ ì„±ê³µ `itemName` í•„ë“œì— BeanValidation ì ìš© 
- `price` ì— ë¬¸ì "A" ì…ë ¥ -> "A"ë¥¼ ìˆ«ì íƒ€ì… ë³€í™˜ ì‹œë„ ì‹¤íŒ¨ -> typeMismatch FieldError ì¶”ê°€ -> `price` í•„ë“œëŠ” BeanValidation ì ìš© X












***
<br>

    ğŸ’› ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ğŸ‘»

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}