---
title:  "[SPRING] JPA ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ - 1 "

categories:
  - Spring
tags:
  - [Framework, Spring, Java]

toc: true
toc_sticky: true
 
date: 2022-07-08 00:39:17
last_modified_at: 2022-07-08 00:39:20
---

# í”„ë¡œì íŠ¸ ìƒì„±
[https://start.spring.io/](https://start.spring.io/)ì—ì„œ ì•„ë˜ì™€ ê°™ì´ ì„¤ì •í•œ ë’¤ì— í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•œë‹¤.<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-07-08 á„‹á…©á„Œá…¥á†« 12 40 32](https://user-images.githubusercontent.com/59405576/177814850-765fefd9-19fb-4ee4-9c6d-29bcd781f0e8.png)

## `build.gradle` ë³€ê²½
ì•„ë˜ `build.gradle` ë‚´ìš©ì„ ê·¸ëŒ€ë¡œ ë³µì‚¬í•´ì„œ ì‚¬ìš©í•˜ì.
```
plugins {
	id 'org.springframework.boot' version '2.4.1'
	id 'io.spring.dependency-management' version '1.0.10.RELEASE'
	id 'java'
}

group = 'jpabook'
version = '0.0.1-SNAPSHOT'
sourceCompatibility = '11'

configurations {
	compileOnly {
		extendsFrom annotationProcessor
	}
}

repositories {
	mavenCentral()
}

dependencies {
	implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
	implementation 'org.springframework.boot:spring-boot-starter-validation'
	implementation 'org.springframework.boot:spring-boot-starter-thymeleaf'
	implementation 'org.springframework.boot:spring-boot-starter-web'

  implementation 'org.springframework.boot:spring-boot-devtools'
  implementation 'com.github.gavlyukovskiy:p6spy-spring-boot-starter:1.5.6'

	compileOnly 'org.projectlombok:lombok'
	runtimeOnly 'com.h2database:h2'

	annotationProcessor 'org.projectlombok:lombok'
	testImplementation 'org.springframework.boot:spring-boot-starter-test'

	//JUnit4 ì¶”ê°€
	testImplementation("org.junit.vintage:junit-vintage-engine") {
		exclude group: "org.hamcrest", module: "hamcrest-core"
	}
}

test {
	useJUnitPlatform()
}
```

### `spring-boot-devtools`
```
implementation 'org.springframework.boot:spring-boot-devtools'
```
`spring-boot-devtools` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì¶”ê°€í•˜ë©´, `html` íŒŒì¼ì„ ì»´íŒŒì¼ë§Œ í•´ì£¼ë©´ ì„œë²„ ì¬ì‹œì‘ ì—†ì´ View íŒŒì¼ ë³€ê²½ì´ ê°€ëŠ¥í•˜ë‹¤.<br>

> ì¸í…”ë¦¬J ì»´íŒŒì¼ ë°©ë²•<br>
ìƒë‹¨ë°” -> `Build` -> `Recompile ...`

### `p6spy-spring-boot-starter`
```
implementation 'com.github.gavlyukovskiy:p6spy-spring-boot-starter:1.5.6'
```
`p6spy-spring-boot-starter` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì¶”ê°€í•˜ë©´, ì•„ë˜ì™€ ê°™ì´ ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ì˜ ë¡œê·¸ë¥¼ ë‚¨ê¸¸ ìˆ˜ ìˆë‹¤.<br>
<img width="785" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-07-08 á„‹á…©á„Œá…¥á†« 2 35 28" src="https://user-images.githubusercontent.com/59405576/177835241-a170e26d-416f-4c93-a507-20d0ea5de47e.png">

> ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•œ ê²ƒì´ë‹¤.<br>
[https://github.com/gavlyukovskiy/spring-boot-data-source-decorator](https://github.com/gavlyukovskiy/spring-boot-data-source-decorator)

> ì°¸ê³ <br>
ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¥¼ ë¡œê·¸ë¡œ ë‚¨ê¸°ëŠ” ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ì‹œìŠ¤í…œ ìì›ì„ ì‚¬ìš©í•˜ë¯€ë¡œ, ê°œë°œ ë‹¨ê³„ì—ì„œëŠ” í¸í•˜ ê²Œ ì‚¬ìš©í•´ë„ ëœë‹¤. <br>
í•˜ì§€ë§Œ ìš´ì˜ì‹œìŠ¤í…œì— ì ìš©í•˜ë ¤ë©´ ê¼­ ì„±ëŠ¥í…ŒìŠ¤íŠ¸ë¥¼ í•˜ê³  ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.

## lombok ì ìš©
1. Prefrences -> plugin -> lombok ê²€ìƒ‰ ì‹¤í–‰ (ì¬ì‹œì‘)
2. Prefrences -> Annotation Processors ê²€ìƒ‰ -> Enable annotation processing ì²´í¬ (ì¬ì‹œì‘)

## IntelliJ Gradle ëŒ€ì‹ ì— ìë°” ì§ì ‘ ì‹¤í–‰
- Preferences -> Build, Execution, Deployment -> Build Tools -> Gradle (í˜¹ì€ `gradle` ê²€ìƒ‰)
- Build and run using: Gradle -> IntelliJ IDEA
- Run tests using: Gradle -> IntelliJ IDEA

# H2 ë°ì´í„°ë² ì´ìŠ¤ ì‚¬ìš©
H2 ë°ì´í„°ë² ì´ìŠ¤ëŠ” `Version 1.4.200`ì„ ì„¤ì¹˜í•´ì•¼í•œë‹¤.
## íŒŒì¼ ìƒì„± (ìµœì´ˆ í•œë²ˆ)
1. `JDBC URL`ì— `jdbc:h2:~/jpashop`ì„ ì…ë ¥í•œ ë’¤ ì—°ê²°í•œë‹¤.
2. `~/jpashop.mv.db` íŒŒì¼ì´ ìƒì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸í•œë‹¤. (í„°ë¯¸ë„ì˜ home(`~`)ì—ì„œ..)

## ì ‘ì†
ì´í›„ ë¶€í„°ëŠ” `JDBC URL`ì— `jdbc:h2:tcp://localhost/~/jpashop`ì„ ì…ë ¥í•˜ì—¬ ì—°ê²°í•œë‹¤.

# JPAì™€ DB ì„¤ì • & ë™ì‘ í™•ì¸
## `application.yml`
`main/resources/application.yml`
```
spring:
  datasource:
    url: jdbc:h2:tcp://localhost/~/jpashop
    username: sa
    password:
    driver-class-name: org.h2.Driver

  jpa:
    hibernate:
      ddl-auto: create
    properties:
      hibernate:
#        show_sql: true
        format_sql: true

logging.level:
  org.hibernate.SQL: debug
#  org.hibernate.type: trace
```
- `spring.jpa.hibernate.ddl-auto: create`<br>- ì´ ì˜µì…˜ì€ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ ì‹œì ì— í…Œì´ë¸”ì„ drop í•˜ê³ , ë‹¤ì‹œ ìƒì„±í•œë‹¤.

> ì°¸ê³ <br>
ëª¨ë“  ë¡œê·¸ ì¶œë ¥ì€ ê°€ê¸‰ì  ë¡œê±°ë¥¼ í†µí•´ ë‚¨ê²¨ì•¼ í•œë‹¤.
- `show_sql` : ì˜µì…˜ì€ `System.out` ì— í•˜ì´ë²„ë„¤ì´íŠ¸ ì‹¤í–‰ SQLì„ ë‚¨ê¸´ë‹¤.
- `org.hibernate.SQL` : ì˜µì…˜ì€ loggerë¥¼ í†µí•´ í•˜ì´ë²„ë„¤ì´íŠ¸ ì‹¤í–‰ SQLì„ ë‚¨ê¸´ë‹¤.

> ì£¼ì˜ ğŸš¨<br>
`application.yml` ê°™ì€ `yml` íŒŒì¼ì€ ë„ì–´ì“°ê¸°(ìŠ¤í˜ì´ìŠ¤) 2ì¹¸ìœ¼ë¡œ ê³„ì¸µì„ ë§Œë“ ë‹¤. <br>
ë”°ë¼ì„œ ë„ì–´ì“°ê¸°ë¥¼ ì£¼ì˜í•´ì•¼ í•œë‹¤!

## ë™ì‘ í™•ì¸

### íšŒì› ì—”í‹°í‹°
`src/main/java/jpabook/jpashop/Member.java`
```java
@Entity
@Getter @Setter
public class Member {

    @Id @GeneratedValue // ìë™ìœ¼ë¡œ ìƒì„±ëœë‹¤.
    private Long id;
    private String username;
}
```

### íšŒì› ë¦¬í¬ì§€í† ë¦¬
`src/main/java/jpabook/jpashop/MemberRepository.java`
```java
@Repository
public class MemberRepository {

    @PersistenceContext
    private EntityManager em;

    public Long save(Member member){
        em.persist(member);
        return member.getId();
    }

    public Member find(Long id){
        return em.find(Member.class, id);
    }
}
```

### í…ŒìŠ¤íŠ¸
`src/test/java/jpabook/jpashop/MemberRepositoryTest.java`
```java
@RunWith(SpringRunner.class)
@SpringBootTest
public class MemberRepositoryTest {

    @Autowired
    MemberRepository memberRepository;

    @Test
    @Transactional
    @Rollback(false)
    public void testMember() throws Exception {
        // given
        Member member = new Member();
        member.setUsername("memberA");

        // when
        Long savdId = memberRepository.save(member);
        Member findMember = memberRepository.find(savdId);

        // then
        assertThat(findMember.getId()).isEqualTo(member.getId());
        assertThat(findMember.getUsername()).isEqualTo(member.getUsername());
    }
}
```
í…ŒìŠ¤íŠ¸ ì½”ë“œì— `@Transactional` ì• ë…¸í…Œì´ì…˜ì„ ë¶™ì´ë©´ ìë™ìœ¼ë¡œ ë¡¤ë°±í•˜ê¸° ë•Œë¬¸ì— ë³€ê²½ ì‚¬í•­ì„ dbì—ì„œ í™•ì¸í•  ìˆ˜ ì—†ë‹¤.<br>
ë³€ê²½ ì‚¬í•­ì„ í™•ì¸í•˜ê¸° ìœ„í•´ì„œ `@Rollback(false)` ì• ë…¸í…Œì´ì…˜ì„ ë¶™ì˜€ë‹¤.

> ì£¼ì˜ ğŸš¨ <br>
`@Test`ëŠ” JUnit4ë¥¼ ì‚¬ìš©í•˜ë©´ `org.junit.Test`ë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤. <br>
ë§Œì•½ JUnit5 ë²„ì „ì„ ì‚¬ìš©í•˜ë©´ ê·¸ ê²ƒì— ë§ê²Œ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

#### `Live Templates` ìƒì„±
`tdd`ë¥¼ ì…ë ¥í•œ ë’¤ì— `tab`ì„ ëˆ„ë¥´ë©´ í…ŒìŠ¤íŠ¸ ì½”ë“œ í…œí”Œë¦¿ì´ ë‚˜ì˜¤ë„ë¡ ì»¤ìŠ¤í…€ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.

1. `Preference` -> `template` ê²€ìƒ‰ í›„ `Live Templates`ì„ í´ë¦­í•œë‹¤.<br>
(`Editor` -> `Code Style` -> `Live Templates`)
2. ìš°ì¸¡ì— `+`ë¥¼ í´ë¦­ -> `Template Group` ì„ íƒ
3. `custom` ì´ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ê·¸ë£¹ ìƒì„±
4. `custom`ì— ì»¤ì„œ ì˜¬ë¦¬ê³  `+` ë‹¤ì‹œ í´ë¦­ -> `Live Templates` ì„ íƒ
5. `<abbreviation>`ì— `tdd` ì…ë ¥ 
6. `Template text`ì— ì½”ë“œ ì‘ì„± (`Description`ì€ ì‘ì„±í•´ë„ ë˜ê³  ì•ˆí•´ë„ ëœë‹¤.)<br>
template text:
```java
@Test
public void $NAME$() throws Exception {
    // given
    $END$
    // when
    
    // then
}
```
7. ë§¨ í•˜ë‹¨ì—ì„œ `Define` í´ë¦­ í›„ `Java` ì „ì²´ë¥¼ ì„ íƒí•œë‹¤.

ì•„ë˜ì™€ ê°™ì´ ì„¤ì •í•˜ë©´ ëœë‹¤. <br>
<img width="968" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-07-08 á„‹á…©á„Œá…¥á†« 1 41 57" src="https://user-images.githubusercontent.com/59405576/177826359-78ec63b8-f6c4-4572-a3aa-9eb1984ba043.png">






***
<br>

    ğŸ’› ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ğŸ‘»

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}