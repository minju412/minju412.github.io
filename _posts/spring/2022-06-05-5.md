---
title:  "[SPRING] ì‹±ê¸€í†¤ íŒ¨í„´ê³¼ ì‹±ê¸€í†¤ ì»¨í…Œì´ë„ˆ"

categories:
  - Spring
tags:
  - [Framework, Spring, Java]

toc: true
toc_sticky: true
 
date: 2022-06-05 14:04:24
last_modified_at: 2022-06-05 14:04:28
---

# 1. ì‹±ê¸€í†¤ íŒ¨í„´
í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ê°€ ë”± 1ê°œë§Œ ìƒì„±ë˜ëŠ” ê²ƒì„ ë³´ì¥í•˜ëŠ” ë””ìì¸ íŒ¨í„´ì´ë‹¤.<br>
ê·¸ë˜ì„œ ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ 2ê°œ ì´ìƒ ìƒì„±í•˜ì§€ ëª»í•˜ë„ë¡ ë§‰ì•„ì•¼ í•œë‹¤. private ìƒì„±ìë¥¼ ì‚¬ìš©í•´ì„œ ì™¸ë¶€ì—ì„œ ì„ì˜ë¡œ new í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•˜ì§€ ëª»í•˜ë„ë¡ ë§‰ì•„ì•¼ í•œë‹¤.
## ì˜ˆì œ
```java
package hello.core.singleton;

public class SingletonService {

    private static final SingletonService instance = new SingletonService();

    public static SingletonService getInstance(){
        return instance;
    }

    private SingletonService() { // ë‹¤ë¥¸ í´ë˜ìŠ¤ì—ì„œ newë¡œ SingletonService ìƒì„±í•  ìˆ˜ ì—†ë„ë¡ private ì„ ì–¸
    }

    public void logic(){
        System.out.println("ì‹±ê¸€í†¤ ê°ì²´ ë¡œì§ í˜¸ì¶œ");
    }
}
```
1. static ì˜ì—­ì— ê°ì²´ instanceë¥¼ ë¯¸ë¦¬ í•˜ë‚˜ ìƒì„±í•´ì„œ ì˜¬ë ¤ë‘”ë‹¤.
2. ì´ ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ê°€ í•„ìš”í•˜ë©´ ì˜¤ì§ `getInstance()` ë©”ì„œë“œë¥¼ í†µí•´ì„œë§Œ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤. ì´ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ë©´ í•­ìƒ ê°™ì€ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°˜í™˜í•œë‹¤.
3. ë”± í•œ ê°œì˜ ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ë§Œ ì¡´ì¬í•´ì•¼ í•˜ë¯€ë¡œ, ìƒì„±ìë¥¼ privateìœ¼ë¡œ ë§‰ì•„ì„œ í˜¹ì‹œë¼ë„ ì™¸ë¶€ì—ì„œ new í‚¤ì›Œë“œë¡œ ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ê°€ ìƒì„±ë˜ëŠ” ê²ƒì„ ë§‰ëŠ”ë‹¤.

> ì°¸ê³ : ì‹±ê¸€í†¤ íŒ¨í„´ì„ êµ¬í˜„í•˜ëŠ” ë°©ë²•ì€ ì—¬ëŸ¬ê°€ì§€ê°€ ìˆë‹¤. ì—¬ê±°ì„œëŠ” ê°ì²´ë¥¼ ë¯¸ë¦¬ ìƒì„±í•´ë‘ëŠ” ê°€ì¥ ë‹¨ìˆœí•˜ê³  ì•ˆì „í•œ ë°©ë²•ì„ ì„ íƒí–ˆë‹¤.

## ì¥ì 
ì‹±ê¸€í†¤ íŒ¨í„´ì„ ì ìš©í•˜ë©´ ê³ ê°ì˜ ìš”ì²­ì´ ì˜¬ ë•Œ ë§ˆë‹¤ ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ì´ë¯¸ ë§Œë“¤ì–´ì§„ ê°ì²´ë¥¼ ê³µìœ í•´ì„œ íš¨ìœ¨ì ìœ¼ë¡œ ì‚¬ìš© í•  ìˆ˜ ìˆë‹¤. í•˜ì§€ë§Œ ì‹±ê¸€í†¤ íŒ¨í„´ì€ ìˆ˜ë§ì€ ë¬¸ì œì  ë˜í•œ ê°€ì§€ê³  ìˆë‹¤.

## ë¬¸ì œì 
1. ì‹±ê¸€í†¤ íŒ¨í„´ì„ êµ¬í˜„í•˜ëŠ” ì½”ë“œ ìì²´ê°€ ë§ì´ ë“¤ì–´ê°„ë‹¤.
2. ì˜ì¡´ê´€ê³„ìƒ í´ë¼ì´ì–¸íŠ¸ê°€ êµ¬ì²´ í´ë˜ìŠ¤ì— ì˜ì¡´í•œë‹¤. -> DIPë¥¼ ìœ„ë°˜í•œë‹¤.
3. í´ë¼ì´ì–¸íŠ¸ê°€ êµ¬ì²´ í´ë˜ìŠ¤ì— ì˜ì¡´í•´ì„œ OCP ì›ì¹™ì„ ìœ„ë°˜í•  ê°€ëŠ¥ì„±ì´ ë†’ë‹¤.
4. í…ŒìŠ¤íŠ¸í•˜ê¸° ì–´ë µë‹¤.
5. ë‚´ë¶€ ì†ì„±ì„ ë³€ê²½í•˜ê±°ë‚˜ ì´ˆê¸°í™” í•˜ê¸° ì–´ë µë‹¤.
6. private ìƒì„±ìë¡œ ìì‹ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ê¸° ì–´ë µë‹¤.
7. ê²°ë¡ ì ìœ¼ë¡œ ìœ ì—°ì„±ì´ ë–¨ì–´ì§„ë‹¤.
8. ì•ˆí‹°íŒ¨í„´ìœ¼ë¡œ ë¶ˆë¦¬ê¸°ë„ í•œë‹¤.

# 2. ì‹±ê¸€í†¤ ì»¨í…Œì´ë„ˆ
ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” ì‹±ê¸€í†¤ íŒ¨í„´ì˜ ë¬¸ì œì ì„ í•´ê²°í•˜ë©´ì„œ, ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‹±ê¸€í†¤(1ê°œë§Œ ìƒì„±)ìœ¼ë¡œ ê´€ë¦¬í•œë‹¤.
ì§€ê¸ˆê¹Œì§€ ìš°ë¦¬ê°€ í•™ìŠµí•œ ìŠ¤í”„ë§ ë¹ˆì´ ë°”ë¡œ ì‹±ê¸€í†¤ìœ¼ë¡œ ê´€ë¦¬ë˜ëŠ” ë¹ˆì´ë‹¤.

## ì‹±ê¸€í†¤ ì»¨í…Œì´ë„ˆ
- ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” ì‹±ê¸€í†¤ íŒ¨í„´ì„ ì ìš©í•˜ì§€ ì•Šì•„ë„, ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‹±ê¸€í†¤ìœ¼ë¡œ ê´€ë¦¬í•œë‹¤.
- ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” ì‹±ê¸€í†¤ ì»¨í…Œì´ë„ˆ ì—­í• ì„ í•œë‹¤. ì´ë ‡ê²Œ ì‹±ê¸€í†¤ ê°ì²´ë¥¼ ìƒì„±í•˜ê³  ê´€ë¦¬í•˜ëŠ” ê¸°ëŠ¥ì„ ì‹±ê¸€í†¤ ë ˆì§€ìŠ¤íŠ¸ë¦¬ë¼ í•œë‹¤.
- ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì˜ ì´ëŸ° ê¸°ëŠ¥ ë•ë¶„ì— ì‹±ê¸€í„´ íŒ¨í„´ì˜ ëª¨ë“  ë‹¨ì ì„ í•´ê²°í•˜ë©´ì„œ ê°ì²´ë¥¼ ì‹±ê¸€í†¤ìœ¼ë¡œ ìœ ì§€í•  ìˆ˜ ìˆë‹¤.

=> ì‹±ê¸€í†¤ íŒ¨í„´ì„ ìœ„í•œ ì§€ì €ë¶„í•œ ì½”ë“œê°€ ë“¤ì–´ê°€ì§€ ì•Šì•„ë„ ëœë‹¤.<br>
=> DIP, OCP, í…ŒìŠ¤íŠ¸, private ìƒì„±ìë¡œë¶€í„° ììœ ë¡­ê²Œ ì‹±ê¸€í†¤ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

## ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆë¥¼ ì‚¬ìš©í•˜ëŠ” í…ŒìŠ¤íŠ¸ ì½”ë“œ
```java
    @Test
    @DisplayName("ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì™€ ì‹±ê¸€í†¤")
    void springContainer(){
        ApplicationContext ac = new AnnotationConfigApplicationContext(AppConfig.class);

        // ì¡°íšŒ: í˜¸ì¶œí•  ë•Œ ë§ˆë‹¤ ê°™ì€ ê°ì²´ë¥¼ ë°˜í™˜
        MemberService memberService1 = ac.getBean("memberService", MemberService.class);
        MemberService memberService2 = ac.getBean("memberService", MemberService.class);

        // ì°¸ì¡°ê°’ì´ ê°™ì€ ê²ƒì„ í™•ì¸
        System.out.println("memberService1 = " + memberService1);
        System.out.println("memberService2 = " + memberService2);

        // memberService1 == memberService2
        assertThat(memberService1).isSameAs(memberService2);
    }
```

## ì‹±ê¸€í†¤ ì»¨í…Œì´ë„ˆ ì ìš© í›„
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-06-05 á„‹á…©á„’á…® 2 55 58](https://user-images.githubusercontent.com/59405576/172037431-9874847d-cf58-41b0-931c-bb271380082a.png)<br>
ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆ ë•ë¶„ì— ê³ ê°ì˜ ìš”ì²­ì´ ì˜¬ ë•Œ ë§ˆë‹¤ ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ì´ë¯¸ ë§Œë“¤ì–´ì§„ ê°ì²´ë¥¼ ê³µìœ í•´ì„œ íš¨ìœ¨ì ìœ¼ë¡œ ì¬ì‚¬ìš© í•  ìˆ˜ ìˆë‹¤.

> ì°¸ê³ : ìŠ¤í”„ë§ì˜ ê¸°ë³¸ ë¹ˆ ë“±ë¡ ë°©ì‹ì€ ì‹±ê¸€í†¤ì´ì§€ë§Œ, ì‹±ê¸€í†¤ ë°©ì‹ë§Œ ì§€ì›í•˜ëŠ” ê²ƒì€ ì•„ë‹ˆë‹¤. ìš”ì²­í•  ë•Œ ë§ˆë‹¤ ìƒˆë¡œìš´ ê°ì²´ë¥¼ ìƒì„±í•´ì„œ ë°˜í™˜í•˜ëŠ” ê¸°ëŠ¥ë„ ì œê³µí•œë‹¤. ìì„¸í•œ ë‚´ìš©ì€ ë¹ˆ ìŠ¤ì½”í”„ì—ì„œ ì„¤ëª…í•œë‹¤.

# 3. ì‹±ê¸€í†¤ ë°©ì‹ì˜ ì£¼ì˜ì 
ì‹±ê¸€í†¤ íŒ¨í„´ì´ë“ , ìŠ¤í”„ë§ ê°™ì€ ì‹±ê¸€í†¤ ì»¨í…Œì´ë„ˆë¥¼ ì‚¬ìš©í•˜ë“ , <br>ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ í•˜ë‚˜ë§Œ ìƒì„±í•´ì„œ ê³µìœ í•˜ëŠ” ì‹±ê¸€í†¤ ë°©ì‹ì€ ì—¬ëŸ¬ í´ë¼ì´ì–¸íŠ¸ê°€ í•˜ë‚˜ì˜ ê°™ì€ ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ê³µìœ í•˜ê¸° ë•Œë¬¸ì— ì‹±ê¸€í†¤ ê°ì²´ëŠ” ìƒíƒœë¥¼ ìœ ì§€(stateful)í•˜ê²Œ ì„¤ê³„í•˜ë©´ ì•ˆëœë‹¤.<br>
ì¦‰, ë¬´ìƒíƒœ(stateless)ë¡œ ì„¤ê³„í•´ì•¼í•œë‹¤!
- íŠ¹ì • í´ë¼ì´ì–¸íŠ¸ì— ì˜ì¡´ì ì¸ í•„ë“œê°€ ìˆìœ¼ë©´ ì•ˆëœë‹¤.
- íŠ¹ì • í´ë¼ì´ì–¸íŠ¸ê°€ ê°’ì„ ë³€ê²½í•  ìˆ˜ ìˆëŠ” í•„ë“œê°€ ìˆìœ¼ë©´ ì•ˆëœë‹¤.
- ê°€ê¸‰ì  ì½ê¸°ë§Œ ê°€ëŠ¥í•´ì•¼ í•œë‹¤.
- í•„ë“œ ëŒ€ì‹ ì— ìë°”ì—ì„œ ê³µìœ ë˜ì§€ ì•ŠëŠ” ì§€ì—­ë³€ìˆ˜, íŒŒë¼ë¯¸í„°, ThreadLocal ë“±ì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

ğŸš¨ ìŠ¤í”„ë§ ë¹ˆì˜ í•„ë“œì— ê³µìœ  ê°’ì„ ì„¤ì •í•˜ë©´ ì •ë§ í° ì¥ì• ê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤!!!

## ë¬¸ì œ ìƒí™©
`StatefulService.java`
```java
package hello.core.singleton;

public class StatefulService {

   private int price; // ìƒíƒœë¥¼ ìœ ì§€í•˜ëŠ” í•„ë“œ
   public void order(String name, int price){
       System.out.println("name = " + name + " | price = " + price);
       this.price = price; // ğŸš¨ íŠ¹ì • í´ë¼ì´ì–¸íŠ¸ê°€ ê°’ì„ ë³€ê²½í•  ìˆ˜ ìˆëŠ” í•„ë“œê°€ ìˆìœ¼ë©´ ì•ˆëœë‹¤!
   }

   public int getPrice(){
       return price;
   }
}
```

`StatefulServiceTest.java`
```java
package hello.core.singleton;

import org.junit.jupiter.api.Test;
import org.springframework.context.ApplicationContext;
import org.springframework.context.annotation.AnnotationConfigApplicationContext;
import org.springframework.context.annotation.Bean;

import static org.assertj.core.api.Assertions.*;

class StatefulServiceTest {

    @Test
    void statefulServiceSingleton(){
        ApplicationContext ac = new AnnotationConfigApplicationContext(TestConfig.class);
        StatefulService statefulService1 = ac.getBean(StatefulService.class);
        StatefulService statefulService2 = ac.getBean(StatefulService.class);

       /*
        ThreadA: ì‚¬ìš©ì Aê°€ 10000ì› ì£¼ë¬¸
        */
       statefulService1.order("userA", 10000);
       /*
        ThreadB: ì‚¬ìš©ì Bê°€ 20000ì› ì£¼ë¬¸ -> Aê°€ ì£¼ë¬¸í•˜ê³  ì¡°íšŒí•˜ëŠ” ì‚¬ì´ì— Bê°€ ë¼ì–´ë“  ìƒí™©!
        */
       statefulService2.order("userB", 20000);
       /*
        ThreadA: ì‚¬ìš©ì Aê°€ ì£¼ë¬¸ ê¸ˆì•¡ ì¡°íšŒ
        */
       int price = statefulService1.getPrice();
       System.out.println("price = " + price);
       assertThat(statefulService1.getPrice()).isEqualTo(20000); // statefulService1ì˜ priceê°€ 10000ì›ì´ ì•„ë‹Œ 20000ì›ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆë‹¤ğŸ¥µ
    }

    static class TestConfig{
        @Bean
        public StatefulService statefulService(){
            return new StatefulService();
        }
    }
}

```

## ë¬¸ì œ í•´ê²°

`StatefulService.java`
```java
package hello.core.singleton;

public class StatefulService {

    public int order(String name, int price){
        System.out.println("name = " + name + " | price = " + price);
        return price;
    }
}
```

`StatefulServiceTest.java`
```java
package hello.core.singleton;

import org.junit.jupiter.api.Test;
import org.springframework.context.ApplicationContext;
import org.springframework.context.annotation.AnnotationConfigApplicationContext;
import org.springframework.context.annotation.Bean;

import static org.assertj.core.api.Assertions.*;

class StatefulServiceTest {

    @Test
    void statefulServiceSingleton(){
        ApplicationContext ac = new AnnotationConfigApplicationContext(TestConfig.class);
        StatefulService statefulService1 = ac.getBean(StatefulService.class);
        StatefulService statefulService2 = ac.getBean(StatefulService.class);

        int userAPrice = statefulService1.order("userA", 10000);
        int userBPrice = statefulService2.order("userB", 20000);
        System.out.println("price = " + userAPrice);
        assertThat(userAPrice).isEqualTo(10000);
    }

    static class TestConfig{
        @Bean
        public StatefulService statefulService(){
            return new StatefulService();
        }
    }
}
```



***
<br>

    ğŸ’› ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ğŸ‘»

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}