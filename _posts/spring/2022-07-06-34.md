---
title:  "[SPRING] ë¡œê·¸ì¸ ì²˜ë¦¬ - 2. í•„í„°, ì¸í„°ì…‰í„° "

categories:
  - Spring
tags:
  - [Framework, Spring, Java]

toc: true
toc_sticky: true
 
date: 2022-07-06 14:49:08
last_modified_at: 2022-07-06 14:49:11
---

# ğŸˆ ì„œë¸”ë¦¿ í•„í„°
## 1. ì†Œê°œ
ìš”êµ¬ì‚¬í•­ì„ ë³´ë©´ ë¡œê·¸ì¸ í•œ ì‚¬ìš©ìë§Œ ìƒí’ˆ ê´€ë¦¬ í˜ì´ì§€ì— ë“¤ì–´ê°ˆ ìˆ˜ ìˆì–´ì•¼ í•œë‹¤.<br>
ë¬¸ì œëŠ” ë¡œê·¸ì¸ í•˜ì§€ ì•Šì€ ì‚¬ìš©ìë„ URLì„ ì§ì ‘ í˜¸ì¶œí•˜ë©´ ìƒí’ˆ ê´€ë¦¬ í™”ë©´ì— ë“¤ì–´ê°ˆ ìˆ˜ ìˆë‹¤ëŠ” ì ì´ë‹¤.

### ê³µí†µ ê´€ì‹¬ì‚¬
ìƒí’ˆ ê´€ë¦¬ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ë¡œê·¸ì¸ ì—¬ë¶€ë¥¼ ì²´í¬í•˜ëŠ” ë¡œì§ì„ í•˜ë‚˜í•˜ë‚˜ ì‘ì„±í•˜ë©´ ë˜ê² ì§€ë§Œ, ë“±ë¡, ìˆ˜ì •, ì‚­ì œ, ì¡°íšŒ ë“±ë“± ìƒí’ˆê´€ë¦¬ì˜ ëª¨ë“  ì»¨íŠ¸ë¡¤ëŸ¬ ë¡œì§ì— ê³µí†µìœ¼ë¡œ ë¡œê·¸ì¸ ì—¬ë¶€ë¥¼ í™•ì¸í•´ì•¼ í•œë‹¤. <br>
ë” í° ë¬¸ì œëŠ” í–¥í›„ ë¡œê·¸ì¸ê³¼ ê´€ë ¨ëœ ë¡œì§ì´ ë³€ê²½ë  ë•Œ ì´ë‹¤. ì‘ì„±í•œ ëª¨ë“  ë¡œì§ì„ ë‹¤ ìˆ˜ì •í•´ì•¼ í•  ìˆ˜ ìˆë‹¤.<br><br>
ì´ë ‡ê²Œ ì• í”Œë¦¬ì¼€ì´ì…˜ ì—¬ëŸ¬ ë¡œì§ì—ì„œ ê³µí†µìœ¼ë¡œ ê´€ì‹¬ì´ ìˆëŠ” ìˆëŠ” ê²ƒì„ ê³µí†µ ê´€ì‹¬ì‚¬(cross-cutting concern)ë¼ê³  í•œë‹¤. <br>
ì—¬ê¸°ì„œëŠ” ë“±ë¡, ìˆ˜ì •, ì‚­ì œ, ì¡°íšŒ ë“±ë“± ì—¬ëŸ¬ ë¡œì§ì—ì„œ ê³µí†µìœ¼ë¡œ ì¸ì¦ì— ëŒ€í•´ì„œ ê´€ì‹¬ì„ ê°€ì§€ê³  ìˆë‹¤.<br><br>
ì´ëŸ¬í•œ ê³µí†µ ê´€ì‹¬ì‚¬ëŠ” ìŠ¤í”„ë§ì˜ AOPë¡œë„ í•´ê²°í•  ìˆ˜ ìˆì§€ë§Œ, ì›¹ê³¼ ê´€ë ¨ëœ ê³µí†µ ê´€ì‹¬ì‚¬ëŠ” ì§€ê¸ˆë¶€í„° ì„¤ëª…í•  ì„œë¸”ë¦¿ í•„í„° ë˜ëŠ” ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤. <br>
ì›¹ê³¼ ê´€ë ¨ëœ ê³µí†µ ê´€ì‹¬ì‚¬ë¥¼ ì²˜ë¦¬í•  ë•ŒëŠ” HTTPì˜ í—¤ë”ë‚˜ URLì˜ ì •ë³´ë“¤ì´ í•„ìš”í•œë°, ì„œë¸”ë¦¿ í•„í„°ë‚˜ ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ëŠ” `HttpServletRequest` ë¥¼ ì œê³µí•œë‹¤.

### ì„œë¸”ë¦¿ í•„í„° ì†Œê°œ
í•„í„°ëŠ” ì„œë¸”ë¦¿ì´ ì§€ì›í•˜ëŠ” ìˆ˜ë¬¸ì¥ì´ë‹¤. í•„í„°ì˜ íŠ¹ì„±ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

#### í•„í„° íë¦„
```
HTTP ìš”ì²­ -> WAS -> í•„í„° -> ì„œë¸”ë¦¿ -> ì»¨íŠ¸ë¡¤ëŸ¬
```
í•„í„°ë¥¼ ì ìš©í•˜ë©´ í•„í„°ê°€ í˜¸ì¶œ ëœ ë‹¤ìŒì— ì„œë¸”ë¦¿ì´ í˜¸ì¶œëœë‹¤. ê·¸ë˜ì„œ ëª¨ë“  ê³ ê°ì˜ ìš”ì²­ ë¡œê·¸ë¥¼ ë‚¨ê¸°ëŠ” ìš”êµ¬ì‚¬í•­ì´ ìˆë‹¤ë©´ í•„í„°ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤. <br>
ì°¸ê³ ë¡œ í•„í„°ëŠ” íŠ¹ì • URL íŒ¨í„´ì— ì ìš©í•  ìˆ˜ ìˆë‹¤. `/*` ì´ë¼ê³  í•˜ë©´ ëª¨ë“  ìš”ì²­ì— í•„í„°ê°€ ì ìš©ëœë‹¤.<br>
(ì°¸ê³ ë¡œ ìŠ¤í”„ë§ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš° ì—¬ê¸°ì„œ ë§í•˜ëŠ” ì„œë¸”ë¦¿ì€ ìŠ¤í”„ë§ì˜ ë””ìŠ¤íŒ¨ì²˜ ì„œë¸”ë¦¿ìœ¼ë¡œ ìƒê°í•˜ë©´ ëœë‹¤.)

#### í•„í„° ì œí•œ
```
HTTP ìš”ì²­ -> WAS -> í•„í„° -> ì„œë¸”ë¦¿ -> ì»¨íŠ¸ë¡¤ëŸ¬ // ë¡œê·¸ì¸ ì‚¬ìš©ì
HTTP ìš”ì²­ -> WAS -> í•„í„° (ì ì ˆí•˜ì§€ ì•Šì€ ìš”ì²­ì´ë¼ íŒë‹¨, ì„œë¸”ë¦¿ í˜¸ì¶œX) // ë¹„ ë¡œê·¸ì¸ ì‚¬ìš©ì
```
í•„í„°ì—ì„œ ì ì ˆí•˜ì§€ ì•Šì€ ìš”ì²­ì´ë¼ê³  íŒë‹¨í•˜ë©´ ê±°ê¸°ì—ì„œ ëì„ ë‚¼ ìˆ˜ë„ ìˆë‹¤. ê·¸ë˜ì„œ ë¡œê·¸ì¸ ì—¬ë¶€ë¥¼ ì²´í¬í•˜ê¸°ì— ë”± ì¢‹ë‹¤.

#### í•„í„° ì²´ì¸
```
HTTP ìš”ì²­ -> WAS -> í•„í„°1-> í•„í„°2-> í•„í„°3-> ì„œë¸”ë¦¿ -> ì»¨íŠ¸ë¡¤ëŸ¬
```
í•„í„°ëŠ” ì²´ì¸ìœ¼ë¡œ êµ¬ì„±ë˜ëŠ”ë°, ì¤‘ê°„ì— í•„í„°ë¥¼ ììœ ë¡­ê²Œ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤. <br>
ì˜ˆë¥¼ ë“¤ì–´ì„œ ë¡œê·¸ë¥¼ ë‚¨ê¸°ëŠ” í•„í„°ë¥¼ ë¨¼ì € ì ìš©í•˜ê³ , ê·¸ ë‹¤ìŒì— ë¡œê·¸ì¸ ì—¬ë¶€ë¥¼ ì²´í¬í•˜ëŠ” í•„í„°ë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤.

#### í•„í„° ì¸í„°í˜ì´ìŠ¤
```java
public interface Filter {
      public default void init(FilterConfig filterConfig) throws ServletException {}
      public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException;
      public default void destroy() {}
}
```
í•„í„° ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ê³  ë“±ë¡í•˜ë©´ ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆê°€ í•„í„°ë¥¼ ì‹±ê¸€í†¤ ê°ì²´ë¡œ ìƒì„±í•˜ê³ , ê´€ë¦¬í•œë‹¤. 
- `init()`: í•„í„° ì´ˆê¸°í™” ë©”ì„œë“œ, ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆê°€ ìƒì„±ë  ë•Œ í˜¸ì¶œëœë‹¤.
- `doFilter()`: ê³ ê°ì˜ ìš”ì²­ì´ ì˜¬ ë•Œ ë§ˆë‹¤ í•´ë‹¹ ë©”ì„œë“œê°€ í˜¸ì¶œëœë‹¤. í•„í„°ì˜ ë¡œì§ì„ êµ¬í˜„í•˜ë©´ ëœë‹¤. 
- `destroy()`: í•„í„° ì¢…ë£Œ ë©”ì„œë“œ, ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆê°€ ì¢…ë£Œë  ë•Œ í˜¸ì¶œëœë‹¤.

## 2. ìš”ì²­ ë¡œê·¸
í•„í„°ê°€ ì •ë§ ìˆ˜ë¬¸ì¥ ì—­í• ì„ ì˜ í•˜ëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ ê°€ì¥ ë‹¨ìˆœí•œ í•„í„°ì¸, ëª¨ë“  ìš”ì²­ì„ ë¡œê·¸ë¡œ ë‚¨ê¸°ëŠ” í•„í„°ë¥¼ ê°œë°œí•˜ê³  ì ìš©í•´ë³´ì.

### ğŸ—‚ web
#### `LogFilter` - í•„í„° ìƒì„±
`src/main/java/hello/login/web/filter/LogFilter.java`
```java
import javax.servlet.Filter;

@Slf4j
public class LogFilter implements Filter {

    @Override
    public void init(FilterConfig filterConfig) throws ServletException {
        log.info("log filter init");
    }

    @Override
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException {
        log.info("log filter doFilter");

        HttpServletRequest httpRequest = (HttpServletRequest)request;
        String requestURI = httpRequest.getRequestURI();

        String uuid = UUID.randomUUID().toString();

        try{
            log.info("REQUEST [{}][{}]", uuid, requestURI);
            chain.doFilter(request, response);
        } catch(Exception e){
            throw e;
        } finally {
            log.info("RESPONSE [{}][{}]", uuid, requestURI);
        }

    }

    @Override
    public void destroy() {
        log.info("log filter destroy");
    }
}
```
- `public class LogFilter implements Filter {}`<br>
â€¢ í•„í„°ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ í•„í„° ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•´ì•¼ í•œë‹¤.
- `doFilter(ServletRequest request, ServletResponse response, FilterChain chain)`<br>
â€¢ HTTP ìš”ì²­ì´ ì˜¤ë©´ `doFilter` ê°€ í˜¸ì¶œëœë‹¤.<br>
â€¢ `ServletRequest request` ëŠ” HTTP ìš”ì²­ì´ ì•„ë‹Œ ê²½ìš°ê¹Œì§€ ê³ ë ¤í•´ì„œ ë§Œë“  ì¸í„°í˜ì´ìŠ¤ì´ë‹¤. HTTPë¥¼ ì‚¬ìš©í•˜ë©´ `HttpServletRequest httpRequest = (HttpServletRequest) request;` ì²˜ëŸ¼ ë‹¤ìš´ ì¼€ìŠ¤íŒ… í•˜ë©´ ëœë‹¤.
- `String uuid = UUID.randomUUID().toString();`<br>
â€¢ HTTP ìš”ì²­ì„ êµ¬ë¶„í•˜ê¸° ìœ„í•´ ìš”ì²­ë‹¹ ì„ì˜ì˜ `uuid` ë¥¼ ìƒì„±í•´ë‘”ë‹¤. 
- `log.info("REQUEST [{}][{}]", uuid, requestURI);`<br>
â€¢ `uuid` ì™€ `requestURI` ë¥¼ ì¶œë ¥í•œë‹¤.
- `chain.doFilter(request, response);`<br>
â€¢ ì´ ë¶€ë¶„ì´ ê°€ì¥ ì¤‘ìš”í•˜ë‹¤. ë‹¤ìŒ í•„í„°ê°€ ìˆìœ¼ë©´ í•„í„°ë¥¼ í˜¸ì¶œí•˜ê³ , í•„í„°ê°€ ì—†ìœ¼ë©´ ì„œë¸”ë¦¿ì„ í˜¸ì¶œí•œë‹¤. ë§Œì•½ ì´ ë¡œì§ì„ í˜¸ì¶œí•˜ì§€ ì•Šìœ¼ë©´ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì§„í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤.

### `WebConfig` - í•„í„° ë“±ë¡
`src/main/java/hello/login/WebConfig.java`
```java
@Configuration
public class WebConfig {

    @Bean
    public FilterRegistrationBean logFilter(){

        FilterRegistrationBean<Filter> filterRegistrationBean = new FilterRegistrationBean<>();

        filterRegistrationBean.setFilter(new LogFilter());
        filterRegistrationBean.setOrder(1);
        filterRegistrationBean.addUrlPatterns("/*");

        return filterRegistrationBean;
    }
}
```
í•„í„°ë¥¼ ë“±ë¡í•˜ëŠ” ë°©ë²•ì€ ì—¬ëŸ¬ê°€ì§€ê°€ ìˆì§€ë§Œ, ìŠ¤í”„ë§ ë¶€íŠ¸ë¥¼ ì‚¬ìš©í•œë‹¤ë©´ `FilterRegistrationBean` ì„ ì‚¬ìš©í•´ì„œ ë“±ë¡í•˜ë©´ ëœë‹¤.
- `setFilter(new LogFilter())` : ë“±ë¡í•  í•„í„°ë¥¼ ì§€ì •í•œë‹¤.
- `setOrder(1)` : í•„í„°ëŠ” ì²´ì¸ìœ¼ë¡œ ë™ì‘í•œë‹¤. ë”°ë¼ì„œ ìˆœì„œê°€ í•„ìš”í•˜ë‹¤. ë‚®ì„ ìˆ˜ë¡ ë¨¼ì € ë™ì‘í•œë‹¤. 
- `addUrlPatterns("/*")` : í•„í„°ë¥¼ ì ìš©í•  URL íŒ¨í„´ì„ ì§€ì •í•œë‹¤. í•œë²ˆì— ì—¬ëŸ¬ íŒ¨í„´ì„ ì§€ì •í•  ìˆ˜ ìˆë‹¤.

#### ì‹¤í–‰ ë¡œê·¸
```
hello.login.web.filter.LogFilter: REQUEST  [0a2249f2-cc70-4db4-98d1-492ccf5629dd][/items]
hello.login.web.filter.LogFilter: RESPONSE [0a2249f2-cc70-4db4-98d1-492ccf5629dd][/items]
```
í•„í„°ë¥¼ ë“±ë¡í•  ë•Œ `urlPattern` ì„ `/*` ë¡œ ë“±ë¡í–ˆê¸° ë•Œë¬¸ì— ëª¨ë“  ìš”ì²­ì— í•´ë‹¹ í•„í„°ê°€ ì ìš©ëœë‹¤.

> ì°¸ê³ <br>
ì‹¤ë¬´ì—ì„œ HTTP ìš”ì²­ì‹œ ê°™ì€ ìš”ì²­ì˜ ë¡œê·¸ì— ëª¨ë‘ ê°™ì€ ì‹ë³„ìë¥¼ ìë™ìœ¼ë¡œ ë‚¨ê¸°ëŠ” ë°©ë²•ì€ logback mdcë¡œ ê²€ìƒ‰í•´ë³´ì.

## 3. ì¸ì¦ ì²´í¬
ë¡œê·¸ì¸ ë˜ì§€ ì•Šì€ ì‚¬ìš©ìëŠ” ìƒí’ˆ ê´€ë¦¬ ë¿ë§Œ ì•„ë‹ˆë¼ ë¯¸ë˜ì— ê°œë°œë  í˜ì´ì§€ì—ë„ ì ‘ê·¼í•˜ì§€ ëª»í•˜ë„ë¡ í•˜ì.

### ğŸ—‚ web
#### `LoginCheckFilter` - í•„í„° ìƒì„±
`src/main/java/hello/login/web/filter/LogFiLoginCheckFilterlter.java`
```java
import javax.servlet.Filter;

@Slf4j
public class LoginCheckFilter implements Filter {

    // ì¸ì¦ì„ ì²´í¬í•˜ì§€ ì•Šì•„ë„ ë˜ëŠ” ê²½ë¡œ
    private static final String[] whilelist = { "/", "/members/add", "/login", "/logout", "/css/*" };

    @Override
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException {

        HttpServletRequest httpRequest = (HttpServletRequest) request;
        String requestURI = httpRequest.getRequestURI();

        HttpServletResponse httpResponse = (HttpServletResponse) response;

        try {
            log.info("ì¸ì¦ ì²´í¬ í•„í„° ì‹œì‘ {}", requestURI);

            if(isLoginCheckPath(requestURI)){ // ì¸ì¦ì„ ì²´í¬í•´ì•¼í•˜ëŠ” ê²½ë¡œë¼ë©´...
                log.info("ì¸ì¦ ì²´í¬ ë¡œì§ ì‹¤í–‰ {}", requestURI);

                HttpSession session = httpRequest.getSession(false);

                if(session == null || session.getAttribute(SessionConst.LOGIN_MEMBER) == null){
                    log.info("ë¯¸ì¸ì¦ ì‚¬ìš©ì ìš”ì²­ {}", requestURI);

                    // ë¡œê·¸ì¸ìœ¼ë¡œ redirect
                    httpResponse.sendRedirect("/login?redirectURL=" + requestURI); // ë¡œê·¸ì¸ ì„±ê³µí•˜ë©´ ì´ì „ì— ë³´ê³ ìˆë˜ í˜ì´ì§€ë¡œ ì´ë™

                    return; // ì—¬ê¸°ê°€ ì¤‘ìš”, ë¯¸ì¸ì¦ ì‚¬ìš©ìëŠ” ë‹¤ìŒìœ¼ë¡œ ì§„í–‰í•˜ì§€ ì•Šê³  ë
                }
            }

            chain.doFilter(request, response);

        } catch (Exception e) {
            throw e; // ì˜ˆì™¸ë¥¼ ë¡œê¹…í•  ìˆ˜ ìˆì§€ë§Œ, í†°ìº£ê¹Œì§€ ì˜ˆì™¸ë¥¼ ë³´ë‚´ì£¼ì–´ì•¼ í•¨
        } finally {
            log.info("ì¸ì¦ ì²´í¬ í•„í„° ì¢…ë£Œ {}", requestURI);
        }
    }

    /**
     * í™”ì´íŠ¸ ë¦¬ìŠ¤íŠ¸ì˜ ê²½ìš° ì¸ì¦ ì²´í¬ë¥¼ í•˜ì§€ ì•ŠëŠ”ë‹¤.
     */
    private boolean isLoginCheckPath(String requestURI){
        return !PatternMatchUtils.simpleMatch(whilelist, requestURI); // í™”ì´íŠ¸ ë¦¬ìŠ¤íŠ¸ê°€ ì•„ë‹ˆë¼ë©´ (=ì¸ì¦ì„ ì²´í¬í•´ì•¼ í•œë‹¤ë©´) true ë°˜í™˜
    }

}
```
- `whitelist = {"/", "/members/add", "/login", "/logout","/css/*"};`<br>
ì¸ì¦ í•„í„°ë¥¼ ì ìš©í•´ë„ í™ˆ, íšŒì›ê°€ì…, ë¡œê·¸ì¸ í™”ë©´, css ê°™ì€ ë¦¬ì†ŒìŠ¤ì—ëŠ” ì ‘ê·¼í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤. <br>
ì´ë ‡ê²Œ í™”ì´íŠ¸ ë¦¬ìŠ¤íŠ¸ ê²½ë¡œëŠ” ì¸ì¦ê³¼ ë¬´ê´€í•˜ê²Œ í•­ìƒ í—ˆìš©í•œë‹¤. <br>
í™”ì´íŠ¸ ë¦¬ìŠ¤íŠ¸ë¥¼ ì œì™¸í•œ ë‚˜ë¨¸ì§€ ëª¨ë“  ê²½ë¡œì—ëŠ” ì¸ì¦ ì²´í¬ ë¡œì§ì„ ì ìš©í•œë‹¤.

- `isLoginCheckPath(requestURI)`<br>
í™”ì´íŠ¸ ë¦¬ìŠ¤íŠ¸ë¥¼ ì œì™¸í•œ ëª¨ë“  ê²½ìš°ì— ì¸ì¦ ì²´í¬ ë¡œì§ì„ ì ìš©í•œë‹¤. 

- `httpResponse.sendRedirect("/login?redirectURL=" + requestURI);`<br>
ë¯¸ì¸ì¦ ì‚¬ìš©ìëŠ” ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ í•œë‹¤. <br>
ê·¸ëŸ°ë° ë¡œê·¸ì¸ ì´í›„ì— ë‹¤ì‹œ í™ˆìœ¼ë¡œ ì´ë™í•´ë²„ë¦¬ë©´, ì›í•˜ëŠ” ê²½ë¡œë¥¼ ë‹¤ì‹œ ì°¾ì•„ê°€ì•¼ í•˜ëŠ” ë¶ˆí¸í•¨ì´ ìˆë‹¤. <br>
ì˜ˆë¥¼ ë“¤ì–´ì„œ ìƒí’ˆ ê´€ë¦¬ í™”ë©´ì„ ë³´ë ¤ê³  ë“¤ì–´ê°”ë‹¤ê°€ ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™í•˜ë©´, ë¡œê·¸ì¸ ì´í›„ì— ë‹¤ì‹œ ìƒí’ˆ ê´€ë¦¬ í™”ë©´ìœ¼ë¡œ ë“¤ì–´ê°€ëŠ” ê²ƒì´ ì¢‹ë‹¤. <br>
ì´ëŸ° ë¶€ë¶„ì´ ê°œë°œì ì…ì¥ì—ì„œëŠ” ì¢€ ê·€ì°®ì„ ìˆ˜ ìˆì–´ë„ ì‚¬ìš©ì ì…ì¥ìœ¼ë¡œ ë³´ë©´ í¸ë¦¬í•œ ê¸°ëŠ¥ì´ë‹¤. ì´ëŸ¬í•œ ê¸°ëŠ¥ì„ ìœ„í•´ í˜„ì¬ ìš”ì²­í•œ ê²½ë¡œì¸ `requestURI` ë¥¼ `/login` ì— ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¡œ í•¨ê»˜ ì „ë‹¬í•œë‹¤. <br>
ë¬¼ë¡  `/login` ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ë¡œê·¸ì¸ ì„±ê³µì‹œ í•´ë‹¹ ê²½ë¡œë¡œ ì´ë™í•˜ëŠ” ê¸°ëŠ¥ì€ ì¶”ê°€ë¡œ ê°œë°œí•´ì•¼ í•œë‹¤.

- `return;` <br>
ì—¬ê¸°ê°€ ì¤‘ìš”í•˜ë‹¤. í•„í„°ë¥¼ ë”ëŠ” ì§„í–‰í•˜ì§€ ì•ŠëŠ”ë‹¤. ì´í›„ í•„í„°ëŠ” ë¬¼ë¡  ì„œë¸”ë¦¿, ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ë”ëŠ” í˜¸ì¶œë˜ì§€ ì•ŠëŠ”ë‹¤. <br>
ì•ì„œ `redirect` ë¥¼ ì‚¬ìš©í–ˆê¸° ë•Œë¬¸ì— `redirect` ê°€ ì‘ë‹µìœ¼ë¡œ ì ìš©ë˜ê³  ìš”ì²­ì´ ëë‚œë‹¤.

### `WebConfig` - `loginCheckFilter()` ì¶”ê°€
`src/main/java/hello/login/WebConfig.java`
```java
@Configuration
public class WebConfig {
    ...
    @Bean
    public FilterRegistrationBean loginCheckFilter(){

        FilterRegistrationBean<Filter> filterRegistrationBean = new FilterRegistrationBean<>();

        filterRegistrationBean.setFilter(new LoginCheckFilter());
        filterRegistrationBean.setOrder(2);
        filterRegistrationBean.addUrlPatterns("/*"); // í•„í„° ì•ˆì— ì •ì˜ëœ isLoginCheckPath()ë¥¼ í†µí•´ (ì¸ì¦ì´ í•„ìš” ì—†ëŠ”) í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ëŠ” ê±¸ëŸ¬ì§„ë‹¤.

        return filterRegistrationBean;
    }
}
```
- `setFilter(new LoginCheckFilter())` : ë¡œê·¸ì¸ í•„í„°ë¥¼ ë“±ë¡í•œë‹¤. 
- `setOrder(2)` : ìˆœì„œë¥¼ 2ë²ˆìœ¼ë¡œ ì¡ì•˜ë‹¤. ë¡œê·¸ í•„í„° ë‹¤ìŒì— ë¡œê·¸ì¸ í•„í„°ê°€ ì ìš©ëœë‹¤. 
- `addUrlPatterns("/*")` : ëª¨ë“  ìš”ì²­ì— ë¡œê·¸ì¸ í•„í„°ë¥¼ ì ìš©í•œë‹¤.

### ğŸ—‚ web
#### `LoginController`
ë¡œê·¸ì¸ì— ì„±ê³µí•˜ë©´ ì²˜ìŒ ìš”ì²­í•œ URLë¡œ ì´ë™í•˜ëŠ” ê¸°ëŠ¥ì„ ê°œë°œí•´ë³´ì.<br>
`src/main/java/hello/login/web/login/LoginController.java`
```java
@Slf4j
@Controller
@RequiredArgsConstructor
public class LoginController {

    private final LoginService loginService;

    @PostMapping("/login")
    public String loginV4(@Valid @ModelAttribute LoginForm form, BindingResult bindingResult,
                          @RequestParam(defaultValue = "/") String redirectURL, // ğŸŒŸ redirectURLì„ ë°›ì•„ì˜¨ë‹¤.
                          HttpServletRequest req){
        if(bindingResult.hasErrors()){
            return "login/loginForm";
        }

        Member loginMember = loginService.login(form.getLoginId(), form.getPassword());

        if(loginMember==null){
            bindingResult.reject("loginFail", "ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ë§ì§€ ì•ŠìŠµë‹ˆë‹¤.");
            return "login/loginForm";
        }

        // ë¡œê·¸ì¸ ì„±ê³µ ì²˜ë¦¬
        HttpSession session = req.getSession();  // ì„¸ì…˜ì´ ìˆìœ¼ë©´ ìˆëŠ” ì„¸ì…˜ì„ ë°˜í™˜, ì—†ìœ¼ë©´ ì‹ ê·œ ì„¸ì…˜ì„ ìƒì„±í•´ì„œ ë°˜í™˜
        session.setAttribute(SessionConst.LOGIN_MEMBER, loginMember); // ì„¸ì…˜ì— ë¡œê·¸ì¸ íšŒì› ì •ë³´ ë³´ê´€

        return "redirect:" + redirectURL; // ğŸŒŸ ë¡œê·¸ì¸ ì„±ê³µí•˜ë©´ ì´ì „ì— ë³´ê³ ìˆë˜ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
    }
}
```
ë¡œê·¸ì¸ ì²´í¬ í•„í„°ì—ì„œ, ë¯¸ì¸ì¦ ì‚¬ìš©ìëŠ” ìš”ì²­ ê²½ë¡œë¥¼ í¬í•¨í•´ì„œ `/login` ì— `redirectURL` ìš”ì²­ íŒŒë¼ë¯¸í„°ë¥¼ ì¶”ê°€í•´ì„œ ìš”ì²­í–ˆë‹¤. <br>
ì´ ê°’ì„ ì‚¬ìš©í•´ì„œ ë¡œê·¸ì¸ ì„±ê³µì‹œ í•´ë‹¹ ê²½ë¡œë¡œ ê³ ê°ì„ `redirect` í•œë‹¤.

# ğŸˆ ì„œë¸”ë¦¿ ì¸í„°ì…‰í„°

## 1. ì†Œê°œ













***
<br>

    ğŸ’› ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ğŸ‘»

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}