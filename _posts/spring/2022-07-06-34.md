---
title:  "[SPRING] ë¡œê·¸ì¸ ì²˜ë¦¬ - 2. í•„í„°, ì¸í„°ì…‰í„° "

categories:
  - Spring
tags:
  - [Framework, Spring, Java]

toc: true
toc_sticky: true
 
date: 2022-07-06 14:49:08
last_modified_at: 2022-07-06 14:49:11
---
ìš”êµ¬ì‚¬í•­ì„ ë³´ë©´ ë¡œê·¸ì¸ í•œ ì‚¬ìš©ìë§Œ ìƒí’ˆ ê´€ë¦¬ í˜ì´ì§€ì— ë“¤ì–´ê°ˆ ìˆ˜ ìˆì–´ì•¼ í•œë‹¤.<br>
ë¬¸ì œëŠ” ë¡œê·¸ì¸ í•˜ì§€ ì•Šì€ ì‚¬ìš©ìë„ URLì„ ì§ì ‘ í˜¸ì¶œí•˜ë©´ ìƒí’ˆ ê´€ë¦¬ í™”ë©´ì— ë“¤ì–´ê°ˆ ìˆ˜ ìˆë‹¤ëŠ” ì ì´ë‹¤.<br><br>
ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œ, ìƒí’ˆ ê´€ë¦¬ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ë¡œê·¸ì¸ ì—¬ë¶€ë¥¼ ì²´í¬í•˜ëŠ” ë¡œì§ì„ í•˜ë‚˜í•˜ë‚˜ ì‘ì„±í•˜ë©´ ë˜ê² ì§€ë§Œ,<br>
 ë“±ë¡, ìˆ˜ì •, ì‚­ì œ, ì¡°íšŒ ë“±ë“± ìƒí’ˆê´€ë¦¬ì˜ ëª¨ë“  ì»¨íŠ¸ë¡¤ëŸ¬ ë¡œì§ì— ê³µí†µìœ¼ë¡œ ë¡œê·¸ì¸ ì—¬ë¶€ë¥¼ í™•ì¸í•´ì•¼ í•œë‹¤. <br>
ë” í° ë¬¸ì œëŠ” í–¥í›„ ë¡œê·¸ì¸ê³¼ ê´€ë ¨ëœ ë¡œì§ì´ ë³€ê²½ë  ë•Œ ì´ë‹¤. ì‘ì„±í•œ ëª¨ë“  ë¡œì§ì„ ë‹¤ ìˆ˜ì •í•´ì•¼ í•  ìˆ˜ ìˆë‹¤.

# ğŸˆ ì„œë¸”ë¦¿ í•„í„° (ì„œë¸”ë¦¿ ì œê³µ)
## 1. ì†Œê°œ
ì• í”Œë¦¬ì¼€ì´ì…˜ ì—¬ëŸ¬ ë¡œì§ì—ì„œ ê³µí†µìœ¼ë¡œ ê´€ì‹¬ì´ ìˆëŠ” ìˆëŠ” ê²ƒì„ ê³µí†µ ê´€ì‹¬ì‚¬(cross-cutting concern)ë¼ê³  í•œë‹¤. <br>
ì—¬ê¸°ì„œëŠ” ë“±ë¡, ìˆ˜ì •, ì‚­ì œ, ì¡°íšŒ ë“±ë“± ì—¬ëŸ¬ ë¡œì§ì—ì„œ ê³µí†µìœ¼ë¡œ ì¸ì¦ì— ëŒ€í•´ì„œ ê´€ì‹¬ì„ ê°€ì§€ê³  ìˆë‹¤.<br><br>
ì´ëŸ¬í•œ ê³µí†µ ê´€ì‹¬ì‚¬ëŠ” ìŠ¤í”„ë§ì˜ AOPë¡œë„ í•´ê²°í•  ìˆ˜ ìˆì§€ë§Œ, ì›¹ê³¼ ê´€ë ¨ëœ ê³µí†µ ê´€ì‹¬ì‚¬ëŠ” ì§€ê¸ˆë¶€í„° ì„¤ëª…í•  ì„œë¸”ë¦¿ í•„í„° ë˜ëŠ” ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤. <br>
ì›¹ê³¼ ê´€ë ¨ëœ ê³µí†µ ê´€ì‹¬ì‚¬ë¥¼ ì²˜ë¦¬í•  ë•ŒëŠ” HTTPì˜ í—¤ë”ë‚˜ URLì˜ ì •ë³´ë“¤ì´ í•„ìš”í•œë°, ì„œë¸”ë¦¿ í•„í„°ë‚˜ ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ëŠ” `HttpServletRequest` ë¥¼ ì œê³µí•œë‹¤.<br><br>
í•„í„°ëŠ” ì„œë¸”ë¦¿ì´ ì§€ì›í•˜ëŠ” ìˆ˜ë¬¸ì¥ì´ë‹¤. í•„í„°ì˜ íŠ¹ì„±ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

### ì„œë¸”ë¦¿ í•„í„° íë¦„
```
HTTP ìš”ì²­ -> WAS -> í•„í„° -> ì„œë¸”ë¦¿ -> ì»¨íŠ¸ë¡¤ëŸ¬
```
í•„í„°ë¥¼ ì ìš©í•˜ë©´ í•„í„°ê°€ í˜¸ì¶œ ëœ ë‹¤ìŒì— ì„œë¸”ë¦¿ì´ í˜¸ì¶œëœë‹¤. ê·¸ë˜ì„œ ëª¨ë“  ê³ ê°ì˜ ìš”ì²­ ë¡œê·¸ë¥¼ ë‚¨ê¸°ëŠ” ìš”êµ¬ì‚¬í•­ì´ ìˆë‹¤ë©´ í•„í„°ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤. <br>
ì°¸ê³ ë¡œ í•„í„°ëŠ” íŠ¹ì • URL íŒ¨í„´ì— ì ìš©í•  ìˆ˜ ìˆë‹¤. `/*` ì´ë¼ê³  í•˜ë©´ ëª¨ë“  ìš”ì²­ì— í•„í„°ê°€ ì ìš©ëœë‹¤.<br>
(ì°¸ê³ ë¡œ ìŠ¤í”„ë§ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš° ì—¬ê¸°ì„œ ë§í•˜ëŠ” ì„œë¸”ë¦¿ì€ ìŠ¤í”„ë§ì˜ ë””ìŠ¤íŒ¨ì²˜ ì„œë¸”ë¦¿ìœ¼ë¡œ ìƒê°í•˜ë©´ ëœë‹¤.)

### ì„œë¸”ë¦¿ í•„í„° ì œí•œ
```
HTTP ìš”ì²­ -> WAS -> í•„í„° -> ì„œë¸”ë¦¿ -> ì»¨íŠ¸ë¡¤ëŸ¬ // ë¡œê·¸ì¸ ì‚¬ìš©ì
HTTP ìš”ì²­ -> WAS -> í•„í„° (ì ì ˆí•˜ì§€ ì•Šì€ ìš”ì²­ì´ë¼ íŒë‹¨, ì„œë¸”ë¦¿ í˜¸ì¶œX) // ë¹„ ë¡œê·¸ì¸ ì‚¬ìš©ì
```
í•„í„°ì—ì„œ ì ì ˆí•˜ì§€ ì•Šì€ ìš”ì²­ì´ë¼ê³  íŒë‹¨í•˜ë©´ ê±°ê¸°ì—ì„œ ëì„ ë‚¼ ìˆ˜ë„ ìˆë‹¤. ê·¸ë˜ì„œ ë¡œê·¸ì¸ ì—¬ë¶€ë¥¼ ì²´í¬í•˜ê¸°ì— ë”± ì¢‹ë‹¤.

### ì„œë¸”ë¦¿ í•„í„° ì²´ì¸
```
HTTP ìš”ì²­ -> WAS -> í•„í„°1-> í•„í„°2-> í•„í„°3-> ì„œë¸”ë¦¿ -> ì»¨íŠ¸ë¡¤ëŸ¬
```
í•„í„°ëŠ” ì²´ì¸ìœ¼ë¡œ êµ¬ì„±ë˜ëŠ”ë°, ì¤‘ê°„ì— í•„í„°ë¥¼ ììœ ë¡­ê²Œ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤. <br>
ì˜ˆë¥¼ ë“¤ì–´ì„œ ë¡œê·¸ë¥¼ ë‚¨ê¸°ëŠ” í•„í„°ë¥¼ ë¨¼ì € ì ìš©í•˜ê³ , ê·¸ ë‹¤ìŒì— ë¡œê·¸ì¸ ì—¬ë¶€ë¥¼ ì²´í¬í•˜ëŠ” í•„í„°ë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤.

### ì„œë¸”ë¦¿ í•„í„° ì¸í„°í˜ì´ìŠ¤
```java
public interface Filter {
      public default void init(FilterConfig filterConfig) throws ServletException {}
      public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException;
      public default void destroy() {}
}
```
í•„í„° ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ê³  ë“±ë¡í•˜ë©´ ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆê°€ í•„í„°ë¥¼ ì‹±ê¸€í†¤ ê°ì²´ë¡œ ìƒì„±í•˜ê³ , ê´€ë¦¬í•œë‹¤. 
- `init()`: í•„í„° ì´ˆê¸°í™” ë©”ì„œë“œ, ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆê°€ ìƒì„±ë  ë•Œ í˜¸ì¶œëœë‹¤.
- `doFilter()`: ê³ ê°ì˜ ìš”ì²­ì´ ì˜¬ ë•Œ ë§ˆë‹¤ í•´ë‹¹ ë©”ì„œë“œê°€ í˜¸ì¶œëœë‹¤. í•„í„°ì˜ ë¡œì§ì„ êµ¬í˜„í•˜ë©´ ëœë‹¤. 
- `destroy()`: í•„í„° ì¢…ë£Œ ë©”ì„œë“œ, ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆê°€ ì¢…ë£Œë  ë•Œ í˜¸ì¶œëœë‹¤.

## 2. ìš”ì²­ ë¡œê·¸
í•„í„°ê°€ ì •ë§ ìˆ˜ë¬¸ì¥ ì—­í• ì„ ì˜ í•˜ëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ ê°€ì¥ ë‹¨ìˆœí•œ í•„í„°ì¸, ëª¨ë“  ìš”ì²­ì„ ë¡œê·¸ë¡œ ë‚¨ê¸°ëŠ” í•„í„°ë¥¼ ê°œë°œí•˜ê³  ì ìš©í•´ë³´ì.

### ğŸ—‚ web
#### `LogFilter` - í•„í„° ìƒì„±
`src/main/java/hello/login/web/filter/LogFilter.java`
```java
import javax.servlet.Filter;

@Slf4j
public class LogFilter implements Filter {

    @Override
    public void init(FilterConfig filterConfig) throws ServletException {
        log.info("log filter init");
    }

    @Override
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException {
        log.info("log filter doFilter");

        HttpServletRequest httpRequest = (HttpServletRequest)request;
        String requestURI = httpRequest.getRequestURI();

        String uuid = UUID.randomUUID().toString();

        try{
            log.info("REQUEST [{}][{}]", uuid, requestURI);
            chain.doFilter(request, response);
        } catch(Exception e){
            throw e;
        } finally {
            log.info("RESPONSE [{}][{}]", uuid, requestURI);
        }

    }

    @Override
    public void destroy() {
        log.info("log filter destroy");
    }
}
```
- `public class LogFilter implements Filter {}`<br>
â€¢ í•„í„°ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ í•„í„° ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•´ì•¼ í•œë‹¤.
- `doFilter(ServletRequest request, ServletResponse response, FilterChain chain)`<br>
â€¢ HTTP ìš”ì²­ì´ ì˜¤ë©´ `doFilter` ê°€ í˜¸ì¶œëœë‹¤.<br>
â€¢ `ServletRequest request` ëŠ” HTTP ìš”ì²­ì´ ì•„ë‹Œ ê²½ìš°ê¹Œì§€ ê³ ë ¤í•´ì„œ ë§Œë“  ì¸í„°í˜ì´ìŠ¤ì´ë‹¤. HTTPë¥¼ ì‚¬ìš©í•˜ë©´ `HttpServletRequest httpRequest = (HttpServletRequest) request;` ì²˜ëŸ¼ ë‹¤ìš´ ì¼€ìŠ¤íŒ… í•˜ë©´ ëœë‹¤.
- `String uuid = UUID.randomUUID().toString();`<br>
â€¢ HTTP ìš”ì²­ì„ êµ¬ë¶„í•˜ê¸° ìœ„í•´ ìš”ì²­ë‹¹ ì„ì˜ì˜ `uuid` ë¥¼ ìƒì„±í•´ë‘”ë‹¤. 
- `log.info("REQUEST [{}][{}]", uuid, requestURI);`<br>
â€¢ `uuid` ì™€ `requestURI` ë¥¼ ì¶œë ¥í•œë‹¤.
- `chain.doFilter(request, response);`<br>
â€¢ ì´ ë¶€ë¶„ì´ ê°€ì¥ ì¤‘ìš”í•˜ë‹¤. ë‹¤ìŒ í•„í„°ê°€ ìˆìœ¼ë©´ í•„í„°ë¥¼ í˜¸ì¶œí•˜ê³ , í•„í„°ê°€ ì—†ìœ¼ë©´ ì„œë¸”ë¦¿ì„ í˜¸ì¶œí•œë‹¤. ë§Œì•½ ì´ ë¡œì§ì„ í˜¸ì¶œí•˜ì§€ ì•Šìœ¼ë©´ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì§„í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤.

### `WebConfig` - í•„í„° ë“±ë¡
`src/main/java/hello/login/WebConfig.java`
```java
@Configuration
public class WebConfig {

    @Bean
    public FilterRegistrationBean logFilter(){

        FilterRegistrationBean<Filter> filterRegistrationBean = new FilterRegistrationBean<>();

        filterRegistrationBean.setFilter(new LogFilter());
        filterRegistrationBean.setOrder(1);
        filterRegistrationBean.addUrlPatterns("/*");

        return filterRegistrationBean;
    }
}
```
í•„í„°ë¥¼ ë“±ë¡í•˜ëŠ” ë°©ë²•ì€ ì—¬ëŸ¬ê°€ì§€ê°€ ìˆì§€ë§Œ, ìŠ¤í”„ë§ ë¶€íŠ¸ë¥¼ ì‚¬ìš©í•œë‹¤ë©´ `FilterRegistrationBean` ì„ ì‚¬ìš©í•´ì„œ ë“±ë¡í•˜ë©´ ëœë‹¤.
- `setFilter(new LogFilter())` : ë“±ë¡í•  í•„í„°ë¥¼ ì§€ì •í•œë‹¤.
- `setOrder(1)` : í•„í„°ëŠ” ì²´ì¸ìœ¼ë¡œ ë™ì‘í•œë‹¤. ë”°ë¼ì„œ ìˆœì„œê°€ í•„ìš”í•˜ë‹¤. ë‚®ì„ ìˆ˜ë¡ ë¨¼ì € ë™ì‘í•œë‹¤. 
- `addUrlPatterns("/*")` : í•„í„°ë¥¼ ì ìš©í•  URL íŒ¨í„´ì„ ì§€ì •í•œë‹¤. í•œë²ˆì— ì—¬ëŸ¬ íŒ¨í„´ì„ ì§€ì •í•  ìˆ˜ ìˆë‹¤.

#### ì‹¤í–‰ ë¡œê·¸
```
hello.login.web.filter.LogFilter: REQUEST  [0a2249f2-cc70-4db4-98d1-492ccf5629dd][/items]
hello.login.web.filter.LogFilter: RESPONSE [0a2249f2-cc70-4db4-98d1-492ccf5629dd][/items]
```
í•„í„°ë¥¼ ë“±ë¡í•  ë•Œ `urlPattern` ì„ `/*` ë¡œ ë“±ë¡í–ˆê¸° ë•Œë¬¸ì— ëª¨ë“  ìš”ì²­ì— í•´ë‹¹ í•„í„°ê°€ ì ìš©ëœë‹¤.

> ì°¸ê³ <br>
ì‹¤ë¬´ì—ì„œ HTTP ìš”ì²­ì‹œ ê°™ì€ ìš”ì²­ì˜ ë¡œê·¸ì— ëª¨ë‘ ê°™ì€ ì‹ë³„ìë¥¼ ìë™ìœ¼ë¡œ ë‚¨ê¸°ëŠ” ë°©ë²•ì€ logback mdcë¡œ ê²€ìƒ‰í•´ë³´ì.

## 3. ì¸ì¦ ì²´í¬
ë¡œê·¸ì¸ ë˜ì§€ ì•Šì€ ì‚¬ìš©ìëŠ” ìƒí’ˆ ê´€ë¦¬ ë¿ë§Œ ì•„ë‹ˆë¼ ë¯¸ë˜ì— ê°œë°œë  í˜ì´ì§€ì—ë„ ì ‘ê·¼í•˜ì§€ ëª»í•˜ë„ë¡ í•˜ì.

### ğŸ—‚ web
#### `LoginCheckFilter` - í•„í„° ìƒì„±
`src/main/java/hello/login/web/filter/LoginCheckFilter.java`
```java
import javax.servlet.Filter;

@Slf4j
public class LoginCheckFilter implements Filter {

    // ì¸ì¦ì„ ì²´í¬í•˜ì§€ ì•Šì•„ë„ ë˜ëŠ” ê²½ë¡œ
    private static final String[] whilelist = { "/", "/members/add", "/login", "/logout", "/css/*" };

    @Override
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException {

        HttpServletRequest httpRequest = (HttpServletRequest) request;
        String requestURI = httpRequest.getRequestURI();

        HttpServletResponse httpResponse = (HttpServletResponse) response;

        try {
            log.info("ì¸ì¦ ì²´í¬ í•„í„° ì‹œì‘ {}", requestURI);

            if(isLoginCheckPath(requestURI)){ // ì¸ì¦ì„ ì²´í¬í•´ì•¼í•˜ëŠ” ê²½ë¡œë¼ë©´...
                log.info("ì¸ì¦ ì²´í¬ ë¡œì§ ì‹¤í–‰ {}", requestURI);

                HttpSession session = httpRequest.getSession(false);

                if(session == null || session.getAttribute(SessionConst.LOGIN_MEMBER) == null){
                    log.info("ë¯¸ì¸ì¦ ì‚¬ìš©ì ìš”ì²­ {}", requestURI);

                    // ë¡œê·¸ì¸ìœ¼ë¡œ redirect
                    httpResponse.sendRedirect("/login?redirectURL=" + requestURI); // ë¡œê·¸ì¸ ì„±ê³µí•˜ë©´ ì´ì „ì— ë³´ê³ ìˆë˜ í˜ì´ì§€ë¡œ ì´ë™

                    return; // ì—¬ê¸°ê°€ ì¤‘ìš”, ë¯¸ì¸ì¦ ì‚¬ìš©ìëŠ” ë‹¤ìŒìœ¼ë¡œ ì§„í–‰í•˜ì§€ ì•Šê³  ë
                }
            }

            chain.doFilter(request, response);

        } catch (Exception e) {
            throw e; // ì˜ˆì™¸ë¥¼ ë¡œê¹…í•  ìˆ˜ ìˆì§€ë§Œ, í†°ìº£ê¹Œì§€ ì˜ˆì™¸ë¥¼ ë³´ë‚´ì£¼ì–´ì•¼ í•¨
        } finally {
            log.info("ì¸ì¦ ì²´í¬ í•„í„° ì¢…ë£Œ {}", requestURI);
        }
    }

    /**
     * í™”ì´íŠ¸ ë¦¬ìŠ¤íŠ¸ì˜ ê²½ìš° ì¸ì¦ ì²´í¬ë¥¼ í•˜ì§€ ì•ŠëŠ”ë‹¤.
     */
    private boolean isLoginCheckPath(String requestURI){
        return !PatternMatchUtils.simpleMatch(whilelist, requestURI); // í™”ì´íŠ¸ ë¦¬ìŠ¤íŠ¸ê°€ ì•„ë‹ˆë¼ë©´ (=ì¸ì¦ì„ ì²´í¬í•´ì•¼ í•œë‹¤ë©´) true ë°˜í™˜
    }

}
```
- `whitelist = {"/", "/members/add", "/login", "/logout","/css/*"};`<br>
ì¸ì¦ í•„í„°ë¥¼ ì ìš©í•´ë„ í™ˆ, íšŒì›ê°€ì…, ë¡œê·¸ì¸ í™”ë©´, css ê°™ì€ ë¦¬ì†ŒìŠ¤ì—ëŠ” ì ‘ê·¼í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤. <br>
ì´ë ‡ê²Œ í™”ì´íŠ¸ ë¦¬ìŠ¤íŠ¸ ê²½ë¡œëŠ” ì¸ì¦ê³¼ ë¬´ê´€í•˜ê²Œ í•­ìƒ í—ˆìš©í•œë‹¤. <br>
í™”ì´íŠ¸ ë¦¬ìŠ¤íŠ¸ë¥¼ ì œì™¸í•œ ë‚˜ë¨¸ì§€ ëª¨ë“  ê²½ë¡œì—ëŠ” ì¸ì¦ ì²´í¬ ë¡œì§ì„ ì ìš©í•œë‹¤.

- `isLoginCheckPath(requestURI)`<br>
í™”ì´íŠ¸ ë¦¬ìŠ¤íŠ¸ë¥¼ ì œì™¸í•œ ëª¨ë“  ê²½ìš°ì— ì¸ì¦ ì²´í¬ ë¡œì§ì„ ì ìš©í•œë‹¤. 

- `httpResponse.sendRedirect("/login?redirectURL=" + requestURI);`<br>
ë¯¸ì¸ì¦ ì‚¬ìš©ìëŠ” ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ í•œë‹¤. <br>
ê·¸ëŸ°ë° ë¡œê·¸ì¸ ì´í›„ì— ë‹¤ì‹œ í™ˆìœ¼ë¡œ ì´ë™í•´ë²„ë¦¬ë©´, ì›í•˜ëŠ” ê²½ë¡œë¥¼ ë‹¤ì‹œ ì°¾ì•„ê°€ì•¼ í•˜ëŠ” ë¶ˆí¸í•¨ì´ ìˆë‹¤. <br>
ì˜ˆë¥¼ ë“¤ì–´ì„œ ìƒí’ˆ ê´€ë¦¬ í™”ë©´ì„ ë³´ë ¤ê³  ë“¤ì–´ê°”ë‹¤ê°€ ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™í•˜ë©´, ë¡œê·¸ì¸ ì´í›„ì— ë‹¤ì‹œ ìƒí’ˆ ê´€ë¦¬ í™”ë©´ìœ¼ë¡œ ë“¤ì–´ê°€ëŠ” ê²ƒì´ ì¢‹ë‹¤. <br>
ì´ëŸ° ë¶€ë¶„ì´ ê°œë°œì ì…ì¥ì—ì„œëŠ” ì¢€ ê·€ì°®ì„ ìˆ˜ ìˆì–´ë„ ì‚¬ìš©ì ì…ì¥ìœ¼ë¡œ ë³´ë©´ í¸ë¦¬í•œ ê¸°ëŠ¥ì´ë‹¤. ì´ëŸ¬í•œ ê¸°ëŠ¥ì„ ìœ„í•´ í˜„ì¬ ìš”ì²­í•œ ê²½ë¡œì¸ `requestURI` ë¥¼ `/login` ì— ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¡œ í•¨ê»˜ ì „ë‹¬í•œë‹¤. <br>
ë¬¼ë¡  `/login` ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ë¡œê·¸ì¸ ì„±ê³µì‹œ í•´ë‹¹ ê²½ë¡œë¡œ ì´ë™í•˜ëŠ” ê¸°ëŠ¥ì€ ì¶”ê°€ë¡œ ê°œë°œí•´ì•¼ í•œë‹¤.

- `return;` <br>
ì—¬ê¸°ê°€ ì¤‘ìš”í•˜ë‹¤. í•„í„°ë¥¼ ë”ëŠ” ì§„í–‰í•˜ì§€ ì•ŠëŠ”ë‹¤. ì´í›„ í•„í„°ëŠ” ë¬¼ë¡  ì„œë¸”ë¦¿, ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ë”ëŠ” í˜¸ì¶œë˜ì§€ ì•ŠëŠ”ë‹¤. <br>
ì•ì„œ `redirect` ë¥¼ ì‚¬ìš©í–ˆê¸° ë•Œë¬¸ì— `redirect` ê°€ ì‘ë‹µìœ¼ë¡œ ì ìš©ë˜ê³  ìš”ì²­ì´ ëë‚œë‹¤.

### `WebConfig` - `loginCheckFilter()` ì¶”ê°€
`src/main/java/hello/login/WebConfig.java`
```java
@Configuration
public class WebConfig {
    ...
    @Bean
    public FilterRegistrationBean loginCheckFilter(){

        FilterRegistrationBean<Filter> filterRegistrationBean = new FilterRegistrationBean<>();

        filterRegistrationBean.setFilter(new LoginCheckFilter());
        filterRegistrationBean.setOrder(2);
        filterRegistrationBean.addUrlPatterns("/*"); // í•„í„° ì•ˆì— ì •ì˜ëœ isLoginCheckPath()ë¥¼ í†µí•´ (ì¸ì¦ì´ í•„ìš” ì—†ëŠ”) í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ëŠ” ê±¸ëŸ¬ì§„ë‹¤.

        return filterRegistrationBean;
    }
}
```
- `setFilter(new LoginCheckFilter())` : ë¡œê·¸ì¸ í•„í„°ë¥¼ ë“±ë¡í•œë‹¤. 
- `setOrder(2)` : ìˆœì„œë¥¼ 2ë²ˆìœ¼ë¡œ ì¡ì•˜ë‹¤. ë¡œê·¸ í•„í„° ë‹¤ìŒì— ë¡œê·¸ì¸ í•„í„°ê°€ ì ìš©ëœë‹¤. 
- `addUrlPatterns("/*")` : ëª¨ë“  ìš”ì²­ì— ë¡œê·¸ì¸ í•„í„°ë¥¼ ì ìš©í•œë‹¤.

### ğŸ—‚ web
#### `LoginController` - ë¡œê·¸ì¸ ì„±ê³µì‹œ ë³´ê³ ìˆë˜ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
ë¡œê·¸ì¸ì— ì„±ê³µí•˜ë©´ ì²˜ìŒ ìš”ì²­í•œ URLë¡œ ì´ë™í•˜ëŠ” ê¸°ëŠ¥ì„ ê°œë°œí•´ë³´ì.<br>
`src/main/java/hello/login/web/login/LoginController.java`
```java
@Slf4j
@Controller
@RequiredArgsConstructor
public class LoginController {

    private final LoginService loginService;

    @PostMapping("/login")
    public String loginV4(@Valid @ModelAttribute LoginForm form, BindingResult bindingResult,
                          @RequestParam(defaultValue = "/") String redirectURL, // ğŸŒŸ redirectURLì„ ë°›ì•„ì˜¨ë‹¤.
                          HttpServletRequest req){
        if(bindingResult.hasErrors()){
            return "login/loginForm";
        }

        Member loginMember = loginService.login(form.getLoginId(), form.getPassword());

        if(loginMember==null){
            bindingResult.reject("loginFail", "ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ë§ì§€ ì•ŠìŠµë‹ˆë‹¤.");
            return "login/loginForm";
        }

        // ë¡œê·¸ì¸ ì„±ê³µ ì²˜ë¦¬
        HttpSession session = req.getSession();  // ì„¸ì…˜ì´ ìˆìœ¼ë©´ ìˆëŠ” ì„¸ì…˜ì„ ë°˜í™˜, ì—†ìœ¼ë©´ ì‹ ê·œ ì„¸ì…˜ì„ ìƒì„±í•´ì„œ ë°˜í™˜
        session.setAttribute(SessionConst.LOGIN_MEMBER, loginMember); // ì„¸ì…˜ì— ë¡œê·¸ì¸ íšŒì› ì •ë³´ ë³´ê´€

        return "redirect:" + redirectURL; // ğŸŒŸ ë¡œê·¸ì¸ ì„±ê³µí•˜ë©´ ì´ì „ì— ë³´ê³ ìˆë˜ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
    }
}
```
ë¡œê·¸ì¸ ì²´í¬ í•„í„°ì—ì„œ, ë¯¸ì¸ì¦ ì‚¬ìš©ìëŠ” ìš”ì²­ ê²½ë¡œë¥¼ í¬í•¨í•´ì„œ `/login` ì— `redirectURL` ìš”ì²­ íŒŒë¼ë¯¸í„°ë¥¼ ì¶”ê°€í•´ì„œ ìš”ì²­í–ˆë‹¤. <br>
ì´ ê°’ì„ ì‚¬ìš©í•´ì„œ ë¡œê·¸ì¸ ì„±ê³µì‹œ í•´ë‹¹ ê²½ë¡œë¡œ ê³ ê°ì„ `redirect` í•œë‹¤.

# ğŸˆ ìŠ¤í”„ë§ ì¸í„°ì…‰í„° (ìŠ¤í”„ë§ MVC ì œê³µ)

## 1. ì†Œê°œ
ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ë„ ì„œë¸”ë¦¿ í•„í„°ì™€ ê°™ì´ ì›¹ê³¼ ê´€ë ¨ëœ ê³µí†µ ê´€ì‹¬ ì‚¬í•­ì„ íš¨ê³¼ì ìœ¼ë¡œ í•´ê²°í•  ìˆ˜ ìˆëŠ” ê¸°ìˆ ì´ë‹¤. <br>
ì„œë¸”ë¦¿ í•„í„°ê°€ ì„œë¸”ë¦¿ì´ ì œê³µí•˜ëŠ” ê¸°ìˆ ì´ë¼ë©´, ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ëŠ” ìŠ¤í”„ë§ MVCê°€ ì œê³µí•˜ëŠ” ê¸°ìˆ ì´ë‹¤. <br>
ë‘˜ë‹¤ ì›¹ê³¼ ê´€ë ¨ëœ ê³µí†µ ê´€ì‹¬ ì‚¬í•­ì„ ì²˜ë¦¬í•˜ì§€ë§Œ, ì ìš©ë˜ëŠ” ìˆœì„œì™€ ë²”ìœ„, ê·¸ë¦¬ê³  ì‚¬ìš©ë°©ë²•ì´ ë‹¤ë¥´ë‹¤.

### ìŠ¤í”„ë§ ì¸í„°ì…‰í„° íë¦„
```
HTTP ìš”ì²­ ->WAS-> í•„í„° -> ì„œë¸”ë¦¿ -> ìŠ¤í”„ë§ ì¸í„°ì…‰í„° -> ì»¨íŠ¸ë¡¤ëŸ¬
```
- ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ëŠ” ë””ìŠ¤íŒ¨ì²˜ ì„œë¸”ë¦¿ê³¼ ì»¨íŠ¸ë¡¤ëŸ¬ ì‚¬ì´ì—ì„œ ì»¨íŠ¸ë¡¤ëŸ¬ í˜¸ì¶œ ì§ì „ì— í˜¸ì¶œ ëœë‹¤.
- ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ëŠ” ìŠ¤í”„ë§ MVCê°€ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ì´ê¸° ë•Œë¬¸ì— ê²°êµ­ ë””ìŠ¤íŒ¨ì²˜ ì„œë¸”ë¦¿ ì´í›„ì— ë“±ì¥í•˜ê²Œ ëœë‹¤.<br>
ìŠ¤í”„ë§ MVCì˜ ì‹œì‘ì ì´ ë””ìŠ¤íŒ¨ì²˜ ì„œë¸”ë¦¿ì´ë¼ê³  ìƒê°í•´ë³´ë©´ ì´í•´ê°€ ë  ê²ƒì´ë‹¤.
- ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ì—ë„ URL íŒ¨í„´ì„ ì ìš©í•  ìˆ˜ ìˆëŠ”ë°, ì„œë¸”ë¦¿ URL íŒ¨í„´ê³¼ëŠ” ë‹¤ë¥´ê³ , ë§¤ìš° ì •ë°€í•˜ê²Œ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.

### ìŠ¤í”„ë§ ì¸í„°ì…‰í„° ì œí•œ
```
HTTP ìš”ì²­ -> WAS -> í•„í„° -> ì„œë¸”ë¦¿ -> ìŠ¤í”„ë§ ì¸í„°ì…‰í„° -> ì»¨íŠ¸ë¡¤ëŸ¬ //ë¡œê·¸ì¸ ì‚¬ìš©ì
HTTP ìš”ì²­ -> WAS -> í•„í„° -> ì„œë¸”ë¦¿ -> ìŠ¤í”„ë§ ì¸í„°ì…‰í„° (ì ì ˆí•˜ì§€ ì•Šì€ ìš”ì²­ì´ë¼ íŒë‹¨, ì»¨íŠ¸ë¡¤ëŸ¬ í˜¸ì¶œ X) // ë¹„ ë¡œê·¸ì¸ ì‚¬ìš©ì
```
ì¸í„°ì…‰í„°ì—ì„œ ì ì ˆí•˜ì§€ ì•Šì€ ìš”ì²­ì´ë¼ê³  íŒë‹¨í•˜ë©´ ê±°ê¸°ì—ì„œ ëì„ ë‚¼ ìˆ˜ë„ ìˆë‹¤. ê·¸ë˜ì„œ ë¡œê·¸ì¸ ì—¬ë¶€ë¥¼ ì²´í¬í•˜ê¸°ì— ë”± ì¢‹ë‹¤.

### ìŠ¤í”„ë§ ì¸í„°ì…‰í„° ì²´ì¸
```
HTTP ìš”ì²­ -> WAS -> í•„í„° -> ì„œë¸”ë¦¿ -> ì¸í„°ì…‰í„°1 -> ì¸í„°ì…‰í„°2 -> ì»¨íŠ¸ë¡¤ëŸ¬
```
ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ëŠ” ì²´ì¸ìœ¼ë¡œ êµ¬ì„±ë˜ëŠ”ë°, ì¤‘ê°„ì— ì¸í„°ì…‰í„°ë¥¼ ììœ ë¡­ê²Œ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤. <br>
ì˜ˆë¥¼ ë“¤ì–´ì„œ ë¡œê·¸ë¥¼ ë‚¨ê¸°ëŠ” ì¸í„°ì…‰í„°ë¥¼ ë¨¼ì € ì ìš©í•˜ê³ , ê·¸ ë‹¤ìŒì— ë¡œê·¸ì¸ ì—¬ë¶€ë¥¼ ì²´í¬í•˜ëŠ” ì¸í„°ì…‰í„°ë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤.<br><br>
ì§€ê¸ˆê¹Œì§€ ë‚´ìš©ì„ ë³´ë©´ ì„œë¸”ë¦¿ í•„í„°ì™€ í˜¸ì¶œ ë˜ëŠ” ìˆœì„œë§Œ ë‹¤ë¥´ê³ , ì œê³µí•˜ëŠ” ê¸°ëŠ¥ì€ ë¹„ìŠ·í•´ ë³´ì¸ë‹¤. <br>
ì•ìœ¼ë¡œ ì„¤ëª…í•˜ê² ì§€ë§Œ, ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ëŠ” ì„œë¸”ë¦¿ í•„í„°ë³´ë‹¤ í¸ë¦¬í•˜ê³ , ë” ì •êµí•˜ê³  ë‹¤ì–‘í•œ ê¸°ëŠ¥ì„ ì§€ì›í•œë‹¤.

### ìŠ¤í”„ë§ ì¸í„°ì…‰í„° ì¸í„°í˜ì´ìŠ¤
ìŠ¤í”„ë§ì˜ ì¸í„°ì…‰í„°ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ `HandlerInterceptor` ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ë©´ ëœë‹¤.
```java
public interface HandlerInterceptor {
    default boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {}

    default void postHandle(HttpServletRequest request, HttpServletResponse response,
                            Object handler, @Nullable ModelAndView modelAndView) throws Exception {}

    default void afterCompletion(HttpServletRequest request, HttpServletResponse response,
                                 Object handler, @Nullable Exception ex) throws Exception {}
}
```
- ì„œë¸”ë¦¿ í•„í„°ì˜ ê²½ìš° ë‹¨ìˆœí•˜ê²Œ `doFilter()` í•˜ë‚˜ë§Œ ì œê³µëœë‹¤. <br>
ì¸í„°ì…‰í„°ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ í˜¸ì¶œ ì „( `preHandle` ), í˜¸ì¶œ í›„( `postHandle` ), ìš”ì²­ ì™„ë£Œ ì´í›„( `afterCompletion` )ì™€ ê°™ì´ ë‹¨ê³„ì ìœ¼ë¡œ ì˜ ì„¸ë¶„í™” ë˜ì–´ ìˆë‹¤. 
- ì„œë¸”ë¦¿ í•„í„°ì˜ ê²½ìš° ë‹¨ìˆœíˆ `request` , `response` ë§Œ ì œê³µí–ˆì§€ë§Œ, ì¸í„°ì…‰í„°ëŠ” ì–´ë–¤ ì»¨íŠ¸ë¡¤ëŸ¬( `handler` )ê°€ í˜¸ì¶œë˜ëŠ”ì§€ í˜¸ì¶œ ì •ë³´ë„ ë°›ì„ ìˆ˜ ìˆë‹¤. <br>
ê·¸ë¦¬ê³  ì–´ë–¤ `modelAndView` ê°€ ë°˜í™˜ë˜ëŠ”ì§€ ì‘ë‹µ ì •ë³´ë„ ë°›ì„ ìˆ˜ ìˆë‹¤.

### ìŠ¤í”„ë§ ì¸í„°ì…‰í„° í˜¸ì¶œ íë¦„
#### ì •ìƒ íë¦„
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-07-06 á„‹á…©á„’á…® 6 55 05](https://user-images.githubusercontent.com/59405576/177524117-4003c12f-dd48-4724-986b-8ad60b8fee7f.png)
- `preHandle` : ì»¨íŠ¸ë¡¤ëŸ¬ í˜¸ì¶œ ì „ì— í˜¸ì¶œëœë‹¤. (ë” ì •í™•íˆëŠ” í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„° í˜¸ì¶œ ì „ì— í˜¸ì¶œëœë‹¤.) <br>- `preHandle` ì˜ ì‘ë‹µê°’ì´ `true` ì´ë©´ ë‹¤ìŒìœ¼ë¡œ ì§„í–‰í•˜ê³ , `false` ì´ë©´ ë”ëŠ” ì§„í–‰í•˜ì§€ ì•ŠëŠ”ë‹¤. `false`
ì¸ ê²½ìš° ë‚˜ë¨¸ì§€ ì¸í„°ì…‰í„°ëŠ” ë¬¼ë¡ ì´ê³ , í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„°ë„ í˜¸ì¶œë˜ì§€ ì•ŠëŠ”ë‹¤. ê·¸ë¦¼ì—ì„œ 1ë²ˆì—ì„œ ëì´ ë‚˜ë²„ë¦°ë‹¤.
- `postHandle` : ì»¨íŠ¸ë¡¤ëŸ¬ í˜¸ì¶œ í›„ì— í˜¸ì¶œëœë‹¤. (ë” ì •í™•íˆëŠ” í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„° í˜¸ì¶œ í›„ì— í˜¸ì¶œëœë‹¤.) 
- `afterCompletion` : ë·°ê°€ ë Œë”ë§ ëœ ì´í›„ì— í˜¸ì¶œëœë‹¤.

#### ì˜ˆì™¸ ë°œìƒ ì‹œ
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-07-06 á„‹á…©á„’á…® 6 55 18](https://user-images.githubusercontent.com/59405576/177524162-c97daf37-f090-4f76-8116-542e80affc69.png)
- `preHandle` : ì»¨íŠ¸ë¡¤ëŸ¬ í˜¸ì¶œ ì „ì— í˜¸ì¶œëœë‹¤.
- `postHandle` : ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ `postHandle` ì€ í˜¸ì¶œë˜ì§€ ì•ŠëŠ”ë‹¤.
- `afterCompletion` : `afterCompletion` ì€ í•­ìƒ í˜¸ì¶œëœë‹¤. ì´ ê²½ìš° ì˜ˆì™¸( `ex` )ë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ë°›ì•„ì„œ ì–´ë–¤ ì˜ˆì™¸ê°€ ë°œìƒí–ˆëŠ”ì§€ ë¡œê·¸ë¡œ ì¶œë ¥í•  ìˆ˜ ìˆë‹¤.<br><br>

ğŸ“ `afterCompletion`ì€ ì˜ˆì™¸ê°€ ë°œìƒí•´ë„ í˜¸ì¶œëœë‹¤.
- ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ `postHandle()` ëŠ” í˜¸ì¶œë˜ì§€ ì•Šìœ¼ë¯€ë¡œ ì˜ˆì™¸ì™€ ë¬´ê´€í•˜ê²Œ ê³µí†µ ì²˜ë¦¬ë¥¼ í•˜ë ¤ë©´ `afterCompletion()` ì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤.
- ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ `afterCompletion()` ì— ì˜ˆì™¸ ì •ë³´( `ex` )ë¥¼ í¬í•¨í•´ì„œ í˜¸ì¶œëœë‹¤.<br><br>

### ì •ë¦¬
ì¸í„°ì…‰í„°ëŠ” ìŠ¤í”„ë§ MVC êµ¬ì¡°ì— íŠ¹í™”ëœ í•„í„° ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤ê³  ì´í•´í•˜ë©´ ëœë‹¤. <br>
ìŠ¤í”„ë§ MVCë¥¼ ì‚¬ìš©í•˜ê³ , íŠ¹ë³„íˆ ì„œë¸”ë¦¿ í•„í„°ë¥¼ ê¼­ ì‚¬ìš©í•´ì•¼ í•˜ëŠ” ìƒí™©ì´ ì•„ë‹ˆë¼ë©´ ì¸í„°ì…‰í„°ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë” í¸ë¦¬í•˜ë‹¤. ğŸŒŸ

## 2. ìš”ì²­ ë¡œê·¸
### ğŸ—‚ web
#### `LogInterceptor` - ìš”ì²­ ë¡œê·¸ ì¸í„°ì…‰í„° ìƒì„±
`src/main/java/hello/login/web/interceptor/LogInterceptor.java`
```java
@Slf4j
public class LogInterceptor implements HandlerInterceptor {

    public static final String LOG_ID = "logId";

    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {

        String requestURI = request.getRequestURI();
        String uuid = UUID.randomUUID().toString();

        request.setAttribute(LOG_ID, uuid);

        /**
         * @RequestMapping: HandlerMethod
         * ì •ì  ë¦¬ì†ŒìŠ¤: ResourceHttpRequestHandler
         */
        if(handler instanceof HandlerMethod){
            HandlerMethod hm = (HandlerMethod) handler; // í˜¸ì¶œí•  ì»¨íŠ¸ë¡¤ëŸ¬ ë©”ì„œë“œì˜ ëª¨ë“  ì •ë³´ê°€ í¬í•¨ë˜ì–´ ìˆë‹¤.
            // hm.get... ë¥¼ ì´ìš©í•´ ì—¬ëŸ¬ê°€ì§€ ì •ë³´ë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤. (ì°¸ê³ ìš©)
        }

        log.info("REQUEST [{}][{}][{}]", uuid, requestURI, handler);
        return true;
    }

    @Override
    public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception {
        log.info("postHandle [{}]", modelAndView);
    }

    @Override
    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception {

        String requestURI = request.getRequestURI();
        String logId = (String) request.getAttribute(LOG_ID);

        log.info("RESPONSE [{}][{}][{}]", logId, requestURI, handler);

        if(ex!=null){
            log.error("afterCompletion error!!", ex);
        }
    }
}
```
- `String uuid = UUID.randomUUID().toString()` <br>
ìš”ì²­ ë¡œê·¸ë¥¼ êµ¬ë¶„í•˜ê¸° ìœ„í•œ `uuid` ë¥¼ ìƒì„±í•œë‹¤.

- `request.setAttribute(LOG_ID, uuid)`<br>
ì„œë¸”ë¦¿ í•„í„°ì˜ ê²½ìš° ì§€ì—­ë³€ìˆ˜ë¡œ í•´ê²°ì´ ê°€ëŠ¥í•˜ì§€ë§Œ, ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ëŠ” í˜¸ì¶œ ì‹œì ì´ ì™„ì „íˆ ë¶„ë¦¬ë˜ì–´ ìˆë‹¤. <br>
ë”°ë¼ì„œ `preHandle` ì—ì„œ ì§€ì •í•œ ê°’ì„ `postHandle` , `afterCompletion` ì—ì„œ í•¨ê»˜ ì‚¬ìš©í•˜ë ¤ë©´ ì–´ë”˜ê°€ì— ë‹´ì•„ë‘ì–´ì•¼ í•œë‹¤. <br>
`LogInterceptor` ë„ ì‹±ê¸€í†¤ ì²˜ëŸ¼ ì‚¬ìš©ë˜ê¸° ë•Œë¬¸ì— ë§´ë²„ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë©´ ìœ„í—˜í•˜ë‹¤. <br>
ë”°ë¼ì„œ `request` ì— ë‹´ì•„ë‘ì—ˆë‹¤. ì´ ê°’ì€ `afterCompletion` ì—ì„œ `request.getAttribute(LOG_ID)` ë¡œ ì°¾ì•„ì„œ ì‚¬ìš©í•œë‹¤.

- `return true`<br>
`true` ë©´ ì •ìƒ í˜¸ì¶œì´ë‹¤. ë‹¤ìŒ ì¸í„°ì…‰í„°ë‚˜ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ í˜¸ì¶œëœë‹¤.

##### `HandlerMethod`
```java
if(handler instanceof HandlerMethod){
    HandlerMethod hm = (HandlerMethod) handler; // í˜¸ì¶œí•  ì»¨íŠ¸ë¡¤ëŸ¬ ë©”ì„œë“œì˜ ëª¨ë“  ì •ë³´ê°€ í¬í•¨ë˜ì–´ ìˆë‹¤.
    // hm.get... ë¥¼ ì´ìš©í•´ ì—¬ëŸ¬ê°€ì§€ ì •ë³´ë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤. (ì°¸ê³ ìš©)
}
```
í•¸ë“¤ëŸ¬ ì •ë³´ëŠ” ì–´ë–¤ í•¸ë“¤ëŸ¬ ë§¤í•‘ì„ ì‚¬ìš©í•˜ëŠ”ê°€ì— ë”°ë¼ ë‹¬ë¼ì§„ë‹¤. <br>
ìŠ¤í”„ë§ì„ ì‚¬ìš©í•˜ë©´ ì¼ë°˜ì ìœ¼ë¡œ` @Controller` , `@RequestMapping` ì„ í™œìš©í•œ í•¸ë“¤ëŸ¬ ë§¤í•‘ì„ ì‚¬ìš©í•˜ëŠ”ë°, ì´ ê²½ìš° í•¸ë“¤ëŸ¬ ì •ë³´ë¡œ `HandlerMethod` ê°€ ë„˜ì–´ì˜¨ë‹¤.

##### `ResourceHttpRequestHandler`
`@Controller` ê°€ ì•„ë‹ˆë¼ `/resources/static` ì™€ ê°™ì€ ì •ì  ë¦¬ì†ŒìŠ¤ê°€ í˜¸ì¶œ ë˜ëŠ” ê²½ìš° `ResourceHttpRequestHandler` ê°€ í•¸ë“¤ëŸ¬ ì •ë³´ë¡œ ë„˜ì–´ì˜¤ê¸° ë•Œë¬¸ì— íƒ€ì…ì— ë”°ë¼ì„œ ì²˜ë¦¬ê°€ í•„ìš”í•˜ë‹¤.

##### `postHandle` & `afterCompletion`
ì¢…ë£Œ ë¡œê·¸ë¥¼ `postHandle` ì´ ì•„ë‹ˆë¼ `afterCompletion` ì—ì„œ ì‹¤í–‰í•œ ì´ìœ ëŠ”, ì˜ˆì™¸ê°€ ë°œìƒí•œ ê²½ìš° `postHandle` ê°€ í˜¸ì¶œë˜ì§€ ì•Šê¸° ë•Œë¬¸ì´ë‹¤. <br>
`afterCompletion` ì€ ì˜ˆì™¸ê°€ ë°œìƒí•´ë„ í˜¸ì¶œ ë˜ëŠ” ê²ƒì„ ë³´ì¥í•œë‹¤.

### `WebConfig` - ì¸í„°ì…‰í„° ë“±ë¡
`src/main/java/hello/login/WebConfig.java`
```java
@Configuration
public class WebConfig implements WebMvcConfigurer {

    @Override
    public void addInterceptors(InterceptorRegistry registry) {

        registry.addInterceptor(new LogInterceptor())
                .order(1)
                .addPathPatterns("/**")
                .excludePathPatterns("/css/**", "/*.ico", "/error");
    }
}
```
`WebMvcConfigurer` ê°€ ì œê³µí•˜ëŠ” `addInterceptors()` ë¥¼ ì‚¬ìš©í•´ì„œ ì¸í„°ì…‰í„°ë¥¼ ë“±ë¡í•  ìˆ˜ ìˆë‹¤.

- `registry.addInterceptor(new LogInterceptor())` : ì¸í„°ì…‰í„°ë¥¼ ë“±ë¡í•œë‹¤.
- `order(1)` : ì¸í„°ì…‰í„°ì˜ í˜¸ì¶œ ìˆœì„œë¥¼ ì§€ì •í•œë‹¤. ë‚®ì„ ìˆ˜ë¡ ë¨¼ì € í˜¸ì¶œëœë‹¤.
- `addPathPatterns("/**")` : ì¸í„°ì…‰í„°ë¥¼ ì ìš©í•  URL íŒ¨í„´ì„ ì§€ì •í•œë‹¤. 
- `excludePathPatterns("/css/**", "/*.ico", "/error")` : ì¸í„°ì…‰í„°ì—ì„œ ì œì™¸í•  íŒ¨í„´ì„ ì§€ì •í•œë‹¤.

í•„í„°ì™€ ë¹„êµí•´ë³´ë©´ ì¸í„°ì…‰í„°ëŠ” `addPathPatterns` , `excludePathPatterns` ë¡œ ë§¤ìš° ì •ë°€í•˜ê²Œ URL íŒ¨í„´ì„ ì§€ì •í•  ìˆ˜ ìˆë‹¤.

#### ì‹¤í–‰ ë¡œê·¸
```
REQUEST  [6234a913-f24f-461f-a9e1-85f153b3c8b2][/members/add][hello.login.web.member.MemberController#addForm(Member)]

postHandle [ModelAndView [view="members/addMemberForm";model={member=Member(id=null, loginId=null, name=null, password=null),
org.springframework.validation.BindingResult.member=org.springframework.validation.BeanPropertyBindingResult: 0 errors}]]

RESPONSE [6234a913-f24f-461f-a9e1-85f153b3c8b2][/members/add]
```

### ìŠ¤í”„ë§ì˜ URL ê²½ë¡œ
ìŠ¤í”„ë§ì´ ì œê³µí•˜ëŠ” URL ê²½ë¡œëŠ” ì„œë¸”ë¦¿ ê¸°ìˆ ì´ ì œê³µí•˜ëŠ” URL ê²½ë¡œì™€ ì™„ì „íˆ ë‹¤ë¥´ë‹¤. ë”ìš± ìì„¸í•˜ê³ , ì„¸ë°€í•˜ê²Œ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.<br>
ìì„¸í•œ ë‚´ìš©ì€ ë‹¤ìŒì„ ì°¸ê³ í•˜ì.

#### PathPattern ê³µì‹ ë¬¸ì„œ
```
? í•œ ë¬¸ì ì¼ì¹˜
* ê²½ë¡œ(/) ì•ˆì—ì„œ 0ê°œ ì´ìƒì˜ ë¬¸ì ì¼ì¹˜
** ê²½ë¡œ ëê¹Œì§€ 0ê°œ ì´ìƒì˜ ê²½ë¡œ(/) ì¼ì¹˜
{spring} ê²½ë¡œ(/)ì™€ ì¼ì¹˜í•˜ê³  springì´ë¼ëŠ” ë³€ìˆ˜ë¡œ ìº¡ì²˜
{spring:[a-z]+} matches the regexp [a-z]+ as a path variable named "spring" {spring:[a-z]+} regexp [a-z]+ ì™€ ì¼ì¹˜í•˜ê³ , "spring" ê²½ë¡œ ë³€ìˆ˜ë¡œ ìº¡ì²˜
{*spring} ê²½ë¡œê°€ ëë‚  ë•Œ ê¹Œì§€ 0ê°œ ì´ìƒì˜ ê²½ë¡œ(/)ì™€ ì¼ì¹˜í•˜ê³  springì´ë¼ëŠ” ë³€ìˆ˜ë¡œ ìº¡ì²˜
```
ì•„ë˜ëŠ” ì˜ˆì‹œì´ë‹¤.
```
/pages/t?st.html â€” matches /pages/test.html, /pages/tXst.html but not /pages/toast.html

/resources/*.png â€” matches all .png files in the resources directory

/resources/** â€” matches all files underneath the /resources/ path, including /resources/image.png and /resources/css/spring.css

/resources/{*path} â€” matches all files underneath the /resources/ path and captures their relative path in a variable named "path"; 
/resources/image.png will match with "path" â†’ "/image.png", and /resources/css/spring.css will match with "path" â†’ "/css/spring.css"
/resources/{filename:\\w+}.dat will match /resources/spring.dat and assign the value "spring" to the filename variable
```

> ì°¸ê³ <br>
[https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/util/pattern/PathPattern.html](https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/util/pattern/PathPattern.html)

## 3. ì¸ì¦ ì²´í¬
ì„œë¸”ë¦¿ í•„í„°ì—ì„œ ì‚¬ìš©í–ˆë˜ ì¸ì¦ ì²´í¬ ê¸°ëŠ¥ì„ ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ë¡œ ê°œë°œí•´ë³´ì.
### ğŸ—‚ web
#### `LoginCheckInterceptor` 
`src/main/java/hello/login/web/interceptor/LoginCheckInterceptor.java`
```java
@Slf4j
public class LoginCheckInterceptor implements HandlerInterceptor {

    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {

        String requestURI = request.getRequestURI();

        log.info("ì¸ì¦ ì²´í¬ ì¸í„°ì…‰í„° ì‹¤í–‰ {}", requestURI);

        HttpSession session = request.getSession();

        if(session == null || session.getAttribute(SessionConst.LOGIN_MEMBER) == null){
            log.info("ë¯¸ì¸ì¦ ì‚¬ìš©ì ìš”ì²­");
            // ë¡œê·¸ì¸ìœ¼ë¡œ redirect
            response.sendRedirect("/login?redirectURL=" + requestURI);
            return false;
        }

        return true;
    }
}
```
ì„œë¸”ë¦¿ í•„í„°ì™€ ë¹„êµí•´ì„œ ì½”ë“œê°€ ë§¤ìš° ê°„ê²°í•˜ë‹¤. <br>
ì¸ì¦ì´ë¼ëŠ” ê²ƒì€ ì»¨íŠ¸ë¡¤ëŸ¬ í˜¸ì¶œ ì „ì—ë§Œ í˜¸ì¶œë˜ë©´ ëœë‹¤. ë”°ë¼ì„œ `preHandle` ë§Œ êµ¬í˜„í•˜ë©´ ëœë‹¤.

### `WebConfig` - `LoginCheckInterceptor()` ì¶”ê°€
`src/main/java/hello/login/WebConfig.java`
```java
@Configuration
public class WebConfig {

   @Override
    public void addInterceptors(InterceptorRegistry registry) {

        registry.addInterceptor(new LogInterceptor())
                .order(1)
                .addPathPatterns("/**")
                .excludePathPatterns("/css/**", "/*.ico", "/error");

        registry.addInterceptor(new LoginCheckInterceptor())
                .order(2)
                .addPathPatterns("/**")
                .excludePathPatterns("/", "/members/add", "/login", "/logout", "/css/**", "/*.ico", "/error"); // ì¸ì¦ ì œì™¸
    }
}
```
ì¸í„°ì…‰í„°ë¥¼ ì ìš©í•˜ê±°ë‚˜ í•˜ì§€ ì•Šì„ ë¶€ë¶„ì€ `addPathPatterns` ì™€ `excludePathPatterns` ì— ì‘ì„±í•˜ë©´ ëœë‹¤. <br>
ê¸°ë³¸ì ìœ¼ë¡œ ëª¨ë“  ê²½ë¡œì— í•´ë‹¹ ì¸í„°ì…‰í„°ë¥¼ ì ìš©í•˜ë˜ ( `/**` ), í™ˆ( `/` ), íšŒì›ê°€ì…( `/members/add` ), ë¡œê·¸ì¸( `/login` ), ë¦¬ì†ŒìŠ¤ ì¡°íšŒ( `/css/**` ), ì˜¤ë¥˜( `/error` )ì™€ ê°™ì€ ë¶€ë¶„ì€ ë¡œê·¸ì¸ ì²´í¬ ì¸í„°ì…‰í„°ë¥¼ ì ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤. <br>
ì„œë¸”ë¦¿ í•„í„°ì™€ ë¹„êµí•´ë³´ë©´ ë§¤ìš° í¸ë¦¬í•œ ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤. ë”°ë¼ì„œ íŠ¹ë³„í•œ ë¬¸ì œê°€ ì—†ë‹¤ë©´ ì¸í„°ì…‰í„°ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.









***
<br>

    ğŸ’› ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ğŸ‘»

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}