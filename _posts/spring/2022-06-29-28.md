---
title:  "[SPRING] 타임리프 - 2. 스프링 통합과 폼 "

categories:
  - Spring
tags:
  - [Framework, Spring, Java]

toc: true
toc_sticky: true
 
date: 2022-06-29 15:58:23
last_modified_at: 2022-06-29 15:58:28
---

# 타임리프 스프링 통합
타임리프는 크게 2가지 메뉴얼을 제공한다.

> 
- 기본 메뉴얼<br>- [https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html](https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html)
- 스프링 통합 메뉴얼<br>- [https://www.thymeleaf.org/doc/tutorials/3.0/thymeleafspring.html](https://www.thymeleaf.org/doc/tutorials/3.0/thymeleafspring.html)

타임리프는 스프링 없이도 동작하지만, 스프링과 통합을 위한 다양한 기능을 편리하게 제공한다. <br>
그리고 이런 부분은 스프링으로 백엔드를 개발하는 개발자 입장에서 타임리프를 선택하는 하나의 이유가 된다.

## 스프링 통합으로 추가되는 기능들
- 스프링의 SpringEL 문법 통합 
- `${@myBean.doSomething()}` 처럼 스프링 빈 호출 지원
- 편리한 폼 관리를 위한 추가 속성<br>- `th:object` (기능 강화, 폼 커맨드 객체 선택) <br>- `th:field` , `th:errors` , `th:errorclass`
- 폼 컴포넌트 기능<br>- checkbox, radio button, List 등을 편리하게 사용할 수 있는 기능 지원
- 스프링의 메시지, 국제화 기능의 편리한 통합 스프링의 검증, 오류 처리 통합
- 스프링의 변환 서비스 통합(ConversionService)

## 설정 방법

> 타임리프 템플릿 엔진을 스프링 빈에 등록하고, 타임리프용 뷰 리졸버를 스프링 빈으로 등록하는 방법 
- [https://www.thymeleaf.org/doc/tutorials/3.0/thymeleafspring.html#the-springstandard-dialect](https://www.thymeleaf.org/doc/tutorials/3.0/thymeleafspring.html#the-springstandard-dialect) 
- [https://www.thymeleaf.org/doc/tutorials/3.0/thymeleafspring.html#views-and-view-resolvers](https://www.thymeleaf.org/doc/tutorials/3.0/thymeleafspring.html#views-and-view-resolvers)

스프링 부트는 이런 부분을 모두 자동화 해준다. <br>
`build.gradle` 에 다음 한줄을 넣어주면 Gradle은 타임리프와 관련된 라이브러리를 다운로드 받고, 스프링 부트는 앞서 설명한 타임리프와 관련된 설정용 스프링 빈을 자동으로 등록해준다.
```
 implementation 'org.springframework.boot:spring-boot-starter-thymeleaf'
```

# 1. 입력 폼 처리
지금부터 타임리프가 제공하는 입력 폼 기능을 적용해서 기존 프로젝트의 폼 코드를 타임리프가 지원하는 기능을 사용해서 효율적으로 개선해보자.

- `th:object` : 커맨드 객체를 지정한다.
- `*{...}` : 선택 변수 식이라고 한다. `th:object` 에서 선택한 객체에 접근한다. 
- `th:field`<br>- HTML 태그의 `id` , `name` , `value` 속성을 자동으로 처리해준다.

렌더링 전<br>
`<input type="text" th:field="*{itemName}" />`<br><br>
렌더링 후<br>
`<input type="text" id="itemName" name="itemName" th:value="*{itemName}" />`

## 1.1. 상품 등록 폼

### 컨트롤러
`th:object` 를 적용하려면 먼저 해당 오브젝트 정보를 넘겨주어야 한다. 등록 폼이기 때문에 데이터가 비어있는 빈 오브젝트를 만들어서 뷰에 전달하자.
```java
@Controller
@RequestMapping("/form/items")
@RequiredArgsConstructor
public class FormItemController {

  @GetMapping("/add")
  public String addForm(Model model) {
      model.addAttribute("item", new Item());
      return "form/addForm";
  }
}
```

### 뷰
```html
...

    <form action="item.html" th:action th:object="${item}" method="post">
        <div>
            <label for="itemName">상품명</label>
            <input type="text" id="itemName" th:field="*{itemName}" class="form-control" placeholder="이름을 입력하세요">
        </div>
        <div>
            <label for="price">가격</label>
            <input type="text" id="price" th:field="*{price}" class="form-control" placeholder="가격을 입력하세요">
        </div>
        <div>
            <label for="quantity">수량</label>
            <input type="text" id="quantity" th:field="*{quantity}" class="form-control" placeholder="수량을 입력하세요">
        </div>

...
```

> 참고<br>
- 이전 코드와의 차이점
![스크린샷 2022-06-29 오후 8 41 16](https://user-images.githubusercontent.com/59405576/176428189-8ef65e56-3793-4398-bf21-2ae64efabf5b.png)

#### 실행 결과 (소스 보기)
![스크린샷 2022-06-29 오후 8 00 11](https://user-images.githubusercontent.com/59405576/176421080-5841afa2-d54e-4bd4-836a-2182c2e4bad1.png)<br>
![스크린샷 2022-06-29 오후 8 22 25](https://user-images.githubusercontent.com/59405576/176425111-656d7a3e-1774-451d-a175-49e928beacff.png)

### `th:object="${item}"` 
- `<form>` 에서 사용할 객체를 지정한다. 선택 변수 식( `*{...}` )을 적용할 수 있다.

### `th:field="*{itemName}"`
- `*{itemName}` 는 선택 변수 식을 사용했는데, 선택 변수 식을 사용하지 않고 `${item.itemName}` 처럼 사용해도 된다. <br>
앞서 `th:object` 로 `item`을 선택했기 때문에 선택 변수 식을 적용할 수 있다.<br>
- `th:field` 는 `id` , `name` , `value` 속성을 모두 자동으로 만들어준다.<br>
• `id` : `th:field` 에서 지정한 변수 이름과 같다. `id="itemName"`<br>
• `name` : `th:field` 에서 지정한 변수 이름과 같다. `name="itemName"`<br>
• `value` : `th:field` 에서 지정한 변수의 값을 사용한다. `value=""`

참고로 해당 예제에서 `id` 속성을 제거해도 `th:field` 가 자동으로 만들어준다.

## 1.2. 상품 수정 폼
### 컨트롤러
컨트롤러는 기존 코드와 동일하다.
```java
@Controller
@RequestMapping("/form/items")
@RequiredArgsConstructor
public class FormItemController {

  @GetMapping("/{itemId}/edit")
  public String editForm(@PathVariable Long itemId, Model model) {
      Item item = itemRepository.findById(itemId);
      model.addAttribute("item", item);
      return "form/editForm";
  }
}
```

### 뷰
```html
...

    <form action="item.html" th:action th:object="${item}" method="post">
        <div>
            <label for="id">상품 ID</label>
            <input type="text" id="id" class="form-control" th:field="*{id}" readonly>
        </div>
        <div>
            <label for="itemName">상품명</label>
            <input type="text" id="itemName" class="form-control" th:field="*{itemName}">
        </div>
        <div>
            <label for="price">가격</label>
            <input type="text" id="price" class="form-control" th:field="*{price}">
        </div>
        <div>
            <label for="quantity">수량</label>
            <input type="text" id="quantity" class="form-control" th:field="*{quantity}">
        </div>

...
```
수정 폼은 앞서 설명한 내용과 같다. 수정 폼의 경우 `id` , `name` , `value` 를 모두 신경써야 했는데, 많은 부분이 `th:field` 덕분에 자동으로 처리되는 것을 확인할 수 있다.

> 참고<br>
- 이전 코드와의 차이점
![스크린샷 2022-06-29 오후 8 42 07](https://user-images.githubusercontent.com/59405576/176428322-fb3233dc-bec5-47b5-b599-84c30b6e1ef9.png)

#### 실행 결과 (소스 보기)
![스크린샷 2022-06-29 오후 8 28 47](https://user-images.githubusercontent.com/59405576/176426281-d2554eb4-9f4e-4c9d-9c21-5c4db16bea60.png)<br>
![스크린샷 2022-06-29 오후 8 36 37](https://user-images.githubusercontent.com/59405576/176427506-f579da0d-ddf4-4c47-99e3-5c634410e008.png)

## 정리
`th:object` , `th:field` 덕분에 폼을 개발할 때 약간의 편리함을 얻었다.<br>
사실 이것의 진짜 위력은 뒤에 설명할 검증(Validation)에서 나타난다. 이후 검증 부분에서 폼 처리와 관련된 부분을 더 깊이있게 알아보자.

# 2. 요구사항 추가


















***
<br>

    💛 개인 공부 기록용 블로그입니다. 👻

[맨 위로 이동하기](#){: .btn .btn--primary }{: .align-right}