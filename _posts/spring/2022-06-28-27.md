---
title:  "[SPRING] 타임리프 - 기본 기능 "

categories:
  - Spring
tags:
  - [Framework, Spring, Java]

toc: true
toc_sticky: true
 
date: 2022-06-28 15:18:20
last_modified_at: 2022-06-28 15:18:23
---

# 타임리프 특징
## 서버 사이드 HTML 렌더링 (SSR)
타임리프는 백엔드 서버에서 HTML을 동적으로 렌더링 하는 용도로 사용된다.

## 네츄럴 템플릿
타임리프는 순수 HTML을 최대한 유지하는 특징이 있다.<br><br>
타임리프로 작성한 파일은 HTML을 유지하기 때문에 웹 브라우저에서 파일을 직접 열어도 내용을 확인할 수 있고, 서버를 통해 뷰 템플릿을 거치면 동적으로 변경된 결과를 확인할 수 있다.
JSP를 포함한 다른 뷰 템플릿들은 해당 파일을 열면, 예를 들어서 JSP 파일 자체를 그대로 웹 브라우저에서 열어보면 JSP 소스코드와 HTML이 뒤죽박죽 섞여서 웹 브라우저에서 정상적인 HTML 결과를 확인할 수 없다. 오직 서버를 통해서 JSP가 렌더링 되고 HTML 응답 결과를 받아야 화면을 확인할 수 있다.<br><br>
반면에 타임리프로 작성된 파일은 해당 파일을 그대로 웹 브라우저에서 열어도 정상적인 HTML 결과를 확인할 수 있다. 물론 이 경우 동적으로 결과가 렌더링 되지는 않는다. 하지만 HTML 마크업 결과가 어떻게 되는지 파일만 열어도 바로 확인할 수 있다.<br><br>
이렇게 순수 HTML을 그대로 유지하면서 뷰 템플릿도 사용할 수 있는 타임리프의 특징을 네츄럴 템플릿 (natural templates)이라 한다.

## 스프링 통합 지원
타임리프는 스프링과 자연스럽게 통합되고, 스프링의 다양한 기능을 편리하게 사용할 수 있게 지원한다. 

# 타임리프 기본 기능
## 타임리프 사용 선언
```html
<html xmlns:th="http://www.thymeleaf.org">
```

## 1. 텍스트 - text, utext

### 컨트롤러
```java
@Controller
@RequestMapping("/basic")
public class BasicController {

  @GetMapping("/text-basic")
  public String textBasic(Model model){
      model.addAttribute("data", "<b>Hello Spring!</b>");
      return "basic/text-basic";
  }

  @GetMapping("/text-unescaped")
  public String textUnescaped(Model model){
      model.addAttribute("data", "Hello <b>Spring!</b>");
      return "basic/text-unescaped";
  }
}
```

### 뷰
#### Escape
타임리프는 다음 두 가지 방법으로 텍스트를 출력할 수 있다.
- `th:text` 
- `[[...]]` 

```html
<li>th:text 사용 <span th:text="${data}"></span></li>
<li>컨텐츠 안에서 직접 출력하기 = [[${data}]]</li>
```

웹 브라우저에서 실행 결과를 보자.<br>
- 웹 브라우저: `Hello <b>Spring!</b>`
- 소스보기: `Hello &lt;b&gt;Spring!&lt;/b&gt;`

웹 브라우저에서 `<b>` 태그가 그대로 나온다. 소스보기를 하면 `<` 부분이 `&lt;`로 변경된 것을 확인할 수 있다.

##### HTML 엔티티
웹브라우저는 `<`를 HTML 태그의 시작으로 인식한다. 따라서 `<`를 태그의 시작이 아니라 문자로 표현할 수 있는 방법이 필요한데, 이것을 HTML 엔티티라 한다. <br>
그리고 이렇게 HTML에서 사용하는 특수 문자를 HTML 엔티티로 변경하는 것을 이스케이프(escape)라 한다. <br>
그리고 타임리프가 제공하는 `th:text` , `[[...]]` 는 기본적으로 이스케이스(escape)를 제공한다.

- `<` -> `&lt;` 
- `>` -> `&gt;`
- 기타 수 많은 HTML 엔티티가 있다.

#### Unescape
개발자가 의도한 것은 `<b>` 가 있으면 해당 부분을 강조하는 것이 목적이었다.<br>
이스케이프 기능을 사용하지 않으려면 어떻게 해야할까?<br>
타임리프는 다음 두 기능을 제공한다. 
- `th:text` -> `th:utext`
- `[[...]`] -> `[(...)]`

```html
<li>th:utext 사용 <span th:utext="${data}"></span></li>
<li><span th:inline="none">[(...)] = </span>[(${data})]</li>
```

- `th:inline="none"`: 타임리프는 `[[...]]` 를 해석하기 때문에, 화면에 `[[...]]` 글자를 보여줄 수 없다. 이 태그 안에서는 타임리프가 해석하지 말라는 옵션이다.

실행해보면 다음과 같이 정상 수행되는 것을 확인할 수 있다. 
- 웹 브라우저: Hello <b>Spring!</b>
- 소스보기: `Hello <b>Spring!</b>`

> 🚨 주의!<br>
실제 서비스를 개발하다 보면 escape를 사용하지 않아서 HTML이 정상 렌더링 되지 않는 수 많은 문제가 발생한다. <br>
escape를 기본으로 하고, 꼭 필요한 때만 unescape를 사용하자.

## 2. 변수 - SpringEL
### 컨트롤러
```java
@Controller
@RequestMapping("/basic")
public class BasicController {

  @GetMapping("/variable")
  public String variable(Model model){
      User userA = new User("userA", 10);
      User userB = new User("userB", 20);

      List<User> list = new ArrayList<>();
      list.add(userA);
      list.add(userB);

      Map<String, User> map = new HashMap<>();
      map.put("userA", userA);
      map.put("userB", userB);

      model.addAttribute("user", userA);
      model.addAttribute("users", list);
      model.addAttribute("userMap", map);

      return "basic/variable";
  }

  @Data
  static class User{
      private String username;
      private int age;

      public User(String username, int age) {
          this.username = username;
          this.age = age;
      }
  }
}
```

### 뷰
```html
...

<body>
<h1>SpringEL 표현식</h1>
<ul>Object
    <li>${user.username} = <span th:text="${user.username}"></span></li>
    <li>${user['username']} = <span th:text="${user['username']}"></span></li>
    <li>${user.getUsername()} = <span th:text="${user.getUsername()}"></span></li>
</ul>
<ul>List
    <li>${users[0].username} = <span th:text="${users[0].username}"></span>
    </li>
    <li>${users[0]['username']} = <span th:text="${users[0]['username']}"></span>
    </li>
    <li>${users[0].getUsername()} = <span th:text="${users[0].getUsername()}"></span></li>
</ul>
<ul>Map
    <li>${userMap['userA'].username} = <span th:text="${userMap['userA'].username}"></span></li>
    <li>${userMap['userA']['username']} = <span th:text="${userMap['userA']['username']}"></span></li>
    <li>${userMap['userA'].getUsername()} = <span th:text="${userMap['userA'].getUsername()}"></span></li>
</ul>

<h1>지역 변수 - (th:with)</h1>
<div th:with="first=${users[0]}">
    <p>처음 사람의 이름은 <span th:text="${first.username}"></span></p>
</div>

</body>
</html>
```

#### Object
- `user.username` : user의 username을 프로퍼티 접근 -> `user.getUsername()`<br>
- `user['username']` : 위와 같음 -> `user.getUsername()` <br>
- `user.getUsername()` : user의 `getUsername()` 을 직접 호출

#### List
- `users[0].username` : List에서 첫 번째 회원을 찾고 username 프로퍼티 접근 -> `list.get(0).getUsername()` <br>
- `users[0]['username']` : 위와 같음
- `users[0].getUsername()` : List에서 첫 번째 회원을 찾고 메서드 직접 호출

#### Map
- `userMap['userA'].username` : Map에서 userA를 찾고, username 프로퍼티 접근 -> `map.get("userA").getUsername()`
- `userMap['userA']['username']` : 위와 같음 
- `userMap['userA'].getUsername()` : Map에서 userA를 찾고 메서드 직접 호출

#### 지역 변수 선언
`th:with`를 사용하면 지역 변수를 선언해서 사용할 수 있다. 지역 변수는 선언한 테그 안에서만 사용할 수 있다.

## 3. 기본 객체와 편의 객체
타임리프는 기본 객체들을 제공한다. 
- `${#request}`
- `${#response}`
- `${#session} `
- `${#servletContext} `
- `${#locale}`

그런데 `#request` 는 `HttpServletRequest` 객체가 그대로 제공되기 때문에 데이터를 조회하려면 `request.getParameter("data")` 처럼 불편하게 접근해야 한다.<br>
이런 점을 해결하기 위해 편의 객체도 제공한다.

- HTTP 요청 파라미터 접근: `param`<br>- 예) `${param.paramData}`
- HTTP 세션 접근: `session`<br>- 예) `${session.sessionData}`
- 스프링 빈 접근:`@`<br>- 예) `${@helloBean.hello('Spring!')}`

### 컨트롤러
```java
@Controller
@RequestMapping("/basic")
public class BasicController {

  @GetMapping("/basic-objects")
  public String basicObjects(HttpSession session){
      session.setAttribute("sessionData", "Hello Session");
      return "basic/basic-objects";
  }

  @Component("helloBean")
  static class HelloBean{
      public String hello(String data){
          return "Hello " + data;
      }
  }
}
```


### 뷰
```html
...

<body>
<h1>식 기본 객체 (Expression Basic Objects)</h1>
<ul>
    <li>request = <span th:text="${#request}"></span></li>
    <li>response = <span th:text="${#response}"></span></li>
    <li>session = <span th:text="${#session}"></span></li>
    <li>servletContext = <span th:text="${#servletContext}"></span></li>
    <li>locale = <span th:text="${#locale}"></span></li>
</ul>
<h1>편의 객체</h1>
<ul>
    <li>Request Parameter = <span th:text="${param.paramData}"></span></li>
    <li>session = <span th:text="${session.sessionData}"></span></li>
    <li>spring bean = <span th:text="${@helloBean.hello('Spring!')}"></span></li>
</ul>
</body>
</html>
```

#### 실행 결과
![스크린샷 2022-06-28 오후 5 43 16](https://user-images.githubusercontent.com/59405576/176135525-7db0506b-4cea-4318-8139-49456289b055.png)<br>
`http://localhost:8080/basic/basic-objects?paramData=HelloParam`을 실행한다. (url에 `paramData`라는 파리미터가 들어가있다.)

## 4. 유틸리티 객체와 날짜
타임리프는 문자, 숫자, 날짜, URI등을 편리하게 다루는 다양한 유틸리티 객체들을 제공한다.
- `#message` : 메시지, 국제화 처리
- `#uris` : URI 이스케이프 지원
- `#dates` : java.util.Date 서식 지원 #calendars : `java.util.Calendar` 서식 지원 
- `#temporals` : 자바8 날짜 서식 지원
- `#numbers` : 숫자 서식 지원
- `#strings` : 문자 관련 편의 기능
- `#objects` : 객체 관련 기능 제공
- `#bools` : boolean 관련 기능 제공
- `#arrays` : 배열 관련 기능 제공
- `#lists` , `#sets` , `#maps` : 컬렉션 관련 기능 제공 
- `#ids` : 아이디 처리 관련 기능 제공, 뒤에서 설명

> 타임리프 유틸리티 객체<br>
[https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html#expression-utility-objects](https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html#expression-utility-objects)

> 유틸리티 객체 예시<br>
[https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html#appendix-b-expression-utility-objects](https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html#appendix-b-expression-utility-objects)

> 참고<br>
이런 유틸리티 객체들은 대략 이런 것이 있다 알아두고, 필요할 때 찾아서 사용하면 된다.

### 자바8 날짜
타임리프에서 자바8 날짜인 `LocalDate` , `LocalDateTime` , `Instant` 를 사용하려면 추가 라이브러리가 필요하다. 스프링 부트 타임리프를 사용하면 해당 라이브러리가 자동으로 추가되고 통합된다.<br>

- 타임리프 자바8 날짜 지원 라이브러리 <br>- `thymeleaf-extras-java8time`<br>

- 자바8 날짜용 유틸리티 객체 <br>- `#temporals`

#### 컨트롤러
```java
@Controller
@RequestMapping("/basic")
public class BasicController {

  @GetMapping("/date")
  public String date(Model model){
      model.addAttribute("localDateTime", LocalDateTime.now());
      return "basic/date";
  }
}
```

#### 뷰
```html
...

<body>
<h1>LocalDateTime</h1>
<ul>
    <li>default = <span th:text="${localDateTime}"></span></li>
    <li>yyyy-MM-dd HH:mm:ss = <span th:text="${#temporals.format(localDateTime, 'yyyy-MM-dd HH:mm:ss')}"></span></li>
</ul>
<h1>LocalDateTime - Utils</h1>
<ul>
    <li>${#temporals.day(localDateTime)} = <span th:text="${#temporals.day(localDateTime)}"></span></li>
    <li>${#temporals.month(localDateTime)} = <span th:text="${#temporals.month(localDateTime)}"></span></li>
    <li>${#temporals.monthName(localDateTime)} = <span th:text="${#temporals.monthName(localDateTime)}"></span></li>
    <li>${#temporals.monthNameShort(localDateTime)} = <span th:text="${#temporals.monthNameShort(localDateTime)}"></span></li>
    <li>${#temporals.year(localDateTime)} = <span th:text="${#temporals.year(localDateTime)}"></span></li>
    <li>${#temporals.dayOfWeek(localDateTime)} = <span th:text="${#temporals.dayOfWeek(localDateTime)}"></span></li>
    <li>${#temporals.dayOfWeekName(localDateTime)} = <span th:text="${#temporals.dayOfWeekName(localDateTime)}"></span></li>
    <li>${#temporals.dayOfWeekNameShort(localDateTime)} = <span th:text="${#temporals.dayOfWeekNameShort(localDateTime)}"></span></li>
    <li>${#temporals.hour(localDateTime)} = <span th:text="${#temporals.hour(localDateTime)}"></span></li>
    <li>${#temporals.minute(localDateTime)} = <span th:text="${#temporals.minute(localDateTime)}"></span></li>
    <li>${#temporals.second(localDateTime)} = <span th:text="${#temporals.second(localDateTime)}"></span></li>
    <li>${#temporals.nanosecond(localDateTime)} = <span th:text="${#temporals.nanosecond(localDateTime)}"></span></li>
</ul>
</body>
</html>
```

##### 실행 결과
![스크린샷 2022-06-28 오후 6 05 20](https://user-images.githubusercontent.com/59405576/176140029-dfde7d37-35b8-4033-8f0e-1a5cdf908fc3.png)

## 5. URL 링크 🌟
타임리프에서 URL을 생성할 때는 `@{...}` 문법을 사용하면 된다.

### 컨트롤러
```java
@Controller
@RequestMapping("/basic")
public class BasicController {

@GetMapping("/link")
  public String link(Model model){
      model.addAttribute("param1", "data1");
      model.addAttribute("param2", "data2");
      return "basic/link";
  }
}
```
### 뷰
```html
...

<body>
<h1>URL 링크</h1>
<ul>
    <li><a th:href="@{/hello}">basic url</a></li>
    <li><a th:href="@{/hello(param1=${param1}, param2=${param2})}">hello query param</a></li>
    <li><a th:href="@{/hello/{param1}/{param2}(param1=${param1}, param2=${param2})}">path variable</a></li>
    <li><a th:href="@{/hello/{param1}(param1=${param1}, param2=${param2})}">path variable + query parameter</a></li>
</ul>
</body>
</html>
```

#### 단순한 URL
- `@{/hello}` -> `/hello`

#### 쿼리 파라미터
- `@{/hello(param1=${param1}, param2=${param2})}`<br>- `/hello?param1=data1&param2=data2`<br>- () 에 있는 부분은 쿼리 파라미터로 처리된다.

#### 경로 변수
- `@{/hello/{param1}/{param2}(param1=${param1}, param2=${param2})}`<br>- `/hello/data1/data2`<br>- URL 경로상에 변수가 있으면 () 부분은 경로 변수로 처리된다.

#### 경로 변수 + 쿼리 파라미터 
- `@{/hello/{param1}(param1=${param1}, param2=${param2})}`<br>- `/hello/data1?param2=data2`<br>- 경로 변수와 쿼리 파라미터를 함께 사용할 수 있다.

> 상대경로, 절대경로, 프로토콜 기준을 표현할 수도 있다. 
> - `/hello` : 절대 경로
> - `hello` : 상대 경로
>
> 참고: [https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html#link-urls](https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html#link-urls)

## 6. 리터럴



















***
<br>

    💛 개인 공부 기록용 블로그입니다. 👻

[맨 위로 이동하기](#){: .btn .btn--primary }{: .align-right}