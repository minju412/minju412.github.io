---
title:  "[SPRING] JDBCë¥¼ ì‚¬ìš©í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ "

categories:
  - Spring
tags:
  - [Framework, Spring, Java]

toc: true
toc_sticky: true
 
date: 2022-07-07 15:01:00
last_modified_at: 2022-07-07 15:01:03
---

# 1. íšŒì›(Member) ë“±ë¡
JDBCë¥¼ ì‚¬ìš©í•´ì„œ íšŒì›( `Member` ) ë°ì´í„°ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ê´€ë¦¬í•˜ëŠ” ê¸°ëŠ¥ì„ ê°œë°œí•´ë³´ì.

> ì£¼ì˜ ğŸš¨<br>
H2 ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì • ë§ˆì§€ë§‰ì— ìˆëŠ” í…Œì´ë¸”ê³¼ ìƒ˜í”Œ ë°ì´í„° ë§Œë“¤ê¸°ë¥¼ í†µí•´ì„œ member í…Œì´ë¸”ì„ ë¯¸ë¦¬ ë§Œë“¤ì–´ë‘ì–´ì•¼ í•œë‹¤.

## ë“±ë¡

### `Member`
`src/main/java/hello/jdbc/domain/Member.java`
```java
@Data
public class Member {

    private String memberId;
    private int money;

    public Member() {
    }

    public Member(String memberId, int money) {
        this.memberId = memberId;
        this.money = money;
    }
}
```
íšŒì›ì˜ IDì™€ í•´ë‹¹ íšŒì›ì´ ì†Œì§€í•œ ê¸ˆì•¡ì„ í‘œí˜„í•˜ëŠ” ë‹¨ìˆœí•œ í´ë˜ìŠ¤ì´ë‹¤. <br>
ì•ì„œ ë§Œë“¤ì–´ë‘” member í…Œì´ë¸”ì— ë°ì´í„°ë¥¼ ì €ì¥í•˜ê³  ì¡°íšŒí•  ë•Œ ì‚¬ìš©í•œë‹¤.

### `MemberRepositoryV0` - íšŒì› ë“±ë¡
`src/main/java/hello/jdbc/repository/MemberRepositoryV0.java`<br>
JDBCë¥¼ ì‚¬ìš©í•´ì„œ ì´ë ‡ê²Œ ë§Œë“  íšŒì› ê°ì²´ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•´ë³´ì.
```java
/**
 * JDBC - DriverManager ì‚¬ìš©
 */
@Slf4j
public class MemberRepositoryV0 {

    public Member save(Member member) throws SQLException {

        String sql = "insert into member(member_id, money) values(?, ?)";

        Connection con = null;
        PreparedStatement pstmt = null;

        try{
            con = getConnection();
            pstmt = con.prepareStatement(sql);

            pstmt.setString(1, member.getMemberId());
            pstmt.setInt(2, member.getMoney());
            pstmt.executeUpdate(); // ì¿¼ë¦¬ ì‹¤í–‰

            return member;

        } catch (SQLException e){
            log.error("db error", e);
            throw e;
        } finally {
            close(con, pstmt, null);
        }

    }

    private void close(Connection con, Statement stmt, ResultSet rs){

        if(rs != null){
            try {
                rs.close();
            } catch (SQLException e) {
                log.info("error", e);
            }
        }

        if(stmt != null){
            try {
                stmt.close();
            } catch (SQLException e) {
                log.info("error", e);
            }
        }

        if(con != null){
            try {
                con.close();
            } catch (SQLException e) {
                log.info("error", e);
            }
        }
    }

    private Connection getConnection() {
        return DBConnectionUtil.getConnection();
    }
}
```

#### ì»¤ë„¥ì…˜ íšë“
`getConnection()` : ì´ì „ì— ë§Œë“¤ì–´ë‘” `DBConnectionUtil` ë¥¼ í†µí•´ì„œ ë°ì´í„°ë² ì´ìŠ¤ ì»¤ë„¥ì…˜ì„ íšë“í•œë‹¤.

#### save() - SQL ì „ë‹¬
- `sql` : ë°ì´í„°ë² ì´ìŠ¤ì— ì „ë‹¬í•  SQLì„ ì •ì˜í•œë‹¤. ì—¬ê¸°ì„œëŠ” ë°ì´í„°ë¥¼ ë“±ë¡í•´ì•¼ í•˜ë¯€ë¡œ `insert sql` ì„ ì¤€ë¹„í–ˆë‹¤.
- `con.prepareStatement(sql)` : ë°ì´í„°ë² ì´ìŠ¤ì— ì „ë‹¬í•  SQLê³¼ íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬í•  ë°ì´í„°ë“¤ì„ ì¤€ë¹„í•œë‹¤.<br>
â€¢ `sql` : `insert into member(member_id, money) values(?, ?)"`<br>
â€¢ `pstmt.setString(1, member.getMemberId())` : SQLì˜ ì²«ë²ˆì§¸ `?` ì— ê°’ì„ ì§€ì •í•œë‹¤. ë¬¸ìì´ë¯€ë¡œ `setString` ì„ ì‚¬ìš©í•œë‹¤.<br>
â€¢ `pstmt.setInt(2, member.getMoney())` : SQLì˜ ë‘ë²ˆì§¸ `?` ì— ê°’ì„ ì§€ì •í•œë‹¤. `Int` í˜• ìˆ«ìì´ë¯€ë¡œ `setInt` ë¥¼ ì§€ì •í•œë‹¤.
- `pstmt.executeUpdate()` : `Statement` ë¥¼ í†µí•´ ì¤€ë¹„ëœ SQLì„ ì»¤ë„¥ì…˜ì„ í†µí•´ ì‹¤ì œ ë°ì´í„°ë² ì´ìŠ¤ì— ì „ë‹¬í•œë‹¤. <br>
ì°¸ê³ ë¡œ `executeUpdate()` ì€ `int` ë¥¼ ë°˜í™˜í•˜ëŠ”ë° ì˜í–¥ë°›ì€ DB row ìˆ˜ë¥¼ ë°˜í™˜í•œë‹¤. ì—¬ê¸°ì„œëŠ” í•˜ë‚˜ì˜ rowë¥¼ ë“±ë¡í–ˆìœ¼ë¯€ë¡œ 1ì„ ë°˜í™˜í•œë‹¤.

#### executeUpdate()
```java
int executeUpdate() throws SQLException;
```

#### ë¦¬ì†ŒìŠ¤ ì •ë¦¬
ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•˜ê³  ë‚˜ë©´ ë¦¬ì†ŒìŠ¤ë¥¼ ì •ë¦¬í•´ì•¼ í•œë‹¤. <br>
ì—¬ê¸°ì„œëŠ” `Connection` , `PreparedStatement` ë¥¼ ì‚¬ìš©í–ˆë‹¤. ë¦¬ì†ŒìŠ¤ë¥¼ ì •ë¦¬í•  ë•ŒëŠ” í•­ìƒ ì—­ìˆœìœ¼ë¡œ í•´ì•¼í•œë‹¤. <br>
`Connection` ì„ ë¨¼ì € íšë“í•˜ê³  `Connection` ì„ í†µí•´ `PreparedStatement` ë¥¼ ë§Œë“¤ì—ˆê¸° ë•Œë¬¸ì— ë¦¬ì†ŒìŠ¤ë¥¼ ë°˜í™˜í•  ë•ŒëŠ” `PreparedStatement` ë¥¼ ë¨¼ì € ì¢…ë£Œí•˜ê³ , ê·¸ ë‹¤ìŒì— `Connection` ì„ ì¢…ë£Œí•˜ë©´ ëœë‹¤. <br>
ì°¸ê³ ë¡œ ì—¬ê¸°ì„œ ì‚¬ìš©í•˜ì§€ ì•Šì€ `ResultSet` ì€ ê²°ê³¼ë¥¼ ì¡°íšŒí•  ë•Œ ì‚¬ìš©í•œë‹¤. ì¡°ê¸ˆ ë’¤ì— ì¡°íšŒ ë¶€ë¶„ì—ì„œ ì•Œì•„ë³´ì.

> ì£¼ì˜ ğŸš¨<br>
ë¦¬ì†ŒìŠ¤ ì •ë¦¬ëŠ” ê¼­! í•´ì£¼ì–´ì•¼ í•œë‹¤. ë”°ë¼ì„œ ì˜ˆì™¸ê°€ ë°œìƒí•˜ë“ , í•˜ì§€ ì•Šë“  í•­ìƒ ìˆ˜í–‰ë˜ì–´ì•¼ í•˜ë¯€ë¡œ `finally` êµ¬ë¬¸ì— ì£¼ì˜í•´ì„œ ì‘ì„±í•´ì•¼í•œë‹¤. 

## í…ŒìŠ¤íŠ¸
### MemberRepositoryV0Test - íšŒì› ë“±ë¡ í…ŒìŠ¤íŠ¸
`src/test/java/hello/jdbc/repository/MemberRepositoryV0Test.java`
```java
class MemberRepositoryV0Test {

    MemberRepositoryV0 repository = new MemberRepositoryV0();

    @Test
    void crud() throws SQLException {

        Member member = new Member("memberV0", 10000);
        repository.save(member);
    }
}
```

#### ì‹¤í–‰ ê²°ê³¼
ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ `select * from member` ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•˜ë©´ ë°ì´í„°ê°€ ì €ì¥ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. <br>
<img width="176" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-07-07 á„‹á…©á„’á…® 4 15 18" src="https://user-images.githubusercontent.com/59405576/177714272-8d2988d3-fde0-480c-a57b-291abb76b4ba.png">

> ì°¸ê³ <br>
ì´ í…ŒìŠ¤íŠ¸ëŠ” 2ë²ˆ ì‹¤í–‰í•˜ë©´ PK ì¤‘ë³µ ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤. ì´ ê²½ìš° `delete from member` ì¿¼ë¦¬ë¡œ ë°ì´í„°ë¥¼ ì‚­ì œí•œ ë‹¤ìŒì— ë‹¤ì‹œ ì‹¤í–‰í•˜ì.

# 2. íšŒì›(Member) ì¡°íšŒ
ì´ë²ˆì—ëŠ” JDBCë¥¼ í†µí•´ ì´ì „ì— ì €ì¥í•œ ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ëŠ” ê¸°ëŠ¥ì„ ê°œë°œí•´ë³´ì.

## ì¡°íšŒ

### `MemberRepositoryV0` - íšŒì› ì¡°íšŒ ì¶”ê°€
`src/main/java/hello/jdbc/repository/MemberRepositoryV0.java`<br>
```java
@Slf4j
public class MemberRepositoryV0 {

    public Member findById(String memberId) throws SQLException {

        String sql = "select * from member where member_id = ?";

        Connection con = null;
        PreparedStatement pstmt = null;
        ResultSet rs = null;

        try{
            con = getConnection();
            pstmt = con.prepareStatement(sql);
            pstmt.setString(1, memberId);

            rs = pstmt.executeQuery();

            if(rs.next()){

                Member member = new Member();
                member.setMemberId(rs.getString("member_id"));
                member.setMoney(rs.getInt("money"));

                return member;

            } else{
                throw new NoSuchElementException("member not found memberId=" + memberId);
            }

        } catch (SQLException e) {
            log.info("error", e);
            throw e;

        } finally {
            close(con, pstmt, rs);
        }
    }
    ...
}
```

#### `findById()` - ì¿¼ë¦¬ ì‹¤í–‰
- `sql` : ë°ì´í„° ì¡°íšŒë¥¼ ìœ„í•œ select SQLì„ ì¤€ë¹„í•œë‹¤.
- `rs = pstmt.executeQuery()` ë°ì´í„°ë¥¼ ë³€ê²½í•  ë•ŒëŠ” `executeUpdate()` ë¥¼ ì‚¬ìš©í•˜ì§€ë§Œ, ë°ì´í„°ë¥¼ ì¡°íšŒí•  ë•ŒëŠ” `executeQuery()` ë¥¼ ì‚¬ìš©í•œë‹¤. <br>
`executeQuery()` ëŠ” ê²°ê³¼ë¥¼ `ResultSet` ì— ë‹´ì•„ì„œ ë°˜í™˜í•œë‹¤.

#### `executeQuery()`
```
ResultSet executeQuery() throws SQLException;
```

#### `ResultSet`
- `ResultSet` ì€ ë‹¤ìŒê³¼ ê°™ì´ ìƒê¸´ ë°ì´í„° êµ¬ì¡°ì´ë‹¤. ë³´í†µ select ì¿¼ë¦¬ì˜ ê²°ê³¼ê°€ ìˆœì„œëŒ€ë¡œ ë“¤ì–´ê°„ë‹¤. <br>
ì˜ˆë¥¼ ë“¤ì–´ì„œ `select member_id, money` ë¼ê³  ì§€ì •í•˜ë©´ `member_id` , `money` ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ë°ì´í„°ê°€ ì €ì¥ëœë‹¤.<br>
(ì°¸ê³ ë¡œ `select *` ì„ ì‚¬ìš©í•˜ë©´ í…Œì´ë¸”ì˜ ëª¨ë“  ì»¬ëŸ¼ì„ ë‹¤ ì§€ì •í•œë‹¤.)
- `ResultSet` ë‚´ë¶€ì— ìˆëŠ” ì»¤ì„œ( `cursor` )ë¥¼ ì´ë™í•´ì„œ ë‹¤ìŒ ë°ì´í„°ë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤.
- `rs.next()` : ì´ê²ƒì„ í˜¸ì¶œí•˜ë©´ ì»¤ì„œê°€ ë‹¤ìŒìœ¼ë¡œ ì´ë™í•œë‹¤. <br>
(ì°¸ê³ ë¡œ ìµœì´ˆì˜ ì»¤ì„œëŠ” ë°ì´í„°ë¥¼ ê°€ë¦¬í‚¤ê³  ìˆì§€ ì•Šê¸° ë•Œë¬¸ì— `rs.next()` ë¥¼ ìµœì´ˆ í•œë²ˆì€ í˜¸ì¶œí•´ì•¼ ë°ì´í„°ë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤.)<br>
`rs.next()` ì˜ ê²°ê³¼ê°€ `true` ë©´ ì»¤ì„œì˜ ì´ë™ ê²°ê³¼ ë°ì´í„°ê°€ ìˆë‹¤ëŠ” ëœ»ì´ë‹¤.<br>
`rs.next()` ì˜ ê²°ê³¼ê°€ `false` ë©´ ë”ì´ìƒ ì»¤ì„œê°€ ê°€ë¦¬í‚¤ëŠ” ë°ì´í„°ê°€ ì—†ë‹¤ëŠ” ëœ»ì´ë‹¤. 
- `rs.getString("member_id")` : í˜„ì¬ ì»¤ì„œê°€ ê°€ë¦¬í‚¤ê³  ìˆëŠ” ìœ„ì¹˜ì˜ `member_id` ë°ì´í„°ë¥¼ `String` íƒ€ì…ìœ¼ë¡œ ë°˜í™˜í•œë‹¤.
- `rs.getInt("money")` : í˜„ì¬ ì»¤ì„œê°€ ê°€ë¦¬í‚¤ê³  ìˆëŠ” ìœ„ì¹˜ì˜ `money` ë°ì´í„°ë¥¼ `int` íƒ€ì…ìœ¼ë¡œ ë°˜í™˜í•œë‹¤.<br><br>

`findById()` ì—ì„œëŠ” íšŒì› í•˜ë‚˜ë¥¼ ì¡°íšŒí•˜ëŠ” ê²ƒì´ ëª©ì ì´ë‹¤. ë”°ë¼ì„œ ì¡°íšŒ ê²°ê³¼ê°€ í•­ìƒ 1ê±´ì´ë¯€ë¡œ `while` ëŒ€ì‹ ì— `if` ë¥¼ ì‚¬ìš©í•œë‹¤. <br>
ë‹¤ìŒ SQLì„ ë³´ë©´ PKì¸ `member_id` ë¥¼ í•­ìƒ ì§€ì •í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. <br>
SQL: `select * from member where member_id = ?`

## í…ŒìŠ¤íŠ¸
### MemberRepositoryV0Test - íšŒì› ì¡°íšŒ í…ŒìŠ¤íŠ¸ ì¶”ê°€
`src/test/java/hello/jdbc/repository/MemberRepositoryV0Test.java`
```java
@Slf4j
class MemberRepositoryV0Test {

    MemberRepositoryV0 repository = new MemberRepositoryV0();

    @Test
    void crud() throws SQLException {

         // save
        Member member = new Member("memberV2", 10000);
        repository.save(member);

        // findById
        Member findMember = repository.findById(member.getMemberId());
        log.info("findMember={}", findMember);
        assertThat(findMember).isEqualTo(member);
    }
}
```

#### ì‹¤í–‰ ê²°ê³¼
```
MemberRepositoryV0Test - findMember=Member(memberId=memberV0, money=10000)
```
- íšŒì›ì„ ë“±ë¡í•˜ê³  ê·¸ ê²°ê³¼ë¥¼ ë°”ë¡œ ì¡°íšŒí•´ì„œ í™•ì¸í•´ë³´ì•˜ë‹¤.
- ì°¸ê³ ë¡œ ì‹¤í–‰ ê²°ê³¼ì— member ê°ì²´ì˜ ì°¸ì¡° ê°’ì´ ì•„ë‹ˆë¼ ì‹¤ì œ ë°ì´í„°ê°€ ë³´ì´ëŠ” ì´ìœ ëŠ” ë¡¬ë³µì˜ `@Data` ê°€ `toString()` ì„ ì ì ˆíˆ ì˜¤ë²„ë¼ì´ë”© í•´ì„œ ë³´ì—¬ì£¼ê¸° ë•Œë¬¸ì´ë‹¤.
- `isEqualTo()` : `findMember.equals(member)` ë¥¼ ë¹„êµí•œë‹¤. <br>
ê²°ê³¼ê°€ ì°¸ì¸ ì´ìœ ëŠ” ë¡¬ë³µì˜ `@Data` ëŠ” í•´ë‹¹ ê°ì²´ì˜ ëª¨ë“  í•„ë“œë¥¼ ì‚¬ìš©í•˜ë„ë¡ `equals()` ë¥¼ ì˜¤ë²„ë¼ì´ë”© í•˜ê¸° ë•Œë¬¸ì´ë‹¤.

# 3. íšŒì›(Member) ìˆ˜ì • & ì‚­ì œ
ìˆ˜ì •ê³¼ ì‚­ì œëŠ” ë“±ë¡ê³¼ ë¹„ìŠ·í•˜ë‹¤. ë“±ë¡, ìˆ˜ì •, ì‚­ì œì²˜ëŸ¼ ë°ì´í„°ë¥¼ ë³€ê²½í•˜ëŠ” ì¿¼ë¦¬ëŠ” `executeUpdate()` ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

## ìˆ˜ì •

### `MemberRepositoryV0` - íšŒì› ìˆ˜ì • ì¶”ê°€
`src/main/java/hello/jdbc/repository/MemberRepositoryV0.java`<br>
```java
```








***
<br>

    ğŸ’› ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ğŸ‘»

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}