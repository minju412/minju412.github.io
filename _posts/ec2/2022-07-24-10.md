---
title:  "[EC2] RDSì™€ ElastiCacheë¥¼ ì´ìš©í•´ spring boot ë°°í¬í•˜ê¸° "

categories:
  - EC2
tags:
  - [AWS, EC2]

toc: true
toc_sticky: true
 
date: 2022-07-24 12:58:33
last_modified_at: 2022-07-24 12:58:36
---
> EC2 ì¸ìŠ¤í„´ìŠ¤ëŠ” ë¯¸ë¦¬ ìƒì„±í•´ë‘” ìƒíƒœì´ë‹¤.
- AWS EC2 ubuntu 20.04

# 1. RDS & ElastiCache ì¸ìŠ¤í„´ìŠ¤ ìƒì„±

## RDS ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
[ì´ ë¸”ë¡œê·¸](https://kshman94.tistory.com/17)ë¥¼ ì°¸ê³ í•˜ì—¬ ìƒì„±í–ˆë‹¤.

## ElastiCache ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
[ì´ ë¸”ë¡œê·¸](https://devlog-wjdrbs96.tistory.com/314)ë¥¼ ì°¸ê³ í•˜ì—¬ ìƒì„±í–ˆë‹¤.

# 2. AWS EC2ì™€ ì—°ê²°
## EC2ì™€ RDS ì—°ê²°
> ì°¸ê³ <br>
[https://deepmal.tistory.com/9](https://deepmal.tistory.com/9)

### ë³´ì•ˆ ê·¸ë£¹ ì„¤ì •
EC2ì—ì„œ RDSì— ì—°ê²°í•˜ê¸° ìœ„í•´ì„œëŠ” RDSì˜ ë³´ì•ˆê·¸ë£¹ì„ ì„¤ì •í•´ì£¼ì–´ì•¼ í•œë‹¤.
1. EC2 ë³´ì•ˆê·¸ë£¹ ID í™•ì¸ í›„ ë³µì‚¬
2. RDS ì¸ìŠ¤í„´ìŠ¤ì˜ vpc ë³´ì•ˆê·¸ë£¹ í´ë¦­
3. 1ë²ˆì—ì„œ ë³µì‚¬í•œ ê°’ì„ ì¸ë°”ìš´ë“œ ê·œì¹™ì— ì¶”ê°€<br>- ìœ í˜•: MySQL/Aurora<br>- í¬íŠ¸ ë²”ìœ„: 3306<br>- ì†ŒìŠ¤: ì‚¬ìš©ì ì§€ì •<br>- ê°’: EC2ì˜ ë³´ì•ˆê·¸ë£¹ ID (ë³µì‚¬í•œ ê°’)

### mysql cli ì„¤ì¹˜
EC2 ì¸ìŠ¤í„´ìŠ¤ì— ì ‘ì†í•œ ìƒíƒœì—ì„œ ì‹¤í–‰í•œë‹¤.
```
$ sudo apt install mysql-client-core-8.0
```
### mysql ì ‘ì†
```
$ mysql -u [ë§ˆìŠ¤í„° ì‚¬ìš©ì ì´ë¦„] -p -h [RDS ì¸ìŠ¤í„´ìŠ¤ ì—”ë“œí¬ì¸íŠ¸]
```

## EC2ì™€ ElastiCache ì—°ê²°

### ë³´ì•ˆ ê·¸ë£¹ ì„¤ì •
RDSì™€ ë§ˆì°¬ê°€ì§€ë¡œ ë³´ì•ˆê·¸ë£¹ì„ ì„¤ì •í•´ì¤€ë‹¤.
1. EC2 ë³´ì•ˆê·¸ë£¹ ID í™•ì¸ í›„ ë³µì‚¬
2. ElastiCache ì¸ìŠ¤í„´ìŠ¤ì˜ ë³´ì•ˆê·¸ë£¹ í´ë¦­
3. 1ë²ˆì—ì„œ ë³µì‚¬í•œ ê°’ì„ ì¸ë°”ìš´ë“œ ê·œì¹™ì— ì¶”ê°€<br>- ìœ í˜•: ì‚¬ìš©ì ì§€ì • TCP<br>- í¬íŠ¸ ë²”ìœ„: 6379<br>- ì†ŒìŠ¤: ì‚¬ìš©ì ì§€ì •<br>- ê°’: EC2ì˜ ë³´ì•ˆê·¸ë£¹ ID (ë³µì‚¬í•œ ê°’)

### gccì™€ make ì„¤ì¹˜
EC2 ì¸ìŠ¤í„´ìŠ¤ì— ì ‘ì†í•œ ìƒíƒœì—ì„œ ì‹¤í–‰í•œë‹¤.
```
$ sudo apt-get update
$ sudo apt install gcc
$ sudo apt install make
```

### redis cli ì„¤ì¹˜
```
# redis-cli ì„¤ì¹˜ ë° make
$ wget http://download.redis.io/redis-stable.tar.gz && tar xvzf redis-stable.tar.gz && cd redis-stable && make

# redis-clië¥¼ binì— ì¶”ê°€í•´ ì–´ëŠ ìœ„ì¹˜ì„œë“  ì‚¬ìš© ê°€ëŠ¥í•˜ê²Œ ë“±ë¡
$ sudo cp src/redis-cli /usr/bin
```
<img width="558" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-07-22 á„‹á…©á„’á…® 3 14 41" src="https://user-images.githubusercontent.com/59405576/180375150-e57e71f5-04da-4f58-b58a-8f6dff093c7d.png"><br>
ì´ëŸ°ì‹ìœ¼ë¡œ ì„¤ì¹˜ê°€ ì™„ë£Œë˜ì—ˆë‹¤.

### redis ì ‘ì†
```
$ redis-cli -h [ElastiCache ì¸ìŠ¤í„´ìŠ¤ ì—”ë“œí¬ì¸íŠ¸] -p 6379
```
ì´ë•Œ, [ElastiCache ì¸ìŠ¤í„´ìŠ¤ ì—”ë“œí¬ì¸íŠ¸]ëŠ” ì•„ë˜ ì‚¬ì§„ê³¼ ê°™ì€ í˜•íƒœì¸ë°, ë§¨ ë§ˆì§€ë§‰ì˜ `:6379` ë¶€ë¶„ì„ ì œì™¸í•˜ê³  ì…ë ¥í•˜ë©´ ëœë‹¤.<br>
<img width="250" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-07-22 á„‹á…©á„’á…® 3 22 02" src="https://user-images.githubusercontent.com/59405576/180376367-5a43c858-0caa-4100-a181-75200f5ab21d.png">


# 3. Spring Boot í”„ë¡œì íŠ¸ì™€ ì—°ë™
## java 11 ì„¤ì¹˜
```
sudo apt-get install openjdk-11-jdk
```

### +) í˜¹ì‹œ í™˜ê²½ë³€ìˆ˜ë¥¼ ì„¤ì •í•´ì•¼ í•œë‹¤ë©´ ì•„ë˜ë¥¼ ì°¸ê³ í•˜ì
ë¨¼ì € java ìœ„ì¹˜ë¥¼ í™•ì¸í•œë‹¤.
```
which java
readlink -f /usr/bin/java
```
ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í–ˆì„ ë•Œ, ë‚˜ì˜ ê²½ìš°ëŠ” `/usr/lib/jvm/java-11-openjdk-amd64/bin/java` ì´ë ‡ê²Œ ë‚˜ì˜¤ëŠ”ë°,<br>
ë’¤ì— `/bin/java`ë§Œ ì œê±°í•˜ê³  ì•ë¶€ë¶„ê¹Œì§€ë§Œ ë³µì‚¬í•œë‹¤.<br><br>
ë³µì‚¬í•œ ë’¤ì—, ì•„ë˜ ëª…ë ¹ìœ¼ë¡œ í™˜ê²½ì„¤ì • íŒŒì¼ì¸ profileì„ ì—´ì–´ì¤€ë‹¤.
```
sudo vi /etc/profile
```
<img width="546" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-07-13 á„‹á…©á„’á…® 8 04 09" src="https://user-images.githubusercontent.com/59405576/178720554-c1c35127-81cc-468a-99e1-c03bbec91d6b.png">
ê·¸ëŸ¼ ì´ëŸ° íŒŒì¼ì´ ë‚˜ì˜¤ëŠ”ë°, ìœ„ì™€ ê°™ì´ ë§¨ ì•„ë˜ 3ì¤„ì„ ì¶”ê°€í•´ì£¼ë©´ ëœë‹¤. <br><br>
í•´ë‹¹ ì‘ì—…ì´ ëë‚œ ë’¤, ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•´ ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•œë‹¤.

```
source /etc/profile
```
ë§ˆì§€ë§‰ìœ¼ë¡œ í™˜ê²½ë³€ìˆ˜ê°€ ì˜ ì„¸íŒ… ë˜ì—ˆëŠ”ì§€ í™•ì¸í•œë‹¤.
```
echo $JAVA_HOME
```
ì´ ëª…ë ¹ì–´ë¥¼ ì³¤ì„ ë•Œ, ì•„ê¹Œ ë³µì‚¬í•´ì¤€ ìœ„ì¹˜ê°€ ë‚˜íƒ€ë‚˜ê²Œ ëœë‹¤ë©´ ì„±ê³µì´ë‹¤.

> ì°¸ê³ <br>
- [https://chucoding.tistory.com/54](https://chucoding.tistory.com/54)


## git clone
ë‚˜ëŠ” develop ë¸Œëœì¹˜ì—ì„œ ê°€ì ¸ì˜¬ê±°ê¸° ë•Œë¬¸ì— ì•„ë˜ ëª…ë ¹ì„ ì‹¤í–‰í–ˆë‹¤.
```
$ git clone -b [ë¸Œëœì¹˜ ì´ë¦„] --single-branch [ê¹ƒí—™ ì£¼ì†Œ]
```
ì˜ˆì‹œ: `git clone -b develop --single-branch https://github.com/...`

## í™˜ê²½ë³€ìˆ˜ íŒŒì¼ ìƒì„±
`.env`ë“± `.gitignore`ì— ë“±ë¡í•´ë‘” í™˜ê²½ë³€ìˆ˜ íŒŒì¼ì„ ë”°ë¡œ ìƒì„±í•´ì¤€ë‹¤.

## ì½”ë“œ ë³€ê²½ 
### `build.gradle`
```
implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
runtimeOnly 'mysql:mysql-connector-java'

implementation 'org.springframework.boot:spring-boot-starter-data-redis'
implementation 'redis.clients:jedis:3.3.0'
```

### `application.yml`
```yml
spring:
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://${MYSQL_ENDPOINT}:${MYSQL_PORT}/${MYSQL_DATABASE}?serverTimezone=Asia/Seoul&characterEncoding=UTF-8
    username: ${MYSQL_MASTER}
    password: ${MYSQL_PASSWORD}

    redis:
      host: ${REDIS_ENDPOINT}
      port: ${REDIS_PORT} 
```
> ì°¸ê³ <br>
[https://velog.io/@u-nij/Spring-Boot-AWS-RDS-MySQL-%EC%97%B0%EB%8F%99%ED%95%98%EA%B8%B0](https://velog.io/@u-nij/Spring-Boot-AWS-RDS-MySQL-%EC%97%B0%EB%8F%99%ED%95%98%EA%B8%B0)

## í”„ë¡œì íŠ¸ ë¹Œë“œ
```
$ ./gradlew build -x test 
```
í…ŒìŠ¤íŠ¸ ì½”ë“œëŠ” ì œì™¸í•˜ê³  ë¹Œë“œí•œë‹¤.

## ë°°í¬
```
$ cd build/libs // jar íŒŒì¼ ìˆëŠ” ê³³ìœ¼ë¡œ ì´ë™
$ java -jar server-0.0.1-SNAPSHOT.jar
```
í˜¹ì‹œ `application.yml` ê°’ì„ ì˜ëª» ì…ë ¥ í–ˆìœ¼ë©´ ìˆ˜ì •í•´ì£¼ê³  ë‹¤ì‹œ ë¹Œë“œ í•´ì£¼ë©´ ëœë‹¤.<br>
ê¼­ ê°’ì„ ìˆ˜ì •í•´ì£¼ê³  ì¬ë¹Œë“œ í•˜ëŠ” ê²ƒì„ ìŠì§€ ë§ì! 

# 4. ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±
ë§¤ë²ˆ ë³€ê²½ëœ ì½”ë“œë¥¼ pull -> ë¹Œë“œ -> ë°°í¬ ê³¼ì •ì´ ê·€ì°®ìœ¼ë‹ˆ, ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‘ì„±í•´ í•œë²ˆì— í•´ê²°í•˜ì.
## ë””ë ‰í„°ë¦¬ ìƒì„±
```
mkdir app
cd app
mkdir git
cd git
```

## clone ë°›ì€ í”„ë¡œì íŠ¸ ì˜®ê¸°ê¸°
ì´ì „ì— `git clone` ë°›ì€ í”„ë¡œì íŠ¸ë¥¼ `app/git/` ì•ˆìœ¼ë¡œ ì˜®ê¸´ë‹¤.
```
mv -R [ë””ë ‰í† ë¦¬ëª…] [ëª©ì ì§€ ë””ë ‰í† ë¦¬ìœ„ì¹˜]
// mv -R naem-server/ app/git/
```

## `deploy.sh` ìƒì„±
```
~app/git$ vi deploy.sh
```
ì•„ë˜ëŠ” `deploy.sh` ë‚´ìš©ì´ë‹¤.
```
#!/bin/bash

REPOSITORY=/home/ubuntu/app/git
PROJECT_NAME=naem-server

cd $REPOSITORY/$PROJECT_NAME/

echo "> Git Pull"

git pull origin develop

echo "> í”„ë¡œì íŠ¸ Build ì‹œì‘"

./gradlew build -x test

echo "> step1 ë””ë ‰í† ë¦¬ ì´ë™"

cd $REPOSITORY

echo "> Build íŒŒì¼ ë³µì‚¬"

cp $REPOSITORY/$PROJECT_NAME/build/libs/*.jar $REPOSITORY/

echo "> í˜„ì¬ êµ¬ë™ì¤‘ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ pid í™•ì¸"

CURRENT_PID=$(pgrep -f ${PROJECT_NAME}*.jar)

echo "í˜„ì¬ êµ¬ë™ ì¤‘ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ pid: $CURRENT_PID"

if [ -z "$CURRENT_PID" ]; then
   echo "> í˜„ì¬ êµ¬ë™ ì¤‘ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì—†ìœ¼ë¯€ë¡œ ì¢…ë£Œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."
else
   echo "> kill -15 $CURRENT_PID"
   kill -15 $CURRENT_PID
   sleep 5
fi

echo "> ìƒˆ ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬"

JAR_NAME=$(ls -tr $REPOSITORY/ | grep jar | tail -n 1)

echo "> JAR Name: $JAR_NAME"

nohup java -jar $REPOSITORY/$JAR_NAME 2>&1 &
```

<br>
ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰

```
$ chmod +x ./deploy.sh // ê¶Œí•œ ë¶€ì—¬
$ ./deploy.sh
```

<br>
í™•ì¸

```
netstat -ntl
```
<img width="563" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-07-22 á„‹á…©á„’á…® 10 09 59" src="https://user-images.githubusercontent.com/59405576/180446010-9454b630-e0eb-484d-98a1-1b0ba374ca62.png"><br>
8080 í¬íŠ¸ê°€ LISTEN ì„ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

> deploy ìŠ¤í¬ë¦½íŠ¸ ìƒì„±<br>
- [https://velog.io/@swchoi0329/EC2-%EC%84%9C%EB%B2%84%EC%97%90-%EC%8A%A4%ED%94%84%EB%A7%81%EB%B6%80%ED%8A%B8-%EB%B0%B0%ED%8F%AC](https://velog.io/@swchoi0329/EC2-%EC%84%9C%EB%B2%84%EC%97%90-%EC%8A%A4%ED%94%84%EB%A7%81%EB%B6%80%ED%8A%B8-%EB%B0%B0%ED%8F%AC) - ouath ì¶”ê°€
- [https://junjangsee.tistory.com/entry/aws-git?category=981871](https://junjangsee.tistory.com/entry/aws-git?category=981871)

<br>
í”„ë¡œì„¸ìŠ¤ë¥¼ ì¢…ë£Œí•˜ê³  ì‹¶ë‹¤ë©´?

```
$ ps -ef | grep [jar íŒŒì¼ëª…].jar // pid í™•ì¸
$ kill -9 [pid] // í”„ë¡œì„¸ìŠ¤ ì¤‘ë‹¨
```
<img width="747" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-07-22 á„‹á…©á„’á…® 8 48 38" src="https://user-images.githubusercontent.com/59405576/180433226-71349cb2-49c6-4d31-bcd3-9597a653874d.png">


# Ref.
- [https://kanoos-stu.tistory.com/11](https://kanoos-stu.tistory.com/11) - redis
- [https://devlog-wjdrbs96.tistory.com/314](https://devlog-wjdrbs96.tistory.com/314) - redis
- [https://jihyee.tistory.com/21](https://jihyee.tistory.com/21) - mysql RDS
- [https://kshman94.tistory.com/17](https://kshman94.tistory.com/17) - utf8 íŒŒë¼ë¯¸í„° ë³€ê²½







***
<br>

    ğŸ’› ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ğŸ‘»

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}