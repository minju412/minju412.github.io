---
title:  "[EC2] ì¸ìŠ¤í„´ìŠ¤ì— spring boot + docker ë°°í¬ (ë¯¸ì™„ì„±) "

categories:
  - EC2
tags:
  - [AWS, EC2]

toc: true
toc_sticky: true
 
date: 2022-07-20 23:23:11
last_modified_at: 2022-07-20 23:23:13
---
```

ğŸš¨ ì‹œì‘í•˜ê¸° ì „ì—!! ì™„ë²½í•˜ì§€ ì•Šì€ ê²Œì‹œê¸€ì…ë‹ˆë‹¤. 
ê°œì¸ ê¸°ë¡ìš©ì´ë‹ˆ ë”°ë¼í•˜ì‹¤ ë¶„ë“¤ì€ ë‹¤ë¥¸ ê¸€ì„ ì°¸ê³ í•˜ì„¸ìš”ğŸ¥²

```

> í™˜ê²½ì€ ì•„ë˜ì™€ ê°™ë‹¤
- AWS EC2 ubuntu 20.04
- Spring Boot + JAVA 11

ë°°í¬ ë°©ë²•ì—ëŠ” ì•„ë˜ ë‘ê°€ì§€ê°€ ìˆë‹¤.
1. jar íŒŒì¼ì„ ë¹Œë“œí•˜ì—¬ EC2 ë³µì‚¬ í›„ ì‹¤í–‰
2. EC2 ì—ì„œ í”„ë¡œì íŠ¸ git clone í›„ ì‹¤í–‰
ì´ ê¸€ì—ì„œëŠ” 2ë²ˆìœ¼ë¡œ ì§„í–‰í•œë‹¤.<br><br>
ec2 ì¸ìŠ¤í„´ìŠ¤ì— ì ‘ì†í•œ ìƒíƒœë¡œ ì‹œì‘í•œë‹¤.

# 1.EC2 ì¸ìŠ¤í„´ìŠ¤ì— ì„¤ì¹˜
## 1) Git
ê¸°ë³¸ì ìœ¼ë¡œ ì„¤ì¹˜ë˜ì–´ìˆë‹¤ë©´ ìƒëµí•´ë„ ëœë‹¤.
```
sudo apt update
sudo apt install git
```

## 2) Docker ê´€ë ¨
### Docker
```
# íŒ¨í‚¤ì§€ ì—…ë°ì´íŠ¸
sudo apt-get update -y

# ê¸°ì¡´ì— ìˆë˜ ë„ì»¤ ì‚­ì œ
sudo apt-get remove docker docker-engine docker.io -y

# ë„ì»¤ ì„¤ì¹˜
sudo apt-get install docker.io -y

# docker ì„œë¹„ìŠ¤ ì‹¤í–‰
sudo service docker start

# /var/run/docker.sock íŒŒì¼ì˜ ê¶Œí•œì„ 666ìœ¼ë¡œ ë³€ê²½í•˜ì—¬ ê·¸ë£¹ ë‚´ ë‹¤ë¥¸ ì‚¬ìš©ìë„ ì ‘ê·¼ ê°€ëŠ¥í•˜ê²Œ ë³€ê²½
sudo chmod 666 /var/run/docker.sock

# ubuntu ìœ ì €ë¥¼ docker ê·¸ë£¹ì— ì¶”ê°€
sudo usermod -a -G docker ubuntu
```

### Docker Compose
```
# ë„ì»¤ ì»´í¬ì¦ˆ ì„¤ì¹˜
sudo curl \
     -L "https://github.com/docker/compose/releases/download/1.26.2/docker-compose-$(uname -s)-$(uname -m)" \
     -o /usr/local/bin/docker-compose 

# ì‹¤í–‰ ê¶Œí•œ ì ìš©
sudo chmod +x /usr/local/bin/docker-compose 


sudo apt install docker-compose // ë„ì»¤ ì»´í¬ì¦ˆ ì„¤ì¹˜
```

### ì„¤ì¹˜ í™•ì¸
```
# ë„ì»¤ ë²„ì „ í™•ì¸
docker version

# ë„ì»¤ ì»´í¬ì¦ˆ ë²„ì „ í™•ì¸
docker-compose version
```
<img width="473" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-07-21 á„‹á…©á„Œá…¥á†« 12 18 35" src="https://user-images.githubusercontent.com/59405576/180019709-a345bd75-595b-408e-9854-7e317faabbe5.png">



# 2. `git clone`ìœ¼ë¡œ SpringBoot í”„ë¡œì íŠ¸ ê°€ì ¸ì˜¤ê¸°
ë‚˜ëŠ” develop ë¸Œëœì¹˜ì—ì„œ ê°€ì ¸ì˜¬ê±°ê¸° ë•Œë¬¸ì— ì•„ë˜ ëª…ë ¹ì„ ì‹¤í–‰í–ˆë‹¤.
```
git clone -b [ë¸Œëœì¹˜ ì´ë¦„] --single-branch [ê¹ƒí—™ ì£¼ì†Œ]
```

ì˜ˆì‹œ: `git clone -b develop --single-branch https://github.com/...`



# 3. docker-composeë¥¼ í†µí•œ ë„ì»¤ ì´ë¯¸ì§€ ìƒì„±
## 1) `.env` ìƒì„±
`.env`ë“± `.gitignore`ì— ë“±ë¡í•´ë‘” í™˜ê²½ë³€ìˆ˜ íŒŒì¼ì„ ë”°ë¡œ ìƒì„±í•´ì¤€ë‹¤.

## 2) ë¹Œë“œ
```
docker-compose up --build
```




# 4. SpringBoot ë¹Œë“œ
## 1) í”„ë¡œì íŠ¸ í´ë”ë¡œ ì´ë™
```
cd [í”„ë¡œì íŠ¸ í´ë”ëª…]
```
## 2) JDK ì„¤ì¹˜
```
sudo apt-get install openjdk-11-jdk
```
## 3) Gradle ë¹Œë“œ
```
./gradlew build -x test //ğŸŒŸ -x test: í…ŒìŠ¤íŠ¸ ì‹¤í–‰ X
```
## 4) ìƒì„±ëœ `.jar` íŒŒì¼ í™•ì¸
```
cd build/libs
ll
```











======================================================================================================

ë„ì»¤ì»´í¬ì¦ˆ ë§ê³  `docker run`ìœ¼ë¡œ ì»¨í…Œì´ë„ˆ ìƒì„±... 


# 4. Docker mysql, redis ì„¤ì¹˜

## 1) mysql container ìƒì„± 
ë¨¼ì €, EC2 ë³´ì•ˆ ê·¸ë£¹ì— 3306 í¬íŠ¸ë¥¼ ì¶”ê°€í•´ì£¼ì–´ì•¼í•œë‹¤!
```
$ docker pull mysql:8 // mysql ì´ë¯¸ì§€ pull

$ docker run -d -p 3306:3306 -e MYSQL_ROOT_PASSWORD=[ë¹„ë°€ë²ˆí˜¸] --name [ì»¨í…Œì´ë„ˆ ì´ë¦„] -v /docker-data/mysql:/var/lib/mysql mysql:8 --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci // mysql ì»¨í…Œì´ë„ˆ êµ¬ë™
// ë‚˜ëŠ” ì•„ë˜ì™€ ê°™ì´ ì…ë ¥í–ˆë‹¤ (ì˜ˆì‹œ)
// $ docker run -d -p 3306:3306 -e MYSQL_ROOT_PASSWORD=testpasswd --name mysql-db -v /docker-data/mysql:/var/lib/mysql mysql:8 --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci 

$ sudo docker logs [ì»¨í…Œì´ë„ˆ ì´ë¦„] // ì •ìƒ êµ¬ë™ ì—¬ë¶€ í™•ì¸

$ docker exec -it mysql-db /bin/bash
bash-4.4# mysql -u root -p // bashë¥¼ ì´ìš©í•œ ì ‘ì†

$ docker inspect [container ID] // IPAddress í™•ì¸ (172.17.0.2)
$ sudo apt-get install mysql-client // mysql-client ì„¤ì¹˜
$ mysql -u root -p --host 172.17.0.2 --port 3306 // EC2ì—ì„œ mysql ì»¨í…Œì´ë„ˆ ì ‘ì†

/////// docker run --name mysql-db -e MYSQL_ROOT_PASSWORD=mysql -d -p 3306:3306 mysql:8 (ì¼ë‹¨ ì´ê±°ëŠ” ë¬´ì‹œí•˜ê³  ìœ„ì—ê»„ë¡œ)
```
<br>

EC2 ì¸ìŠ¤í„´ìŠ¤ì—ì„œ mysqlì— ì ‘ì†í•œ ë’¤ì— ìœ ì €ë¥¼ ìƒì„±í•œ ë’¤ ê¶Œí•œì„ ë¶€ì—¬í•œë‹¤.
```
mysql> use mysql; // mysql db ì‚¬ìš©

mysql> select host, user from user; // user ì¡°íšŒ

mysql> create user 'mj'@'%' identified by 'ë¹„ë°€ë²ˆí˜¸'; // ê³„ì • ìƒì„±

mysql> GRANT ALL PRIVILEGES ON *.* TO 'mj'@'%'; // ê¶Œí•œ ë¶€ì—¬

mysql> flush privileges; // ë©”ëª¨ë¦¬ì— ë°˜ì˜

mysql> show grants for 'mj'@'%'; // ê¶Œí•œ í™•ì¸
```
<br>

ìƒì„±í•œ ìœ ì €ë¡œ ì ‘ì†í•˜ì—¬ í…Œì´ë¸”ì„ ìƒì„±í•œë‹¤.
```
$ docker exec -it mysql-db /bin/bash

bash-4.4# mysql -u mj -p

mysql> create database naem;

mysql> show databases;
```







## 2) redis container ìƒì„± 
ë§ˆì°¬ê°€ì§€ë¡œ, EC2 ë³´ì•ˆ ê·¸ë£¹ì— 6379 í¬íŠ¸ë¥¼ ì¶”ê°€í•´ì£¼ì–´ì•¼í•œë‹¤!
```
$ docker pull redis:alpine // redis ì´ë¯¸ì§€ pull

$ docker network create redis-netÂ // redis-clië„ êµ¬ë™í•˜ì—¬ ì—°ê²°ì„ ìœ„í•´ì„œ 2ê°œì˜ ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•˜ê¸° ìœ„í•´ docker network êµ¬ì„±

$ docker network ls // ë„¤íŠ¸ì›Œí¬ í™•ì¸

$ docker run --name [ì»¨í…Œì´ë„ˆ ì´ë¦„] -p 6379:6379 --network [ë„¤íŠ¸ì›Œí¬ ì´ë¦„] -v /docker-data/redis -d redis:alpine redis-server --appendonly yes // redis ì»¨í…Œì´ë„ˆ êµ¬ë™
// ë‚˜ëŠ” ì•„ë˜ì™€ ê°™ì´ ì…ë ¥í–ˆë‹¤ (ì˜ˆì‹œ)
// $ docker run --name redis-db -p 6379:6379 --network redis-net -v /docker-data/redis -d redis:alpine redis-server --appendonly yes

$ sudo apt-get install redis-tools // redis-cli ì„¤ì¹˜
$ docker exec -it redis-db redis-cli // redis-clië¥¼ í†µí•´ redis-db ì ‘ê·¼
```

```
//////// $ dockerÂ runÂ -itÂ --networkÂ redis-netÂ --rmÂ redis:alpineÂ redis-cliÂ -hÂ redis-db // redis-clië¡œ redis serverì— ì ‘ì† ( -rm ì†ì„±ì€ í•´ë‹¹ ì»¨í…Œì´ë„ˆê°€ ì´ë¯¸ ìˆìœ¼ë©´ ì‚­ì œí•˜ê³  ì‹¤í–‰)
//////// $ redis-cli -h [EC2 IP] -p 6379 -a password // ì´ê±°ëŠ” ìš°ì„  ì•„ë‹ˆê³  ìœ„ì—êº¼ë¡œ í•˜ê¸°....
```
<br>

+) ì•Œì•„ë‘ë©´ ì¢‹ì€ ë„ì»¤ ëª…ë ¹ì–´<br>
```
$ docker ps -a // ì»¨í…Œì´ë„ˆ í™•ì¸
$ docker rm [ì»¨í…Œì´ë„ˆ ID] // ì»¨í…Œì´ë„ˆ ì‚­ì œ

$ docker images // ì´ë¯¸ì§€ í™•ì¸
$ docker rmi [ì´ë¯¸ì§€ ID] // ì´ë¯¸ì§€ ì‚­ì œ
```

# 5. Docker Hub ì´ìš©
## 1) Dockerfile
```
FROM openjdk:11
ARG JAR_FILE=build/libs/server-0.0.1-SNAPSHOT.jar
COPY ${JAR_FILE} app.jar
EXPOSE 8080
ENTRYPOINT ["java", "-jar", "/app.jar"]
```
## 2) gradle ë¹Œë“œ
```
$ ./gradlew build -x test //ğŸŒŸ -x test: í…ŒìŠ¤íŠ¸ ì‹¤í–‰ X
```
<img width="581" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-07-21 á„‹á…©á„’á…® 4 32 41" src="https://user-images.githubusercontent.com/59405576/180156284-8b211b6d-3558-4350-9965-2655cba7ba33.png"><br>
ì´ëŸ°ì‹ìœ¼ë¡œ ìƒì„±ëœë‹¤.

## 3) Docker Hub
> Docker Hub<br>
[https://hub.docker.com/](https://hub.docker.com/)

### ë ˆí¬ì§€í† ë¦¬ ìƒì„±
1. íšŒì›ê°€ì… ë° ë¡œê·¸ì¸
2. Repositories > Create Repository ë¡œ ë“¤ì–´ê°€ì„œ ë„ì»¤ ë ˆí¬ì§€í† ë¦¬ë¥¼ ìƒì„±
3. Repository ì´ë¦„ê³¼ Publicìœ¼ë¡œ ì„¤ì •í•˜ê³  Create ë¥¼ í´ë¦­

### Docker Build -> ì´ë¯¸ì§€ ìƒì„±
```
// gradle
$ docker build --build-arg DEPENDENCY=build/dependency -t [ë„ì»¤í—ˆë¸Œ ID]/[Repository ì´ë¦„] --platform linux/amd64 .
// ë‚˜ëŠ” ì•„ë˜ì™€ ê°™ì´ ì…ë ¥í–ˆë‹¤ (ì˜ˆì‹œ)
// $ docker build --build-arg DEPENDENCY=build/dependency -t ln8847/naem --platform linux/amd64 .

// maven
$ docker build -t [ë„ì»¤í—ˆë¸Œ ID]/[Repository ì´ë¦„] --platform linux/amd64 .
```

#### ë§Œì•½ ì´ëŸ° ì˜¤ë¥˜ê°€ ë‚œë‹¤ë©´??
<img width="925" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-07-21 á„‹á…©á„’á…® 1 22 29" src="https://user-images.githubusercontent.com/59405576/180129446-5bee8bf4-8dd1-42d8-b626-d74dcdafb675.png">

##### `.dockerignore`
`.dockerignore` íŒŒì¼ì— `volume` ë””ë ‰í„°ë¦¬ë¥¼ ì¶”ê°€í•œë‹¤.
```
### IntelliJ IDEA ###
.idea
*.iws
*.iml
*.ipr

### volume ###
**/docker-data
```
<img width="928" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-07-21 á„‹á…©á„’á…® 1 26 20" src="https://user-images.githubusercontent.com/59405576/180129737-8ab17f36-2f50-4847-b108-b5b51bd69d1b.png"><br>
ì´ì œ ì—ëŸ¬ê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤!

### Docker Image Push
ìœ„ì—ì„œ ìƒì„±í•œ docker image íŒŒì¼ì„ Docker Hubì— pushë¥¼ í•´ì¤€ë‹¤.
```
$ docker login
$ docker push ln8847/naem
```

<img width="1052" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-07-21 á„‹á…©á„’á…® 1 29 02" src="https://user-images.githubusercontent.com/59405576/180129988-521185f1-8e8d-4314-aadb-8d9c79f7bb43.png"><br>

<img width="719" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-07-21 á„‹á…©á„’á…® 1 32 00" src="https://user-images.githubusercontent.com/59405576/180130316-63623671-c8cc-4506-9b23-455e687ff12b.png">

#### í‘¸ì‹œ ì „
<img width="1285" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-07-21 á„‹á…©á„’á…® 1 31 19" src="https://user-images.githubusercontent.com/59405576/180130413-a3939512-80bf-4308-9c84-63d4fe3ad2f9.png">

#### í‘¸ì‹œ í›„
<img width="1275" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-07-21 á„‹á…©á„’á…® 1 33 03" src="https://user-images.githubusercontent.com/59405576/180130418-c6924900-cbda-4a39-b196-b29dfb719ff3.png">

# 5. AWS EC2
AWS EC2 ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ê³ , ë„ì»¤ë¥¼ ì„¤ì¹˜í•œ í›„ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë°°í¬í•´ë³´ë„ë¡ í•˜ì!

```
# ë„ì»¤ ì„¤ì¹˜
sudo yum install docker // ì´ê±°ëŠ” ì´ë¯¸ í•¨....

# ë„ì»¤ ì‹¤í–‰
sudo systemctl start docker // ì´ê²ƒë„ ìœ„ì—ì„œ í•¨....
```

```
# ë„ì»¤ í—ˆë¸Œì— ì¡´ì¬í•˜ëŠ” ì´ë¯¸ì§€ íŒŒì¼ pull
$ sudo docker pull ln8847/naem

# ë„ì»¤ ì´ë¯¸ì§€ë¥¼ í†µí•´ ìŠ¤í”„ë§ ë¶€íŠ¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬
$ sudo docker run --name naem-application -p 8080:8080 ln8847/naem
```




















# Ref.
- [https://velog.io/@haeny01/AWS-EC2-X-Docker-Spring-Boot-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EC%98%AC%EB%A6%AC%EA%B8%B0](https://velog.io/@haeny01/AWS-EC2-X-Docker-Spring-Boot-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EC%98%AC%EB%A6%AC%EA%B8%B0)
- [https://wooogy-egg.tistory.com/55](https://wooogy-egg.tistory.com/55) - ë„ì»¤ ì»´í¬ì¦ˆ ì„¤ì¹˜
- [https://zzang9ha.tistory.com/360](https://zzang9ha.tistory.com/360) - Spring Boot + Docker + AWS EC2 ë°°í¬í•˜ê¸°(MacOS M1)ğŸŒŸ
- [https://fenderist.tistory.com/412](https://fenderist.tistory.com/412) - redis










***
<br>

    ğŸ’› ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ğŸ‘»

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}