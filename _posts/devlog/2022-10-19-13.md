---
title:  "Dockerfileì„ ì´ìš©í•œ spring boot ë°°í¬ "

categories:
  - Devlog
tags:
  - [Devlog]

toc: true
toc_sticky: true
 
date: 2022-10-19 21:36:43
last_modified_at: 2022-10-19 21:36:46
---

ë‚˜ì¤‘ì— mysqlê³¼ redisì— ë³¼ë¥¨ ì„¤ì •ì„ ì¶”ê°€ë¡œ í•´ì•¼í•œë‹¤!<br>
ì¼ë‹¨ ë°°í¬ë¶€í„° ì§„í–‰í•´ë³´ì.

# 0. Ubuntuì— Docker Engine ì„¤ì¹˜
> [ê³µì‹ ì‚¬ì´íŠ¸](https://docs.docker.com/engine/install/ubuntu/)ë¥¼ ì°¸ê³ í–ˆë‹¤.

## Repository ì„¤ì •
```bash
# apt-get ì—…ë°ì´íŠ¸
$ sudo apt-get update

$ sudo apt-get install \
ca-certificates \
curl \
gnupg \
lsb-release

$ sudo mkdir -p /etc/apt/keyrings

$ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg

$ echo \
"deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
$(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
```

## Docker Engine ì„¤ì¹˜ ë° ì‹¤í–‰
```bash
$ sudo apt-get update

# ì„¤ì¹˜
$ sudo apt-get install docker-ce docker-ce-cli containerd.io docker-compose-plugin

# ë„ì»¤ ì‹¤í–‰
$ sudo service docker start

# ìƒíƒœ í™•ì¸
$ sudo service docker status
```


# 1. ë„¤íŠ¸ì›Œí¬ ìƒì„±
```bash
# $ sudo docker system prune

$ sudo docker network ls

# ë„¤íŠ¸ì›Œí¬ ìƒì„±
$ sudo docker network create --gateway 172.18.0.1 --subnet 172.18.0.0/16 naem-network

# ë„¤íŠ¸ì›Œí¬ ëª©ë¡ í™•ì¸
$ sudo docker network ls

# íŠ¹ì • ë„¤íŠ¸ì›Œí¬ ìƒì„¸ ë³´ê¸°
$ sudo docker network inspect naem-network
```

# 2. mysql ê¸°ë™
## 1) `Dockerfile` ì‘ì„±
ë¡œì»¬ì—ì„œ ì§„í–‰í•œë‹¤.<br>
ec2 ì¸ìŠ¤í„´ìŠ¤ì—ì„œ ì‚¬ìš©í•  ë•Œì—ëŠ” ë„ì»¤ í—ˆë¸Œì—ì„œ pull ë°›ì•„ì„œ ì‚¬ìš©í•œë‹¤.
```Dockerfile
FROM mysql

# ADD ./mysql-init-files /docker-entrypoint-initdb.d

ENV MYSQL_ROOT_PASSWORD naem2524!
ENV MYSQL_DATABASE naem

EXPOSE 3306
```

## 2) ì´ë¯¸ì§€ ë¹Œë“œ ë° ë„ì»¤ í—ˆë¸Œì— ì—…ë¡œë“œ
ë¡œì»¬ì—ì„œ ì§„í–‰í•œë‹¤.
```bash
# ì´ë¯¸ì§€ íŒŒì¼ ë¹Œë“œ
$ docker build \
--platform linux/x86_64 \
-t ln8847/naem_mysql:1.0 .

# $ docker build \
# --build-arg DEPENDENCY=build/dependency \
# -t ln8847/naem_mysql:1.0 .

# $ docker build -t ln8847/naem_mysql:1.0 .

# ìƒì„±ëœ ì´ë¯¸ì§€ í™•ì¸
$ docker images | grep naem_mysql

# ë„ì»¤ í—ˆë¸Œì— ì—…ë¡œë“œ
$ docker push ln8847/naem_mysql:1.0
```

## 3) ë„ì»¤ ì»¨í…Œì´ë„ˆ ì‹¤í–‰
ec2 ì¸ìŠ¤í„´ìŠ¤ì—ì„œ ì§„í–‰í•œë‹¤.
```bash
# ì»¨í…Œì´ë„ˆ ì‹¤í–‰
$ sudo docker run --platform linux/x86_64 -d -p 3306:3306 --network naem-network \
--name mysql \
ln8847/naem_mysql:1.0

# ë§Œì•½ ì»¨í…Œì´ë„ˆê°€ ì—ëŸ¬ë¡œ ì¢…ë£Œë˜ì—ˆë‹¤ë©´
$ sudo docker system prune # ë„¤íŠ¸ì›Œí¬ì— ì—°ê²°ëœ ì»¨í…Œì´ë„ˆê°€ ì—†ë‹¤ë©´ ë„¤íŠ¸ì›Œí¬ê°€ ì‚­ì œëœë‹¤!

# ì»¨í…Œì´ë„ˆ ëª©ë¡ í™•ì¸
$ sudo docker ps -a

# ë¡œê·¸ í™•ì¸
$ sudo docker logs mysql
```


# 3. redis ê¸°ë™
## 1) `Dockerfile` ì‘ì„±
```Dockerfile
FROM redis

# ENV MYSQL_ROOT_PASSWORD naem2524!
# ENV MYSQL_DATABASE naem

EXPOSE 6379
```

## 2) ì´ë¯¸ì§€ ë¹Œë“œ ë° ë„ì»¤ í—ˆë¸Œì— ì—…ë¡œë“œ
```bash
# ì´ë¯¸ì§€ íŒŒì¼ ë¹Œë“œ
$ docker build -t ln8847/naem_redis:1.0 .

# ìƒì„±ëœ ì´ë¯¸ì§€ í™•ì¸
$ docker images | grep naem_redis

# ë„ì»¤ í—ˆë¸Œì— ì—…ë¡œë“œ
$ docker push ln8847/naem_redis:1.0
```

## 3) ë„ì»¤ ì»¨í…Œì´ë„ˆ ì‹¤í–‰
```bash
# ì»¨í…Œì´ë„ˆ ì‹¤í–‰
$ docker run -d -p 6379:6379 --network naem-network \
--name redis \
ln8847/naem_redis:1.0

# ë¡œê·¸ í™•ì¸
$ docker logs redis
```


# 4. spring boot ê¸°ë™
## 1) `Dockerfile` ì‘ì„±
```Dockerfile
FROM openjdk:11

# VOLUME /tmp

COPY build/libs/server-0.0.1-SNAPSHOT.jar Server.jar

ENTRYPOINT ["java","-jar","Server.jar"]

EXPOSE 8080
```

## 2) ì´ë¯¸ì§€ ë¹Œë“œ ë° ë„ì»¤ í—ˆë¸Œì— ì—…ë¡œë“œ
```bash
# ìµœì‹  ë²„ì „ìœ¼ë¡œ ì»´íŒŒì¼
# $ mvn clean compile package -DskipTests=true
$ ./gradlew build -x test
# cleanì€ ê¸°ì¡´ íŒŒì¼ì„ ì§€ìš´ë‹¤.
# package ì˜µì…˜ìœ¼ë¡œ jar íŒŒì¼ê¹Œì§€ ìƒì„±í•  ìˆ˜ ìˆë‹¤.
# í…ŒìŠ¤íŠ¸ ì½”ë“œëŠ” skip

# ì´ë¯¸ì§€ íŒŒì¼ ë¹Œë“œ
$ docker build -t ln8847/naem-backend:1.0  .

# ìƒì„±ëœ ì´ë¯¸ì§€ í™•ì¸
$ docker images | grep naem-backend

# ë„ì»¤ í—ˆë¸Œì— ì—…ë¡œë“œ
$ docker push ln8847/naem-backend:1.0
```

## 3) ë„ì»¤ ì»¨í…Œì´ë„ˆ ì‹¤í–‰
```bash
$ docker run -d --network naem-network \
-e "spring.datasource.url=jdbc:mysql://mysql:3306/naem?serverTimezone=Asia/Seoul&characterEncoding=UTF-8&useSSL=false&allowPublicKeyRetrieval=true" \
-e "spring.redis.host=redis" \
--name naem-backend \
ln8847/naem-backend:1.0
```















***
<br>


    ğŸ’› ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ğŸ‘»

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}