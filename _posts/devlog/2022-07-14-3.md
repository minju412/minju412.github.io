---
title:  "[Naem] `[ë³„ë„ì´ë¦„].yml`ì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (for í™˜ê²½ë³€ìˆ˜ ê´€ë¦¬) "
# excerpt: "sprintfì— ëŒ€í•´ ì•Œì•„ë³´ì"

categories:
  - Devlog
tags:
  - [Devlog]

toc: true
toc_sticky: true
 
date: 2022-07-14 11:01:26
last_modified_at: 2022-07-14 11:01:29
---

redis ì—°ê²°ì„ ìœ„í•´ `RedisConfig.java`ë¥¼ ì‘ì„±í•´ì•¼ í–ˆëŠ”ë°,<br>
ì´ë•Œ `port`ì™€ `host` ì •ë³´ë¥¼ ì§ì ‘ ì ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ë”°ë¡œ `secret.yml`ì— ê¸°ì…í•œ ë’¤ì—, <br>
í•´ë‹¹ íŒŒì¼ì€ `.gitignore`ë¥¼ í†µí•´ ê¹ƒì— ì˜¬ë¦¬ì§€ ì•Šê³  í•´ë‹¹ ì •ë³´ë§Œ ê°€ì ¸ì™€ì„œ ì‚¬ìš©í•˜ê³  ì‹¶ì—ˆë‹¤.<br><br>
ì•„ë˜ì™€ ê°™ì´ í™˜ê²½ë³€ìˆ˜ë¥¼ ë‹´ì€ `yml` íŒŒì¼ì´ ì¡´ì¬í•œë‹¤.
`secret.yml`
```yml
redis:
  host: localhost
  port: 6379
cache:
  type: redis
```
ì´ íŒŒì¼ì€ `.gitignore`ì— ë“±ë¡í•˜ì—¬ ê¹ƒì— ì˜¬ë¼ê¸°ì§€ ì•Šë„ë¡ í•œë‹¤.

# 1. `YamlPropertySourceFactory.java` ì‘ì„±
```java
public class YamlPropertySourceFactory implements PropertySourceFactory {

    @Override
    public PropertySource<?> createPropertySource(@Nullable String name, EncodedResource resource) throws IOException {
        Properties propertiesFromYaml = loadYamlIntoProperties(resource);
        String sourceName = name != null ? name : resource.getResource().getFilename();
        return new PropertiesPropertySource(sourceName, propertiesFromYaml);
    }

    private Properties loadYamlIntoProperties(EncodedResource resource) throws FileNotFoundException {
        try {
            YamlPropertiesFactoryBean factory = new YamlPropertiesFactoryBean();
            factory.setResources(resource.getResource());
            factory.afterPropertiesSet();
            return factory.getObject();
        } catch (IllegalStateException e) {
            // for ignoreResourceNotFound
            Throwable cause = e.getCause();
            if (cause instanceof FileNotFoundException) {
                throw (FileNotFoundException)e.getCause();
            }
            throw e;
        }
    }
}

```
`application.yml` íŒŒì¼ì´ ì•„ë‹Œ, ì„ì˜ë¡œ ìƒì„±í•œ `yml` íŒŒì¼ì„ ì½ê¸° ìœ„í•´ í•„ìš”í•œ í´ë˜ìŠ¤ì´ë‹¤.<br>
`PropertySourceFactory`ë¥¼ ìƒì†ë°›ì•„ êµ¬í˜„í•œë‹¤.

# 2. `SecretYamlRead.java` ì‘ì„±
```java
@Configuration
@PropertySource(value = "classpath:secret.yml", factory = YamlPropertySourceFactory.class) //valueë¥¼ í†µí•´ ê°’ì´ ìˆëŠ” ìœ„ì¹˜ë¥¼ ëª…ì‹œí•´ì¤€ë‹¤.
@ConfigurationProperties(prefix = "redis") // classpathì— ì ì€ yml íŒŒì¼ì—ì„œ ê°€ì ¸ì˜¬ ë³€ìˆ˜ ì´ë¦„ì„ ëª…ì‹œí•´ì¤€ë‹¤.
@Getter
@Setter
public class SecretYamlRead {

    private String host;
    private String port;

}
```
`secretYamlRead`ì— í•„ìš”í•œ ê²ƒì€ ë‘ ê°€ì§€ì´ë‹¤.
1. `secret.yml`
2. `YamlPropertySourceFactory`


# 3. `RedisConfig.java` ì‘ì„±
```java
@Configuration
public class RedisConfig {

    // ===========================================
    @Autowired
    private SecretYamlRead secretYamlRead;

    String host = secretYamlRead.getHost();
    int port = Integer.parseInt(secretYamlRead.getPort());
    // ===========================================

    @Bean
    public RedisConnectionFactory redisConnectionFactory() {
        return new LettuceConnectionFactory(host, port);
    }

    @Bean
    public RedisTemplate<?, ?> redisTemplate() {
        RedisTemplate<?, ?> redisTemplate = new RedisTemplate<>();
        redisTemplate.setConnectionFactory(redisConnectionFactory());
        return redisTemplate;
    }
}
```
ê°•ì¡°í•œ ë¶€ë¶„ì„ ì£¼ëª©í•˜ë©´ ëœë‹¤.<br>
ì´ì²˜ëŸ¼ `secretYamlRead`ë¥¼ í†µí•´ `host`ì™€ `port` ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.





# Ref.
- [https://koogood.tistory.com/23](https://koogood.tistory.com/23)
- [https://vsh123.github.io/spring%20boot/spring-boot-yml/](https://vsh123.github.io/spring%20boot/spring-boot-yml/)


***
<br>


    ğŸ’› ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ğŸ‘»

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}