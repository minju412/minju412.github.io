---
title:  "[SonarQube] ì  í‚¨ìŠ¤ì™€ ì†Œë‚˜íë¸Œ ì—°ë™í•˜ê¸°"

categories:
  - Devlog
tags:
  - [Devlog]

toc: true
toc_sticky: true
 
date: 2023-03-16 18:00:48
last_modified_at: 2023-03-16 18:00:51
---


> [ì´ ê¸€](https://minju412.github.io/devlog/21/)ì—ì„œ ì  í‚¨ìŠ¤ë¥¼ ë„ì…í•´ë³´ì•˜ë‹¤. ì´ë²ˆì—ëŠ” ì  í‚¨ìŠ¤ì™€ ì†Œë‚˜íë¸Œë¥¼ ì—°ë™í•˜ì—¬ ì •ì  ê²€ì‚¬ë¥¼ í†µí•´ ì½”ë“œ í’ˆì§ˆì„ í–¥ìƒì‹œì¼œë³´ì.


# 1. SonarQube ì„¤ì¹˜í•˜ê¸° (with. Docker Compose)

> [ì´ ê¸€](https://gblee1987.tistory.com/105)ì„ ì°¸ê³ í–ˆë‹¤.

ì„¤ì¹˜ ìˆœì„œëŠ” ì•„ë˜ì™€ ê°™ë‹¤.
1. AWS EC2ì— `docker-compose`ë¥¼ ë¨¼ì € ì„¤ì¹˜í•œë‹¤.
2. ì´í›„ `docker-compose.yml` íŒŒì¼ì„ ì´ìš©í•´ sonarqubeë¥¼ êµ¬ë™í•œë‹¤. (dockerëŠ” ë¯¸ë¦¬ ì„¤ì¹˜ë˜ì–´ ìˆë‹¤ê³  ê°€ì •)
3. sonar rule ì„¸íŒ…ì€ í•˜ì§€ ì•ŠëŠ”ë‹¤.
4. default ID/PasswordëŠ” `admin`/`admin` ì´ë‹¤.

## 1) í´ë” ë§Œë“¤ê¸°
ìš°ë¶„íˆ¬ ì¸ìŠ¤í„´ìŠ¤ì— ì ‘ì†í•´ì„œ ì§„í–‰í•œë‹¤.<br>
`docker` í´ë” ìƒì„± í›„(ë‚˜ëŠ” ì  í‚¨ìŠ¤ë¥¼ ë„ì»¤ì»´í¬ì¦ˆë¥¼ í†µí•´ ì‹¤í–‰í•˜ê³  ìˆê¸° ë•Œë¬¸ì— ì´ë¯¸ ë§Œë“¤ì–´ì ¸ ìˆì—ˆë‹¤) ê·¸ ì•ˆì— `sonarqube` í´ë”ë¥¼ ë§Œë“¤ì.<br><br>
ê·¸ë¦¬ê³  `sonarqube` í´ë” ì•ˆì— `docker-compose.yml`ì„ ìƒì„±í•˜ì.<br>
í´ë” êµ¬ì¡°ëŠ” ì•„ë˜ì™€ ê°™ë‹¤.
```
docker
â¿ sonarqube
 â¿ docker-compose.yml
```

## 2) docker compose ì‘ì„±
```yml
version: "2"

services:
  sonarqube:
    image: sonarqube:lts
    container_name: sonarqube
    ports:
      - "9000:9000"
    ulimits:
      nofile:
        soft: "262144"
        hard: "262144"
    networks:
      - sonarnet
    environment:
      - sonar.jdbc.url=jdbc:postgresql://db:5432/sonar
    volumes:
      - sonarqube_conf:/opt/sonarqube/conf
      - sonarqube_data:/opt/sonarqube/data
      - sonarqube_extensions:/opt/sonarqube/extensions
      - sonarqube_logs:/opt/sonarqube/logs

  db:
    image: postgres
    container_name: postgres_sonar
    ports:
      - "5432:5432"
    networks:
      - sonarnet
    environment:
      - POSTGRES_USER=sonar
      - POSTGRES_PASSWORD=sonar
    volumes:
      - postgresql:/var/lib/postgresql
      - postgresql_data:/var/lib/postgresql/data

networks:
  sonarnet:
    driver: bridge

volumes:
  sonarqube_conf:
  sonarqube_data:
  sonarqube_extensions:
  sonarqube_logs:
  postgresql:
  postgresql_data:
```

- sonarqubeì™€ dbë¼ëŠ” ì„œë¹„ìŠ¤ (ë„ì»¤ ì»¨í…Œì´ë„ˆ)ë¡œ êµ¬ì„±ë˜ê³  ì´ë“¤ê°„ì€ bridgeëª¨ë“œë¡œ ë„¤íŠ¸ì›Œí¬ë¥¼ ì„œë¡œ ì—°ê²°í•œë‹¤. (db:5432/sonar ë¡œ ìš”ì²­ê°€ëŠ¥í•œ ì´ìœ ê°€ ì´ê²ƒì„)
- ulimits ì´í•˜ ë¶€ë¶„ì´ ì—†ìœ¼ë©´ ê¸°ë™ì‹œì— `max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]` ë“±ê³¼ ê°™ì€ ì˜¤ë¥˜ê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.
  - (í˜¸ìŠ¤íŠ¸ ì„œë²„) rootë¡œ í•´ë‹¹ íŒŒì¼ì„ ì˜¤í”ˆí•œë‹¤.<br>(ë‹¹ì¥ ì ìš©ì€ CLIì—ì„œ sudo sysctl -w vm.max_map_count=262144 )
  ```
  vi /etc/sysctl.conf
  # ì•„ë˜ ë‚´ìš© ì¶”ê°€
  vm.max_map_count=262144
  ```

  - (docker-compose.yml) ì•„ë˜ ë‚´ìš© ì¶”ê°€
  ```
  ulimits:
    nofile:
      soft: "262144"
      hard: "262144"
  ```

- AWS EC2ìœ„ì—ì„œ ì…‹ì—…í–ˆìœ¼ë¯€ë¡œ Security Groupì—ì„œ `9000` í¬íŠ¸ë¥¼ ì˜¤í”ˆí•œë‹¤.<br>
(DB ì ‘ì† í•„ìš”ì‹œ `5432` í¬íŠ¸ë„ ì˜¤í”ˆ)


## 3) SonarQube ì‹¤í–‰
```bash
$ docker-compose up -d
```

## 4) ë¸Œë¼ìš°ì € ì ‘ì†
`http://[EC2_IP]:9000`ìœ¼ë¡œ ì ‘ì†í•˜ë©´ ì•„ë˜ì™€ ê°™ì€ í™”ë©´ì´ ëœ¬ë‹¤.<br>
<img width="727" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-03-16 á„‹á…©á„’á…® 10 36 30" src="https://user-images.githubusercontent.com/59405576/225633966-14d1f6fe-c075-4722-9010-e2e0a3819bdd.png"><br>

ì´ˆê¸°ì—ëŠ” `ID`ì™€ `Password` ëª¨ë‘ `admin`ì´ë‹¤.<br>
ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ í›„ ë¡œê·¸ì¸í•˜ë©´ ì•„ë˜ì™€ ê°™ì€ í™”ë©´ì´ ë‚˜ì˜¨ë‹¤.<br>
<img width="1379" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-03-16 á„‹á…©á„’á…® 10 40 14" src="https://user-images.githubusercontent.com/59405576/225634949-a525dd1c-a8ed-4c28-9710-d0696411727c.png">



# 2. Jenkinsì™€ ì—°ë™í•˜ê¸°

> [ì´ ê¸€](https://velog.io/@pymin1012/Jenkins-Sonarqube-%EC%97%B0%EB%8F%99)ê³¼ [ì´ ê¸€](https://zunoxi.tistory.com/105)ì„ ì°¸ê³ í–ˆë‹¤.

## 1) Sonarqube Token ìƒì„±
ì†Œë‚˜íë¸Œ ë¸Œë¼ìš°ì €ì— ì ‘ì†í•œ ë’¤ ì‹œì‘í•˜ì!<br><br>
Administration -> Security -> Users -> Tokens ë²„íŠ¼ì„ ëˆŒëŸ¬ì„œ Tokenì„ ìƒì„±í•œë‹¤.

<img width="1404" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-03-16 á„‹á…©á„’á…® 10 57 19" src="https://user-images.githubusercontent.com/59405576/225640379-94b6521b-5416-46c4-a3ce-d1d1b891c832.png"><br><br>
Generate Tokens ì…ë ¥ì°½ ì•ˆì— Token ëª…ì„ ì…ë ¥í•œë’¤ Generate ë²„íŠ¼ì„ ëˆ„ë¥¸ë‹¤. (ë‚˜ëŠ” `jenkinsXsonar`ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ í† í°ì„ ìƒì„±í–ˆë‹¤.)<br>
ì´í›„ í† í° ê°’ì´ ìƒì„±ë˜ë©´ copy ë²„íŠ¼ì„ ëˆ„ë¥´ê³  ë©”ëª¨ì¥ ê°™ì€ ë…¸íŠ¸ ì–´í”Œì— ë³µì‚¬í•´ ë‘ë„ë¡ í•œë‹¤. <br>
<img width="1059" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-03-17 á„‹á…©á„Œá…¥á†« 11 19 45" src="https://user-images.githubusercontent.com/59405576/225795826-9bdcd2e0-03dd-488d-a86b-45014d243007.png">

## 2) Sonarqube í”„ë¡œì íŠ¸ ìƒì„±
ë‹¤ìŒì€ ì  í‚¨ìŠ¤ì™€ ì—°ë™í•  ì†Œë‚˜íë¸Œ í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•œë‹¤. <br>
### Projects -> Add a project ë²„íŠ¼ì„ ëˆŒëŸ¬ ìƒˆë¡œìš´ Sonarqube í”„ë¡œì íŠ¸ ìƒì„±
<img width="1362" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-03-16 á„‹á…©á„’á…® 11 03 50" src="https://user-images.githubusercontent.com/59405576/225642063-1c294b68-4913-40d8-bc7e-ffbb6eca6b02.png"><br><br>

### Project Key ë° Display Name ì…ë ¥
<img width="490" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-03-16 á„‹á…©á„’á…® 11 07 05" src="https://user-images.githubusercontent.com/59405576/225642781-def88001-2e92-4e07-a11f-900c08689829.png">

## 3) Jenkins SonarQube Scanner Plugin ì¶”ê°€ ë° ì„¤ì •
ì—¬ê¸°ì„œë¶€í„°ëŠ” ì  í‚¨ìŠ¤ ë¸Œë¼ìš°ì €ì— ì ‘ì†í•˜ì—¬ ì§„í–‰í•œë‹¤.

### Jenkins ê´€ë¦¬ -> Plugin Managerì—ì„œ SonarQube Scanner í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜
ì  í‚¨ìŠ¤ì—ì„œ ì†Œë‚˜íë¸Œì™€ ì—°ë™í•  ìˆ˜ ìˆëŠ” í”ŒëŸ¬ê·¸ì¸ì„ ì„¤ì¹˜í•œë‹¤. í”ŒëŸ¬ê·¸ì¸ì€ Jenkinsì›¹í˜ì´ì§€ ì¢Œì¸¡ ë©”ë‰´ì—ì„œ ì—ì„œ Jenkinsê´€ë¦¬ > í”ŒëŸ¬ê·¸ì¸ ê´€ë¦¬ë¥¼ í´ë¦­ í›„, ì„¤ì¹˜ ê°€ëŠ¥ íƒ­ì„ í´ë¦­í•œë‹¤. ì´í›„ ê²€ìƒ‰ì°½ì— ì•„ë˜ì™€ ê°™ì´ "Sonarqube scanner" ë¥¼ ì…ë ¥ í›„ ì²´í¬ë°•ìŠ¤ë¥¼ ì„ íƒí•˜ê³  Install without restartë¥¼ ì„ íƒí•˜ì—¬ ì„¤ì¹˜í•œë‹¤.<br>
<img width="1654" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-03-16 á„‹á…©á„’á…® 11 10 22" src="https://user-images.githubusercontent.com/59405576/225643897-46f08657-2726-4360-9ed6-9c975e68a6ba.png">


### Jenkins ê´€ë¦¬ -> Global Tool Configurationì—ì„œ SonarQube Scanner ì¶”ê°€
Jenkinsê´€ë¦¬ ë©”ë‰´ì—ì„œ Global Tool Configuration í´ë¦­í•œë‹¤. ë°”ë¡œ ì „ í”ŒëŸ¬ê·¸ì¸ì„ ì„¤ì¹˜í–ˆê¸° ë•Œë¬¸ì— SonarQube Scannerë¼ëŠ” í•­ëª©ì´ í™•ì¸ ê°€ëŠ¥í•˜ë‹¤. 'Add SonarQube Scanner' í´ë¦­, ìŠ¤ìºë„ˆì˜ ì´ë¦„ì„ ì •í•˜ê³  ë²„ì „ í™•ì¸ í›„ ì €ì¥ë²„íŠ¼ì„ í´ë¦­ (ë‚˜ëŠ” versionì„ ë”°ë¡œ ì§€ì •í•˜ì§€ ì•Šì•˜ë‹¤.)<br>
<img width="1650" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-03-16 á„‹á…©á„’á…® 11 15 37" src="https://user-images.githubusercontent.com/59405576/225645228-03474827-c3bc-43a2-8c0c-822c6cba93a9.png">

### Jenkins ê´€ë¦¬ -> ì‹œìŠ¤í…œ ì„¤ì •ì—ì„œ SonarQube servers ì„¤ì •
jenkinsê´€ë¦¬ì— ì‹œìŠ¤í…œ ì„¤ì • ë©”ë‰´ë¥¼ í´ë¦­ í›„ SonarQube servers í•­ëª©ì˜ 'Add SonarQube'ë¥¼ í´ë¦­í•œë‹¤. <br>
ì´í›„ í™•ì¸ë˜ëŠ” í™•ì¥ íƒ­ì—ì„œ Serverì´ë¦„ì„ ê¸°ì…í•˜ê³  í˜„ì¬ ì†Œë‚˜íë¸Œê°€ êµ¬ë™ë˜ê³  ìˆëŠ” ipì™€ portë¥¼ ì…ë ¥í•˜ê³  ì €ì¥í•œë‹¤. (ë‚˜ëŠ” ì†Œë‚˜íë¸Œë¥¼ êµ¬ë™í•˜ê³  ìˆëŠ” EC2 IPë¥¼ ì ì—ˆë‹¤.)<br>
<img width="1645" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-03-16 á„‹á…©á„’á…® 11 19 33" src="https://user-images.githubusercontent.com/59405576/225646434-ff56a693-2026-47e1-8e23-c904b72c5dd1.png">


## 4) Jenkins Item êµ¬ì„± ì„¤ì •
### Jenkins Item -> êµ¬ì„± ì„ íƒ
<img width="1671" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-03-16 á„‹á…©á„’á…® 11 21 49" src="https://user-images.githubusercontent.com/59405576/225647024-4e92872a-5e31-4a2d-ad54-f38473e235d6.png">

### Add build stepì—ì„œ Execute SonarQube Scanner ì„ íƒ
<img width="1661" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-03-16 á„‹á…©á„’á…® 11 24 09" src="https://user-images.githubusercontent.com/59405576/225647684-bbbbc6bb-7fdb-413f-bf8e-bef3ff975aa0.png">

### í•­ëª© ì¤‘ `Analysis properties`ì— ì•„ë˜ ë‚´ìš© ê¸°ì…
```
sonar.login=*****************************************
sonar.projectKey=sonarpilot
sonar.projectName=sonarpilot
sonar.host.url=http://*****:9000/
sonar.report.export.path=sonar-report.json
detekt.sonar.kotlin.config.path=default-detekt-config.yml
sonar.sources=src/main/java,src/main/resources
sonar.java.sourcesion=1.0
sonar.sourceEncoding=UTF-8
sonar.java.binaries=build/classes
```

- `sonar.login`: ì†Œë‚˜íë¸Œì—ì„œ ë°œê¸‰í•œ token (ì´ì „ì— ë³µì‚¬í•´ë‘ì—ˆë˜ í† í° ê°’ ì‚¬ìš©!)
- `sonar.projectKey`: ì†Œë‚˜íë¸Œ í”„ë¡œì íŠ¸ ìƒì„± ì‹œ Key ê°’
- `sonar.projectName`: ì†Œë‚˜íë¸Œ í”„ë¡œì íŠ¸ ì´ë¦„
- `sonar.host.url`: ì†Œë‚˜íë¸Œ ìŠ¤ìºë„ˆê°€ êµ¬ë™ë˜ê³  ìˆëŠ” `ip:port` (í•„ìì˜ ê²½ìš° 9000ë²ˆ í¬íŠ¸ ì‚¬ìš©)
- `sonar.java.binaries`: gradleì´ë¼ë©´ `build/classes`, mavenì´ë¼ë©´ `target/classes`ë¥¼ ì‘ì„±í•œë‹¤.

<img width="1658" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-03-16 á„‹á…©á„’á…® 11 27 54" src="https://user-images.githubusercontent.com/59405576/225648908-ec44336a-575a-4a95-9ef2-b6665be8da41.png">



### ì €ì¥ í›„ Build nowë¥¼ í´ë¦­í•˜ì—¬ Buildê°€ ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ”ì§€ í™•ì¸í•œë‹¤.
<img width="739" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-03-17 á„‹á…©á„Œá…¥á†« 12 05 29" src="https://user-images.githubusercontent.com/59405576/225659703-ba7bed15-75cb-4508-a581-5d114473746d.png">

## 5) Sonarqube ê²°ê³¼ í™”ë©´
ë°°í¬í•  ì›ê²©ì„œë²„ì˜ ip:portë¥¼ í†µí•´ ë¹Œë“œê°€ ì •ìƒì ìœ¼ë¡œ ì´ë£¨ì–´ì§ì´ í™•ì¸ë˜ì—ˆë‹¤ë©´, <br>
Sonarqubeê°€ ì„¤ì¹˜ëœ `http://ip:port`ë¡œ ì ‘ì†í•˜ì—¬ ìƒì„±í–ˆë˜ projectì— ë¶„ì„ Overviewê°€ ì¶œë ¥ë˜ì—ˆëŠ”ì§€ í™•ì¸í•œë‹¤.<br>
<img width="1413" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-03-17 á„‹á…©á„Œá…¥á†« 12 08 06" src="https://user-images.githubusercontent.com/59405576/225660339-51384249-31ff-40b5-a0f4-4d3e768ac3c7.png"><br><br>
í”„ë¡œì íŠ¸ -> `Issues`ì—ì„œ ì•„ë˜ì™€ ê°™ì´ ìƒì„¸í•œ ì •ë³´ë“¤ì„ ë³¼ ìˆ˜ ìˆë‹¤. <br>
<img width="1357" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-03-17 á„‹á…©á„Œá…¥á†« 12 09 40" src="https://user-images.githubusercontent.com/59405576/225660987-609f5361-a9bf-4248-8216-15c4ab224a0f.png">

> [ì´ ê¸€](https://seller-lee.github.io/static-code-analysis-part3)ì„ ì°¸ê³ í–ˆë‹¤.

SonarQubeì—ì„œ ê´€ë¦¬í•´ì£¼ëŠ” ì†Œí”„íŠ¸ì›¨ì–´ í’ˆì§ˆì— ëŒ€í•´ ê°„ë‹¨í•˜ê²Œ ì†Œê°œí•´ë³´ë©´
- Code Smell : ì‹¬ê°í•œ ì´ìŠˆëŠ” ì•„ë‹ˆì§€ë§Œ ë² ìŠ¤íŠ¸ í”„ë ‰í‹°ìŠ¤ì—ì„œ ì‚¬ì†Œí•œ ì´ìŠˆë“¤ë¡œ ëª¨ë“ˆì„±(modularity), ì´í•´ê°€ëŠ¥ì„±(understandability), ë³€ê²½ê°€ëŠ¥ì„±(changeability), í…ŒìŠ¤íŠ¸ìš©ì˜ì„±(testability), ì¬ì‚¬ìš©ì„±(reusability) ë“±ì´ í¬í•¨ëœë‹¤.
- Bugs : ì¼ë°˜ì ìœ¼ë¡œ ì ì¬ì ì¸ ë²„ê·¸ í˜¹ì€ ì‹¤í–‰ì‹œê°„ì— ì˜ˆìƒë˜ëŠ” ë™ì‘ì„ í•˜ì§€ ì•ŠëŠ” ì½”ë“œë¥¼ ë‚˜íƒ€ë‚¸ë‹¤.
- Vulnerabilities : í•´ì»¤ë“¤ì—ê²Œ ì ì¬ì ì¸ ì•½ì ì´ ë  ìˆ˜ ìˆëŠ” ë³´ì•ˆìƒì˜ ì´ìŠˆë¥¼ ë§í•œë‹¤. SQL ì¸ì ì…˜, í¬ë¡œìŠ¤ ì‚¬ì´íŠ¸ ìŠ¤í¬ë¦½íŒ…ê³¼ ê°™ì€ ë³´ì•ˆ ì·¨ì•½ì„±ì„ ì°¾ì•„ë‚¸ë‹¤.
- Duplications : ì½”ë“œ ì¤‘ë³µì€ ì½”ë“œì˜ í’ˆì§ˆì„ ì €í•´ì‹œí‚¤ëŠ” ê°€ì¥ í° ìš”ì¸ ì¤‘ í•˜ë‚˜ì´ë‹¤.
- Unit Test : ë‹¨ìœ„í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ë¥¼ í†µí•´ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ì˜ ìˆ˜í–‰ ì •ë„ì™€ ìˆ˜í–‰í•œ í…ŒìŠ¤íŠ¸ì˜ ì„±ê³µ/ì‹¤íŒ¨ ì •ë³´ë¥¼ ì œê³µí•œë‹¤.
- Complexity : ì½”ë“œì˜ ìˆœí™˜ ë³µì¡ë„, ì¸ì§€ ë³µì¡ë„ë¥¼ ì¸¡ì •í•©ë‹ˆë‹¤.
- Size : ì†ŒìŠ¤ì½”ë“œ ì‚¬ì´ì¦ˆì™€ ê´€ë ¨ëœ ë‹¤ì–‘í•œ ì§€í‘œë¥¼ ì œê³µí•©ë‹ˆë‹¤.

(ğŸ‰ ì´ì œ ì—´ì‹¬íˆ ì½”ë“œë¥¼ ê³ ì³ë³´ì! ã… ã…  SonarQubeë¥¼ ì ìš©í•œ ì§í›„ì—¬ì„œ Code smellì´ ì •ë§ ë§ë‹¤.. )



***
<br>


    ğŸ’› ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ğŸ‘»

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}