---
title:  "ì  í‚¨ìŠ¤ì™€ ì†Œë‚˜íë¸Œ ì—°ë™í•˜ê¸°"

categories:
  - Devlog
tags:
  - [Devlog]

toc: true
toc_sticky: true
 
date: 2023-03-16 18:00:48
last_modified_at: 2023-03-16 18:00:51
---


> [ì´ ê¸€](https://minju412.github.io/devlog/21/)ì—ì„œ ì  í‚¨ìŠ¤ë¥¼ ë„ì…í•´ë³´ì•˜ë‹¤. ì´ë²ˆì—ëŠ” ì  í‚¨ìŠ¤ì™€ ì†Œë‚˜íë¸Œë¥¼ ì—°ë™í•˜ì—¬ ì •ì  ê²€ì‚¬ë¥¼ í†µí•´ ì½”ë“œ í’ˆì§ˆì„ í–¥ìƒì‹œì¼œë³´ì.


# 1. SonarQube ì„¤ì¹˜í•˜ê¸° (with. Docker Compose)

> [ì´ ê¸€](https://gblee1987.tistory.com/105)ì„ ì°¸ê³ í–ˆë‹¤.

ì„¤ì¹˜ ìˆœì„œëŠ” ì•„ë˜ì™€ ê°™ë‹¤.
1. AWS EC2ì— `docker-compose`ë¥¼ ë¨¼ì € ì„¤ì¹˜í•œë‹¤.
2. ì´í›„ `docker-compose.yml` íŒŒì¼ì„ ì´ìš©í•´ sonarqubeë¥¼ êµ¬ë™í•œë‹¤. (dockerëŠ” ë¯¸ë¦¬ ì„¤ì¹˜ë˜ì–´ ìˆë‹¤ê³  ê°€ì •)
3. sonar rule ì„¸íŒ…ì€ í•˜ì§€ ì•ŠëŠ”ë‹¤.
4. default ID/PasswordëŠ” `admin`/`admin` ì´ë‹¤.

## 1) í´ë” ë§Œë“¤ê¸°
ìš°ë¶„íˆ¬ ì¸ìŠ¤í„´ìŠ¤ì— ì ‘ì†í•´ì„œ ì§„í–‰í•œë‹¤.<br>
`docker` í´ë” ìƒì„± í›„(ë‚˜ëŠ” ì  í‚¨ìŠ¤ë¥¼ ë„ì»¤ì»´í¬ì¦ˆë¥¼ í†µí•´ ì‹¤í–‰í•˜ê³  ìˆê¸° ë•Œë¬¸ì— ì´ë¯¸ ë§Œë“¤ì–´ì ¸ ìˆì—ˆë‹¤) ê·¸ ì•ˆì— `sonarqube` í´ë”ë¥¼ ë§Œë“¤ì.<br><br>
ê·¸ë¦¬ê³  `sonarqube` í´ë” ì•ˆì— `docker-compose.yml`ì„ ìƒì„±í•˜ì.<br>
í´ë” êµ¬ì¡°ëŠ” ì•„ë˜ì™€ ê°™ë‹¤.
```
docker
â¿ sonarqube
 â¿ docker-compose.yml
```

## 2) docker compose ì‘ì„±
```yml
version: "2"

services:
  sonarqube:
    image: sonarqube:lts
    container_name: sonarqube
    ports:
      - "9000:9000"
    ulimits:
      nofile:
        soft: "262144"
        hard: "262144"
    networks:
      - sonarnet
    environment:
      - sonar.jdbc.url=jdbc:postgresql://db:5432/sonar
    volumes:
      - sonarqube_conf:/opt/sonarqube/conf
      - sonarqube_data:/opt/sonarqube/data
      - sonarqube_extensions:/opt/sonarqube/extensions
      - sonarqube_logs:/opt/sonarqube/logs

  db:
    image: postgres
    container_name: postgres_sonar
    ports:
      - "5432:5432"
    networks:
      - sonarnet
    environment:
      - POSTGRES_USER=sonar
      - POSTGRES_PASSWORD=sonar
    volumes:
      - postgresql:/var/lib/postgresql
      - postgresql_data:/var/lib/postgresql/data

networks:
  sonarnet:
    driver: bridge

volumes:
  sonarqube_conf:
  sonarqube_data:
  sonarqube_extensions:
  sonarqube_logs:
  postgresql:
  postgresql_data:
```

- sonarqubeì™€ dbë¼ëŠ” ì„œë¹„ìŠ¤ (ë„ì»¤ ì»¨í…Œì´ë„ˆ)ë¡œ êµ¬ì„±ë˜ê³  ì´ë“¤ê°„ì€ bridgeëª¨ë“œë¡œ ë„¤íŠ¸ì›Œí¬ë¥¼ ì„œë¡œ ì—°ê²°í•œë‹¤. (db:5432/sonar ë¡œ ìš”ì²­ê°€ëŠ¥í•œ ì´ìœ ê°€ ì´ê²ƒì„)
- ulimits ì´í•˜ ë¶€ë¶„ì´ ì—†ìœ¼ë©´ ê¸°ë™ì‹œì— `max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]` ë“±ê³¼ ê°™ì€ ì˜¤ë¥˜ê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.
  - (í˜¸ìŠ¤íŠ¸ ì„œë²„) rootë¡œ í•´ë‹¹ íŒŒì¼ì„ ì˜¤í”ˆí•œë‹¤.<br>(ë‹¹ì¥ ì ìš©ì€ CLIì—ì„œ sudo sysctl -w vm.max_map_count=262144 )
  ```
  vi /etc/sysctl.conf
  # ì•„ë˜ ë‚´ìš© ì¶”ê°€
  vm.max_map_count=262144
  ```

  - (docker-compose.yml) ì•„ë˜ ë‚´ìš© ì¶”ê°€
  ```
  ulimits:
    nofile:
      soft: "262144"
      hard: "262144"
  ```

- AWS EC2ìœ„ì—ì„œ ì…‹ì—…í–ˆìœ¼ë¯€ë¡œ Security Groupì—ì„œ `9000` í¬íŠ¸ë¥¼ ì˜¤í”ˆí•œë‹¤.<br>
(DB ì ‘ì† í•„ìš”ì‹œ `5432` í¬íŠ¸ë„ ì˜¤í”ˆ)


## 3) SonarQube ì‹¤í–‰
```bash
$ docker-compose up -d
```

## 4) ë¸Œë¼ìš°ì € ì ‘ì†
`http://[EC2_IP]:9000`ìœ¼ë¡œ ì ‘ì†í•˜ë©´ ì•„ë˜ì™€ ê°™ì€ í™”ë©´ì´ ëœ¬ë‹¤.<br>
<img width="727" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-03-16 á„‹á…©á„’á…® 10 36 30" src="https://user-images.githubusercontent.com/59405576/225633966-14d1f6fe-c075-4722-9010-e2e0a3819bdd.png"><br>

ì´ˆê¸°ì—ëŠ” `ID`ì™€ `Password` ëª¨ë‘ `admin`ì´ë‹¤.<br>
ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ í›„ ë¡œê·¸ì¸í•˜ë©´ ì•„ë˜ì™€ ê°™ì€ í™”ë©´ì´ ë‚˜ì˜¨ë‹¤.<br>
<img width="1379" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-03-16 á„‹á…©á„’á…® 10 40 14" src="https://user-images.githubusercontent.com/59405576/225634949-a525dd1c-a8ed-4c28-9710-d0696411727c.png">



# 2. Jenkinsì™€ ì—°ë™í•˜ê¸°












***
<br>


    ğŸ’› ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ğŸ‘»

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}