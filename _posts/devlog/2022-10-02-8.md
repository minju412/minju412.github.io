---
title:  "ì¡°íšŒ ìˆ˜ ì¤‘ë³µ ë°©ì§€ "

categories:
  - Devlog
tags:
  - [Devlog]

toc: true
toc_sticky: true
 
date: 2022-10-02 19:51:16
last_modified_at: 2022-10-02 19:51:18
---
íŠ¹ì • ê²Œì‹œê¸€ì„ ì¡°íšŒí•  ë•Œ, ì¡°íšŒ ìˆ˜ê°€ ì¤‘ë³µìœ¼ë¡œ ì¹´ìš´íŠ¸ ë˜ì§€ ì•Šë„ë¡ ì¿ í‚¤ë¥¼ ì´ìš©í•´ êµ¬í˜„í•´ë³´ì.
# ì„œë²„
`PostServiceImpl.java`
```java
@Override
@Transactional
public DetailedPostInfoDto getDetailedPostInfo(Long postId, HttpServletRequest request,
    HttpServletResponse response) {

    Post post = getPost(postId);

    // ì¡°íšŒ ìˆ˜ ì¤‘ë³µ ë°©ì§€
    Cookie oldCookie = null;
    Cookie[] cookies = request.getCookies();
    if (cookies != null) {
        for (Cookie cookie : cookies) {
            if (cookie.getName().equals("postView")) {
                oldCookie = cookie;
            }
        }
    }
    if (oldCookie != null) {
        if (!oldCookie.getValue().contains("[" + postId.toString() + "]")) {
            updateViewCnt(post);
            oldCookie.setValue(oldCookie.getValue() + "_[" + postId + "]");
            oldCookie.setPath("/");
            oldCookie.setMaxAge(60 * 60 * 24);
            response.addCookie(oldCookie);
        }
    } else {
        updateViewCnt(post);
        Cookie newCookie = new Cookie("postView", "[" + postId + "]");
        newCookie.setPath("/");
        newCookie.setMaxAge(60 * 60 * 24);
        response.addCookie(newCookie);
        System.out.println(newCookie);
    }

    return new DetailedPostInfoDto(post);
}

private void updateViewCnt(Post post) {
    post.setViewCnt(post.getViewCnt() + 1);
}
```

ì¡°íšŒìˆ˜ë¥¼ ì˜¬ë¦¬ëŠ”ë° ì¿ í‚¤ë¥¼ í™œìš©í•˜ê¸° ìœ„í•´ request, responseë¥¼ íŒŒë¼ë¯¸í„°ì— ì¶”ê°€í–ˆë‹¤.

1. `oldCookie` ê°ì²´ë¥¼ ì„ ì–¸í•œ í›„ ë¹ˆê°’ìœ¼ë¡œ ì´ˆê¸°í™”
2. request ê°ì²´ì—ì„œ ì¿ í‚¤ë“¤ì„ ê°€ì ¸ì™€ Cookie íƒ€ì…ì„ ìš”ì†Œë¡œ ê°€ì§€ëŠ” ë¦¬ìŠ¤íŠ¸ì— ë‹´ëŠ”ë‹¤.
3. `cookies`ê°€ nullì´ ì•„ë‹Œì§€ ì²´í¬í•œë‹¤.
4. `cookies`ê°€ nullì´ ì•„ë‹ˆë©´ forë¬¸ì„ ëŒë ¤ì„œ cookieì˜ ì´ë¦„ì´ `postView`ì¸ì§€ í™•ì¸í•˜ê³ , ë§ìœ¼ë©´ `oldCookie`ì— ì´ cookieë¥¼ ëŒ€ì…í•œë‹¤.
5. `oldCookie`ê°€ nullì´ ì•„ë‹ë•Œ<br>- `oldCookie`ì˜ valueì¤‘ ê²Œì‹œë¬¼ì˜ id ê°’ì´ ì—†ì„ ë•Œ (ìˆë‹¤ë©´ ì´ë¯¸ ì¡°íšŒí•œ ê²Œì‹œë¬¼ë¡œ ì¡°íšŒìˆ˜ê°€ ì˜¬ë¼ê°€ì§€ ì•ŠìŒ) ì¡°íšŒìˆ˜ ì˜¬ë¦¬ëŠ” ë©”ì†Œë“œ í˜¸ì¶œ<br>- `oldCookie`ì— ê²½ë¡œ, ì¿ í‚¤ìœ ì§€ ì‹œê°„ì„ ì¶”ê°€í•˜ì—¬ responseì— `oldCookie` ë¥¼ ì „ë‹¬í•œë‹¤.
6. `oldCookie`ê°€ nullì¼ ë•Œ<br>- ì¡°íšŒìˆ˜ ì˜¬ë¦¬ëŠ” ë©”ì†Œë“œ í˜¸ì¶œ<br>- `postView`ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ì¿ í‚¤ë¥¼ ë§Œë“¤ê³  ê±°ê¸°ì— ê²Œì‹œë¬¼ id ê°’ì„ ê´„í˜¸ë¡œ ê°ì‹¸ ì¶”ê°€í•œë‹¤.<br>- ë§ˆì°¬ê°€ì§€ë¡œ, ì¿ í‚¤ìœ ì§€ ì‹œê°„ì„ ì¶”ê°€í•˜ì—¬ responseì— `oldCookie` ë¥¼ ì „ë‹¬í•œë‹¤.

# í´ë¼ì´ì–¸íŠ¸
`post-details.js`
```js
// ê²Œì‹œê¸€ ìƒì„¸ ì½ê¸°
function getPost() {
    ...
    $.ajax({
        type: 'GET',
        url: process.env.BACKEND_HOST + '/post/' + params['id'],
        xhrFields: {
            withCredentials: true
        },
        ...
    });
}
```
ì„œë²„ëŠ” 8080, í´ë¼ì´ì–¸íŠ¸ëŠ” 3000ë²ˆì„ ì“°ê¸° ë•Œë¬¸ì— ì„œë¡œ ì¶œì²˜ê°€ ë‹¤ë¥´ë‹¤. <br>
ì´ë ‡ê²Œ ë˜ë©´ ì¿ í‚¤ë¥¼ í†µí•´ í†µì‹ ì„ í•  ìˆ˜ ì—†ë‹¤. (í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì„œë²„ë¡œ ìš”ì²­ ì‹œ, ìë™ìœ¼ë¡œ ì¿ í‚¤ê°€ ìš”ì²­ ë©”ì‹œì§€ì— ë‹´ê¸°ì§€ ì•ŠìŒ) <br><br>
ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ `xhrFields: { withCredentials: true }`ë¥¼ ì¶”ê°€í•´ì£¼ì–´ì•¼ í•œë‹¤.<br>
ì´ëŠ” í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ê°€ ì¿ í‚¤ ê°’ì„ ê³µìœ í•˜ê² ë‹¤ëŠ” ì˜ë¯¸ì´ë‹¤.<br>
(ì„œë²„ì—ì„œ ì¿ í‚¤ë¥¼ ë³´ë‚´ê¸° ë•Œë¬¸ì—, ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„  í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì¿ í‚¤ë¡œ í†µì‹ í•˜ëŠ” ê²ƒì„ í—ˆë½í•´ì•¼ í•œë‹¤.)

# Ref.
- [https://velog.io/@juwonlee920/Spring-%EC%A1%B0%ED%9A%8C%EC%88%98-%EA%B8%B0%EB%8A%A5-%EA%B5%AC%ED%98%84-%EC%A1%B0%ED%9A%8C%EC%88%98-%EC%A4%91%EB%B3%B5-%EB%B0%A9%EC%A7%80](https://velog.io/@juwonlee920/Spring-%EC%A1%B0%ED%9A%8C%EC%88%98-%EA%B8%B0%EB%8A%A5-%EA%B5%AC%ED%98%84-%EC%A1%B0%ED%9A%8C%EC%88%98-%EC%A4%91%EB%B3%B5-%EB%B0%A9%EC%A7%80)
- [https://velog.io/@kwg527/Spring-%EC%A1%B0%ED%9A%8C%EC%88%98-%EA%B8%B0%EB%8A%A5-%EA%B5%AC%ED%98%84-%EC%A1%B0%ED%9A%8C%EC%88%98-%EC%A4%91%EB%B3%B5-%EB%B0%A9%EC%A7%80](https://velog.io/@kwg527/Spring-%EC%A1%B0%ED%9A%8C%EC%88%98-%EA%B8%B0%EB%8A%A5-%EA%B5%AC%ED%98%84-%EC%A1%B0%ED%9A%8C%EC%88%98-%EC%A4%91%EB%B3%B5-%EB%B0%A9%EC%A7%80)





***
<br>


    ğŸ’› ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ğŸ‘»

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}