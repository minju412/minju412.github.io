---
title:  "[AWS] Docker Compose + Jenkins + Sonarqube "

categories:
  - Devlog
tags:
  - [Devlog]

toc: true
toc_sticky: true
 
date: 2023-02-14 17:32:36
last_modified_at: 2023-02-14 17:32:39
---

# 1. Ubuntuì— Docker Engine ì„¤ì¹˜
> [ê³µì‹ ì‚¬ì´íŠ¸](https://docs.docker.com/engine/install/ubuntu/)ë¥¼ ì°¸ê³ í–ˆë‹¤.

## Repository ì„¤ì •
```bash
# apt-get ì—…ë°ì´íŠ¸
$ sudo apt-get update

$ sudo apt-get install \
ca-certificates \
curl \
gnupg \
lsb-release

$ sudo mkdir -p /etc/apt/keyrings

$ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg

$ echo \
"deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
$(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
```

## Docker Engine ì„¤ì¹˜ ë° ì‹¤í–‰
```bash
$ sudo apt-get update

# ì„¤ì¹˜
$ sudo apt-get install docker-ce docker-ce-cli containerd.io docker-compose-plugin

# ë„ì»¤ ì‹¤í–‰
$ sudo service docker start

# ìƒíƒœ í™•ì¸
$ sudo service docker status
```

## ê¶Œí•œ ì„¤ì •
linuxì—ì„œ root ê¶Œí•œì´ ì•„ë‹Œ ìƒíƒœë¡œ dockerë¥¼ ì‹¤í–‰í•˜ë©´ ê¶Œí•œ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.
```
[linux@localhost ]$ docker ps
Got permission denied while trying to connect to the Docker daemon socket at unix:///var/run/docker.sock: Get http://%2Fvar%2Frun%2Fdocker.sock/v1.40/containers/json: dial unix /var/run/docker.sock: connect: permi
ssion denied
```
ì´ëŸ° ê²½ìš° ë§¤ë²ˆ sudoë¡œ ì»¤ë§¨ë“œë¥¼ ì‹¤í–‰í•´ë„ ë˜ì§€ë§Œ, ë²ˆê±°ë¡­ê¸° ë•Œë¬¸ì— docker groupì— í•´ë‹¹ ìœ ì €ë¥¼ ì¶”ê°€í•´ì£¼ë©´ í•´ê²°í•  ìˆ˜ ìˆë‹¤.<br>
```bash
# ë³´í†µì€ docker groupì´ ìƒê²¼ì„í…Œì§€ë§Œ, ë§Œì•½ ì—†ìœ¼ë©´ ìƒì„±í•´ì¤€ë‹¤.
$ sudo groupadd docker

# docker groupì— í•´ë‹¹ ìœ ì €ë¥¼ ì¶”ê°€
$ sudo usermod -aG docker $USER

# ë¡œê·¸ì•„ì›ƒ í›„ ë‹¤ì‹œ ë¡œê·¸ì¸í•˜ê±°ë‚˜ ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰ì‹œì¼œì•¼ ì ìš©ì´ ëœë‹¤.
$ newgrp docker
```


# 2. ë„ì»¤ ì»´í¬ì¦ˆ ì„¤ì¹˜

```bash
$ sudo apt  install docker-compose
$ docker-compose --version
```


# 3. ì  í‚¨ìŠ¤ ì„¤ì¹˜ (with.Docker Compose)
> [ì´ ê¸€](https://mrgamza.tistory.com/801)ê³¼ [ì´ ê¸€](https://hsik0225.github.io/jenkins/docker/2022/03/03/Jenkins-Docker%EB%A1%9C-Jenkins-%EC%84%A4%EC%B9%98%ED%95%98%EA%B8%B0/)ì„ ì°¸ê³ í–ˆë‹¤.


## 1) í´ë” ë§Œë“¤ê¸°
ìš°ë¶„íˆ¬ ì¸ìŠ¤í„´ìŠ¤ì— ì ‘ì†í•´ì„œ ì§„í–‰í•œë‹¤.<br>
docker í´ë” ìƒì„± í›„ ê·¸ ì•ˆì— jenkins í´ë”ë¥¼ ë§Œë“¤ê³ , ê·¸ ì•ˆì— home í´ë”ê¹Œì§€ ë§Œë“¤ì–´ì£¼ì.
```
docker
â¿ jenkins
 â¿ home
```

ì´ì œ `home` ë””ë ‰í„°ë¦¬ì— ê¶Œí•œì„ ë¶€ì—¬í•´ì•¼ í•œë‹¤.
```bash
$ chmod -R 777 home
```

> ğŸš¨ ì£¼ì˜<br>
ê¶Œí•œì„ ë¶€ì—¬í•˜ì§€ ì•Šìœ¼ë©´ ì•„ë˜ ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤...
```
touch: cannot touch '/var/jenkins_home/copy_reference_file.log': Permission denied
Can not write to /var/jenkins_home/copy_reference_file.log. Wrong volume permissions?
```


## 2) `docker-compose.yml` ìƒì„±
jenkins í´ë” ì•ˆì— `docker-compose.yml`ì„ ìƒì„±í•  ê²ƒì´ë‹¤.<br>
ì´ì œ í´ë” êµ¬ì¡°ëŠ” ì•„ë˜ì²˜ëŸ¼ ëœë‹¤.
```
docker
â¿ jenkins
 â¿ home
 â¿ docker-compose.yml
```

`docker-compose.yml` ë‚´ìš©ì€ ì•„ë˜ì²˜ëŸ¼ ì‘ì„±í•œë‹¤.
```yml
version: '3'
services:
  jenkins:
    container_name: 'jenkins'
    image: 'jenkins/jenkins:lts'
    restart: always
    ports:
      - 9090:8080
      - 50000:50000
    volumes:
      - /home/ubuntu/docker/jenkins/home:/var/jenkins_home
    environment:
      TZ: "Asiz/Seoul"
```

> ë§Œì•½ Jenkinsì˜ í¬íŠ¸ë¥¼ 9090ì´ ì•„ë‹Œ ë‹¤ë¥¸ í¬íŠ¸ë¥¼ ì“°ê³  ì‹¶ë‹¤ë©´ "ì•"ì˜ í¬íŠ¸ë¥¼ 9090ì´ ì•„ë‹Œ ë‹¤ë¥¸ í¬íŠ¸ë¡œ ë°”ê¾¼ë‹¤. <br>
ë’¤ì˜ í¬íŠ¸ê¹Œì§€ ë°”ê¾¸ë©´ Jenkinsì— ì ‘ì†í•  ìˆ˜ ì—†ë‹¤. ì™œëƒí•˜ë©´ Jenkins ë‚´ë¶€ì—ì„œ í¬íŠ¸ë¥¼ 8080ê³¼ 50000ë§Œ ì—´ì–´ë‘ì—ˆê¸° ë•Œë¬¸ì´ë‹¤.<br>
ì¦‰, `9090:8080`ì€ ì ‘ì†í•  ìˆ˜ ìˆì§€ë§Œ `9090:9090`ì€ ì ‘ì†í•  ìˆ˜ ì—†ë‹¤.



## 3) ì  í‚¨ìŠ¤ ì»¨í…Œì´ë„ˆ ì‹¤í–‰
jenkins í´ë” ì•ˆì—ì„œ ì§„í–‰í•œë‹¤.
```bash
$ docker-compose up -d

# ë§Œì•¼ ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤ë©´ ë¡œê·¸ë¥¼ í™•ì¸í•´ë³´ì
$ docker logs jenkins # ë§¨ ë§ˆì§€ë§‰ì€ ì»¨í…Œì´ë„ˆ ì´ë¦„!
```

<img width="822" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-02-15 á„‹á…©á„’á…® 2 42 53" src="https://user-images.githubusercontent.com/59405576/218943027-3fc3e597-f03f-4dec-b214-7389042f0edc.png"><br>

ìµœì¢…ì ìœ¼ë¡œ í´ë” êµ¬ì¡°ëŠ” ì•„ë˜ì²˜ëŸ¼ ëœë‹¤! (`jenkins` í´ë”ëŠ” ìƒì„±í•œì  ì—†ëŠ”ë° ìë™ìœ¼ë¡œ ìƒê²¼ë‹¤..) <br>
<img width="481" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-02-15 á„‹á…©á„’á…® 2 43 30" src="https://user-images.githubusercontent.com/59405576/218943036-08f01e04-cbd3-41ef-a368-2ad0c9fd338a.png">

# 4. ì  í‚¨ìŠ¤ ì„¤ì • ë° ë°°í¬

## 1) ì  í‚¨ìŠ¤ ì ‘ì† ë° ì„¤ì •
> [ì´ ê¸€](https://hsik0225.github.io/jenkins/docker/2022/03/03/Jenkins-Docker%EB%A1%9C-Jenkins-%EC%84%A4%EC%B9%98%ED%95%98%EA%B8%B0/)ì„ ì°¸ê³ í–ˆë‹¤.

ì  í‚¨ìŠ¤ ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•œ í›„, `ì¸ìŠ¤í„´ìŠ¤ì˜ public ip:9090`ë¡œ ì ‘ì†í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ í˜ì´ì§€ê°€ ë‚˜ì˜¨ë‹¤.

### íŒ¨ìŠ¤ì›Œë“œ ì…ë ¥
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-04 á„‹á…©á„’á…® 11 43 59](https://user-images.githubusercontent.com/59405576/193850463-dde67826-8368-429d-81fd-bbfdde242bef.png){: width="500" height="500"}<br>
ec2 ì¸ìŠ¤í„´ìŠ¤ì—ì„œ ìœ„ ì‚¬ì§„ì— ë³´ì´ëŠ” ê²½ë¡œë¡œ ì´ë™í•´ ë¹„ë°€ë²ˆí˜¸ë¥¼ í™•ì¸í•œë‹¤.<br>
permission deniedê°€ ëœ¬ë‹¤ë©´ sudoë¥¼ ë¶™ì´ì!
```bash
$ cat /var/lib/jenkins/secrets/initialAdminPassword
```
<img width="588" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-04 á„‹á…©á„’á…® 11 46 37" src="https://user-images.githubusercontent.com/59405576/193850996-783fc139-8c3c-4e1a-8cc4-3eaae082286a.png"><br>

ìœ„ì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì ‘ì†í•œ ì¸í„°ë„· ì°½ì˜ Administrator password ì— ì…ë ¥í•©ë‹ˆë‹¤.<br>
ë¹„ë°€ë²ˆí˜¸ë¥¼ ì œëŒ€ë¡œ ì…ë ¥í–ˆë‹¤ë©´ ë‹¤ìŒê³¼ ê°™ì€ ì–´ë“œë¯¼ ì„¤ì •í˜ì´ì§€ê°€ ë‚˜ì˜µë‹ˆë‹¤.<br>
ì•ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ì´ë¯€ë¡œ ì„¤ì •í•˜ì‹œê³  ìŠì§€ ë§ì•„ì£¼ì„¸ìš”.



### í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜ í™”ë©´
íŒ¨ìŠ¤ì›Œë“œë¥¼ ì…ë ¥ í›„ ì•„ë˜ì™€ ê°™ì´ í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜í™”ë©´ì´ ë‚˜ì˜¤ëŠ”ë° íŠ¹ë³„íˆ ì„¤ì¹˜í•  í”ŒëŸ¬ê·¸ì¸ì´ í•„ìš”ì—†ë‹¤ë©´ `install suggested plugins`ë¥¼ ì„ íƒí•œë‹¤.<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-04 á„‹á…©á„’á…® 11 48 09](https://user-images.githubusercontent.com/59405576/193851421-0bd60061-605b-41ad-bf58-cfc9478f317a.png){: width="500" height="500"}<br><br>
ê·¸ëŸ¼ ì•„ë˜ì²˜ëŸ¼ Getting Started í˜ì´ì§€ê°€ ë‚˜ì˜¬ ê²ƒì´ë‹¤. ì ì‹œ ê¸°ë‹¤ë¦¬ì.<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-04 á„‹á…©á„’á…® 11 48 52](https://user-images.githubusercontent.com/59405576/193851543-a33f7b7d-7888-4bdb-a74f-86bc0f1e9d4e.png){: width="500" height="500"}

### Admin ê³„ì • ìƒì„±
ê¸°ë‹¤ë¦¬ë©´ ì´ë ‡ê²Œ Admin ì‚¬ìš©ìë¥¼ ìƒì„±í•˜ëŠ” í˜ì´ì§€ê°€ ë‚˜ì˜¤ëŠ”ë°, Admin ì‚¬ìš©ìë¥¼ ìƒì„±í•˜ê³  ë‹¤ìŒ í™”ë©´ì„ ëˆ„ë¥´ë©´ Jenkins í™”ë©´ì´ ë³´ì´ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.<br>


### Instance Configuration
ë§ˆì§€ë§‰ìœ¼ë¡œ ì  í‚¨ìŠ¤ì˜ TCP í¬íŠ¸ë¥¼ ì•ìœ¼ë¡œë„ ê³„ì† ê°™ì€ í¬íŠ¸ë¥¼ ì“¸ ê²ƒì¸ì§€ ë¬¼ì–´ë³¸ë‹¤.<br>


ì´ì œ ì„¤ì •ì´ ëë‚¬ë‹¤. Start using Jenkinsë¥¼ ëˆ„ë¥´ì.<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-04 á„‹á…©á„’á…® 8 51 42](https://user-images.githubusercontent.com/59405576/193812599-6d380d79-123e-4fcb-ad30-043c55eec549.png)<br>
ê·¸ëŸ¼ ì•„ë˜ì™€ ê°™ì€ ëŒ€ì‹œë³´ë“œê°€ ë‚˜ì˜¨ë‹¤.<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-04 á„‹á…©á„’á…® 8 52 56](https://user-images.githubusercontent.com/59405576/193812824-f32c2a1f-17e8-4b67-a223-3d50c82c80ed.png){: width="500" height="500"}


## 2) ì  í‚¨ìŠ¤ë¥¼ ì´ìš©í•œ ìë™ ë°°í¬
> [ì´ ê¸€](https://learnote-dev.com/java/Spring-%EC%A0%A0%ED%82%A8%EC%8A%A4-%EB%B0%B0%ED%8F%AC/#%EC%A0%A0%ED%82%A8%EC%8A%A4-%EB%B9%8C%EB%93%9C-%EC%84%A4%EC%A0%95%ED%95%98%EA%B8%B0)ì„ ì°¸ê³ í–ˆë‹¤.

### ì  í‚¨ìŠ¤ ë¹Œë“œ ì„¤ì •í•˜ê¸°

### ssh í‚¤ ë°œê¸‰


### ê¹ƒ deploy key ë“±ë¡


### jenkins credentials ì¶”ê°€


### sudoers ë³€ê²½

### ê¹ƒ web hook ì„¤ì •


# 5. ì†Œë‚˜íë¸Œ ì„¤ì¹˜ (with.Docker Compose)

```yml


```

# 6. ì  í‚¨ìŠ¤ì™€ ì†Œë‚˜íë¸Œ ì—°ë™
































***
<br>


    ğŸ’› ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ğŸ‘»

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}