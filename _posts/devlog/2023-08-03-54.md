---
title:  "EC2를 이용한 Docker 배포 (with. Docker Hub)"
# excerpt: "sprintf에 대해 알아보자"

categories:
  - Devlog
tags:
  - [Devlog]

toc: true
toc_sticky: true
 
date: 2023-08-03 17:53:45
last_modified_at: 2023-08-03 17:53:47
---

# 📌 프로젝트에서
## 1) 이미지 빌드
```bash
$ ./gradlew build jar -x test # jar 파일 빌드

# docker build -t [dockerHub ID]/[이미지명]:[태그명] . # 맨 뒤 .은 [DockerFile위치]
# docker build -t [dockerHub ID]/[이미지명] . # 태그 lastest로 지정됨
$ docker-compose -f docker-compose.dev.yml build  # 이미지 빌드 
$ docker-image ls # 도커 이미지 확인 
```

## 2) Docker hub로 이미지 push
```bash
$ docker login -u ln8847 # 해당 커맨드 실행 후 Password 입력.
$ docker push ln8847/[생성한 이미지 이름]:[tag]
```


# 📌 Ubuntu 인스턴스에서

## 0) 인스턴스 생성 후 보안그룹 열기



## 1) Docker Engine 설치
> [공식 사이트](https://docs.docker.com/engine/install/ubuntu/)를 참고했다.

### Repository 설정
```bash
# apt-get 업데이트
$ sudo apt-get update

$ sudo apt-get install \
ca-certificates \
curl \
gnupg \
lsb-release

$ sudo mkdir -p /etc/apt/keyrings

$ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg

$ echo \
"deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
$(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
```

### Docker Engine 설치 및 실행
```bash
$ sudo apt-get update

# 설치
$ sudo apt-get install docker-ce docker-ce-cli containerd.io docker-compose-plugin

# 도커 실행
$ sudo service docker start

# 상태 확인
$ sudo service docker status
```

### 권한 설정
linux에서 root 권한이 아닌 상태로 docker를 실행하면 권한 문제가 발생할 수 있다.
```
[linux@localhost ]$ docker ps
Got permission denied while trying to connect to the Docker daemon socket at unix:///var/run/docker.sock: Get http://%2Fvar%2Frun%2Fdocker.sock/v1.40/containers/json: dial unix /var/run/docker.sock: connect: permi
ssion denied
```
이런 경우 매번 sudo로 커맨드를 실행해도 되지만, 번거롭기 때문에 docker group에 해당 유저를 추가해주면 해결할 수 있다.<br>
```bash
# 보통은 docker group이 생겼을테지만, 만약 없으면 생성해준다.
$ sudo groupadd docker

# docker group에 해당 유저를 추가
$ sudo usermod -aG docker $USER

# 로그아웃 후 다시 로그인하거나 다음 명령어를 실행시켜야 적용이 된다.
$ newgrp docker
```


## 2) 도커 컴포즈 설치

```bash
$ sudo apt  install docker-compose
$ docker-compose --version
```

## 💥 만약 위 방법으로 도커 컴포즈를 설치하고 버전을 확인했을 때 `build unknown`이 나온다면?
> [이 글](https://velog.io/@dailylifecoding/ubuntu-20.04-docker-and-dockercompose-install) 참고

![스크린샷 2023-06-05 오후 6 38 36](https://github.com/minju412/jenkins-test/assets/59405576/706400d2-1be3-4fce-8d07-c469c58128a7)

```bash
$ sudo apt remove docker-compose # 이전에 설치한 docker-compose를 제거

$ sudo curl -L "https://github.com/docker/compose/releases/download/v2.5.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/bin/docker-compose
# 이 명령어는 외부에서 그대로 파일을 가져와서 현재의 시스템에 올려 놓는 것이다.
# 결과적으로 "/usr/bin/" 경로에 "docker-compose" 라는 이름의 파일로 다운된다.
# 참고) https://github.com/docker/compose/releases 에서 최신 버전 확인이 가능하다.
# 최신 버전을 설치하고 싶다면 위 명령어에 보이는 1.28.5 라는 버전 숫자를 바꿔주면 된다!

$ sudo chmod +x /usr/bin/docker-compose # chmod 를 통해서 실행이 가능하게 세팅

$ docker-compose --version
```
![스크린샷 2023-06-05 오후 6 42 40](https://github.com/minju412/jenkins-test/assets/59405576/ad5fa9b1-c856-4e0d-927e-21664f91821c)




## 3) 배포 (=컨테이너 실행)
```bash
$ docker run -d -p 8080:8080 ln8847/boot-prac # pull까지 받아온다
```





***
<br>


    💛 개인 공부 기록용 블로그입니다. 👻

[맨 위로 이동하기](#){: .btn .btn--primary }{: .align-right}