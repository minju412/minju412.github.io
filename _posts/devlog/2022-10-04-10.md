---
title:  "JWT payload ì •ë³´ ê°€ì ¸ì˜¤ê¸° "

categories:
  - Devlog
tags:
  - [Devlog]

toc: true
toc_sticky: true
 
date: 2022-10-04 00:20:04
last_modified_at: 2022-10-04 00:20:06
---

JWTë¥¼ ì‚¬ìš©í•˜ë©´ì„œ access tokenì˜ í˜ì´ë¡œë“œ ì•ˆì— ìˆëŠ” exp ì •ë³´ë¥¼ ê°€ì ¸ì™€ì•¼í•  ì¼ì´ ìƒê²¼ë‹¤.

## `TokenDto`
`TokenDto`ëŠ” ë¡œê·¸ì¸ í›„ í† í° ì •ë³´ë¥¼ ë°˜í™˜í•˜ê¸° ìœ„í•œ dtoì´ë‹¤.<br>
ì—¬ê¸°ì— `accessTokenExp`ë¥¼ ì¶”ê°€í•œë‹¤.
```java
@Getter
@AllArgsConstructor
@NoArgsConstructor
public class TokenDto {

    private String accessToken;
    private String refreshToken;
    private Date accessTokenExp; // ğŸŒŸ ì¶”ê°€
}
```

## `JwtTokenProvider`
`JwtTokenProvider`ëŠ” access tokenê³¼ refresh tokenì„ ìƒì„±í•˜ëŠ” í´ë˜ìŠ¤ì¸ë°, ì—¬ê¸°ì— `getAccessTokenExp()` ë©”ì„œë“œë¥¼ ì¶”ê°€í•œë‹¤.
```java
@Component
public class JwtTokenProvider {

    @Value("${jwt.token.jwt-secret-key}")
    private String SECRET_KEY;
    ...
    /**
     * ì—‘ì„¸ìŠ¤ í† í°ì˜ exp ê°€ì ¸ì˜¤ê¸°
     */
    public Date getAccessTokenExp(String accessToken) {

        Claims body = getClaims(accessToken);
        // Date issuedAt = body.getIssuedAt(); // issuedAtë„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.
        return body.getExpiration();
    }

    /**
     * í† í°ì •ë³´ í•´ì„
     */
    private Claims getClaims(String token) {
        Claims body = Jwts.parserBuilder()
            .setSigningKey(SECRET_KEY)
            .build()
            .parseClaimsJws(token)
            .getBody();
        return body;
    }
}
```

## `AuthServiceImpl`
`new TokenDto()`ë¥¼ í†µí•´ í† í° dtoë¥¼ ìƒì„±í•  ë•Œ, `accessTokenExp`ë„ ì¶”ê°€í•œë‹¤.
```java
@Service
@RequiredArgsConstructor
@Slf4j
public class AuthServiceImpl implements AuthService {

    private final MemberRepository userRepository;
    private final JwtTokenProvider jwtTokenProvider;
    private final AuthenticationManager authenticationManager;
    private final RedisTemplate<String, String> redisTemplate;

    private long REFRESH_TOKEN_EXPIRE_TIME = 1000L * 60 * 60 * 24 * 7; // 7ì¼

    @Override
    public ResponseEntity<TokenDto> signIn(SignInReq signInReq) {
        try {

            Member member = userRepository.findByUsername(signInReq.getUsername())
                .orElseThrow(() -> new CustomException(MEMBER_NOT_FOUND));

            Authentication authentication = authenticationManager.authenticate(
                new UsernamePasswordAuthenticationToken(
                    signInReq.getUsername(),
                    signInReq.getPassword()
                )
            );

            String accessToken = jwtTokenProvider.generateAccessToken(authentication);
            String refreshToken = jwtTokenProvider.generateRefreshToken(authentication);
            Date accessTokenExp = jwtTokenProvider.getAccessTokenExp(accessToken); // ğŸŒŸ ì—‘ì„¸ìŠ¤ í† í° exp

            TokenDto tokenDto = new TokenDto(
                accessToken,
                refreshToken,
                accessTokenExp // ğŸŒŸ ì—‘ì„¸ìŠ¤ í† í° exp
            );

            ...

            return new ResponseEntity<>(tokenDto, httpHeaders, HttpStatus.OK);

        } catch (AuthenticationException e) {
            throw new CustomException(INVALID_CREDENTIAL);
        }
    }
}
```

## Ref.
- [https://lemontia.tistory.com/1041](https://lemontia.tistory.com/1041)




***
<br>


    ğŸ’› ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ğŸ‘»

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}