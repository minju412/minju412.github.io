---
title:  "ì˜ˆì™¸ ì²˜ë¦¬ í•˜ê¸° (exception handling)"

categories:
  - Devlog
tags:
  - [Devlog]

toc: true
toc_sticky: true
 
date: 2023-03-03 13:07:24
last_modified_at: 2023-03-03 13:07:30
---

> [ì´ ê¸€](https://samtao.tistory.com/42)ì„ ì°¸ê³ í–ˆë‹¤.

ìŠ¤í”„ë§ë¶€íŠ¸ì—ì„œ exceptionì„ ì²˜ë¦¬í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë³´ì<br><br>
ìˆœì„œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤
1. ì—ëŸ¬ì½”ë“œ ì •ë¦¬ enum í´ë˜ìŠ¤ë¡œ ì‘ì„±
2. Exception ë°œìƒì‹œ ì‘ë‹µí•˜ëŠ” ì—ëŸ¬ ì •ë³´ í´ë˜ìŠ¤ ì‘ì„±
3. ì‚¬ìš©ì ì •ì˜ Exception í´ë˜ìŠ¤ ì‘ì„±
4. Exception ë°œìƒì‹œ ì „ì—­ìœ¼ë¡œ ì²˜ë¦¬í•  exception handler ì‘ì„±
5. ì¼ê¸° ì¡°íšŒ ì„œë¹„ìŠ¤ì—ì„œ exception handling
6. api ì‹¤í–‰ ë° exception ê²°ê³¼ í™•ì¸


## 1. ì—ëŸ¬ì½”ë“œ ì •ë¦¬ enum í´ë˜ìŠ¤ë¡œ ì‘ì„±
`ErrorCode`
```java
@Getter
@AllArgsConstructor
public enum ErrorCode {

    /* 400 BAD_REQUEST : ì˜ëª»ëœ ìš”ì²­ */
    CONSTRAINT_VIOLATION(HttpStatus.BAD_REQUEST, "ì œì•½ ì¡°ê±´ì„ ìœ„ë°°í•œ ìš”ì²­ì…ë‹ˆë‹¤ (constraint violation)"),
    METHOD_ARG_NOT_VALID(HttpStatus.BAD_REQUEST, "ì œì•½ ì¡°ê±´ì„ ìœ„ë°°í•œ ìš”ì²­ì…ë‹ˆë‹¤ (method argument not valid)"),
    STAMP_LIST_SIZE_ERROR(HttpStatus.BAD_REQUEST, "ìµœëŒ€ 3ê°œì˜ ìŠ¤íƒ¬í”„ë¥¼ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤"),
    INVALID_FILE_ERROR(HttpStatus.BAD_REQUEST, "í™•ì¥ìê°€ jpg, jpeg, png ì¸ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤."),

    /* 404 NOT_FOUND : Resource ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ */
    USER_NOT_FOUND(HttpStatus.NOT_FOUND, "íšŒì›ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"),
    DIARY_NOT_FOUND(HttpStatus.NOT_FOUND, "ì¼ê¸°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"),
    PET_NOT_FOUND(HttpStatus.NOT_FOUND, "ë°˜ë ¤ ë™ë¬¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"),
    STAMP_NOT_FOUND(HttpStatus.NOT_FOUND, "ìŠ¤íƒ¬í”„ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"),

    /* 500 INTERNAL_SERVER_ERROR : ì„œë²„ ì—ëŸ¬ */
    FILE_CAN_NOT_UPLOAD(HttpStatus.INTERNAL_SERVER_ERROR, "íŒŒì¼ ì—…ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."),
    FILE_CAN_NOT_DELETE(HttpStatus.INTERNAL_SERVER_ERROR, "íŒŒì¼ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."),

    ;

    private final HttpStatus httpStatus;
    private final String message;

}
```

## 2. Exception ë°œìƒì‹œ ì‘ë‹µí•˜ëŠ” ì—ëŸ¬ ì •ë³´ í´ë˜ìŠ¤ ì‘ì„±
`ErrorResponse`
```java
@Getter
@Builder
public class ErrorResponse {
    private final String error;
    private final String message;

    public static ResponseEntity<ErrorResponse> toResponseEntity(ErrorCode errorCode) {
        return ResponseEntity
            .status(errorCode.getHttpStatus())
            .body(ErrorResponse.builder()
                .error(errorCode.getHttpStatus().name())
                .message(errorCode.getMessage())
                .build()
            );
    }

    public static ResponseEntity<ErrorResponse> toResponseEntity(ErrorCode errorCode, String defaultMessage) {
        return ResponseEntity
            .status(errorCode.getHttpStatus())
            .body(ErrorResponse.builder()
                .error(errorCode.getHttpStatus().name())
                .message(defaultMessage)
                .build()
            );
    }
}
```

## 3. ì‚¬ìš©ì ì •ì˜ Exception í´ë˜ìŠ¤ ì‘ì„±
`CustomException`
```java
@Getter
@AllArgsConstructor
public class CustomException extends RuntimeException {
    private final ErrorCode errorCode;
}
```

## 4. Exception ë°œìƒì‹œ ì „ì—­ìœ¼ë¡œ ì²˜ë¦¬í•  exception handler ì‘ì„±
`GlobalExceptionHandler`
```java
@Slf4j
@RestControllerAdvice
public class GlobalExceptionHandler {
    @ExceptionHandler(MethodArgumentNotValidException.class)
    protected Object handleMethodArgumentNotValidException(MethodArgumentNotValidException ex,
        HttpServletRequest request) {
        String defaultMessage = Objects.requireNonNull(ex.getBindingResult().getFieldError()).getDefaultMessage();
        return ErrorResponse.toResponseEntity(METHOD_ARG_NOT_VALID, defaultMessage);
    }

    @ExceptionHandler(value = {ConstraintViolationException.class, DataIntegrityViolationException.class})
    protected ResponseEntity<ErrorResponse> handleDataException() {
        log.error("handleDataException throw Exception : {}", CONSTRAINT_VIOLATION);
        return ErrorResponse.toResponseEntity(CONSTRAINT_VIOLATION);
    }

    @ExceptionHandler(CustomException.class)
    protected ResponseEntity<ErrorResponse> handleCustomException(CustomException e) {
        log.error("handleCustomException throw CustomException : {}", e.getErrorCode());
        return ErrorResponse.toResponseEntity(e.getErrorCode());
    }
}
```

## 5. ì¼ê¸° ì¡°íšŒ ì„œë¹„ìŠ¤ì—ì„œ exception handling

`DiaryServiceImpl`ì—ì„œ ë‹¨ê±´ ì¼ê¸°ë¥¼ ì¡°íšŒí•  ë•Œ, <br>
ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì¼ê¸°ë¥¼ ì¡°íšŒí•˜ë ¤ê³  í•  ê²½ìš° `CustomException`ì„ ë°œìƒì‹œí‚¤ë©°<br>
`GlobalExceptionHandler`ì—ì„œ í•´ë‹¹ exceptionì„ ìºì¹˜í•´ì„œ ì ì ˆí•œ ì—ëŸ¬ì‘ë‹µì„ ìƒì„±í•´ì„œ jsonê²°ê³¼ë¥¼ ë‚´ë ¤ì¤€ë‹¤.

```java
@Slf4j
@Service
@RequiredArgsConstructor
public class DiaryServiceImpl implements DiaryService {
    @Override
    @Transactional
    public DiaryDetailResDto getDetailedDiary(Long diaryId) {
        Diary diary = diaryRepository.findById(diaryId)
                .orElseThrow(() -> new CustomException(DIARY_NOT_FOUND)); // âœ…
        return new DiaryDetailResDto(diary);
    }

    ...
}
```

## 6. api ì‹¤í–‰ ë° exception ê²°ê³¼ í™•ì¸
ë§Œì•½, ì¡´ì¬í•˜ì§€ ì•ŠëŠ” 100ë²ˆì§¸ ì¼ê¸°ë¥¼ ì¡°íšŒí•˜ë ¤ê³  ì‹œë„í•œë‹¤ë©´?<br>
<img width="700" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-03-03 á„‹á…©á„’á…® 1 56 34" src="https://user-images.githubusercontent.com/59405576/222634955-dbde9578-ea9c-4422-bfd5-cbab335b20f1.png"><br>
ìœ„ì™€ ê°™ì´ ì§ì ‘ ì •ì˜í•œ exceptionì´ ë°œìƒí•œë‹¤.







***
<br>


    ğŸ’› ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ğŸ‘»

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}