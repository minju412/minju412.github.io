---
title:  "Spring Rest Docs ì ìš©í•˜ê¸° "

categories:
  - Devlog
tags:
  - [Devlog]

toc: true
toc_sticky: true
 
date: 2023-02-24 20:53:44
last_modified_at: 2023-02-24 20:53:47
---

> Spring Rest Docsë¥¼ ì ìš©í•˜ê¸° ìœ„í•´ì„œ ì•„ë˜ ê¸€ë“¤ì„ ì°¸ê³ í–ˆë‹¤.
- [https://tbmaster.tistory.com/96](https://tbmaster.tistory.com/96)
- [https://velog.io/@minnseong/spring-rest-docs](https://velog.io/@minnseong/spring-rest-docs)
- [https://techblog.woowahan.com/2597/](https://techblog.woowahan.com/2597/)

<br>

# 0. ì „ì²´ íë¦„

1. Member CRUD ì½”ë“œ ì‘ì„±
2. test ì½”ë“œ ì‘ì„±
3. `build.gradle` ë‚´ìš© ì¶”ê°€
4. snippet íŒŒì¼ ìƒì„± 
5. adoc íŒŒì¼ìƒì„± + snippet íŒŒì¼ import
6. html íŒŒì¼ë¡œ ë³€í™˜
7. ìµœì¢…í™”ë©´ 

â€» ì „ì²´ ì½”ë“œëŠ” [git](https://github.com/minju412/jenkins-test) ì°¸ê³  

<br>

# 1. Member CRUD ì½”ë“œ ì‘ì„±
spring rest docs ì„ ì ìš©í•˜ê¸° ìœ„í•œ ì½”ë“œê°€ í•„ìš”í•˜ë‹¤. ê°„ë‹¨í•˜ê²Œ memberì— ëŒ€í•œ CRUD ë¥¼ ì‘ì„±í•˜ì˜€ë‹¤.<br>
<img width="200" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-02-26 á„‹á…©á„’á…® 11 51 45" src="https://user-images.githubusercontent.com/59405576/221417955-676cb944-4f8a-4053-96f5-3c2bda2e2026.png">



# 2. test ì½”ë“œ ì‘ì„±
`UserControllerTest.java`
```java
@ActiveProfiles("test")
@AutoConfigureRestDocs // Spring REST Docs ìë™ ì„¤ì • ì–´ë…¸í…Œì´ì…˜ (í…ŒìŠ¤íŠ¸ ìˆ˜í–‰ ì‹œ, ìë™ìœ¼ë¡œ sinppets íŒŒì¼ì„ ìƒì„±)
@AutoConfigureMockMvc
@SpringBootTest
@TestMethodOrder(MethodOrderer.OrderAnnotation.class)
@TestInstance(TestInstance.Lifecycle.PER_CLASS)
class UserControllerTest {
    /*
     *  1. member ì¡°íšŒ
     *  2. member ì¶”ê°€
     *  3. member ìˆ˜ì •
     *  4. member ì‚­ì œ
     *  5. member ì „ì²´ ì¡°íšŒ
     * */

    @Autowired
    private MockMvc mockMvc;
    @Autowired
    private MemberService memberService;

    @BeforeAll
    void init() {
        CreateRequest createRequest = new CreateRequest();
        createRequest.setName("john");
        createRequest.setYear(2);
        createRequest.setGrade("junior");

        memberService.createMember(createRequest);
    }


    @Order(1)
    @Test
    void getMemberTest() throws Exception {
        mockMvc.perform(get("/member/{name}", "john"))
                .andDo(print())
                .andDo(document("getMember"))
                .andExpect(jsonPath("$.name", is("john")));
    }

    @Order(2)
    @Test
    void createMemberTest() throws Exception {
        mockMvc.perform(post("/member")
                        .header(HttpHeaders.CONTENT_TYPE, MediaType.APPLICATION_JSON_VALUE)
                        .content("{\n" +
                                "    \"name\":\"jessi\",\n" +
                                "    \"grade\":\"junior\",\n" +
                                "    \"year\":2\n" +
                                "}"))
                .andDo(print())
                .andDo(document("createMember"))
                .andExpect(status().isOk());
    }

    @Order(3)
    @Test
    void updateMemberTest() throws Exception {
        UpdateRequest request = new UpdateRequest();
        request.setGrade("senior");
        request.setYear(7);

        mockMvc.perform(put("/member/{name}", "john")
                        .header(HttpHeaders.CONTENT_TYPE, MediaType.APPLICATION_JSON_VALUE)
                        .content(new ObjectMapper().writeValueAsString(request)))
                .andDo(print())
                .andDo(document("updateMember"))
                .andExpect(jsonPath("$.year", is(7)))
                .andExpect(jsonPath("$.grade", is("senior")));
    }

    @Order(5)
    @Test
    void deleteMemberTest() throws Exception {
        mockMvc.perform(delete("/member/{name}", "john"))
                .andDo(print())
                .andDo(document("deleteMember"))
                .andExpect(jsonPath("$.name", is("john")))
                .andExpect(status().isOk());
    }

    @Order(4)
    @Test
    void getAllMemberTest() throws Exception {
        mockMvc.perform(get("/members"))
                .andDo(print())
                .andDo(document("getAllMember"))
                .andExpect(status().isOk());
    }
}
```

# 3. `build.gradle` ë‚´ìš© ì¶”ê°€
âœ… ë¶€ë¶„ì„ ì˜ í™•ì¸í•˜ì!
```
plugins {
	id 'java'
	id 'org.springframework.boot' version '2.7.8'
	id 'io.spring.dependency-management' version '1.0.15.RELEASE'
	id 'org.asciidoctor.jvm.convert' version '3.3.2' // âœ… asciidoctor plugin ì¶”ê°€
}

group = 'com.example'
version = '0.0.1-SNAPSHOT'
sourceCompatibility = '11'

configurations {
	compileOnly {
		extendsFrom annotationProcessor
	}
}

repositories {
	mavenCentral()
}

ext{
	snippetDir = file('build/generated-snippets') // âœ… snippets íŒŒì¼ì„ ì €ì¥í•  ë””ë ‰í† ë¦¬ ìƒì„±
}

test {
	useJUnitPlatform()
	outputs.dir snippetDir // âœ… ìƒì„±ëœ íŒŒì¼ì„ ë¯¸ë¦¬ ìƒì„±í•œ ë””ë ‰í† ë¦¬(build/generated-snippets)ì— ì €ì¥
}

asciidoctor{ // asciidoctor ì„¤ì • task
	inputs.dir snippetDir // âœ… snippets ë””ë ‰í† ë¦¬ë¥¼ ì…ë ¥ìœ¼ë¡œ í•¨
	dependsOn test // âœ… test taskë¥¼ ì˜ì¡´í•˜ë„ë¡ í•˜ì—¬, ë¬¸ì„œ ìƒì„± ì „ì— testë¥¼ ìˆ˜í–‰í•˜ë„ë¡ í•¨
}

bootJar{ // springbootë¥¼ ì´ìš©í•œ jar íŒŒì¼ ìƒì„± ì‹œ í•„ìš”í•œ ì„¤ì • task
	dependsOn asciidoctor // âœ… asciidoctor ë¥¼ ì˜ì¡´í•˜ë„ë¡ í•˜ì—¬, bootJar ìƒì„± ì „ì— asciidoctor taskë¥¼ ìˆ˜í–‰í•˜ë„ë¡ í•¨
	// (jar íŒŒì¼ ìƒì„± ì‹œ, ë¬¸ì„œ ìƒì„±ì„ ë³´ì¥ í•¨)
	from("src/docs/asciidoc"){ // âœ… ë¬¸ì„œ ìƒì„± ì‹œ, Jar íŒŒì¼ ë‚´ static/docs ì—ë„ ë³µì‚¬ë˜ë„ë¡ í•¨ // ğŸŒŸ ê²½ë¡œ ì¡°ì‹¬! 
		into 'BOOT-INF/classes/static/docs'
	}

	// âœ… index í˜ì´ì§€ë¥¼ ë…¸ì¶œí•˜ê¸° ìœ„í•´ ì„¤ì •
	copy {
		from asciidoctor.outputDir
		into "src/main/resources/static/docs"
	}
}

dependencies {
	implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
	implementation 'org.springframework.boot:spring-boot-starter-validation'
	implementation 'org.springframework.boot:spring-boot-starter-web'
	compileOnly 'org.projectlombok:lombok'
	runtimeOnly 'com.mysql:mysql-connector-j'
	annotationProcessor 'org.projectlombok:lombok'
	testImplementation 'org.springframework.boot:spring-boot-starter-test'

	// spring rest docs ì„ ì´ìš©í•˜ê¸° ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬
	testImplementation 'org.springframework.restdocs:spring-restdocs-mockmvc' // âœ…

	// mockmvc
	testImplementation 'org.springframework.restdocs:spring-restdocs-mockmvc' // âœ…

	// H2
	implementation 'com.h2database:h2:1.4.199' // âœ… í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ë°ì´í„°ë² ì´ìŠ¤ë¡œ ì‚¬ìš©
}
```

# 4. snippet íŒŒì¼ ìƒì„±
í…ŒìŠ¤íŠ¸ ì½”ë“œ ë¹Œë“œ í›„, í…ŒìŠ¤íŠ¸ê°€ í†µê³¼ë˜ì—ˆë‹¤ë©´ snippet íŒŒì¼ì´ ìë™ìœ¼ë¡œ ìƒì„±ë  ê²ƒì´ë‹¤.<br>
í…ŒìŠ¤íŠ¸ ì½”ë“œ ì•ˆì—ì„œ ì‹¤í–‰ ë²„íŠ¼ì„ í´ë¦­í•˜ê³  í™•ì¸í•´ë³´ì.<br>
<img width="408" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-02-27 á„‹á…©á„Œá…¥á†« 12 01 35" src="https://user-images.githubusercontent.com/59405576/221418613-fdebcfa2-b296-4de2-ac76-2c55f252438c.png">



# 5. adoc íŒŒì¼ìƒì„± ë° snippet íŒŒì¼ import
Rest API ë¬¸ì„œì˜ ë©”ì¸ íŒŒì¼ì„ ìƒì„±í•œë‹¤. <br>
`src/docs/asciidoc` ë””ë ‰í† ë¦¬ ìƒì„± í›„, `index.adoc` ìƒì„±<br>
<img width="223" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-02-27 á„‹á…©á„Œá…¥á†« 12 12 11" src="https://user-images.githubusercontent.com/59405576/221419197-752da4aa-0edf-4252-ab7b-563613cb3528.png"><br>

`src/docs/asciidoc/index.adoc`
```
= REST Docs
:doctype: book
:icons: font
:source-highlighter: highlightjs
:toc: left
:toclevels: 2
:sectlinks:

ifndef::snippets[]
:snippets: ./build/generated-snippets
endif::[]


[[Member_API]]
== Member API


[[Member_ìƒì„±]]
=== Member ìƒì„±
include::{snippets}/createMember/http-request.adoc[]
include::{snippets}/createMember/http-response.adoc[]

[[Member_ì¡°íšŒ]]
=== Member ì¡°íšŒ
include::{snippets}/getMember/http-request.adoc[]
include::{snippets}/getMember/http-response.adoc[]


[[Member_ìˆ˜ì •]]
=== Member ìˆ˜ì •
include::{snippets}/updateMember/http-request.adoc[]
include::{snippets}/updateMember/http-response.adoc[]

[[Member_ì‚­ì œ]]
=== Member ì‚­ì œ
include::{snippets}/deleteMember/http-request.adoc[]
include::{snippets}/deleteMember/http-response.adoc[]


[[Member_ì „ì²´_ì¡°íšŒ]]
=== Member ì „ì²´ ì¡°íšŒ
include::{snippets}/getAllMember/http-request.adoc[]
include::{snippets}/getAllMember/http-response.adoc[]
```
- `include::{snippets}` ë¥¼ ì´ìš©í•˜ì—¬ ìƒì„±í•œ snippets íŒŒì¼ì„ ì¶”ê°€í•˜ì˜€ë‹¤.


## gradle bootJar ì‹¤í–‰
```bash
$ ./gradlew clean
$ ./gradlew build jar
```

## jar íŒŒì¼ ë‚´ë¶€ì— ìƒì„±ëœ index.html í™•ì¸
bootJar ì‹¤í–‰ í›„ ìë™ìœ¼ë¡œ ìƒì„±ëœë‹¤.
```bash
# jar íŒŒì¼ ë‚´ë¶€ ë¦¬ìŠ¤íŠ¸ ë³´ê¸°
$ jar -tf ./build/libs/jenkins-test-0.0.1-SNAPSHOT.jar

# jar íŒŒì¼ ë‚´ë¶€ index.adoc ê²€ìƒ‰
$ jar -tf ./build/libs/jenkins-test-0.0.1-SNAPSHOT.jar | grep index.adoc
```
<img width="823" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-02-27 á„‹á…©á„Œá…¥á†« 12 33 55" src="https://user-images.githubusercontent.com/59405576/221420330-fe841da4-d346-40f2-a8ef-6c4cb2f1b146.png">

# 6. html íŒŒì¼ë¡œ ë³€í™˜
bootJar íŒŒì¼ì— index.html ë¬¸ì„œë¥¼ ì¶”ê°€í•˜ê¸° ìœ„í•œ build.gradle ì„¤ì •ì„ í•œë‹¤.<br>
(ì•„ë˜ ë¶€ë¶„ì¸ë°, ì´ì „ì— ë¯¸ë¦¬ ì‘ì„± í•´ë‘ì—ˆìœ¼ë‹ˆ ë„˜ì–´ê°€ì!)

```
plugins {
   ...
   
   id 'org.asciidoctor.jvm.convert' version '3.3.2' //asciidoctor plugin ì¶”ê°€
}

... 

asciidoctor{ //asciidoctor ì„¤ì • task
   inputs.dir snippetDir //snippets ë””ë ‰í† ë¦¬ë¥¼ ì…ë ¥ìœ¼ë¡œ í•¨
   dependsOn test // test taskë¥¼ ì˜ì¡´í•˜ë„ë¡ í•˜ì—¬, ë¬¸ì„œ ìƒì„± ì „ì— testë¥¼ ìˆ˜í–‰í•˜ë„ë¡ í•¨
}

bootJar{ //springbootë¥¼ ì´ìš©í•œ jar íŒŒì¼ ìƒì„± ì‹œ í•„ìš”í•œ ì„¤ì • task
   dependsOn asciidoctor //asciidoctor ë¥¼ ì˜ì¡´í•˜ë„ë¡ í•˜ì—¬, bootJar ìƒì„± ì „ì— asciidoctor taskë¥¼ ìˆ˜í–‰í•˜ë„ë¡ í•¨
                     // (jar íŒŒì¼ ìƒì„± ì‹œ, ë¬¸ì„œ ìƒì„±ì„ ë³´ì¥ í•¨)
   from("src/docs/asciidoc"){ //ë¬¸ì„œ ìƒì„± ì‹œ, Jar íŒŒì¼ ë‚´ static/docs ì—ë„ ë³µì‚¬ë˜ë„ë¡ í•¨
      into 'BOOT-INF/classes/static/docs'
   }
}
...
```

# 7. ìµœì¢… í™”ë©´
bootJar ì‹¤í–‰í›„, `localhost:8080/docs/index.html` ì— ë“¤ì–´ê°”ì„ ë•Œ í™”ë©´ì´ë‹¤.<br>
<img width="765" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-02-27 á„‹á…©á„Œá…¥á†« 12 07 19" src="https://user-images.githubusercontent.com/59405576/221418936-0d1811e0-2b07-4412-a31a-f47d0b7849d0.png">




## ëª¨ë“  ì„¤ì •ì´ ì˜ ë˜ì—ˆëŠ”ì§€ í™•ì¸
ëª¨ë“  ì„¤ì •ì´ ì˜ ë˜ì—ˆë‹¤ë©´ ì•„ë˜ íŒŒì¼ë“¤ì´ ìë™ìœ¼ë¡œ ìƒì„±ë˜ì–´ ìˆì–´ì•¼ í•œë‹¤.<br>
<img width="220" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-02-27 á„‹á…©á„Œá…¥á†« 12 10 59" src="https://user-images.githubusercontent.com/59405576/221419155-aeed4562-ddf8-4ccb-9a3e-73ebc88d61e1.png"><br><br>
<img width="198" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-02-27 á„‹á…©á„Œá…¥á†« 12 13 10" src="https://user-images.githubusercontent.com/59405576/221419263-f511cbb2-fecc-4db9-93d0-e2da2a5692e0.png">








***
<br>


    ğŸ’› ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ğŸ‘»

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}