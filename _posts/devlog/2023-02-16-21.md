---
title:  "[AWS] Jenkinsë¥¼ í†µí•œ Docker Compose + mysql+ Spring Boot ì• í”Œë¦¬ì¼€ì´ì…˜ ë¹Œë“œ ë° ìë™ ë°°í¬ ğŸŒŸğŸŒŸğŸŒŸ "

categories:
  - Devlog
tags:
  - [Devlog]

toc: true
toc_sticky: true
 
date: 2023-02-16 15:57:23
last_modified_at: 2023-02-16 15:57:25
---

# 0. í”Œë¡œìš°

> [ì´ ê¸€](https://tape22.tistory.com/20?category=928488)ì„ ì°¸ê³ í–ˆë‹¤.

ì›ë˜ëŠ” `github ì˜¬ë¦¼` â†’ `Jenkinsì—ì„œ githubì— ì˜¬ë¼ì™€ìˆëŠ” springboot í”„ë¡œì íŠ¸ë¥¼ ê°€ì ¸ì™€ì„œ ë¹Œë“œ` â†’ `ë©”ì¸ ì„œë²„ì— .jar í˜•íƒœë¡œ íŒŒì¼ì„ ì „ì†¡` â†’ `ì‹¤í–‰` ì„ í•˜ê³  ì‹¶ë‹¤ë©´ [ë‹¤ìŒ](https://dbjh.tistory.com/68?category=839984)ê³¼ ê°™ì€ ë°©ë²•ì„ ì¨ì•¼í•˜ì§€ë§Œ,<br>
ë‚˜ëŠ” springboot ì„œë²„ë¥¼ docker ì»¨í…Œì´ë„ˆì—ì„œ ì‹¤í–‰í•  ê²ƒì´ë¯€ë¡œ ì•„ë˜ê³¼ ê°™ì€ í”Œë¡œìš°ë¡œ ê°€ë ¤ê³  í•œë‹¤.

```
github ì˜¬ë¦¼ 
â†’ Jenkinsì—ì„œ githubì— ì˜¬ë¼ì™€ìˆëŠ” springboot í”„ë¡œì íŠ¸ë¥¼ ê°€ì ¸ì™€ì„œ ë¹Œë“œ
â†’ jenkins ì»¨í…Œì´ë„ˆì—ì„œ ìë™ ë¹Œë“œ ë° docker-compose ëª…ë ¹ì–´ë¡œ ë°°í¬
```

<br>
ëª©í‘œ:
1. ìš°ë¶„íˆ¬ ì¸ìŠ¤í„´ìŠ¤ì—ì„œ `Dockerfile`ê³¼ `docker-compose.yml`ë¥¼ í†µí•´ ì  í‚¨ìŠ¤ êµ¬ë™í•˜ê¸°
2. `github webhook`ì„ ì´ìš©í•´ Jenkinsì™€ github ì—°ë™í•˜ê¸°
3. Spring Boot í”„ë¡œì íŠ¸ì—ì„œ `Dockerfile`ê³¼ `docker-compose.yml`ì„ ì´ìš©í•´ mysql ì»¨í…Œì´ë„ˆì™€ ì›¹ ì»¨í…Œì´ë„ˆ êµ¬ë™í•˜ê¸°
4. `git push`ë¥¼ í†µí•´ ì  í‚¨ìŠ¤ì—ì„œ Spring Boot ì• í”Œë¦¬ì¼€ì´ì…˜ ìë™ ë¹Œë“œ & ë°°í¬ ì‹œìŠ¤í…œ êµ¬ì¶•

<br>

# 1. ìš°ë¶„íˆ¬ ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ë° swap file í• ë‹¹
> swap file í• ë‹¹ì€ [ì´ ê¸€](https://minju412.github.io/docker/8/#naem-server-%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88-%EA%B8%B0%EB%8F%99-%EC%8B%9C-mysql-%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88%EA%B0%80-%EC%A2%85%EB%A3%8C%EB%90%98%EB%8A%94-%EB%AC%B8%EC%A0%9C)ì„ ì°¸ê³ í–ˆë‹¤.

ì¸ìŠ¤í„´ìŠ¤ ë³¼ë¥¨ì€ ë„‰ë„‰í•˜ê²Œ 30Gë¡œ ìƒì„±í•˜ì!! (í”„ë¦¬í‹°ì–´ëŠ” ìµœëŒ€ 30Gê¹Œì§€ ë¬´ë£Œì´ë‹¤.)<br>
8Gë¡œ í–ˆë‹¤ê°€ ì»¨í…Œì´ë„ˆ ìƒì„±í•  ë•Œ ê³µê°„ì´ ë¶€ì¡±í•´ì„œ ì—ëŸ¬ í•´ê²°í•˜ëŠ”ë° ì• ë¨¹ì—ˆë‹¤..<br>



# 2. Ubuntuì— Docker Engine ì„¤ì¹˜
> [ê³µì‹ ì‚¬ì´íŠ¸](https://docs.docker.com/engine/install/ubuntu/)ë¥¼ ì°¸ê³ í–ˆë‹¤.

## Repository ì„¤ì •
```bash
# apt-get ì—…ë°ì´íŠ¸
$ sudo apt-get update

$ sudo apt-get install \
ca-certificates \
curl \
gnupg \
lsb-release

$ sudo mkdir -p /etc/apt/keyrings

$ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg

$ echo \
"deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
$(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
```

## Docker Engine ì„¤ì¹˜ ë° ì‹¤í–‰
```bash
$ sudo apt-get update

# ì„¤ì¹˜
$ sudo apt-get install docker-ce docker-ce-cli containerd.io docker-compose-plugin

# ë„ì»¤ ì‹¤í–‰
$ sudo service docker start

# ìƒíƒœ í™•ì¸
$ sudo service docker status
```

## ê¶Œí•œ ì„¤ì •
linuxì—ì„œ root ê¶Œí•œì´ ì•„ë‹Œ ìƒíƒœë¡œ dockerë¥¼ ì‹¤í–‰í•˜ë©´ ê¶Œí•œ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.
```
[linux@localhost ]$ docker ps
Got permission denied while trying to connect to the Docker daemon socket at unix:///var/run/docker.sock: Get http://%2Fvar%2Frun%2Fdocker.sock/v1.40/containers/json: dial unix /var/run/docker.sock: connect: permi
ssion denied
```
ì´ëŸ° ê²½ìš° ë§¤ë²ˆ sudoë¡œ ì»¤ë§¨ë“œë¥¼ ì‹¤í–‰í•´ë„ ë˜ì§€ë§Œ, ë²ˆê±°ë¡­ê¸° ë•Œë¬¸ì— docker groupì— í•´ë‹¹ ìœ ì €ë¥¼ ì¶”ê°€í•´ì£¼ë©´ í•´ê²°í•  ìˆ˜ ìˆë‹¤.<br>
```bash
# ë³´í†µì€ docker groupì´ ìƒê²¼ì„í…Œì§€ë§Œ, ë§Œì•½ ì—†ìœ¼ë©´ ìƒì„±í•´ì¤€ë‹¤.
$ sudo groupadd docker

# docker groupì— í•´ë‹¹ ìœ ì €ë¥¼ ì¶”ê°€
$ sudo usermod -aG docker $USER

# ë¡œê·¸ì•„ì›ƒ í›„ ë‹¤ì‹œ ë¡œê·¸ì¸í•˜ê±°ë‚˜ ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰ì‹œì¼œì•¼ ì ìš©ì´ ëœë‹¤.
$ newgrp docker
```


# 3. ë„ì»¤ ì»´í¬ì¦ˆ ì„¤ì¹˜

```bash
$ sudo apt  install docker-compose
$ docker-compose --version
```


# 4. ì  í‚¨ìŠ¤ ì„¤ì¹˜ (with.Docker Compose)
> [ì´ ê¸€](https://mrgamza.tistory.com/801)ê³¼ [ì´ ê¸€](https://hsik0225.github.io/jenkins/docker/2022/03/03/Jenkins-Docker%EB%A1%9C-Jenkins-%EC%84%A4%EC%B9%98%ED%95%98%EA%B8%B0/)ì„ ì°¸ê³ í–ˆë‹¤.


## 1) í´ë” ë§Œë“¤ê¸°
ìš°ë¶„íˆ¬ ì¸ìŠ¤í„´ìŠ¤ì— ì ‘ì†í•´ì„œ ì§„í–‰í•œë‹¤.<br>
docker í´ë” ìƒì„± í›„ ê·¸ ì•ˆì— jenkins í´ë”ë¥¼ ë§Œë“¤ê³ , ê·¸ ì•ˆì— home í´ë”ê¹Œì§€ ë§Œë“¤ì–´ì£¼ì.
```
docker
â¿ jenkins
 â¿ home
```

ì´ì œ `home` ë””ë ‰í„°ë¦¬ì— ê¶Œí•œì„ ë¶€ì—¬í•´ì•¼ í•œë‹¤.
```bash
$ chmod -R 777 home
```

> ğŸš¨ ì£¼ì˜<br>
ê¶Œí•œì„ ë¶€ì—¬í•˜ì§€ ì•Šìœ¼ë©´ ì•„ë˜ ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤...
```
touch: cannot touch '/var/jenkins_home/copy_reference_file.log': Permission denied
Can not write to /var/jenkins_home/copy_reference_file.log. Wrong volume permissions?
```


## 2) `Dockerfile` ìƒì„±

> [ì´ ê¸€](https://narup.tistory.com/228)ì„ ì°¸ê³ í–ˆë‹¤.

jenkins í´ë” ì•ˆì— `Dockerfile`ì„ ìƒì„±í•  ê²ƒì´ë‹¤.<br>
ì´ì œ í´ë” êµ¬ì¡°ëŠ” ì•„ë˜ì²˜ëŸ¼ ëœë‹¤.
```
docker
â¿ jenkins
 â¿ home
 â¿ Dockerfile
```

ë‚˜ì¤‘ì— ì  í‚¨ìŠ¤ ì»¨í…Œì´ë„ˆ ì•ˆì—ì„œ `docker-compose up -d` ì»¤ë§¨ë“œë¥¼ ì‹¤í–‰í•  ê²ƒì´ê¸° ë•Œë¬¸ì— docker ì™€ docker-composeë¥¼ ì„¤ì¹˜í•´ì¤€ë‹¤.<br>
(ì  í‚¨ìŠ¤ ì»¨í…Œì´ë„ˆì— ì ‘ì†í•´ì„œ ì§ì ‘ ì„¤ì¹˜í•´ë„ ë˜ì§€ë§Œ ê·¸ëŸ¬ë©´ ì»¨í…Œì´ë„ˆë¥¼ ì§€ìš°ê³  ìƒˆë¡œ ë§Œë“¤ë•Œë§ˆë‹¤ ë§¤ë²ˆ ì„¤ì¹˜í•´ì£¼ì–´ì•¼ í•´ì„œ êµ‰ì¥íˆ ë²ˆê±°ë¡­ë‹¤..)

```Dockerfile
# docker ì„¤ì¹˜
RUN apt-get update && \
 apt-get -y install apt-transport-https \
 ca-certificates \
 curl \
 gnupg2 \
 zip \
 unzip \
 software-properties-common && \
curl -fsSL https://download.docker.com/linux/$(. /etc/os-release; echo "$ID")/gpg > /tmp/dkey; apt-key add /tmp/dkey && \
 add-apt-repository \
 "deb [arch=amd64] https://download.docker.com/linux/$(. /etc/os-release; echo "$ID") \
 $(lsb_release -cs) \
 stable" && \
 apt-get update && \
 apt-get -y install docker-ce

 # docker-compose ì„¤ì¹˜
 RUN curl -L "https://github.com/docker/compose/releases/download/1.28.5/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose && \
    chmod +x /usr/local/bin/docker-compose && \
    ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose
```



## 3) `docker-compose.yml` ìƒì„±
jenkins í´ë” ì•ˆì— `docker-compose.yml`ì„ ìƒì„±í•  ê²ƒì´ë‹¤.<br>
ì´ì œ í´ë” êµ¬ì¡°ëŠ” ì•„ë˜ì²˜ëŸ¼ ëœë‹¤.
```
docker
â¿ jenkins
 â¿ home
 â¿ Dockerfile
 â¿ docker-compose.yml
```

`docker-compose.yml` ë‚´ìš©ì€ ì•„ë˜ì²˜ëŸ¼ ì‘ì„±í•œë‹¤.
```yml
version: '3'
services:
  jenkins:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: 'jenkins'
    image: 'jenkins/jenkins:lts'
    restart: always
    #user: root
    #privileged: true
    ports:
      - 9090:8080
      - 50000:50000
    volumes:
      - /home/ubuntu/docker/jenkins/home:/var/jenkins_home
      - /var/run:/var/run:ro              # docker ì‹¤í–‰ í´ë” ê³µìœ 
      - /var/run/docker.sock:/var/run/docker.sock # docker ì†Œì¼“ íŒŒì¼ ë§ˆìš´íŠ¸
    environment:
      TZ: "Asiz/Seoul"
```

> ë§Œì•½ Jenkinsì˜ í¬íŠ¸ë¥¼ 9090ì´ ì•„ë‹Œ ë‹¤ë¥¸ í¬íŠ¸ë¥¼ ì“°ê³  ì‹¶ë‹¤ë©´ "ì•"ì˜ í¬íŠ¸ë¥¼ 9090ì´ ì•„ë‹Œ ë‹¤ë¥¸ í¬íŠ¸ë¡œ ë°”ê¾¼ë‹¤. <br>
ë’¤ì˜ í¬íŠ¸ê¹Œì§€ ë°”ê¾¸ë©´ Jenkinsì— ì ‘ì†í•  ìˆ˜ ì—†ë‹¤. ì™œëƒí•˜ë©´ Jenkins ë‚´ë¶€ì—ì„œ í¬íŠ¸ë¥¼ 8080ê³¼ 50000ë§Œ ì—´ì–´ë‘ì—ˆê¸° ë•Œë¬¸ì´ë‹¤.<br>
ì¦‰, `9090:8080`ì€ ì ‘ì†í•  ìˆ˜ ìˆì§€ë§Œ `9090:9090`ì€ ì ‘ì†í•  ìˆ˜ ì—†ë‹¤.



## 3) ì  í‚¨ìŠ¤ ì»¨í…Œì´ë„ˆ ì‹¤í–‰
ìš°ë¶„íˆ¬ ì¸ìŠ¤í„´ìŠ¤ì˜ jenkins í´ë” ì•ˆì—ì„œ ì§„í–‰í•œë‹¤.
```bash
$ docker-compose up -d # permission deniedê°€ ë°œìƒí•˜ë©´ sudoë¥¼ ë¶™ì´ì!

# ë§Œì•¼ ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤ë©´ ë¡œê·¸ë¥¼ í™•ì¸í•´ë³´ì
$ docker logs jenkins # ë§¨ ë§ˆì§€ë§‰ì€ ì»¨í…Œì´ë„ˆ ì´ë¦„!
```

<img width="822" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-02-15 á„‹á…©á„’á…® 2 42 53" src="https://user-images.githubusercontent.com/59405576/218943027-3fc3e597-f03f-4dec-b214-7389042f0edc.png"><br>

ìµœì¢…ì ìœ¼ë¡œ í´ë” êµ¬ì¡°ëŠ” ì•„ë˜ì²˜ëŸ¼ ëœë‹¤! <br>
<img width="471" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-02-16 á„‹á…©á„’á…® 3 39 59" src="https://user-images.githubusercontent.com/59405576/219287996-6d252f90-900b-4f9e-acd9-010a6170d26b.png">


# 5. ì  í‚¨ìŠ¤ ì„¤ì •

## 1) ì  í‚¨ìŠ¤ ì ‘ì† ë° ì„¤ì •
> [ì´ ê¸€](https://hsik0225.github.io/jenkins/docker/2022/03/03/Jenkins-Docker%EB%A1%9C-Jenkins-%EC%84%A4%EC%B9%98%ED%95%98%EA%B8%B0/)ì„ ì°¸ê³ í–ˆë‹¤.

ì  í‚¨ìŠ¤ ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•œ í›„, `ì¸ìŠ¤í„´ìŠ¤ì˜ public ip:9090`ë¡œ ì ‘ì†í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ í˜ì´ì§€ê°€ ë‚˜ì˜¨ë‹¤.

### íŒ¨ìŠ¤ì›Œë“œ ì…ë ¥
<img width="979" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-02-15 á„‹á…©á„’á…® 4 10 01" src="https://user-images.githubusercontent.com/59405576/218957276-f1f98718-8466-4b37-88d7-7e95bcebb77f.png"><br>
ìœ„ ì‚¬ì§„ì— ë³´ì´ëŠ” ê²½ë¡œë¡œ ì´ë™í•´ ë¹„ë°€ë²ˆí˜¸ë¥¼ í™•ì¸í•´ì•¼í•˜ë‹ˆ ê²½ë¡œë¥¼ ë³µì‚¬í•˜ì!<br>
ğŸŒŸ ì§€ê¸ˆì€ ë„ì»¤ë¥¼ ì´ìš©í–ˆê¸° ë•Œë¬¸ì— ë„ì»¤ ì»¨í…Œì´ë„ˆì— ì ‘ì†í•´ì„œ í™•ì¸í•´ì•¼ í•œë‹¤!

```bash
$ docker exec -it jenkins /bin/bash # jenkins ìë¦¬ëŠ” ì  í‚¨ìŠ¤ ì»¨í…Œì´ë„ˆ ì´ë¦„!
# í˜¹ì€ docker exec -u 0 -it jenkins bash

# ì  í‚¨ìŠ¤ ì»¨í…Œì´ë„ˆ ì ‘ì† í›„ ì•„ë˜ ì»¤ë§¨ë“œ ì‹¤í–‰
$ cat ***/initialAdminPassword # ìœ„ì—ì„œ ë³µì‚¬í•œ ê²½ë¡œë¥¼ ì…ë ¥í•œë‹¤.
```
<img width="549" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-02-15 á„‹á…©á„’á…® 4 15 50" src="https://user-images.githubusercontent.com/59405576/218958410-268a7864-cfc0-4e66-8d72-134b498ea04f.png"><br>
ìœ„ì˜ ë¹¨ê°„ìƒ‰ìœ¼ë¡œ í‘œì‹œí•œ ë¶€ë¶„ì— ì¶œë ¥ë˜ëŠ” ê°’ì„ Administrator password ì— ì…ë ¥í•œë‹¤.<br>
ë¹„ë°€ë²ˆí˜¸ë¥¼ ì œëŒ€ë¡œ ì…ë ¥í–ˆë‹¤ë©´ ì–´ë“œë¯¼ ì„¤ì •í˜ì´ì§€ê°€ ë‚˜ì˜¨ë‹¤.<br><br>
ì–´ë“œë¯¼ ì„¤ì •í˜ì´ì§€ì—ì„œ ì„¤ì •í•œ ì•„ì´ë””ì™€ íŒ¨ìŠ¤ì›Œë“œëŠ” ì•ìœ¼ë¡œ ì‚¬ìš©í•´ì•¼í•˜ê¸° ë•Œë¬¸ì— ìŠìœ¼ë©´ ì•ˆëœë‹¤!

#### Trouble Shooting
ì²˜ìŒì—ëŠ” ë„ì»¤ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì•˜ì„ ë•Œì²˜ëŸ¼ ìš°ë¶„íˆ¬ì—ì„œ ë°”ë¡œ `cat ***/initialAdminPassword` ì»¤ë§¨ë“œë¥¼ ì‹¤í–‰í•˜ë‹ˆ `No such file or directory` ì—ëŸ¬ê°€ ë–´ë‹¤...<br>
<img width="563" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-02-15 á„‹á…©á„’á…® 4 15 20" src="https://user-images.githubusercontent.com/59405576/218958395-23836dd1-5787-4f55-a478-39c97e5d677d.png"><br>
ë„ì»¤ë¥¼ ì´ìš©í•´ ì  í‚¨ìŠ¤ë¥¼ êµ¬ë™í–ˆë‹¤ë©´ ì  í‚¨ìŠ¤ ì»¨í…Œì´ë„ˆì— ì ‘ì†í•œ ë’¤ì— í•´ë‹¹ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•´ì•¼ í•œë‹¤!


### í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜ í™”ë©´
íŒ¨ìŠ¤ì›Œë“œë¥¼ ì…ë ¥ í›„ ì•„ë˜ì™€ ê°™ì´ í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜í™”ë©´ì´ ë‚˜ì˜¤ëŠ”ë° íŠ¹ë³„íˆ ì„¤ì¹˜í•  í”ŒëŸ¬ê·¸ì¸ì´ í•„ìš”ì—†ë‹¤ë©´ `install suggested plugins`ë¥¼ ì„ íƒí•œë‹¤.<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-04 á„‹á…©á„’á…® 11 48 09](https://user-images.githubusercontent.com/59405576/193851421-0bd60061-605b-41ad-bf58-cfc9478f317a.png){: width="500" height="500"}<br><br>
ê·¸ëŸ¼ ì•„ë˜ì²˜ëŸ¼ Getting Started í˜ì´ì§€ê°€ ë‚˜ì˜¬ ê²ƒì´ë‹¤. ì ì‹œ ê¸°ë‹¤ë¦¬ì.<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-04 á„‹á…©á„’á…® 11 48 52](https://user-images.githubusercontent.com/59405576/193851543-a33f7b7d-7888-4bdb-a74f-86bc0f1e9d4e.png){: width="500" height="500"}

### Admin ê³„ì • ìƒì„±
ê¸°ë‹¤ë¦¬ë©´ ì´ë ‡ê²Œ Admin ì‚¬ìš©ìë¥¼ ìƒì„±í•˜ëŠ” í˜ì´ì§€ê°€ ë‚˜ì˜¤ëŠ”ë°, Admin ì‚¬ìš©ìë¥¼ ìƒì„±í•˜ê³  ë‹¤ìŒ í™”ë©´ì„ ëˆ„ë¥´ë©´ Jenkins í™”ë©´ì´ ë³´ì´ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.<br>


### Instance Configuration
ë§ˆì§€ë§‰ìœ¼ë¡œ ì  í‚¨ìŠ¤ì˜ TCP í¬íŠ¸ë¥¼ ì•ìœ¼ë¡œë„ ê³„ì† ê°™ì€ í¬íŠ¸ë¥¼ ì“¸ ê²ƒì¸ì§€ ë¬¼ì–´ë³¸ë‹¤.<br>


ì´ì œ ì„¤ì •ì´ ëë‚¬ë‹¤. Start using Jenkinsë¥¼ ëˆ„ë¥´ì.<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-04 á„‹á…©á„’á…® 8 51 42](https://user-images.githubusercontent.com/59405576/193812599-6d380d79-123e-4fcb-ad30-043c55eec549.png)<br>
ê·¸ëŸ¼ ì•„ë˜ì™€ ê°™ì€ ëŒ€ì‹œë³´ë“œê°€ ë‚˜ì˜¨ë‹¤.<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-04 á„‹á…©á„’á…® 8 52 56](https://user-images.githubusercontent.com/59405576/193812824-f32c2a1f-17e8-4b67-a223-3d50c82c80ed.png){: width="500" height="500"}


## 2) ì  í‚¨ìŠ¤ë¥¼ í†µí•œ ìë™ ë¹Œë“œ & ìë™ ë°°í¬ ğŸŒŸ
> [ì´ ê¸€](https://learnote-dev.com/java/Spring-%EC%A0%A0%ED%82%A8%EC%8A%A4-%EB%B0%B0%ED%8F%AC/#%EC%A0%A0%ED%82%A8%EC%8A%A4-%EB%B9%8C%EB%93%9C-%EC%84%A4%EC%A0%95%ED%95%98%EA%B8%B0)ì„ ì°¸ê³ í–ˆë‹¤.

### Item ìƒì„± ë° ê¸°ë³¸ ì„¤ì •
ì  í‚¨ìŠ¤ ëŒ€ì‹œë³´ë“œì—ì„œ ì§„í–‰í•œë‹¤.
1. ìƒˆë¡œìš´ ì•„ì´í…œ ì„ íƒ
2. Freestyle project ì„ íƒ ë° ì´ë¦„ ì‘ì„±
3. ì†ŒìŠ¤ ì½”ë“œ ê´€ë¦¬ -> Git ì„ íƒ -> Repository URL & Branch Specifier ì‘ì„±
4. ë¹Œë“œ ìœ ë°œ -> `GitHub hook trigger for GITScm polling` ì„ íƒ

ì´ ìƒíƒœë¡œ ìš°ì„  ì €ì¥í•œë‹¤.<br>
3ë²ˆì—ì„œ Credentials ëŠ” ë‚˜ì¤‘ì— ìƒì„±í•œ ë’¤ì— ì¶”ê°€í•  ê²ƒì´ë‹¤.

### ssh í‚¤ ë°œê¸‰
> [ì´ ê¸€](https://uchupura.tistory.com/63)ì„ ì°¸ê³ í–ˆë‹¤.

```bash
$ docker exec -it [jenkins ì»¨í…Œì´ë„ˆ ì´ë¦„] ssh-keygen
# ì—°ì†ìœ¼ë¡œ ì—”í„° ì„¸ ë²ˆ ì…ë ¥í•˜ê¸°
# Created directory í™•ì¸ !! ğŸŒŸ

# ìƒì„± ëœ Public SSH í‚¤ ê²€ìƒ‰
$ docker exec -it [jenkins ì»¨í…Œì´ë„ˆ ì´ë¦„] cat [í™•ì¸í•œ Created directory]/id_rsa.pub
# ì˜ˆ. docker exec -it jenkins cat /root/.ssh/id_rsa.pub

# ìƒì„± ëœ Private SSH í‚¤ ê²€ìƒ‰
docker exec -it [jenkins ì»¨í…Œì´ë„ˆ ì´ë¦„] cat /[í™•ì¸í•œ Created directory]/id_rsa
# ì˜ˆ. docker exec -it jenkins cat /root/.ssh/id_rsa
```
<img width="568" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-02-16 á„‹á…©á„’á…® 4 11 20" src="https://user-images.githubusercontent.com/59405576/219293741-3d5f34c7-d8a5-4b5c-92ed-8e68e01ae5e4.png"><br><br>
ë¹„ë°€í‚¤ì™€ ê³µê°œí‚¤ê°€ ì˜ ìƒì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸í•´ë³´ì<br>
<img width="548" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-02-16 á„‹á…©á„’á…® 4 12 44" src="https://user-images.githubusercontent.com/59405576/219294074-535eb91e-92c7-4333-9b82-439d22d770fd.png">


### ê¹ƒ deploy key ë“±ë¡
ì´ì œ GitHubë¡œ ê°€ì„œ Deploy Keyë¥¼ ë“±ë¡í•´ì£¼ì!<br>
ë°±ì—”ë“œ ë ˆí¬ì§€í† ë¦¬ë¡œ ê°€ì„œ Settings > Deploy keys > Add deploy key ë¥¼ í´ë¦­í•œë‹¤.<br>
<img width="622" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-02-15 á„‹á…©á„’á…® 5 04 49" src="https://user-images.githubusercontent.com/59405576/218968494-bc966381-2078-435e-9b56-c74b7ef65cfa.png"><br>
ìœ„ ëª…ë ¹ìœ¼ë¡œ ê³µê°œí‚¤ë¥¼ í™•ì¸í•œ ë’¤, ë³µë¶™í•´ì£¼ê³  `Add key` ë²„íŠ¼ì„ ëˆ„ë¥¸ë‹¤.<br>
<img width="808" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-02-15 á„‹á…©á„’á…® 5 06 45" src="https://user-images.githubusercontent.com/59405576/218968904-6e2f88a2-9ceb-47d5-9404-61faa632b3d1.png">


### jenkins credentials ì¶”ê°€
ë‹¤ì‹œ ì  í‚¨ìŠ¤ ëŒ€ì‹œë³´ë“œë¡œ ê°€ì„œ Jenkins ê´€ë¦¬ > `Manage Credentials`ë¡œ ì´ë™í•´ì¤€ë‹¤.<br>
<img width="705" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-02-15 á„‹á…©á„’á…® 5 08 47" src="https://user-images.githubusercontent.com/59405576/218969359-89922e91-870d-416e-a039-5fc6014481db.png"><br>
`Stores scoped to Jenkins`ì— ìˆëŠ” `global`ì„ ëˆŒëŸ¬ ì´ë™í•œë‹¤.<br><br>
<img width="698" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-02-15 á„‹á…©á„’á…® 5 11 29" src="https://user-images.githubusercontent.com/59405576/218969910-ea3da443-8017-40ad-8b7d-8f12aa410c59.png"><br>
`Add Credenials`ë¥¼ ëˆŒëŸ¬ í‚¤ë¥¼ ì¶”ê°€í•´ì¤€ë‹¤.<br><br>
Kindë¥¼ `SSH Username with private Key`ë¡œ ë°”ê¾¸ê³  `privateKey`ì˜ `Enter directly`ë¥¼ í™œì„±í™”í•œë’¤ Addë¥¼ í†µí•´ ì´ë²ˆì—ëŠ” ì  í‚¨ìŠ¤ì˜ ë¹„ë°€í‚¤ë¥¼ ì¶”ê°€í•´ì¤€ë‹¤.<br>
<img width="599" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-02-15 á„‹á…©á„’á…® 5 12 57" src="https://user-images.githubusercontent.com/59405576/218970213-105b1803-aaad-4d65-94aa-8a23656fd664.png"><br>
ìœ„ ëª…ë ¹ìœ¼ë¡œ ê³µê°œí‚¤ë¥¼ í™•ì¸í•œ ë’¤, ë³µë¶™í•´ì£¼ê³  ì•„ë˜ì²˜ëŸ¼ ë¶™ì—¬ë„£ëŠ”ë‹¤.<br>
<img width="697" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-02-15 á„‹á…©á„’á…® 5 14 06" src="https://user-images.githubusercontent.com/59405576/218970482-bcc0b532-3038-42a4-8fd1-6faa91ad2da6.png">
<img width="695" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-02-15 á„‹á…©á„’á…® 5 14 16" src="https://user-images.githubusercontent.com/59405576/218970502-e6645c4f-c3fd-42ca-9589-ffdd8c9b220f.png"><br>
`Username`ì€ ì›í•˜ëŠ” ì´ë¦„ìœ¼ë¡œ ì„¤ì •í•´ì£¼ë©´ ëœë‹¤. ë‚˜ëŠ” `deploy key`ë¡œ ì„¤ì •í–ˆë‹¤.<br>
ì´ì œ `Create`ë¥¼ ëˆŒëŸ¬ì¤€ë‹¤.

### Itemì— ìƒì„±í•œ credential ì¶”ê°€
ì´ì œ ì•„ê¹Œ ë§Œë“  Itemì— ë°©ê¸ˆ ìƒì„±í•œ credential(`deploy key`)ì„ ì¶”ê°€í•˜ì.<br><br>
ëŒ€ì‹œë³´ë“œì—ì„œ ì•„ê¹Œ ë§Œë“  Item ì´ë¦„ì„ í´ë¦­í•œë‹¤.<br>
<img width="1075" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-02-15 á„‹á…©á„’á…® 5 19 48" src="https://user-images.githubusercontent.com/59405576/218971850-f4911c69-56f5-47ee-85ea-427334f38087.png"><br><br>
ì™¼ìª½ ì‚¬ì´ë“œë°”ì—ì„œ `êµ¬ì„±`ì„ í´ë¦­í•œë‹¤.<br>
<img width="344" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-02-15 á„‹á…©á„’á…® 5 19 59" src="https://user-images.githubusercontent.com/59405576/218971864-6c3573f6-3c65-4084-aac8-a64e2461c4da.png"><br><br>
ì†ŒìŠ¤ì½”ë“œê´€ë¦¬ > Credentialsì— ì•„ê¹Œ ë§Œë“¤ì–´ì¤€ sshí‚¤(`deploy key`)ë¥¼ ì„¤ì •í•´ì¤€ë‹¤.<br>
<img width="942" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-02-15 á„‹á…©á„’á…® 5 20 26" src="https://user-images.githubusercontent.com/59405576/218971880-e4dd2ddd-b0d2-48ab-8d12-b282d49b238f.png"><br><br>
ë¹Œë“œ ìœ ë°œì—ëŠ” ê¹ƒí—ˆë¸Œ webhook ì„¤ì •ì„ ìœ„í•´ `GitHub hook trigger for GITScm polling`ì„ ì²´í¬í•´ì¤€ë‹¤.

### Build ì„¤ì •
ì´ì œ Build ì„¤ì •ì„ í•˜ì. <br>
`Build Steps` í•­ëª©ì—ì„œ `Execute shell`ì„ ì„ íƒí•´ì£¼ê³  Githubì— í‘¸ì‰¬ê°€ ë˜ì—ˆì„ë•Œ ì–´ë–»ê²Œ ì‘ë™í• ì§€ë¥¼ ì ì–´ì¤€ë‹¤.<br>
ë‚˜ëŠ” ì•„ë˜ì²˜ëŸ¼ ì ì—ˆë‹¤.
```sh
echo "ê¸°ì¡´ ì»¨í…Œì´ë„ˆ ì¤‘ì§€"
docker-compose stop

echo "ë„ì»¤ ì»¨í…Œì´ë„ˆ ì‹¤í–‰"
docker-compose up -d

sleep 5s
docker ps -a
```
ì´ëŒ€ë¡œ ëŒë¦¬ê²Œ ë˜ë©´ `sudo`ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤ëŠ” ì—ëŸ¬ê°€ ëœ¬ë‹¤. root ê³„ì •ì´ ì•„ë‹ˆë©´ `sudo`ë¥¼ ì‚¬ìš©í•  ìˆ˜ê°€ ì—†ê¸° ë•Œë¬¸ì´ë‹¤. <br>
ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ì  í‚¨ìŠ¤ ê³„ì •ì´ `sudo`ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì„¤ì • í•´ì£¼ì–´ì•¼ í•œë‹¤.<br><br>
(ë‚˜ëŠ” ìœ„ì— `Execute shell`ì—ì„œ `sudo`ë¥¼ ì‚¬ìš©í•˜ì§€ëŠ” ì•Šì•˜ì§€ë§Œ í˜¹ì‹œ ëª°ë¼ì„œ ì•„ë˜ sudoers ì„¤ì •ê¹Œì§€ í•´ì£¼ì—ˆë‹¤..!)

### sudoers ì„¤ì •
ìš°ë¶„íˆ¬ ì¸ìŠ¤í„´ìŠ¤ì— ì ‘ì†í•œ ìƒíƒœë¡œ ì§„í–‰í•œë‹¤.
```bash
$ sudo su
$ vi /etc/sudoers
# jenkins ALL=(ALL) NOPASSWD: ALL ì¶”ê°€
```
`jenkins ALL=(ALL) NOPASSWD: ALL`ëŠ” jenkinsì—ê²Œ sudo ì ‘ê·¼ê¶Œí•œì„ ì£¼ëŠ” ëª…ë ¹ì–´ì´ë‹¤.<br>
<img width="373" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-02-15 á„‹á…©á„’á…® 5 35 42" src="https://user-images.githubusercontent.com/59405576/218975263-7a89cae8-0ff6-48b3-bfa0-c804154fae8b.png"><br><br>
<img width="731" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-02-15 á„‹á…©á„’á…® 5 35 25" src="https://user-images.githubusercontent.com/59405576/218975274-f78d2f7e-475b-4e31-a0e5-cad6375fdeff.png">

### ê¹ƒ web hook ì„¤ì •
ë ˆí¬ì§€í† ë¦¬ì˜ ì„¸íŒ…ì— ë“¤ì–´ê°€ Webhooksë¥¼ ì„ íƒí•œë‹¤.<br>
<img width="1385" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-02-15 á„‹á…©á„’á…® 5 41 45" src="https://user-images.githubusercontent.com/59405576/218976933-a2e164b6-62e0-4c71-88a0-b2fa8a2e9fdc.png"><br><br>
`Add webhook`ì„ ëˆ„ë¥¸ ë’¤, ì•„ë˜ì²˜ëŸ¼ `payload URL`ì— í•´ë‹¹ ì  í‚¨ìŠ¤ ì£¼ì†Œë¥¼ ì ì–´ì£¼ê³  `Content type`ì„ `application/json`ìœ¼ë¡œ ì„¤ì •í•´ì£¼ë©´ ëœë‹¤.<br>
<img width="796" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-02-15 á„‹á…©á„’á…® 5 42 45" src="https://user-images.githubusercontent.com/59405576/218976954-0c2cb6ee-8fab-4c6f-91e4-3d01ff97aacd.png"><br><br>
ì´ë•Œ, ê¼­ ë³´ì•ˆê·¸ë£¹ì˜ ì¸ë°”ìš´ë“œ ê·œì¹™ì— ì  í‚¨ìŠ¤ í¬íŠ¸ë¥¼ `0.0.0.0`ìœ¼ë¡œ í¼ë¸”ë¦­ìœ¼ë¡œ ì—´ì–´ë‘ì–´ì•¼ ê¹ƒí—ˆë¸Œê°€ ë³´ë‚¸ Webhook ìš”ì²­ì„ ë°›ì„ ìˆ˜ ìˆë‹¤.<br>
ì´ì œ í‘¸ì‰¬ìš”ì²­ì„ ë³´ë‚´ë©´, ì  í‚¨ìŠ¤ê°€ ì•Œì•„ì„œ ê¹ƒì—ì„œ í‘¸ì‰¬ëœ ë‚´ìš©ì„ ê°€ì ¸ì™€ íŒŒì¼ì„ ë¹Œë“œí•˜ê³  ì´ë¥¼ ë„ì»¤ ì»¨í…Œì´ë„ˆë¡œ ë¹Œë“œí•˜ì—¬ ì‹¤í–‰í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì„ ê²ƒì´ë‹¤.

# 6. Spring Boot í”„ë¡œì íŠ¸ êµ¬ì„±
ë¡œì»¬ì— ìˆëŠ” Spring Boot í”„ë¡œì íŠ¸ì˜ ìµœìƒìœ„ì— `Dockerfile`ê³¼ `docker-compose.yml`ì„ ìƒì„±í•œë‹¤.

## `Dockerfile`
```Dockerfile
FROM openjdk:11-jdk
#VOLUME /tmp
ARG JAR_FILE=./build/libs/jenkins-test-0.0.1-SNAPSHOT.jar
COPY ${JAR_FILE} app.jar
ENTRYPOINT ["java","-jar","/app.jar"]
EXPOSE 8080
```

## `docker-compose.yml`
```yml
version: '3'
services:
  database:
    container_name: my_mysql
    image: mysql
    environment:
      - MYSQL_ROOT_PASSWORD=1234
      - MYSQL_DATABASE=testdb
    ports:
      - 3306:3306
    volumes:
    # - {ì—°ê²°ë  ì‹¤ì œ ë¬¼ë¦¬ folder path}/{docker ì•ˆì— folder path}
      - ./docker/data:/var/lib/mysql
    networks:
      - test_network

  application:
    container_name: my_app
    build:
      context: ./
      dockerfile: Dockerfile
    ports:
      - 8080:8080
    environment:
      SPRING_APPLICATION_JSON: '{
          "spring.datasource.url"  : "jdbc:mysql://my_mysql:3306/testdb?serverTimezone=UTC&characterEncoding=UTF-8",
          "spring.datasource.username" : "root",
          "spring.datasource.password" : "1234",
          "spring.jpa.properties.hibernate.dialect" : "org.hibernate.dialect.MySQL8Dialect",
          "spring.jpa.hibernate.ddl-auto" : "create"
        }'
    depends_on:
      - database
    networks:
      - test_network

networks:
  test_network:
    driver: bridge
```
ì´ë•Œ db ì ‘ì† ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì—ˆê¸° ë•Œë¬¸ì— `application.yml`ì—ëŠ” `spring.datasource` ì •ë³´ë¥¼ ì‘ì„±í•  í•„ìš”ê°€ ì—†ë‹¤!

# ë§ˆë¬´ë¦¬

ì´ì œ Spring Boot ì½”ë“œë¥¼ ê¹ƒí—™ì— í‘¸ì‹œí•˜ë©´, <br>
ì  í‚¨ìŠ¤ê°€ webhookì„ í†µí•´ ê°€ì ¸ì™€ì„œ ìë™ìœ¼ë¡œ build í•˜ê³ , `Execute shell`ì— ì ì€ `docker-compose up -d` ì»¤ë§¨ë“œë¥¼ í†µí•´ ë°°í¬ê¹Œì§€ ì§„í–‰í•œë‹¤.

## Trouble Shooting
í˜¹ì‹œë‚˜ ë¹Œë“œ ì‹œì— ì•„ë˜ì™€ ê°™ì€ ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤ë©´...<br>
<img width="1230" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-02-16 á„‹á…©á„Œá…¥á†« 11 06 14" src="https://user-images.githubusercontent.com/59405576/219249092-b7c251f8-f5cc-4729-9474-58a1cbeaad18.png"><br><br>
`Dockerfile`ì—ì„œ `COPY` ë¶€ë¶„ì—ì„œ ë¬¸ì œê°€ ë°œìƒí•œ ê²ƒ ê°™ë‹¤...

> [ì´ ê¸€](https://community.render.com/t/i-do-a-docker-file-in-a-spring-boots-proyect-local-worked-fine-but-when-render-use-dockers-file-its-cant-finde-compute-cache-key/8141)ì„ ë³´ê³  `.gitignore`ì˜ ë¬¸ì œì„ì„ ì•Œì•˜ë‹¤.

Dockerfileì—ì„œ `build/libs/jenkins-test-0.0.1-SNAPSHOT.jar` ì„ `app.jar` ë¡œ COPY í•´ì•¼í•˜ëŠ”ë° `build` ë””ë ‰í† ë¦¬ê°€ `.gitignore`ì— ë“±ë¡ë˜ì–´ìˆì—ˆë‹¤.<br>
ê·¸ë˜ì„œ `build/libs`ë¥¼ `.gitignore`ì—ì„œ ì œì™¸í–ˆë‹¤.<br><br>

ë³€ê²½ ì „ `gitignore`
```
...

build/

...
```

ë³€ê²½ í›„ `gitignore`
```
...

build/classes
build/generated
build/resources
build/tmp
build/bootJarMainClassName

...
```

ì´í›„ ë¹Œë“œí•´ë³´ë‹ˆ ì—ëŸ¬ê°€ í•´ê²°ë˜ì—ˆë‹¤!!!










***
<br>


    ğŸ’› ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ğŸ‘»

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}