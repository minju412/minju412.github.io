---
title:  "[GCP] spring boot + jenkins + docker ë°°í¬í•˜ê¸° - 1. ì  í‚¨ìŠ¤ ì„œë²„ "

categories:
  - GCP
tags:
  - [GCP]

toc: true
toc_sticky: true
 
date: 2022-10-14 13:28:00
last_modified_at: 2022-10-14 13:28:02
---

GCP í”„ë¡œì íŠ¸ ìƒì„±ë¶€í„° jenkins ì„¤ì¹˜ê¹Œì§€ëŠ” [ì´ì „ ê¸€](https://minju412.github.io/gcp/1/)ì—ì„œ ë‹¤ë¤˜ë‹¤.<br><br>
ìš°ì„ , ì´ì „ì— ë§Œë“  `jenkins` ì¸ìŠ¤í„´ìŠ¤ì—ì„œ [ìœ ì‚¬í•˜ê²Œ ë§Œë“¤ê¸°]ë¡œ `web` ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ì.<br>
ìƒì„± í›„ì—ëŠ” ì™¸ë¶€ ê³ ì • IPë„ í• ë‹¹í•˜ì.<br>
(ê¸°ì¡´ì— ìˆë˜ `instance-1`ì€ ubuntu ì˜€ìœ¼ë¯€ë¡œ ì¼ë‹¨ ì¤‘ì§€í•´ë†“ì.)<br><br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-13 á„‹á…©á„’á…® 9 31 17](https://user-images.githubusercontent.com/59405576/195596730-9ca43c1c-7011-4a6c-ba3c-9ffae5f58acd.png)<br>
í˜„ì¬ ì‹¤í–‰ ì¤‘ì¸ ì¸ìŠ¤í„´ìŠ¤ëŠ” ì•„ë˜ì™€ ê°™ë‹¤.
- `jenkins`: ì  í‚¨ìŠ¤ ì„œë²„, Centos7
- `web`: ë°°í¬ ì„œë²„, Centos7

ì  í‚¨ìŠ¤ ì„œë²„ì—ì„œëŠ” Dockerë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³ ,<br>
ë°°í¬ ì„œë²„ì—ì„œëŠ” Dockerë¥¼ ì‚¬ìš©í•  ê²ƒì´ë‹¤.

<br>

## 0. ì‹œë‚˜ë¦¬ì˜¤
> [ì´ ê¸€](https://dev-gorany.tistory.com/345)ì„ ì°¸ê³ í–ˆë‹¤.

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-13 á„‹á…©á„’á…® 9 32 22](https://user-images.githubusercontent.com/59405576/195596855-1d9b623e-495e-4c70-89e8-50a569de2b20.png){: width="500" height="500"}
1. ì½”ë“œë¥¼ ì‘ì„±í•œë‹¤.
2. ê¹ƒí—™ì— Pushí•œë‹¤.
3. Webhookì´ ê±¸ë ¤ ì  í‚¨ìŠ¤ì—ê²Œ Jobì„ ì‹¤í–‰í•˜ë¼ê³  í•œë‹¤.
4. ì  í‚¨ìŠ¤ê°€ Buildí•´ì¤€ ê²°ê³¼ë¥¼ ë°°í¬ ì„œë²„ì— ë„˜ê¸´ë‹¤.
5. ë°°í¬ ì„œë²„ì—ì„œ ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•´ ìë™ ë°°í¬í•œë‹¤.

<br>

ì´ë²ˆ ê¸€ì—ì„œëŠ” ì  í‚¨ìŠ¤ ì¸ìŠ¤í„´ìŠ¤(`jenkins`)ì—ì„œ ì§„í–‰í•˜ê³ ,<br>
ë‹¤ìŒ ê¸€ì—ì„œëŠ” ë°°í¬ ì¸ìŠ¤í„´ìŠ¤(`web`)ì—ì„œ ì§„í–‰í•  ê²ƒì´ë‹¤.

## 1. ë©”íƒ€ë°ì´í„° ssh ì ‘ê·¼ ì„¤ì •
í‚¤ ìƒì„±ê³¼ ë“±ë¡ì€ ì´ì „ ê¸€ì—ì„œ ì´ë¯¸ ì§„í–‰í–ˆë‹¤.

## 2. ì  í‚¨ìŠ¤ ì„œë²„ êµ¬ë™ í™•ì¸
ì  í‚¨ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ì— SSH ì ‘ì†í•œ ë’¤ì— ì•„ë˜ ì»¤ë§¨ë“œë¥¼ ì‹¤í–‰í•œë‹¤.
```bash
# ì  í‚¨ìŠ¤ ìƒíƒœ í™•ì¸
$ sudo service jenkins status

# ë§Œì•½ ì •ì§€ë˜ì–´ ìˆìœ¼ë©´ ì•„ë˜ ì»¤ë§¨ë“œë¡œ ì‹¤í–‰
$ sudo service jenkins start systemctl enable jenkins
```
`http://[ì  í‚¨ìŠ¤ ì„œë²„ ì™¸ë¶€IP]:9090`ìœ¼ë¡œ ì›¹ ë¸Œë¼ìš°ì €ì— ì ‘ì†í•œë‹¤.


## 3. Global Tool Configuration
> [ì´ ê¸€](https://1gold.tistory.com/77)ì„ ì°¸ê³ í–ˆë‹¤.

> [Dashboard] > [Jenkins ê´€ë¦¬] > [Global Tool Configuration]

ë§Œì•½ ì´ëŸ° ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤ë©´?
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-14 á„‹á…©á„’á…® 4 04 37](https://user-images.githubusercontent.com/59405576/195783680-cb749ee6-a2c0-437c-b254-3d6bbe4d9487.png)<br><br>
ì‹œë„ 1)<br>
```bash
$ vi ~/.bash_profile

# ì•„ë˜ ì½”ë“œ ë‘ ì¤„ ì¶”ê°€
export JAVA_HOME=/usr/lib/jvm/java-11-openjdk-11.0.16.1.1-1.el7_9.x86_64
export PATH=$JAVA_HOME/bin:$PATH

# ë³€ê²½ì‚¬í•­ ì ìš©
$ source ~/.bash_profile
```
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-14 á„‹á…©á„’á…® 4 03 30](https://user-images.githubusercontent.com/59405576/195783489-72171e5e-0945-4347-bc0c-b6eaf45b50aa.png)<br><br>
í•˜ì§€ë§Œ ë¬¸ì œê°€ í•´ê²°ë˜ì§€ ì•Šì•„ ë‹¤ì‹œ ì›ìƒë³µêµ¬ í–ˆë‹¤.<br><br>
ì‹œë„2)<br>
java ë‹¤ì‹œ ì„¤ì¹˜
```bash
# ì„¤ì¹˜í•  ìˆ˜ ìˆëŠ” ë²„ì „ í™•ì¸
$ yum list java*jdk-devel

# ì„¤ì¹˜
$ sudo yum install java-11-openjdk-devel.x86_64

# ê¸°ë³¸ ìë°” ì„ íƒ
$ sudo update-alternatives --config java
```
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-14 á„‹á…©á„’á…® 4 29 30](https://user-images.githubusercontent.com/59405576/195788217-7b719b8b-6569-4103-a5a8-44b4249a1e0c.png)<br><br>

ì•„ë˜ ì½”ë“œë¡œ javaê°€ ì„¤ì¹˜ëœ ë””ë ‰í† ë¦¬ë¥¼ í™•ì¸í•´ë³´ì.
```bash
$ cd /usr/lib/jvm
```
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-14 á„‹á…©á„’á…® 4 39 08](https://user-images.githubusercontent.com/59405576/195790209-c662e480-0f07-4e53-8e28-2467bdffb30e.png)<br><br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-14 á„‹á…©á„’á…® 4 35 49](https://user-images.githubusercontent.com/59405576/195789463-9c0d1cd4-0c5e-42c8-a74a-7ba2cbbd3ecf.png)<br><br>
í•´ê²°ë˜ì—ˆë‹¤!<br><br>
ì´ì œ ë°”ë¡œ ì•„ë˜ ìˆëŠ” Git ì„¤ì •ë„ í•´ì£¼ì.<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-14 á„‹á…©á„’á…® 4 36 36](https://user-images.githubusercontent.com/59405576/195789612-66704431-cf5f-44f6-a91d-db83f3a376e1.png)<br><br>
ì´ì œ Save ë²„íŠ¼ì„ ëˆ„ë¥¸ë‹¤.

## 4. Publish Over SSH
> [ì´ ê¸€](https://barbera.tistory.com/60)ì„ ì°¸ê³ í–ˆë‹¤.

### 1) ì„¤ì¹˜
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-13 á„‹á…©á„’á…® 9 38 50](https://user-images.githubusercontent.com/59405576/195598306-3d54819f-c28c-4e74-88ef-490d7bc3cb72.png){: width="700" height="700"}<br><br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-13 á„‹á…©á„’á…® 9 45 30](https://user-images.githubusercontent.com/59405576/195599713-a9de5b05-1aec-44c2-8829-4976928f6bb0.png){: width="700" height="700"}<br><br>
ìœ„ í”ŒëŸ¬ê·¸ì¸ì„ ì„¤ì¹˜í•œë‹¤.

### 2) ê³µê°œí‚¤/ê°œì¸í‚¤ í™•ì¸
ì„¤ì •í•˜ê¸° ì „ì—, ê³µê°œí‚¤ì™€ ê°œì¸í‚¤ë¥¼ í™•ì¸í•´ë³´ì.<br>
```bash
# ê³µê°œí‚¤ í™•ì¸
$ cat .ssh/id_rsa.pub

# ê°œì¸í‚¤ í™•ì¸
$ cat .ssh/id_rsa # ë³µì‚¬í•´ë‘ì!
```
ì´ë•Œ í™•ì¸í•œ ê°œì¸í‚¤ë¥¼ ë³µì‚¬í•´ë‘ì!<br><br>

### 3) ì„¤ì •
ì´ì œ Publish Over SSH ì„¤ì •ì„ í•´ë³´ì.<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-13 á„‹á…©á„’á…® 10 15 58](https://user-images.githubusercontent.com/59405576/195606720-bca8e141-8a80-472f-b8ed-0c8f154c752d.png){: width="500" height="500"}<br><br>
[Jenkins ê´€ë¦¬ > ì‹œìŠ¤í…œ ì„¤ì •]ì— ë“¤ì–´ê°„ë‹¤.<br>
ë§¨ ì•„ë˜ ë³´ë©´ Publish Over SSH ê´€ë ¨ ì„¤ì •ì´ ìˆë‹¤.<br>
ì•„ë˜ì™€ ê°™ì´ ì„¤ì •í•´ì£¼ì—ˆë‹¤.<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-13 á„‹á…©á„’á…® 10 27 13](https://user-images.githubusercontent.com/59405576/195609746-77041c2e-8313-4247-95ab-ad7da7a7fa7d.png){: width="500" height="500"}<br><br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-13 á„‹á…©á„’á…® 10 26 35](https://user-images.githubusercontent.com/59405576/195609738-2901380e-c97e-4d4e-8692-701193937bcd.png){: width="500" height="500"}

> ê°ê°ì˜ ì…ë ¥ì€ ì•„ë˜ì˜ ê³¼ì •ì„ ê±°ì¹˜ë©´ ëœë‹¤.<br>
1. ì•„ë˜ì˜ ê·¸ë¦¼ì—ì„œ Nameì€ ê°€ê¸‰ì ì´ë©´ GCPì—ì„œ ì¸ìŠ¤í„´ìŠ¤ì˜ ì´ë¦„ê³¼ ë™ì¼í•˜ê²Œ ì§€ì–´ì£¼ëŠ”ê²ƒì´ ì¢‹ë‹¤. (ë‚˜ëŠ” ë°°í¬ ì¸ìŠ¤í„´ìŠ¤ì˜ ì´ë¦„ì„ ì ì—ˆë‹¤.)
2. Hostnameì€ IPë¥¼ ì ì–´ì£¼ë©´ ë˜ëŠ”ë° ì›Œì»¤ ì¸ìŠ¤í„´ìŠ¤ê°€ ì  í‚¨ìŠ¤ì™€ ê°™ì€ ë„¤íŠ¸ì›Œí¬ìƒì— ìˆìœ¼ë©´ ë‚´ë¶€IPë¥¼ ì‚¬ìš©í•´ë„ ëœë‹¤. (ë‚˜ëŠ” ë‚´ë¶€ IPë¥¼ ì‚¬ìš©í–ˆë‹¤.)<br>
(ê°™ì€ Regionì— ë‚´ë¶€ IPê°€ ë¹„ìŠ·í•˜ë‹¤ë©´ ê°™ì€ ë„¤íŠ¸ì›Œí¬)
3. Usernameì€ ì¸ìŠ¤í„´ìŠ¤ì™€ ì—°ê²°ëœ Usernameì— ëŒ€í•œ ì •ë³´ì´ë‹¤. GCPì—ì„œ ë¡œê·¸ì¸í• ë•Œ ì‚¬ìš©í•˜ëŠ” ê³„ì • IDë¥¼ ì ì–´ì£¼ë©´ ëœë‹¤.<br>
4. Remote DirectoryëŠ” í™ˆ ë””ë ‰í† ë¦¬ë¥¼ ì‚¬ìš©í–ˆë‹¤. í™ˆ ë””ë ‰í† ë¦¬ ì •ë³´ëŠ” í™ˆ ê²½ë¡œ(~)ì—ì„œ ìŠ¤í¬ë¦½íŠ¸ ëª…ë ¹ì–´ 'pwd'ë¥¼ ì…ë ¥í•˜ë©´ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
5. Test Configurationì„ í´ë¦­í•˜ì—¬ ì •ìƒì ìœ¼ë¡œ ì„¤ì •ì´ ë˜ì—ˆëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ì˜ ë˜ì—ˆë‹¤ë©´ ì™¼ìª½ í•˜ë‹¨ì— 'Success' ë¼ëŠ” ì¶œë ¥ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
6. ëª¨ë“  ì…ë ¥ì´ ëë‚œ í›„ì—ëŠ” ì €ì¥ì„ í•´ì£¼ë©´ ëœë‹¤


<!-- ## 3) Jenkinsì™€ Github Webhooksë¥¼ ì´ìš©í•˜ì—¬ ë°°í¬ ìë™í™” í•˜ê¸°
> [ì´ ê¸€](https://barbera.tistory.com/65)ì„ ì°¸ê³ í–ˆë‹¤. -->


## 5. Webhooks
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-14 á„‹á…©á„’á…® 2 35 35](https://user-images.githubusercontent.com/59405576/195770135-a701fdc8-1b92-4aa5-a7c2-6e9bdeb4eae2.png){: width="700" height="700"}<br><br>
<!-- ğŸš¨ ìƒì„±ëœ webhook secretì€ ë‹¤ì‹œëŠ” í™•ì¸í•  ìˆ˜ ì—†ìœ¼ë‹ˆ ë³µì‚¬ í›„ ì˜ ë³´ê´€í•´ë‘ì!! -->

## 6. Personal access tokens
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-14 á„‹á…©á„’á…® 2 39 39](https://user-images.githubusercontent.com/59405576/195770587-38d7acd8-0934-49f1-8dbb-f759da665a40.png)<br><br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-14 á„‹á…©á„’á…® 2 40 00](https://user-images.githubusercontent.com/59405576/195770630-652e6e5b-362d-4556-97c0-afe0a6d9d414.png)<br>
ğŸš¨ ìƒì„±ëœ secretì€ ë‹¤ì‹œëŠ” í™•ì¸í•  ìˆ˜ ì—†ìœ¼ë‹ˆ ë³µì‚¬ í›„ ì˜ ë³´ê´€í•´ë‘ì!!????

ì  í‚¨ìŠ¤ì—ì„œ ë“±ë¡ (Dashboard>Jenkins ê´€ë¦¬>Configure System)<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-14 á„‹á…©á„’á…® 2 45 02](https://user-images.githubusercontent.com/59405576/195771276-85f59680-72ac-4943-944d-f384cf37ef19.png){: width="800" height="800"}<br><br>
ì´ë•Œ, Credentials ëŠ” ì²˜ìŒì—ëŠ” ì—†ì„ê±°ê³ , Addë¥¼ ëˆŒëŸ¬ ì•„ë˜ì™€ ê°™ì´ ìƒì„±í•œë‹¤.<br>
Secretì—ëŠ” ë°©ê¸ˆ ìƒì„±í•œ webhook secretì„ ì…ë ¥í•œë‹¤.
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-14 á„‹á…©á„’á…® 2 46 06](https://user-images.githubusercontent.com/59405576/195771411-3ed4b7bc-3306-4a74-bdd2-2f37febed830.png){: width="700" height="700"}


## 7. Jenkins Job ìƒì„± (ìƒˆë¡œìš´ Item ìƒì„±)
CI / CDë¥¼ ìœ„í•œ ì¡ì„ ë§Œë“¤ì–´ë³´ì. ì  í‚¨ìŠ¤ íŒŒì¼(ì„ ì–¸ì  íŒŒì´í”„ë¼ì¸)ë¡œ ë§Œë“¤ì–´ë³¼ ê²ƒì´ë‹¤.<br>
(ë‚˜ëŠ” `job-1`ì´ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ìƒì„±í–ˆë‹¤.)<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-14 á„‹á…©á„’á…® 2 54 37](https://user-images.githubusercontent.com/59405576/195772587-9636a310-7cf5-40cb-b6e3-4638d9e43f8c.png)<br><br>
ê¹ƒí—™ì— PUSH ë˜ë©´ ìë™ìœ¼ë¡œ ì  í‚¨ìŠ¤ê°€ ì¼ì„ í•´ì•¼í•˜ë¯€ë¡œ Hookë§Œ ê±¸ì–´ë†“ì.<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-14 á„‹á…©á„’á…® 2 54 50](https://user-images.githubusercontent.com/59405576/195772615-d8314eb6-9c11-44e1-bda4-c1c6bcf947c2.png){: width="300" height="300"}<br><br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-14 á„‹á…©á„’á…® 2 54 57](https://user-images.githubusercontent.com/59405576/195772623-2b90cc61-d6fa-4fac-a825-62d48fc46def.png)<br><br>
ìŠ¤í¬ë¦½íŠ¸ëŠ” ì•„ë˜ì™€ ê°™ë‹¤. (ì¼ë‹¨ ë¼ˆëŒ€ë§Œ ë§Œë“¤ì–´ë†“ì.)
```bash
pipeline {
    agent any

    stages {
        stage('Prepare') {
            steps {
                echo '=== Prepare ==='
            }
        }
        
        stage('Build') {
            steps {
                echo '=== Build ==='
            }
        }
        
        stage('Deploy') {
            steps {
                echo '=== Deploy ==='
            }
        }
    }
}
```

### 1) git clone
> [ì´ ê¸€](https://velog.io/@zayson/Jenkins-CICD-1.-GitHub-Repository-Clone%ED%95%98%EA%B8%B0)ì„ ì°¸ê³ í–ˆë‹¤.

ì´ì œ git cloneì„ ì§„í–‰í•˜ì.<br>
Pipeline Syntaxë¥¼ í´ë¦­í•˜ì.<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-14 á„‹á…©á„’á…® 3 07 16](https://user-images.githubusercontent.com/59405576/195774359-6d37d545-8681-4b92-807e-3776704460e4.png){: width="700" height="700"}<br><br>
Sample Stepì—ì„œ `git: Git`ì„ ì„ íƒí•˜ì.<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-14 á„‹á…©á„’á…® 3 17 26](https://user-images.githubusercontent.com/59405576/195775985-f92bb966-0b51-462b-b310-071c1da9c678.png){: width="700" height="700"}<br><br>
> ğŸš¨ ì£¼ì˜!<br>
ë ˆí¬ì§€í† ë¦¬ ì£¼ì†Œ ë¶™ì—¬ë„£ì„ ì‹œ .git ì£¼ì†Œê°€ ì•„ë‹Œ, ì£¼ì†Œì°½ì—ì„œ ë ˆí¬ì§€í† ë¦¬ URL ì£¼ì†Œë¥¼ ë¶™ì—¬ë„£ëŠ”ë‹¤.

CredentialsëŠ” ê¹ƒí—ˆë¸Œ ê³„ì •ê³¼ ì—‘ì„¸ìŠ¤ í† í°ìœ¼ë¡œ ìƒˆë¡œ ìƒì„±í•´ ì‚¬ìš©í–ˆë‹¤.<br>
ì´ ë•Œ, ì—‘ì„¸ìŠ¤ í† í°ì€ ì§ì „ì— ìƒì„±í•œê²Œ ì•„ë‹ˆë¼ ì›ë˜ ì‚¬ìš©í•˜ë˜ ì—‘ì„¸ìŠ¤ í† í°ì„ ì‚¬ìš©í–ˆë‹¤.<br>
KindëŠ” Username with passwordë¡œ ì‚¬ìš©í•œë‹¤ . <br>
Usernameì€ Github ê³„ì •ëª… PasswordëŠ” Access Token ê°’ì„ ì‚¬ìš©í•œë‹¤.<br><br>
Credentialsê¹Œì§€ ëª¨ë‘ ì¶”ê°€ë˜ì—ˆë‹¤ë©´ Generate Pipeline Scriptë¥¼ ì´ìš©í•´ì„œ ìƒì„±ëœ Scriptë¥¼ ë³µì‚¬í•´ `Prepare`ì— ë¶™ì—¬ë„£ì„ ê²ƒì´ë‹¤.

### 2) Pipeline Script ì‘ì„±
`Prepare`ì—ëŠ” ë°©ê¸ˆ ë³µì‚¬í•œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë¶™ì—¬ë„£ì„ ê²ƒì´ë‹¤.<br>
`Build` ë¶€ë¶„ì—ëŠ”, ë¹Œë“œí•˜ê¸° ìœ„í•´ gradlewë¥¼ ì“¸ ê²ƒì´ê¸° ë•Œë¬¸ì— ì‰˜ ëª…ë ¹ì–´ 2ì¤„ë§Œ ì¶”ê°€í•´ì£¼ì.<br>
ê·¸ëŸ¼ ì§€ê¸ˆê¹Œì§€ ì‘ì„±í•œ íŒŒì´í”„ë¼ì¸ì€ ë‹¤ìŒê³¼ ê°™ë‹¤. (ì•„ì§ ëë‚˜ì§€ ì•Šì•˜ë‹¤!) <br>
```bash
pipeline {
    agent any

    stages {
        stage('Prepare') {
            steps {
                echo '=== Prepare ==='
                git credentialsId: 'access-token', url: 'https://github.com/minju412/docker-test'
            }
        }
        
        stage('Build') {
            steps {
                echo '=== Build ==='
                sh '''
                    chmod +x gradlew
                    ./gradlew clean build -x test
                '''
            }
        }
        
        stage('Deploy') {
            steps {
                echo '=== Deploy ==='
            }
        }
    }
}
```

ì´ë²ˆì—ëŠ” `Deploy`ë¥¼ ì±„ìš¸ ê²ƒì´ë‹¤.<br>
`job-1`ì—ì„œ Pipeline Syntaxë¥¼ í´ë¦­í•˜ì.<br><br>
Sample Stepì—ì„œ `sshPublisher: Send build artifacts over SSH`ë¥¼ ì„ íƒí•˜ì.<br>

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-14 á„‹á…©á„’á…® 2 16 47](https://user-images.githubusercontent.com/59405576/195767751-4a521ce6-ed89-40c0-bbdb-99a5ac9ea9a0.png)<br><br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-14 á„‹á…©á„’á…® 3 37 44](https://user-images.githubusercontent.com/59405576/195779152-be4506f6-f41f-44f1-99bb-d702c3571978.png)
1. ì†ŒìŠ¤íŒŒì¼ì˜ ìœ„ì¹˜, ë¹Œë“œí•œ ê²°ê³¼ëŠ” build/libs/---.jarì— ìœ„ì¹˜í•œë‹¤.
2. ì†ŒìŠ¤íŒŒì¼ì—ì„œ ì›ë³¸ íŒŒì¼ì˜ ë””ë ‰í† ë¦¬ë¥¼ ì–´ë””ê¹Œì§€ í¬í•¨í•  ê²ƒì¸ì§€ì— ëŒ€í•œ ì„¤ì • (build/libsëŠ” ì œê±°ëœë‹¤.)
3. remote directory ê¸°ì¤€ìœ¼ë¡œ ë°°í¬ë  ê²½ë¡œë¥¼ ì ëŠ”ë‹¤. (ê²°ê³¼ : /home/swanjj11/deploy)
4. ì „ì†¡ì„ ë§ˆì¹˜ê³  ì‹¤í–‰í•  Shell ëª…ë ¹ì–´ë¥¼ ì ëŠ”ë‹¤. ì´ë”° 'init.sh'ì´ë¼ëŠ” íŒŒì¼ì„ ì‹¤í–‰í•  ê²ƒì´ë‹¤.

`Generate Pipeline Script`ë¥¼ í´ë¦­í•œ ë’¤, ìƒì„±ëœ Snipetì„ 'Deploy'ì— ë³µë¶™í•˜ì.<br>
ìµœì¢… ì™„ì„±ëœ íŒŒì´í”„ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ëŠ” ì•„ë˜ì™€ ê°™ë‹¤.<br>
`Dashboard > job-1 > êµ¬ì„±`ì—ì„œ Pipeline Scriptë¥¼ ì‘ì„±í•˜ëŠ” ë¶€ë¶„ì— ì•„ë˜ ì½”ë“œë¥¼ ë¶™ì—¬ë„£ì.
```bash
pipeline {
    agent any

    stages {
        stage('Prepare') {
            steps {
                echo '=== Prepare ==='
                git credentialsId: 'access-token', url: 'https://github.com/minju412/docker-test'
            }
        }
        
        stage('Build') {
            steps {
                echo '=== Build ==='
                sh '''
                    chmod +x gradlew
                    ./gradlew clean build
                '''
            }
        }
        
        stage('Deploy') {
            steps {
                echo '=== Deploy ==='
                sshPublisher(publishers: [sshPublisherDesc(configName: 'web', transfers: [sshTransfer(cleanRemote: false, excludes: '', execCommand: 'sh init.sh', execTimeout: 120000, flatten: false, makeEmptyDirs: false, noDefaultExcludes: false, patternSeparator: '[, ]+', remoteDirectory: 'deploy/', remoteDirectorySDF: false, removePrefix: 'build/libs', sourceFiles: 'build/libs/*.jar')], usePromotionTimestamp: false, useWorkspaceInPromotion: false, verbose: true)
                ])
            } #ë§ˆì§€ë§‰ì— verboseë¥¼ trueë¡œ ì£¼ë©´ íŠ¸ëŸ¬ë¸” ìŠˆíŒ…í•˜ê¸° ìš©ì´í•˜ë‹¤
        }
    }
}
```


ì´ì œ ì  í‚¨ìŠ¤ì—ì„œ í•  ì¼ì€ ëë‚¬ë‹¤.<br><br>
ë‹¤ìŒ ê¸€ì—ì„œ ì§„í–‰í•  ë‚´ìš©ì€ ì•„ë˜ì™€ ê°™ë‹¤.
- ë°°í¬ ì„œë²„ì— ë„ì»¤íŒŒì¼ ìƒì„±
- ë°°í¬ ì„œë²„ì— init.sh ì‘ì„±
- ê¹ƒí—™ì— push í•´ë³´ê¸°
- ìë™ ë°°í¬ ëëŠ”ì§€ í™•ì¸



========================
## 8. ë¯¼ê° ì •ë³´ ì¶”ê°€í•˜ê¸°
<!-- `application.yml`ê³¼ ê°™ì€ `.gitignore`ì— ë“±ë¡ëœ íŒŒì¼ì„ ì¶”ê°€í•˜ì.<br> -->
<!-- ì  í‚¨ìŠ¤ ì„œë²„ì˜ `resources` íŒŒì¼ì„ ë§Œë“ ë‹¤. -->


> [ì´ ê¸€](https://redcoder.tistory.com/300)ì„ ì°¸ê³ í–ˆë‹¤.

### 1) í”„ë¡œì íŠ¸ `application.yml` ë³€ê²½
ë¯¼ê° ì •ë³´ë¥¼ ì œê±°í•œ ë’¤ì— ê¹ƒí—ˆë¸Œì— ì—…ë¡œë“œ í•˜ì.<br>
(ë¯¼ê° ì •ë³´ëŠ” ë”°ë¡œ ê¸°ë¡í•´ë‘ì—ˆë‹¤ê°€ ì´í›„ì— ì  í‚¨ìŠ¤ì—ì„œ string parameterë¡œ ë“±ë¡í•  ê²ƒì´ë‹¤.)
```yml
spring:
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://${MYSQL_IP}:${MYSQL_PORT}/${MYSQL_NAME}?${MYSQL_OPT}
    username: ${MYSQL_USERNAME}
    password: ${MYSQL_PASSWORD}

  jpa:
    hibernate:
      ddl-auto: update
    properties:
      hibernate:
        globally_quoted_identifiers: true
        format_sql: true
        dialect: org.hibernate.dialect.MySQL8Dialect

  cache:
    type: redis
  redis:
    host: ${REDIS_IP}
    port: ${REDIS_PORT}

  devtools:
    livereload:
      enabled: false

  mvc:
    pathmatch:
      matching-strategy: ant_path_matcher
#    log-resolved-exception: false

  # ==== í˜ì´ì§• í•  ë•Œ ê¸°ë³¸ê°’, 20ê°œì”© ì¡°íšŒ ==== #
  data:
    web:
      pageable:
        default-page-size: 20

  # ==== S3 íŒŒì¼ ì—…ë¡œë“œ ìš©ëŸ‰ ì„¤ì • ==== #
  servlet:
    multipart:
      max-file-size: 3MB #ì—…ë¡œë“œ íŒŒì¼ í¬ê¸° ì œí•œ
      max-request-size: 5MB #ì—…ë¡œë“œ íŒŒì¼ í¬ê¸° ì´ëŸ‰ ì œí•œ

# ==== JWT ==== #
jwt:
  token:
    jwt-secret-key: ${JWT_SECRET}

# === AWS S3 === #
cloud:
  aws:
    credentials:
      access-key: ${S3_ACCESS_KEY}
      secret-key: ${S3_SECRET_KEY}
    s3:
      bucket: posts-image-bucket
    region:
      static: ap-northeast-2
    stack:
      auto: false

# === Firebase === #
fcm:
  api-url: ${FIREBASE_URL}

logging.level:
  org.hibernate.SQL: debug
```


### 2) ì  í‚¨ìŠ¤ì—ì„œ String Parameter ì„ ì–¸
> [ì´ ê¸€](https://krksap.tistory.com/1807)ì„ ì°¸ê³ í–ˆë‹¤.

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-25 á„‹á…©á„Œá…¥á†« 12 54 59](https://user-images.githubusercontent.com/59405576/197570871-06e4cf4d-8b1f-4a8d-8a63-a5b46afb1217.png)<br><br>

> ì¤‘ìš”ğŸŒŸ <br>
ë§Œì•½ì— String Parameterì˜ valueì— `/` ê¸°í˜¸ê°€ í¬í•¨ë˜ì–´ ìˆë‹¤ë©´,<br>
`/` ê¸°í˜¸ ì•ì—ëŠ” escape ë¬¸ì(`\`)ë¥¼ ë„£ì–´ì£¼ì–´ì•¼ í•œë‹¤!<br><br>
ë§Œì•½ `abc/def` ë¼ëŠ” ê°’ì´ë©´ `abc\/def`ê°€ ë˜ëŠ” ê²ƒì´ê³ ,<br>
ë§Œì•½ `abc//def`ë¼ë©´ `abc\/\/def`ê°€ ë˜ëŠ” ê²ƒì´ë‹¤.


### 3) sed ìŠ¤í¬ë¦½íŠ¸ ì¶”ê°€
Build ì´ì „ì— ë„£ì–´ì¤€ë‹¤.<br>
`$` ë¬¸ì ì•ì—ëŠ” `\`ì„ ë„£ì–´ì£¼ì–´ì•¼ í•œë‹¤.
```bash
pipeline {
    agent any

    stages {
        stage('Prepare') {
            steps {
                echo '=== Prepare ==='
                git credentialsId: 'access-token', url: 'https://github.com/minju412/docker-test'
            }
        }

        stage('Set String Parameters') {
            steps {
                echo '=== Set String Parameter ==='

                echo '01. REDIS :: IP, Port Setting'
                sh '''
                    sed -i "s/\${REDIS_IP}/\${REDIS_IP}/" "\${WORKSPACE}/src/main/resources/application.yml"
                    sed -i "s/\${REDIS_PORT}/\${REDIS_PORT}/" "\${WORKSPACE}/src/main/resources/application.yml"
                '''

                echo '02. Database :: UserName, Password Setting'
                sh '''
                    sed -i "s/\${MYSQL_USERNAME}/\${MYSQL_USERNAME}/" "\${WORKSPACE}/src/main/resources/application.yml"
                    sed -i "s/\${MYSQL_PASSWORD}/\${MYSQL_PASSWORD}/" "\${WORKSPACE}/src/main/resources/application.yml"
                '''

                echo '03. Database :: IP, Port, Name, Opt Setting'
                sh '''
                    sed -i "s/\${MYSQL_IP}/\${MYSQL_IP}/" "\${WORKSPACE}/src/main/resources/application.yml"
                    sed -i "s/\${MYSQL_PORT}/\${MYSQL_PORT}/" "\${WORKSPACE}/src/main/resources/application.yml"
                    sed -i "s/\${MYSQL_NAME}/\${MYSQL_NAME}/" "\${WORKSPACE}/src/main/resources/application.yml"
                    sed -i "s/\${MYSQL_OPT}/\${MYSQL_OPT}/" "\${WORKSPACE}/src/main/resources/application.yml"
                '''

                echo '04. Jwt :: Secret Setting'
                sh '''
                    sed -i "s/\${JWT_SECRET}/\${JWT_SECRET}/" "\${WORKSPACE}/src/main/resources/application.yml"
                '''

                echo '05. AWS S3 :: Secret Setting'
                sh '''
                    sed -i "s/\${S3_ACCESS_KEY}/\${S3_ACCESS_KEY}/" "\${WORKSPACE}/src/main/resources/application.yml"
                    sed -i "s/\${S3_SECRET_KEY}/\${S3_SECRET_KEY}/" "\${WORKSPACE}/src/main/resources/application.yml"
                '''

                echo '06. Firebase :: Url Setting'
                sh '''
                    sed -i "s/\${FIREBASE_URL}/\${FIREBASE_URL}/" "\${WORKSPACE}/src/main/resources/application.yml"
                '''
            }
        }
        
        stage('Build') {
            steps {
                echo '=== Build ==='
                sh '''
                    chmod +x gradlew
                    ./gradlew clean build -x test
                '''
            }
        }
        
        stage('Deploy') {
            steps {
                echo '=== Deploy ==='
                sshPublisher(publishers: [sshPublisherDesc(configName: 'web', transfers: [sshTransfer(cleanRemote: false, excludes: '', execCommand: 'sh init.sh', execTimeout: 120000, flatten: false, makeEmptyDirs: false, noDefaultExcludes: false, patternSeparator: '[, ]+', remoteDirectory: 'deploy/', remoteDirectorySDF: false, removePrefix: 'build/libs', sourceFiles: 'build/libs/*.jar')], usePromotionTimestamp: false, useWorkspaceInPromotion: false, verbose: true)
                ])
            }
        }
    }
}
```

ì¶”ê°€í•œ ì ˆì°¨ë¥¼ í†µí•´ì„œ `application.yml`ì˜ ì •ë³´ê°€ ë°”ë€ë‹¤.<br>
`Deploy`ì—ì„œ ë§ˆì§€ë§‰ì— verboseë¥¼ trueë¡œ ì£¼ë©´ íŠ¸ëŸ¬ë¸” ìŠˆíŒ…í•˜ê¸° ìš©ì´í•˜ë‹¤

### 4) íŒŒë¼ë¯¸í„°ì™€ í•¨ê»˜ ë¹Œë“œ
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-25 á„‹á…©á„Œá…¥á†« 1 27 48](https://user-images.githubusercontent.com/59405576/197590430-45a6d00a-6d3b-4aa4-b261-45543e00774d.png)







> ì°¸ê³ <br>
ì´ ë°©ë²• ë§ê³  ì¡°ê¸ˆ ë” íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•˜ê¸° ìœ„í•´ì„œ Spring Cloud Config Serverë¥¼ ì´ìš©í•  ìˆ˜ë„ ìˆëŠ”ë°,<br>
ê¶ê¸ˆí•˜ë‹¤ë©´ [ì´ ê¸€](https://devbksheen.tistory.com/entry/Jenkins-Docker-Spring-Cloud-Config-%EC%A0%81%EC%9A%A9%EA%B8%B0)ì„ ì°¸ê³ í•˜ì.











***
<br>


    ğŸ’› ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ğŸ‘»

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}