---
title:  "[GCP] spring boot + jenkins + docker ë°°í¬í•˜ê¸° - 2. ë°°í¬ ì„œë²„ "

categories:
  - GCP
tags:
  - [GCP]

toc: true
toc_sticky: true
 
date: 2022-10-14 14:20:24
last_modified_at: 2022-10-14 14:20:27
---

ì´ì „ ê¸€ì— ì  í‚¨ìŠ¤ ì„œë²„ ì„¤ì •ì„ ë§ˆì³¤ë‹¤.<br>
ì´ì œ ë°°í¬ ì„œë²„ ì„¤ì •ì„ í•´ë³´ì.

# ê¸°ë³¸ ì„¤ì •
ë°°í¬ ì¸ìŠ¤í„´ìŠ¤ì— ssh ì ‘ì†í•œë‹¤.

## jdk ì„¤ì¹˜ ë° JAVA_HOME ì„¤ì •
```bash
# ì„¤ì¹˜í•  ìˆ˜ ìˆëŠ” ë²„ì „ í™•ì¸
$ yum list java*jdk-devel

# ì„¤ì¹˜
$ sudo yum install java-11-openjdk-devel.x86_64

# ê¸°ë³¸ ìë°” ì„ íƒ
$ sudo update-alternatives --config java
```
ì´ì œ JAVA_HOMEì„ ì„¤ì •í•˜ì.
```bash
$ update-alternatives --list java
# ì¶œë ¥: /usr/lib/jvm/java-11-openjdk-11.0.16.1.1-1.el7_9.x86_64/bin/java

$ sudo vi /etc/profile
# ë§¨ í•˜ë‹¨ì— ì•„ë˜ ëª…ë ¹ì–´ ì¶”ê°€
export JAVA_HOME=/usr/lib/jvm/java-11-openjdk-11.0.16.1.1-1.el7_9.x86_64 PATH=$PATH:$JAVA_HOME/bin export PATH

# ë³€ê²½ì‚¬í•­ ì ìš©
$ source /etc/profile

$ echo $JAVA_HOME
```



```bash
$ update-alternatives --list java
# ì¶œë ¥: /usr/lib/jvm/java-11-openjdk-amd64/bin/java

$ sudo vi /etc/environment
# ì¶”ê°€: JAVA_HOME="/usr/lib/jvm/java-11-openjdk-amd64"

# ë³€ê²½ ì‚¬í•­ ì ìš©
$ source /etc/environment

# ë³€ê²½ í™•ì¸
$ echo $JAVA_HOME
```


## docker ì„¤ì¹˜
> [ì´ ê¸€](https://1mini2.tistory.com/21)ì„ ì°¸ê³ í–ˆìœ¼ë©°, [ê³µì‹ ì‚¬ì´íŠ¸](https://docs.docker.com/engine/install/centos/)ë¥¼ ì°¸ê³ í•´ë„ ëœë‹¤.

```bash
# yum-utils ì—…ë°ì´íŠ¸
$ sudo yum install -y yum-utils

# Docker-ce ì €ì¥ì†Œ ì¶”ê°€
$ sudo yum-config-manager \
--add-repo \
https://download.docker.com/linux/centos/docker-ce.repo

# ë„ì»¤ ì—”ì§„ ì„¤ì¹˜
$ sudo yum install docker-ce docker-ce-cli containerd.io docker-compose-plugin

# ë„ì»¤ ì—”ì§„ ì‹¤í–‰ ë° ì„œë¹„ìŠ¤ ë“±ë¡
$ sudo systemctl start docker
$ sudo systemctl enable docker
$ sudo systemctl status docker
```
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-14 á„‹á…©á„’á…® 6 09 55](https://user-images.githubusercontent.com/59405576/195809140-32632601-3227-425c-9208-48ad8dcd7029.png)

# ë³¸ê²©ì ì¸ ì‹œì‘
## 1. ë°°í¬ ì„œë²„ì— Dockerfile ìƒì„±
```bash
$ vi Dockerfile
```

```Dockerfile
FROM openjdk:11
WORKDIR /var/deploy
EXPOSE 8080
CMD ["nohup", "java", "-jar", "server-0.0.1-SNAPSHOT.jar", ">", "app.log", "&"]
```
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-24 á„‹á…©á„’á…® 9 26 00](https://user-images.githubusercontent.com/59405576/197525119-30acdb38-1f1e-4ee5-967d-5f0da1cbf925.png)<br><br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-24 á„‹á…©á„’á…® 9 26 41](https://user-images.githubusercontent.com/59405576/197525242-b22b98f7-0f6c-4b31-ab8b-0dbe35d9bdbc.png)<br><br>
openjdk11 ì´ë¯¸ì§€ë¥¼ ê¸°ë°˜ìœ¼ë¡œ<br>
`/var/deploy` ë””ë ‰í† ë¦¬ì—ì„œ ì‘ì—…í•  ê²ƒì´ê³ <br>
8080í¬íŠ¸ë¥¼ ë…¸ì¶œí•œë‹¤.<br>
`.jar` íŒŒì¼ì„ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‹¤í–‰í•  ê²ƒì´ë‹¤.<br><br>
Dockerfileì„ ì‘ì„±í–ˆìœ¼ë©´, ì´ì œ ì´ë¯¸ì§€ë¡œ ë§Œë“¤ì–´ì£¼ì.
```bash
$ sudo docker build -t naem-server .
```
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-24 á„‹á…©á„’á…® 9 28 58](https://user-images.githubusercontent.com/59405576/197525678-79756836-40f3-4a46-be53-0e42111feec0.png)<br>
ìœ„ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ë©´ naem-server ë¼ëŠ” ì´ë¦„ì˜ ì´ë¯¸ì§€ê°€ ìƒê¸´ë‹¤.



## 2. ë°°í¬ ì„œë²„(= ì›Œì»¤ ì¸ìŠ¤í„´ìŠ¤)ì— init.sh ì‘ì„±
> [ì´ ê¸€](https://dev-gorany.tistory.com/345)ì„ ì°¸ê³ í–ˆë‹¤.

init.shëŠ” ì  í‚¨ìŠ¤ê°€ ë°°í¬ ì„œë²„ì— ì ‘ì†í•´ì„œ ì‹¤í–‰í•  ì‰˜ ëª…ë ¹ì–´ì˜ ì§‘í•©ì´ë¼ê³  ìƒê°í•˜ë©´ ëœë‹¤. ë„ì»¤ ì»¨í…Œì´ë„ˆë¥¼ ì œê±°í•˜ê³ , ë‹¤ì‹œ ìƒì„±í•˜ëŠ” ê²ƒì„ ì ì–´ë‘˜ ê²ƒì´ë‹¤.
```bash
$ vi init.sh
```

```
sudo docker rm -f naem-container
sudo docker run --name naem-container \
        -p 8080:8080 \
        -d \
        -v /home/ln8847/deploy:/var/deploy \
        naem-server
```

ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì¶”ê°€í•´ ì•„ë˜ë¡œë„ í•´ë´¤ë‹¤.
```bash
sudo docker rm -f naem-container
docker run --platform linux/x86_64 -d -p 8080:8080 --network naem-network \
        -e "spring.datasource.url=jdbc:mysql://mysql:3306/naem?serverTimezone=Asia/Seoul&characterEncoding=UTF-8&useSSL=false&allowPublicKeyRetrieval=true" \
        -e "spring.redis.host=redis" \
        -v /home/ln8847/deploy:/var/deploy \
        --name naem-container \
        naem-server
```


![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-24 á„‹á…©á„’á…® 9 31 54](https://user-images.githubusercontent.com/59405576/197526113-862ca8ce-61fa-420a-a8e7-a2ad520df0b0.png)<br><br>
`-v í˜¸ìŠ¤íŠ¸:ì»¨í…Œì´ë„ˆ`<br>
í˜¸ìŠ¤íŠ¸ì˜ `/home/ln8847/deploy` ë””ë ‰í† ë¦¬ì™€<br>
ì»¨í…Œì´ë„ˆì˜ `/var/deploy` íŒŒì¼ ì‹œìŠ¤í…œì„ ê³µìœ í•œë‹¤.<br><br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-24 á„‹á…©á„’á…® 9 33 20](https://user-images.githubusercontent.com/59405576/197526370-025c7d2e-b7e9-4536-8682-df4f4be5ef66.png)<br>
ì´ì œ ëª¨ë“  ì¤€ë¹„ë¥¼ ë§ˆì³¤ë‹¤. ì½”ë“œë¥¼ ì‘ì„±í•´ì„œ ê¹ƒí—™ì— í‘¸ì‹œ ë‚ ë ¤ë³´ì.

# ì œí‚¨ìŠ¤ ì„œë²„
ìš°ì„  ì  í‚¨ìŠ¤ ì„œë²„ë¥¼ ê¸°ë™í•˜ì.<br>
ê·¸ë¦¬ê³  ì•„ë˜ ì»¤ë§¨ë“œë¡œ ìƒíƒœë¥¼ í™•ì¸í•´ë³´ì.
```bash
$ sudo service jenkins status
```
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-24 á„‹á…©á„’á…® 9 41 28](https://user-images.githubusercontent.com/59405576/197527793-2e2a0679-6fed-407f-9931-6cda352e08f4.png)













====================

> [ì´ ê¸€](https://web-atoz.github.io/development%20environment/docker/2020/02/16/jenkins-setting(3).html)ì„ ì°¸ê³ í–ˆë‹¤.


shell script ëª…ë ¹ì–´
```
docker login -u  -p 
docker build --build-arg JAR_FILE=build/libs/*.jar -t smkim08/springboot-docker-test .
docker tag smkim08/springboot-docker-test {ì´ë¯¸ì§€ë¥¼ ê°€ì ¸ì˜¬ ë„ì»¤í—ˆë¸Œ}
docker push {ì´ë¯¸ì§€ë¥¼ ê°€ì ¸ì˜¬ ë„ì»¤í—ˆë¸Œ}
```

Docker pull, Container Delete, Docker run
```
docker pull webatoz/spring-docker:latest
docker stop test-springboot
docker rm -f test-springboot
docker run --name test-springboot -itd -p 80:80 {ì´ë¯¸ì§€ë¥¼ ê°€ì ¸ì˜¬ ë„ì»¤í—ˆë¸Œ}
```


















## 3. Githubì— PUSH


## 4. ìë™ ë°°í¬ ëëŠ”ì§€ í™•ì¸






==========================

> [ì´ ê¸€](https://velog.io/@znftm97/Jenkins%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%B4%EC%84%9C-%EB%B0%B0%ED%8F%AC%ED%95%98%EA%B8%B0)ì„ ì°¸ê³ í–ˆë‹¤.

```bash
$ chmod 700 ~/.ssh
$ chmod 600 ~/.ssh/authorized_keys
```







***
<br>


    ğŸ’› ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ğŸ‘»

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}