---
title:  "[GCP] spring boot + jenkins + docker 배포하기 - 2. 배포 서버 "

categories:
  - GCP
tags:
  - [GCP]

toc: true
toc_sticky: true
 
date: 2022-10-14 14:20:24
last_modified_at: 2022-10-14 14:20:27
---

> [이 글](https://velog.io/@znftm97/Jenkins%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%B4%EC%84%9C-%EB%B0%B0%ED%8F%AC%ED%95%98%EA%B8%B0)을 참고했다.

```bash
$ chmod 700 ~/.ssh
$ chmod 600 ~/.ssh/authorized_keys
```









==========================

GCP 프로젝트 생성부터 jenkins 설치까지는 [이전 글](https://minju412.github.io/gcp/1/)에서 다뤘다.<br><br>
우선, 이전에 만든 `jenkins` 인스턴스에서 [유사하게 만들기]로 `web` 인스턴스를 생성하자.<br>
생성 후에는 외부 고정 IP도 할당하자.<br>
(기존에 있던 `instance-1`은 ubuntu 였으므로 일단 중지해놓자.)<br><br>
![스크린샷 2022-10-13 오후 9 31 17](https://user-images.githubusercontent.com/59405576/195596730-9ca43c1c-7011-4a6c-ba3c-9ffae5f58acd.png)<br>
현재 실행 중인 인스턴스는 아래와 같다.
- `jenkins`: 젠킨스 서버, Centos7
- `web`: 배포 서버, Centos7

젠킨스 서버에서는 Docker를 사용하지 않고,<br>
배포 서버에서는 Docker를 사용할 것이다.

<br>

# 시나리오
> [이 글](https://dev-gorany.tistory.com/345)을 참고했다.

![스크린샷 2022-10-13 오후 9 32 22](https://user-images.githubusercontent.com/59405576/195596855-1d9b623e-495e-4c70-89e8-50a569de2b20.png){: width="500" height="500"}
1. 코드를 작성한다.
2. 깃헙에 Push한다.
3. Webhook이 걸려 젠킨스에게 Job을 실행하라고 한다.
4. 젠킨스가 Build해준 결과를 배포 서버에 넘긴다.
5. 배포 서버에서 컨테이너를 실행해 자동 배포한다.


# 배포 서버 (`web`)
## 1) Docker 설치
> [이 글](https://1mini2.tistory.com/21)을 참고했으며, [공식 사이트](https://docs.docker.com/engine/install/centos/)를 참고해도 된다.

```bash
# yum-utils 업데이트
$ sudo yum install -y yum-utils

# Docker-ce 저장소 추가
$ sudo yum-config-manager \
--add-repo \
https://download.docker.com/linux/centos/docker-ce.repo

# 도커 엔진 설치
$ sudo yum install docker-ce docker-ce-cli containerd.io docker-compose-plugin

# 도커 엔진 실행 및 서비스 등록
$ systemctl start docker
$ systemctl enable docker
$ systemctl status docker
```



## 2) Dockerfile 생성



## 3) `init.sh` 작성


## 4) Github에 Push


## 5) 자동 배포 되었는지 확인









# 2. 배포 서버에 도커 설치













==========================

# `web`
## 인스턴스에 도커 설치하기
> [이 글](https://wings2pc.tistory.com/entry/%EB%8F%84%EC%BB%A4Docker-%EB%A6%AC%EB%88%85%EC%8A%A4linux%EC%97%90-%EB%8F%84%EC%BB%A4-%EC%84%A4%EC%B9%98%ED%81%B4%EB%9D%BC%EC%9A%B0%EB%93%9C-%ED%99%9C%EC%9A%A9)을 참고했다.


[](https://blog.dalso.org/google-cloud-platform-2/nas-project/8618)


```bash
$ sudo apt-get update

# 필수 패키지 설치
$ sudo apt-get install apt-transport-https ca-certificates curl gnupg-agent software-properties-common

# GCP Key 인증
$ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -

# finger pring 확인
$ sudo apt-key fingerprint 0EBFCD88

# docker repository emdfhr
$ sudo add-apt-repository \
"deb [arch=amd64] https://download.docker.com/linux/ubuntu \
$(lsb_release -cs) \
stable"

# docker 설치
$ sudo apt-get update && sudo apt-get install docker-ce docker-ce-cli containerd.io

$ docker -v

$ sudo systemctl enable docker && service docker start

# 권한 부여
$ sudo usermod -aG docker $USER
```




## spring boot 배포하기
> [이 글](https://wings2pc.tistory.com/entry/%EB%8F%84%EC%BB%A4Docker-Dockerfile%EC%9D%84-%ED%99%9C%EC%9A%A9%ED%95%98%EC%97%AC-springboot-app-%EB%B0%B0%ED%8F%AC-%EB%B0%8F-GCP-%EB%B0%A9%ED%99%94%EB%B2%BD-%EC%84%A4%EC%A0%95)을 참고했다.














# Ref.





***
<br>


    💛 개인 공부 기록용 블로그입니다. 👻

[맨 위로 이동하기](#){: .btn .btn--primary }{: .align-right}