---
title:  "[E-commerce App] FeignClient - ErrorDecoderë¥¼ ì´ìš©í•œ ì˜ˆì™¸ ì²˜ë¦¬ "

categories:
  - SpringCloud
tags:
  - [SpringCloud]

toc: true
toc_sticky: true
 
date: 2022-10-08 19:11:02
last_modified_at: 2022-10-08 19:11:05
---

ì´ë²ˆì—ëŠ” ErrorDecoderë¥¼ ì´ìš©í•œ ì˜ˆì™¸ ì²˜ë¦¬ë¥¼ í•´ë³´ì.
# `user-service`
## `FeignErrorDecoder.java`
```java
public class FeignErrorDecoder implements ErrorDecoder {

    @Override
    public Exception decode(String methodKey, Response response) {
        switch (response.status()) {
            case 400:
                break;
            case 404:
                if(methodKey.contains("getOrders")) {
                    return new ResponseStatusException(HttpStatus.valueOf(response.status()),
                        env.getProperty("order-service.exception.order-is-empty"));
                }
                break;
            default:
                return new Exception(response.reason());
        }
        return null;
    }
}
```

## `UserServiceImpl.java`
`UserServiceImpl`ì—ì„œëŠ” try-catch ë¬¸ì„ ì œê±°í•œë‹¤.
```java
@Service
@Slf4j
public class UserServiceImpl implements UserService {
    ...
    @Override
    public UserDto getUserByUserId(String userId) {

        UserEntity userEntity = userRepository.findByUserId(userId);
        UserDto userDto = new ModelMapper().map(userEntity, UserDto.class);

        // ì£¼ë¬¸ ìƒì„±
        /* Using Feign ErrorDecoder */
        List<ResponseOrder> orderList = orderServiceClient.getOrders(userId);

        userDto.setOrders(orderList);

        return userDto;
    }
}
```

## `native-file-repo/user-service.yml`
`order-service.exception.order-is-empty`ì— 404 ì—ëŸ¬ê°€ ë°œìƒí–ˆì„ ë•Œ ë³´ì—¬ì§ˆ ë¬¸êµ¬ë¥¼ ì •ì˜í•œë‹¤.
```yml
...
order-service:
  url: http://ORDER-SERVICE/order-service/%s/orders
  exception:
    order-is-empty: User's order is empty.
```

# í…ŒìŠ¤íŠ¸
`user-service`ì—ì„œ break pointë¥¼ ì°ê³  ë””ë²„ê¹…ëª¨ë“œë¡œ ì‹¤í–‰í•œë‹¤.<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-08 á„‹á…©á„’á…® 9 28 11](https://user-images.githubusercontent.com/59405576/194707626-e4ab9bdc-5546-4fdc-814c-ed52cde572c0.png)<br>
ìœ„ì™€ ê°™ì´ ì„¤ì • íŒŒì¼ì—ì„œ ì •ë³´ë¥¼ ì˜ ì½ì–´ì™”ìŒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.<br><br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-08 á„‹á…©á„’á…® 9 25 11](https://user-images.githubusercontent.com/59405576/194707546-4fd4ced6-d1cd-4fc5-898d-e34f9702c193.png)<br>
í¬ìŠ¤íŠ¸ë§¨ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ í–ˆì„ ë•Œ, 404 ì—ëŸ¬ê°€ ë°œìƒí•˜ê³  ì—ëŸ¬ ë©”ì‹œì§€ê°€ ì˜ ì¶œë ¥ëœë‹¤.





***
<br>


    ğŸ’› ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ğŸ‘»

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}