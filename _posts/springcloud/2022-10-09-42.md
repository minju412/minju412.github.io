---
title:  "[E-commerce App] Kafka Sink Connect ì‚¬ìš© "

categories:
  - SpringCloud
tags:
  - [SpringCloud]

toc: true
toc_sticky: true
 
date: 2022-10-09 21:47:36
last_modified_at: 2022-10-09 21:47:39
---
ì´ì „ ê¸€ì—ì„œ source connectì—ì„œ topicì— ë°ì´í„°ë¥¼ ì „ë‹¬í•˜ë©´, topicì— í•´ë‹¹ ë°ì´í„°ê°€ ìŒ“ì´ëŠ” ê²ƒê¹Œì§€ í™•ì¸í–ˆë‹¤.<br>
sink connectê°€ í•˜ëŠ” ì—­í• ì€, topicì— ì „ë‹¬ëœ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ì„œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ë‹¤.<br>
(`Kafka-console-producer`ì—ì„œ ë°ì´í„° ì „ì†¡ -> Topicì— ì¶”ê°€ -> MariaDBì— ì¶”ê°€)

# Kafka Sink Connect ë“±ë¡
Sink Connectë¥¼ ì¶”ê°€í•˜ëŠ” ë°©ë²•ì€ Source Connectë¥¼ ì¶”ê°€í•˜ëŠ” ë°©ë²•ê³¼ ìœ ì‚¬í•˜ë‹¤.<br>
ì´ì „ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ í¬ìŠ¤íŠ¸ë§¨ì„ ì´ìš©í•´ MariaDB ê´€ë ¨ë˜ì–´ìˆëŠ” Sinkë¥¼ ë“±ë¡í•´ë³´ë„ë¡ í•˜ì.<br><br>
í¬ìŠ¤íŠ¸ë§¨ì„ ì¼œì„œ ì•„ë˜ ë°ì´í„°ë¥¼ bodyì— ë‹´ì•„ `http://localhost:8083/connectors`ì— ìš”ì²­í•´ë³´ì.<br>

> ğŸŒŸ ì£¼ì˜<br>
ê·¸ ì „ì— zookeeper ì„œë²„ & kafka ì„œë²„ & Kafka Connectê°€ ê¸°ë™ë˜ê³  ìˆì–´ì•¼ í•œë‹¤!

```bash
# í˜„ì¬ ìœ„ì¹˜: /Users/minju/study/msa/kafka-demo/kafka_2.13-2.7.0
# zookeeper ì‹¤í–‰ 
$ ./bin/zookeeper-server-start.sh ./config/zookeeper.properties

# í˜„ì¬ ìœ„ì¹˜: /Users/minju/study/msa/kafka-demo/kafka_2.13-2.7.0
# kafka ì‹¤í–‰ 
$ ./bin/kafka-server-start.sh ./config/server.properties

# í˜„ì¬ ìœ„ì¹˜: /Users/minju/study/msa/kafka-demo/confluent-6.1.0
# Kafka Connect ì‹¤í–‰ 
$ ./bin/connect-distributed ./etc/kafka/connect-distributed.properties
```

<br>

ğŸš¨ ì•„ë˜ì—ì„œ `connection.user`ì™€ `connection.password`ëŠ” ë³¸ì¸ì˜ mysql ì„¤ì •ì— ë§ê²Œ ë³€ê²½í•´ì£¼ì–´ì•¼ í•œë‹¤!
```json
{
  "name":"my-sink-connect",
  "config":{
  "connector.class":"io.confluent.connect.jdbc.JdbcSinkConnector",
  "connection.url":"jdbc:mysql://localhost:3306/mydb",
  "connection.user":"admin",
  "connection.password":"***",
  "auto.create":"true",
  "auto.evolve":"true",
  "delete.enabled":"false",
  "tasks.max":"1",
  "topics":"my_topic_users"
  }
}
```
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-09 á„‹á…©á„’á…® 11 08 01](https://user-images.githubusercontent.com/59405576/194761448-fd136e0f-49c9-4308-a0d7-9778c972bd80.png)<br>

> ì°¸ê³ <br>
í¬ìŠ¤íŠ¸ë§¨ì´ ì•„ë‹Œ, í„°ë¯¸ë„ì—ì„œëŠ” ì•„ë˜ ì»¤ë§¨ë“œë¥¼ ì‹¤í–‰í•˜ë©´ ëœë‹¤.
```bash
echo '
{
  "name":"my-sink-connect",
  "config":{
  "connector.class":"io.confluent.connect.jdbc.JdbcSinkConnector",
  "connection.url":"jdbc:mysql://localhost:3306/mydb",
  "connection.user":"admin",
  "connection.password":"***",
  "auto.create":"true",
  "auto.evolve":"true",
  "delete.enabled":"false",
  "tasks.max":"1",
  "topics":"my_topic_users"
  }
}
'| curl -X POST -d @- http://localhost:8083/connectors --header "content-Type:application/json"
```

# í…ŒìŠ¤íŠ¸
## connector í™•ì¸
í¬ìŠ¤íŠ¸ë§¨ì„ ì´ìš©í•´ í˜„ì¬ ë“±ë¡ë˜ì–´ì§„ connectorë¥¼ í™•ì¸í•´ë³´ì.<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-09 á„‹á…©á„’á…® 11 10 23](https://user-images.githubusercontent.com/59405576/194761518-b1e3a0b2-5b6b-48f5-9b4f-22e3200f96d1.png)<br>
íŠ¹ì • connectorì— ëŒ€í•œ ìƒì„¸ì •ë³´ë¥¼ ë³´ê³  ì‹¶ë‹¤ë©´, ì•„ë˜ì™€ ê°™ì´ ìš”ì²­í•˜ì.<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-09 á„‹á…©á„’á…® 11 11 10](https://user-images.githubusercontent.com/59405576/194761571-46cb9859-1ef5-4626-ad29-54917d1b08c6.png)

## sink connect í…Œì´ë¸” í™•ì¸
ì •ìƒì ìœ¼ë¡œ sink connectorê°€ ë§Œë“¤ì–´ì¡Œë‹¤ëŠ” ê²ƒì€, ë°ì´í„°ë² ì´ìŠ¤ì— í† í”½ì˜ ì´ë¦„ê³¼ ê°™ì€ í˜•íƒœì˜ í…Œì´ë¸”ì´ ìƒì„±ë˜ì—ˆë‹¤ëŠ” ê²ƒì´ë‹¤.<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-09 á„‹á…©á„’á…® 11 13 21](https://user-images.githubusercontent.com/59405576/194761651-e51b34dc-b165-46d6-b4a3-f7122c3c529f.png)<br><br>
ê·¸ë ‡ë‹¤ë©´, ê¸°ì¡´ì˜ `users` í…Œì´ë¸”ê³¼ ìƒˆë¡œ ìƒê¸´ `my_topic_users` í…Œì´ë¸”ì˜ ë°ì´í„°ë¥¼ ë¹„êµí•´ë³´ì.<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-09 á„‹á…©á„’á…® 11 14 26](https://user-images.githubusercontent.com/59405576/194761686-6a59c40f-cecd-4e63-b182-8934c72db8ff.png)<br>
ë‘ í…Œì´ë¸”ì— ë“¤ì–´ìˆëŠ” ë°ì´í„°ê°€ ê°™ìŒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.<br><br>
ì´ë²ˆì—ëŠ”, `users` í…Œì´ë¸”ì— ìƒˆë¡œìš´ ë°ì´í„°ë¥¼ insert í•œ ë’¤ì— `my_topic_users` í…Œì´ë¸”ì„ í™•ì¸í•´ë³´ì.<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-09 á„‹á…©á„’á…® 11 16 38](https://user-images.githubusercontent.com/59405576/194761856-6e8a3978-7384-4b55-9456-dabea0e19780.png)<br>
`users` í…Œì´ë¸”ì—ëŠ” ë‹¹ì—°íˆ ê°’ì´ ì¶”ê°€ë˜ì—ˆê² ì§€ë§Œ, `my_topic_users` í…Œì´ë¸”ì—ë„ ì¶”ê°€ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.<br><br>
ë”°ë¼ì„œ Kafka Connectë¥¼ ì´ìš©í•˜ë©´, source connectë¥¼ í†µí•´ ì „ë‹¬ëœ ë°ì´í„°ê°€ sink connectì™€ ì—°ê²°ëœ í…Œì´ë¸”ì—ê¹Œì§€ ì´ì–´ì§„ë‹¤ëŠ” ê²ƒì„ í™•ì¸í–ˆë‹¤.<br>
ì§€ê¸ˆê¹Œì§€ëŠ”, ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ insert ì¿¼ë¦¬ë¥¼ ì´ìš©í•´ topicì— ë°ì´í„°ë¥¼ ì¶”ê°€í•˜ê³ , ê·¸ topicì— ì¶”ê°€ëœ ë°ì´í„°ê°€ sink connect í…Œì´ë¸”(=`my_topic_users`)ì—ê¹Œì§€ ë“¤ì–´ì˜¤ëŠ” ê²ƒì„ í™•ì¸í•´ë³´ì•˜ë‹¤.<br>
ì´ì œë¶€í„° ã…‡ã…‡ã…‡


# Kafka console producer ì‹¤í–‰
```
$ ./bin/kafka-console-producer.sh --broker-list localhost:9092 --topic my_topic_users
```

ìš°ë¦¬ëŠ” í† í”½ì— ì €ì¥ëœ ë°ì´í„°ê°€ sink connectì—ë„ ê°™ì´ ì €ì¥ë˜ê¸°ë¥¼ ì›í•˜ëŠ” ê²ƒì´ë‹¤.<br>
ê·¸ëŸ¬ê¸° ìœ„í•´ì„œëŠ” sink connectê°€ ì•Œ ìˆ˜ ìˆëŠ” JDBC ë°ì´í„° í¬ë§·ìœ¼ë¡œ ë°ì´í„°ë¥¼ ë³´ë‚´ì•¼ í•œë‹¤.<br>
í•´ë‹¹ í¬ë§·ì€ Kafka console consumerì—ì„œ í™•ì¸í•  ìˆ˜ ìˆëŠ” ë°ì´í„° í¬ë§·ì´ë‹¤.<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-09 á„‹á…©á„’á…® 11 26 32](https://user-images.githubusercontent.com/59405576/194762259-f33cec0a-d2ae-40a0-ab4e-439d0e209c8c.png)<br><br>
ì´ë¥¼ ì•„ë˜ì™€ ê°™ì´ ë³€í˜•í•´ë³´ì.<br>
```json
{"schema":{"type":"struct","fields":[{"type":"int32","optional":false,"field":"id"},{"type":"string","optional":true,"field":"user_id"},{"type":"string","optional":true,"field":"pwd"},{"type":"string","optional":true,"field":"name"},{"type":"int64","optional":true,"name":"org.apache.kafka.connect.data.Timestamp","version":1,"field":"created_at"}],"optional":false,"name":"users"},"payload":{"id":7,"user_id":"my_id","pwd":"my_password","name":"Ann","created_at":1665400364000}}
```
`Kafka console producer`<br>
ë§ˆì§€ë§‰ì— ìˆëŠ” `payload` ê°’ë§Œ ì›í•˜ëŠ” ê°’ìœ¼ë¡œ ë³€ê²½í•´ producerì— ì „ë‹¬í•´ë³´ì.<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-09 á„‹á…©á„’á…® 11 33 29](https://user-images.githubusercontent.com/59405576/194762675-b757dffb-8db4-44cd-a260-ac2f6c75b877.png)<br><br>
`Kafka console consumer`<br>
ê·¸ëŸ¼ í•´ë‹¹ ê°’ì´ topicì— ì „ë‹¬ë˜ì–´ consumerê°€ ë°›ì•„ì˜¤ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-09 á„‹á…©á„’á…® 11 35 55](https://user-images.githubusercontent.com/59405576/194762737-f4f02439-fa79-4392-9270-c0edf1782555.png)<br><br>
ê·¸ë ‡ë‹¤ë©´ ì´ ë°ì´í„°ê°€ ë°ì´í„°ë² ì´ìŠ¤ì—ë„ ì¶”ê°€ë˜ì—ˆì„ê¹Œ?<br>
`users` ë°ì´í„°ë² ì´ìŠ¤ë¥¼ í™•ì¸í•´ë³´ì.<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-09 á„‹á…©á„’á…® 11 59 33](https://user-images.githubusercontent.com/59405576/194763995-68814be6-1195-4392-97cb-713084eecb91.png)<br>
ë‹¹ì—°íˆ `users`ì—ëŠ” ì¶”ê°€ë˜ì§€ ì•Šì•˜ë‹¤.<br>
ì™œëƒí•˜ë©´ `users`ëŠ” í† í”½ìœ¼ë¡œë¶€í„° ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ”ê²Œ ì•„ë‹ˆë¼, ìì‹ ì´ ê°€ì§€ê³  ìˆëŠ” ë°ì´í„°ë¥¼ í† í”½ìœ¼ë¡œ ë°€ì–´ë„£ëŠ” ê°œë…ì´ê¸° ë•Œë¬¸ì´ë‹¤.<br><br>
ì´ì œ `my_topic_users` ë°ì´í„°ë² ì´ìŠ¤ë¥¼ í™•ì¸í•´ë³´ì.<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-10 á„‹á…©á„Œá…¥á†« 12 01 50](https://user-images.githubusercontent.com/59405576/194764103-67c11410-4012-4f73-89c2-517b98bf268d.png)<br>
`my_topic_users`ì—ëŠ” producerì— ì „ë‹¬í•œ ë°ì´í„°ê°€ ì¶”ê°€ë˜ì—ˆë‹¤. <br>
ì™œëƒí•˜ë©´ `my_topic_users` sink connectì™€ ì—°ê²°ë˜ì–´ìˆì–´, í† í”½ìœ¼ë¡œë¶€í„° ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ë‹¤.<br><br>
ì´ë ‡ê²Œ sink connectë§Œ ê°€ì§€ê³ ë„, í† í”½ì— ì—…ë°ì´íŠ¸ê°€ ë°œìƒí•  ë•Œ ë³€ê²½ëœ ê°’ì„ íƒ€ê²Ÿ ì†ŒìŠ¤(ë°ì´í„°ë² ì´ìŠ¤ í˜¹ì€ ìŠ¤í† ë¦¬ì§€)ì— ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.






***
<br>


    ğŸ’› ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ğŸ‘»

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}