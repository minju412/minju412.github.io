---
title:  "[E-commerce App] μ„¤μ • μ •λ³΄μ μ•”νΈν™” μ²λ¦¬ "

categories:
  - SpringCloud
tags:
  - [SpringCloud]

toc: true
toc_sticky: true
 
date: 2022-10-06 09:35:46
last_modified_at: 2022-10-06 09:35:50
---

<br>
`application.yml` νΉμ€ `bootstrap.yml`μ— μλ” plain text κ°’λ“¤μ„ μ•”νΈν™”μ²λ¦¬ν•λ” λ°©λ²•μ— λ€ν•΄ μ•μ•„λ³΄μ.

# κ°μ”
## λ€μΉ­ν‚¤ (Shared)
- μ•”/λ³µνΈν™” μ‹μ— κ°™μ€ ν‚¤λ¥Ό μ‚¬μ©ν•λ‹¤.

## λΉ„λ€μΉ­ν‚¤ (RSA Keypair)
- μ•”νΈν™” ν•  λ• μ‚¬μ©λλ” ν‚¤μ™€ λ³µνΈν™” ν•  λ• μ‚¬μ©λλ” ν‚¤κ°€ λ‹¤λ¥΄λ‹¤.
- κ³µκ°ν‚¤μ™€ μ‚¬μ„¤ν‚¤λ¥Ό μ‚¬μ©ν•λ‹¤.
- ν‚¤ κ°’μ„ μƒμ„±ν•κΈ° μ„ν•΄ Java keytoolμ„ μ‚¬μ©ν•λ‹¤.

## νλ¦„
![α„‰α…³α„α…³α„…α…µα†«α„‰α…£α†Ί 2022-10-06 α„‹α…©α„α…¥α†« 9 44 10](https://user-images.githubusercontent.com/59405576/194188883-2cde97ae-d121-4eeb-9808-7f46f40afd43.png){: width="500" height="500"}<br>
λ―Όκ°ν• ν™κ²½ λ³€μκ°€ λ‹΄κΈ΄ `application.yml` νμΌμ„ κ·Έλ€λ΅ git repositoryμ— μ¬λ¦¬κ²λλ©΄, λ³΄μ•μ μΈ μ΄μκ°€ λ°μƒν•  μ μμΌλ―€λ΅ μ•”νΈν™”λ¥Ό μ§„ν–‰ν•  κ²ƒμ΄λ‹¤.<br><br>
μ΄ λ• ν…μ¤νΈκ°€ μ•”νΈν™” λμ–΄μλ‹¤λ” ν‘μ‹λ΅, ν…μ¤νΈ μ•μ— `{cipher}`λ¥Ό λ¶™μΈλ‹¤.<br>
μ•”νΈν™” λ κ°’μ΄ Spring Cloud Coonfig Serverμ—μ„ μ½ν€μ§€κ³ , <br>
κ°κ°μ λ§μ΄ν¬λ΅ μ„λΉ„μ¤λ“¤μ—κ² μ „λ‹¬λλ” μ‹μ μ—, keyλ¥Ό μ΄μ©ν•΄ cipher textλ¥Ό λ³µνΈν™” ν• λ’¤μ— μ‚¬μ©ν•λ‹¤.<br><br>
μ΄λ ‡κ² repository νΉμ€ νμΌμ‹μ¤ν…μ— λ―Όκ°ν• λ°μ΄ν„° νΉμ€ secret κ°’μ„ μ €μ¥μ‹μΌ λ†“λ”λ‹¤κ³  ν•λ”λΌλ„ μ™Έλ¶€μ— λ…Έμ¶λ  μ μλ” μ„ν—μ„ μµμ†ν™” ν•  μ μλ‹¤.

## JCE (Java Cryptography Extension)
java8(jdk8)μ„ μ‚¬μ©ν•λ‹¤λ©΄ JCEλ¥Ό μ¶”κ°€μ μΌλ΅ μ‚¬μ©ν•΄μ•Όν•λ‹¤.
> π¨ μ£Όμ
- java8(jdk8)μ„ μ‚¬μ©ν•λ‹¤λ©΄, encryption νΉμ€ decryption ν•  λ• μ•„λμ™€ κ°™μ€ λ¬Έμ κ°€ λ°μƒν•  μ μλ‹¤.<br>- Illegal key size or default parameters<br>- Unsupported keysize of algorithm parameters
- μ΄ κ²½μ°μ—λ” μ•„λ μ‚¬μ΄νΈμ—μ„ ν•„μ”ν• νμΌμ„ μ¶”κ°€λ΅ μ„¤μΉν•΄μ•Ό ν•λ‹¤.<br>- [https://www.oracle.com/java/technologies/javase-jce-all-downloads.html](https://www.oracle.com/java/technologies/javase-jce-all-downloads.html)<br>![α„‰α…³α„α…³α„…α…µα†«α„‰α…£α†Ί 2022-10-06 α„‹α…©α„α…¥α†« 9 56 52](https://user-images.githubusercontent.com/59405576/194189980-2f778c8c-8a87-4838-b9e1-ee624f3c4722.png)
- μ΄ κ³Όμ •μ€ java11(jdk11) μ΄μƒμ„ μ‚¬μ©ν•  λ•μ—λ” μƒλµν•  μ μλ‹¤.

JCEλ¥Ό μ‚¬μ©ν•΄μ•Όν•λ‹¤κ³  ν•λ©΄, μ„μ—μ„ λ§ν• νμΌμ„ λ‹¤μ΄λ΅λ“ λ°›μ€ ν›„μ— μ•„λ κ³Όμ •μ„ λ”°λΌν•μ.<br>
![α„‰α…³α„α…³α„…α…µα†«α„‰α…£α†Ί 2022-10-06 α„‹α…©α„α…¥α†« 9 59 47](https://user-images.githubusercontent.com/59405576/194190340-92d8cb1c-991d-4f4a-8961-d4e022b042e4.png){: width="700" height="700"}

# λ€μΉ­ν‚¤λ¥Ό μ΄μ©ν• μ•”νΈν™”
## π `config-service`
### `pom.xml`
bootstrapμ΄ μ΄λ―Έ μ¶”κ°€λμ–΄μλ‹¤λ©΄ μ¶”κ°€ν•μ§€ μ•μ•„λ„ λλ‹¤.
```xml
<!-- Bootstrap -->
<dependency>
  <groupId>org.springframework.cloud</groupId>
  <artifactId>spring-cloud-starter-bootstrap</artifactId>
</dependency>
```

### `bootstrap.yml`
κΈ°μ΅΄μ— `bootstrap.yml` νμΌμ΄ μ—†μ—κΈ° λ•λ¬Έμ— μƒλ΅ μƒμ„±ν•λ‹¤.<br>
λ€μΉ­ν‚¤ λ°©μ‹μ€ μ•”/λ³µνΈν™” μ‹ κ°™μ€ ν‚¤λ¥Ό μ‚¬μ©ν•λ‹¤.<br>
μ΄λ• μ‚¬μ©λ  ν‚¤λ¥Ό `bootstrap.yml`μ— μ •μν•μ. (ν‚¤λ” λ§μλ€λ΅ μ •μν•λ©΄ λλ‹¤.)
```yml
encrypt:
  key: abcdefghijklmnopqrstuvwxyz0123456789
```

> ν…μ¤νΈ<br>
μ•”νΈν™”κ°€ μ λλ”μ§€ ν…μ¤νΈλ¥Ό ν•΄λ³΄μ.<br>
`service-discovery`μ™€ λ°©κΈ μ„¤μ •ν• `config-service` λ‘ μ„λ²„λ¥Ό κΈ°λ™ν• λ’¤μ—,<br>
ν¬μ¤νΈλ§¨μ—μ„ `http://localhost:8888/encrypt`μ— λ‹¤μ μ”μ²­μ„ ν•΄λ³΄μ.<br>
![α„‰α…³α„α…³α„…α…µα†«α„‰α…£α†Ί 2022-10-06 α„‹α…©α„α…¥α†« 10 28 58](https://user-images.githubusercontent.com/59405576/194193666-3bcc448f-3fe1-4257-ac1e-5d2a25616ae1.png){: width="500" height="500"}<br>
μ•”νΈν™”κ°€ λμ—λ‹¤.<br><br>
μ΄λ²μ—λ” cipher textλ¥Ό κ°€μ§€κ³  λ³µνΈν™” ν…μ¤νΈλ¥Ό ν•΄λ³΄μ.<br>
`http://localhost:8888/decrypt`μ— λ‹¤μ μ”μ²­μ„ ν•΄λ³΄μ.<br>
![α„‰α…³α„α…³α„…α…µα†«α„‰α…£α†Ί 2022-10-06 α„‹α…©α„α…¥α†« 10 31 29](https://user-images.githubusercontent.com/59405576/194193947-7dba8727-344a-4574-a42d-d66c9558353b.png){: width="500" height="500"}<br>
λ³µνΈν™”λ„ μ λλ” κ²ƒμ„ ν™•μΈν•  μ μλ‹¤.

## π `user-service`
### `application.yml`
`application.yml`μ— μλ db μ—°λ™ μ‹ ν•„μ”ν• μ„¤μ • μ •λ³΄λ¥Ό λ³„λ„μ νμΌλ΅ λ”°λ΅ λ¶„λ¦¬μ‹ν‚¤μ.<br>
μ΄λ” `config-service`μ `user-service.yml`λ΅ μ΄λ™μ‹ν‚¬ κ²ƒμ΄λ‹¤.<br>
μ•„λμ—μ„λ” μ–΄λ–¤ μ •λ³΄κ°€ μ‚¬λ¦¬μ΅λ”μ§€ λ‚νƒ€λ‚΄κΈ° μ„ν•΄ μ£Όμ„μΌλ΅ ν‘μ‹ν–μ§€λ§, μ‹¤μ λ΅λ” μ‚­μ ν•λ‹¤.
```yml
# datasource:
#  driver-class-name: org.h2.Driver
#  url: jdbc:h2:mem:testdb
#  username: sa
#  password: 1234
```

### `bootstrap.yml`
μ½μ–΄μ¤κ³ μ ν•λ” μ„¤μ • νμΌμ μ •λ³΄λ¥Ό λ…μ‹ν•λ‹¤.<br>
μ΄ λ• `name`μ— `config-service`λΌλ” Configuration Serverμ μ΄λ¦„μ„ μ κ²λλ©΄ `application.yml` νμΌμ„ μ½μ–΄μ¤κ³ ,<br>
`user-service`μ™€ κ°™μ€ νΉμ • μ΄λ¦„μ„ λ…μ‹ν•λ©΄ `user-service.yml`μ„ μ½μ–΄μ¨λ‹¤.
```yml
spring:
  cloud:
    config:
      uri: http://127.0.0.1:8888
      name: user-service # π native-file-repo μ•μ— μλ” user-service.yml νμΌμ„ μ½μ–΄μ¨λ‹¤.
```

## π `native-file-repo`
### `user-service.yml`
μ•„κΉ `user-service`μ—μ„ μλΌλ‚Έ db μ—°κ²° μ •λ³΄λ¥Ό `user-service.yml`λ΅ λ¶™μ—¬λ„£λ”λ‹¤.<br>
μ΄ λ•, h2 databaseμ password(= `1234`)λ¥Ό μ•”νΈν™”ν•΄μ„ λ„£μ–΄μ¤€λ‹¤. <br>
```yml
spring:
  datasource:
  driver-class-name: org.h2.Driver
  url: jdbc:h2:mem:testdb
  username: sa
  password: '{cipher}c0c61dbe3eb9ef876f5b1810bd510a49d2ee8aa679956f68d9d1d4ff3b661108'
...
```
νμΌμ„ μ €μ¥ν• λ’¤μ— `config-service`λ¥Ό μ¬κΈ°λ™ν•΄μ¤€λ‹¤.

> μ°Έκ³ <br>
μ•”νΈν™”λ” μ„μ—μ„ ν–λ κ²ƒμ²λΌ ν¬μ¤νΈλ§¨μ„ μ΄μ©ν•λ©΄ λλ‹¤.<br>
![α„‰α…³α„α…³α„…α…µα†«α„‰α…£α†Ί 2022-10-06 α„‹α…©α„α…¥α†« 10 44 16](https://user-images.githubusercontent.com/59405576/194195739-ec330646-ad70-4492-a2c8-06e3b10c2338.png){: width="500" height="500"}

## ν…μ¤νΈ
ν…μ¤νΈλ¥Ό μ„ν•΄ `gateway-service`λ„ κΈ°λ™ν•΄μ¤€λ‹¤. (ν„μ¬ `service-discovery` -> `config-service` -> `gateway-service` -> `user-service`κ°€ κΈ°λ™λμ–΄μλ‹¤.)<br>
μ•„λ μ‚¬μ§„μ—μ„ μ›Ή λΈλΌμ°μ €λ¥Ό ν†µν•΄ λ³΄μ΄λ” λ‹¨κ³„κ°€ `user`λΌλ” λ§μ΄ν¬λ΅ μ„λΉ„μ¤κ°€ μ‚¬μ©ν•λ” μ‹μ μ΄λΌκ³  λ³Ό μ μλ‹¤.<br>
![α„‰α…³α„α…³α„…α…µα†«α„‰α…£α†Ί 2022-10-06 α„‹α…©α„α…¥α†« 10 51 40](https://user-images.githubusercontent.com/59405576/194196535-328bf776-ce78-4235-bcbe-ddedc790e9b1.png){: width="500" height="500"}<br>
`spring.password`λ¥Ό λ³΄λ©΄, μ •μƒμ μΌλ΅ `1234`λΌλ” plain textλ¥Ό μ½μ–΄μ¤λ” κ²ƒμ„ ν™•μΈν•  μ μλ‹¤.<br>
λ”°λΌμ„ μ €μ¥ν•  λ•μ—λ” μ•”νΈν™”λ cypher textλ¥Ό μ €μ¥ν•κ³ , μ‚¬μ©ν•  λ•μ—λ” μ„ μ‚¬μ§„μ—μ„ μ²λΌ decrypted λ plain textλ¥Ό μ‚¬μ©ν•¨μ„ μ• μ μλ‹¤.

> λ§μ•½ ν¨μ¤μ›λ“μ— μλ»λ μ•”νΈλ¬Έμ„ λ„£λ”λ‹¤λ©΄?<br><br>
`native-file-repo/user-service.yml`μ—μ„ passwordμ—<br>
`'{cipher}c0c61dbe3eb9ef876f5b1810bd510a49d2ee8aa679956f68d9d1d4ff3b661108_wrong'`κ³Ό κ°™μ΄ μΌλ¶€λ¬ μλ»λ μ•”νΈλ¬Έμ„ λ„£μ–΄λ³΄μ.<br><br>
`http://localhost:8888/user-service/default` νμ΄μ§€λ¥Ό μƒλ΅κ³ μΉ¨ ν•κ² λλ©΄, μ•„λμ™€ κ°™μ΄ `<n/a>`λ΅ ν‘μ‹λ¨μ„ μ• μ μλ‹¤.<br>
![α„‰α…³α„α…³α„…α…µα†«α„‰α…£α†Ί 2022-10-06 α„‹α…©α„α…¥α†« 10 58 56](https://user-images.githubusercontent.com/59405576/194197403-fc8c676e-6281-4f5f-a178-d3c56a249dcc.png)

### h2-console μ ‘μ† ν…μ¤νΈ
`localhost:8761`μΌλ΅ μ λ μΉ΄ ν™μ— λ“¤μ–΄κ°€μ„ `user-service`μ ν¬νΈλ²νΈλ¥Ό ν™•μΈν• λ’¤, μ£Όμ† λ§μ§€λ§‰μ„ `/h2-console`λ΅ λ³€κ²½ν•΄ h2 μ½μ†”λ΅ μ ‘μ†ν•λ‹¤.<br>
μ΄μ „μ— ν–λ κ²ƒμ²λΌ ν¨μ¤μ›λ“ μ—†μ΄ test connectionμ„ μ‹λ„ν•΄λ³΄μ.<br>
![α„‰α…³α„α…³α„…α…µα†«α„‰α…£α†Ί 2022-10-06 α„‹α…©α„α…¥α†« 11 12 02](https://user-images.githubusercontent.com/59405576/194198814-21323fdb-3edd-487f-bc54-649d72dc5193.png)<br>
ν¨μ¤μ›λ“ μ—†μ΄λ” μ ‘μ†λμ§€ μ•λ” κ²ƒμ„ ν™•μΈν–λ‹¤.<br>
μ΄λ²μ—λ” ν¨μ¤μ›λ“μ— `1234`λ¥Ό μ…λ ¥ν•΄λ³΄μ.<br>
![α„‰α…³α„α…³α„…α…µα†«α„‰α…£α†Ί 2022-10-06 α„‹α…©α„α…¥α†« 11 12 31](https://user-images.githubusercontent.com/59405576/194198869-ae241add-0390-4d05-a2c1-d7cd3e2e0db8.png)<br>
μ°λ¦¬κ°€ μ•”νΈλ¬ΈμΌλ΅ μ„¤μ •ν•λ€λ΅ `1234`λ¥Ό μ…λ ¥ν•΄μ•Ό μ ‘μ†μ΄ λλ” κ²ƒμ„ ν™•μΈν•  μ μλ‹¤. 

# λΉ„λ€μΉ­ν‚¤λ¥Ό μ΄μ©ν• μ•”νΈν™”


















***
<br>


    π’› κ°μΈ κ³µλ¶€ κΈ°λ΅μ© λΈ”λ΅κ·Έμ…λ‹λ‹¤. π‘»

[λ§¨ μ„λ΅ μ΄λ™ν•κΈ°](#){: .btn .btn--primary }{: .align-right}