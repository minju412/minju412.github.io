---
title:  "[E-commerce App] Micrometerë¥¼ ì´ìš©í•œ ë§ˆì´í¬ë¡œ ì„œë¹„ìŠ¤ ëª¨ë‹ˆí„°ë§ "

categories:
  - SpringCloud
tags:
  - [SpringCloud]

toc: true
toc_sticky: true
 
date: 2022-10-15 00:07:51
last_modified_at: 2022-10-15 00:07:53
---


# ê°œìš”
## Micrometer
- Micrometer<br>- [https://micrometer.io/](https://micrometer.io/)<br>- JVM ê¸°ë°˜ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ Metrics ì œê³µ<br>- Spring Framework 5, Spring Boot 2ë¶€í„° Springì˜ Metrics ì²˜ë¦¬<br>- Prometheusë“±ì˜ ë‹¤ì–‘í•œ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ ì§€ì›

- Timer<br>- ì§§ì€ ì§€ì—° ì‹œê°„, ì´ë²¤íŠ¸ì˜ ì‚¬ìš© ë¹ˆë„ë¥¼ ì¸¡ì •<br>- ì‹œê³„ì—´ë¡œ ì´ë²¤íŠ¸ì˜ ì‹œê°„, í˜¸ì¶œ ë¹ˆë„ ë“±ì„ ì œê³µ<br>- `@Timed` ì œê³µ


# êµ¬í˜„
## `user-service`
### `pom.xml`
```xml
<!-- Micrometer -->
<dependency>
    <groupId>io.micrometer</groupId>
    <artifactId>micrometer-registry-prometheus</artifactId>
</dependency>
```

### `application.yml`
```yml
management:
  endpoints:
    web:
      exposure:
        include: refresh, health, beans, busrefresh, info, metrics, prometheus # ë§ˆì§€ë§‰ ì„¸ ê°œ ì¶”ê°€
```

### `UserController.java`
```java
@RestController
@RequestMapping("/") 
public class UserController {
    ...
    @GetMapping("/health-check")
    @Timed(value = "users.status", longTask = true) // ğŸŒŸ @Timed ì¶”ê°€
    public String status() { ... }

    @GetMapping("/welcome")
    @Timed(value = "users.welcome", longTask = true) // ğŸŒŸ @Timed ì¶”ê°€
    public String welcome() { ... }
}
```

## `gateway-service`
### `pom.xml`
```xml
<!-- Micrometer -->
<dependency>
    <groupId>io.micrometer</groupId>
    <artifactId>micrometer-registry-prometheus</artifactId>
</dependency>
```

### `application.yml`
```yml
management:
  endpoints:
    web:
      exposure:
        include: refresh, health, beans, busrefresh, info, metrics, prometheus # ë§ˆì§€ë§‰ ì„¸ ê°œ ì¶”ê°€
```

## `order-service`
### `pom.xml`
ì˜¤ë” ì„œë¹„ìŠ¤ì—ëŠ” ì´ì „ì— actuatorë¥¼ ì¶”ê°€í•˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì—, actuatorë„ ì¶”ê°€í•œë‹¤.
```xml
<!-- Spring Boot Actuator -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-actuator</artifactId>
</dependency>

<!-- Micrometer -->
<dependency>
    <groupId>io.micrometer</groupId>
    <artifactId>micrometer-registry-prometheus</artifactId>
</dependency>
```

### `application.yml`
ê¸°ì¡´ì—ëŠ” ì•„ë˜ ì½”ë“œê°€ ì•„ì˜ˆ ì¶”ê°€ë˜ì–´ ìˆì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì—, ì¶”ê°€í•œë‹¤.
```yml
management:
  endpoints:
    web:
      exposure:
        include: health, httptrace, info, metrics, prometheus
```

# í…ŒìŠ¤íŠ¸
ì•„ë˜ ìˆœì„œëŒ€ë¡œ ì„œë¹„ìŠ¤ë“¤ì„ ê¸°ë™í•˜ì.
- ìœ ë ˆì¹´ ì„œë²„
- configuration ì„œë²„
- ê²Œì´íŠ¸ì›¨ì´ ì„œë²„
- rabbitmq ì„œë²„
- zipkin ì„œë²„
- ìœ ì € ì„œë¹„ìŠ¤
- ì˜¤ë” ì„œë¹„ìŠ¤

ì´ì œ ìœ ì € ì„œë¹„ìŠ¤ì— ê°€ì„œ actuatorì— ì¶”ê°€í•œ metricsì™€ prometheusê°€ ì–´ë–¤ ì •ë³´ë¥¼ ê°€ì§€ê³  ìˆëŠ”ì§€ í™•ì¸í•´ë³´ì.<br><br>
ë¨¼ì €, ì•„ê¹Œ `@Timed` ì¶”ê°€ë¥¼ í•œ `welcome()` ê³¼ `status()`ë¥¼ í˜¸ì¶œí•´ë³´ì.<br>
ê·¸ë¦¬ê³  ìœ ë ˆì¹´ ì„œë²„ì—ì„œ `user-service` í´ë¦­ í›„, ì—”ë“œ í¬ì¸íŠ¸ë¥¼ `/actuator/metrics`ë¡œ ë³€ê²½í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ ì •ë³´ê°€ ë‚˜ì˜¨ë‹¤.<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-15 á„‹á…©á„Œá…¥á†« 12 48 02](https://user-images.githubusercontent.com/59405576/195888129-fc9a4533-1f8d-402f-844f-18dbd22da3c2.png)<br><br>
ìœ„ì—ì„œ í™•ì¸í•œ ê²ƒì²˜ëŸ¼ `@Timed` ì¶”ê°€í•œ ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ë©´, metricsì— ì •ë³´ê°€ ì°íŒë‹¤.<br><br>
ì´ë²ˆì—ëŠ” `/actuator/prometheus`ì— ì ‘ì†í•´ë³´ì.<br>
ì ‘ì† í›„ `users_welocme` í‚¤ì›Œë“œë¡œ ê²€ìƒ‰í•´ë³´ë©´ ì•„ë˜ì™€ ê°™ì´ ëª‡ ë²ˆ í˜¸ì¶œë˜ì—ˆëŠ”ì§€, ì´ ì‚¬ìš© ì‹œê°„ ë“±ì˜ ì •ë³´ê°€ ë‚˜ì˜¨ë‹¤.<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-15 á„‹á…©á„Œá…¥á†« 12 51 58](https://user-images.githubusercontent.com/59405576/195888893-5f7eeb61-cfae-407a-b326-ad65524a554a.png)<br><br>
`users_status`ë„ ë§ˆì°¬ê°€ì§€ë¡œ ì°¾ì•„ë³¼ ìˆ˜ ìˆë‹¤.<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-15 á„‹á…©á„Œá…¥á†« 12 54 01](https://user-images.githubusercontent.com/59405576/195889213-2c5ecd9c-eca9-4ad6-a537-24835b632e68.png)





***
<br>


    ğŸ’› ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ğŸ‘»

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}