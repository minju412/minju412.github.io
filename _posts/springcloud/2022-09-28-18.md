---
title:  "[Spring Cloud Gateway] Logging Filter "

categories:
  - SpringCloud
tags:
  - [SpringCloud]

toc: true
toc_sticky: true
 
date: 2022-09-28 00:55:22
last_modified_at: 2022-09-28 00:55:25
---
ì´ ì „ì— ì‚´í´ë³¸ Global Filterë¥¼ ë¡œê¹… ì¶œë ¥ì— ì ìš©í•´ë³´ì.
# ì½”ë“œ
## apigateway-service
### `filter/LoggingFilter.java`
ì´ ì „ì— ë§Œë“  `GlobalFilter`ì™€ ê°™ì€ ìœ„ì¹˜ì— `LoggingFilter`ë¥¼ ìƒì„±í•œë‹¤.
```java
@Component
@Slf4j
public class LoggingFilter extends AbstractGatewayFilterFactory<LoggingFilter.Config> {

    public LoggingFilter() {
        super(Config.class);
    }

    @Override
    public GatewayFilter apply(Config config) {
        GatewayFilter filter = new OrderedGatewayFilter((exchange, chain) -> {
            ServerHttpRequest request = exchange.getRequest();
            ServerHttpResponse response = exchange.getResponse();

            log.info("Logging Filter baseMessage: {}", config.getBaseMessage());

            if (config.getPreLogger()) {
                log.info("Logging Pre Filter: request id -> {}", request.getId());
            }

            return chain.filter(exchange)
                .then(Mono.fromRunnable(() -> {
                    if (config.getPostLogger()) {
                        log.info("Logging Post Filter: response id -> {}", response.getStatusCode());
                    }
                }));
        }, Ordered.HIGHEST_PRECEDENCE);

        return filter;
    }

    @Data
    public static class Config {
        // configuration ì •ë³´ë¥¼ ë„£ê¸°
        private String baseMessage;
        private Boolean preLogger;
        private Boolean postLogger;
    }
}
```

### `application.yml`
```yml
...
spring:
  application:
    name: apigateway-service
  cloud:
    gateway:
      default-filters:
        - name: GlobalFilter
          args:
            baseMessage: Spring Cloud Gateway Global Filter
            preLogger: true
            postLogger: true
      routes:
        - id: first-service
          uri: http://localhost:8081/ 
          predicates:
            - Path=/first-service/** 
          filters:
            - CustomFilter # ì „ë‹¬í•  íŒŒë¼ë¯¸í„° ì—†ìœ¼ë©´ name ìƒëµ ê°€ëŠ¥
        - id: second-service
          uri: http://localhost:8082/
          predicates:
            - Path=/second-service/**
          filters:
            - name: CustomFilter
            - name: LoggingFilter # ğŸŒŸ LoggingFilter ì¶”ê°€
              args:
                baseMessage: Hi, there.
                preLogger: true
                postLogger: true
```




# í¬ìŠ¤íŠ¸ë§¨ ê²°ê³¼
í¬ìŠ¤íŠ¸ë§¨ì„ í†µí•´ `http://localhost:8000/first-service/check`ì— ì ‘ì†í•´ë³´ì.<br>
`apigateway-service`ì˜ ì½˜ì†”ì— ì•„ë˜ì™€ ê°™ì€ ë¡œê·¸ê°€ ì°íŒë‹¤.<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-09-28 á„‹á…©á„Œá…¥á†« 12 52 35](https://user-images.githubusercontent.com/59405576/192575191-09723d3e-aa2c-4ecc-9bf9-ffa92751618f.png){: width="800" height="800"}<br><br>
ì´ë²ˆì—ëŠ”, ì´ì–´ì„œ `http://localhost:8000/second-service/check`ì— ì ‘ì†í•´ë³´ì.<br>
`application.yml`ì—ì„œ `second-service`ì—ëŠ” `LoggingFilter`ë¥¼ ì ìš©í–ˆê¸° ë•Œë¬¸ì—, `first-service`ì™€ëŠ” ë‹¤ë¥´ê²Œ ë‚˜íƒ€ë‚  ê²ƒì´ë‹¤.<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-09-28 á„‹á…©á„Œá…¥á†« 1 14 07](https://user-images.githubusercontent.com/59405576/192580188-d7a5521a-a96a-411c-9e45-73b8bd5ca562.png){: width="800" height="800"}<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-09-28 á„‹á…©á„Œá…¥á†« 12 59 46](https://user-images.githubusercontent.com/59405576/192576652-0121cbf5-e333-4e1c-a76a-3da1cbea806d.png){: width="800" height="800"}<br>
ê·¸ëŸ°ë°, ì´ëŠ” ìœ„ ì‚¬ì§„ì²˜ëŸ¼ `Global` -> `Custom` -> `Logging` -> `Logging` -> `Custom` -> `Global` ì˜ ìˆœì„œê°€ ì•„ë‹ˆë‹¤.<br>
ìˆœì„œê°€ `Logging` -> `Global` -> `Custom` -> `Custom` -> `Global` -> `Logging` ì˜ ìˆœì„œë¡œ ì‹¤í–‰ëœ ì´ìœ ëŠ” ì•„ë˜ì™€ ê°™ë‹¤.
```java
GatewayFilter filter = new OrderedGatewayFilter((exchange, chain) -> {...}, Ordered.HIGHEST_PRECEDENCE);
```
ì•„ê¹Œ `LoggingFilter`ë¥¼ ìƒì„±í•˜ë©´ì„œ ìš°ì„ ìˆœìœ„ë¥¼ `HIGHEST_PRECEDENCE`ë¡œ ì§€ì •í–ˆê¸° ë•Œë¬¸ì—<br>
`LoggingFilter`ê°€ ì œì¼ ë¨¼ì € ì‹¤í–‰ ëœ ê²ƒì´ë‹¤.<br><br>
ì´ì²˜ëŸ¼ í•„í„°ì˜ ìš°ì„ ìˆœìœ„ë¥¼ ë³€ê²½í•  ìˆ˜ ìˆë‹¤.<br>
ë§Œì•½ `LoggerFilter`ì˜ ìš°ì„ ìˆœìœ„ë¥¼ ê°€ì¥ ë‚®ê²Œ `Ordered.LOWEST_PRECEDENCE`ë¡œ ë³€ê²½í•œë‹¤ë©´,<br>
ì˜ˆìƒëŒ€ë¡œ `Global` -> `Custom` -> `Logging` -> `Logging` -> `Custom` -> `Global` ì˜ ìˆœì„œë¡œ ì‹¤í–‰ë  ê²ƒì´ë‹¤.






***
<br>


    ğŸ’› ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ğŸ‘»

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}