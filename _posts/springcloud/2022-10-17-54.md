---
title:  "[E-commerce App] Docker Containerë¥¼ ì´ìš©í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬ - 2. Discovery Service & Gateway Service "

categories:
  - SpringCloud
tags:
  - [SpringCloud]

toc: true
toc_sticky: true
 
date: 2022-10-17 17:57:57
last_modified_at: 2022-10-17 17:57:59
---

ì´ì „ ê¸€ì— ì´ì–´ì„œ ì§„í–‰í•´ë³´ì.

# Docker Container
## 3. Discovery Service
### 1) `application.yml` ìˆ˜ì •
ìœ ë ˆì¹´ ì„œë²„ì—ì„œ configuration ì„œë²„ì— ìˆëŠ” êµ¬ì„± ì •ë³´ë¥¼ ì‚¬ìš©í•  ìˆ˜ë„ ìˆìœ¼ë‹ˆ configuration ì„œë²„ì˜ ì •ë³´ë¥¼ ëª…ì‹œí•´ë†“ì.<br>
ì´ë”°ê°€ `docker run` í•  ë•Œì—ëŠ”, ì´ì „ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ ë„ì»¤ IP Addressë¥¼ ì˜µì…˜ìœ¼ë¡œ ë¶€ì—¬í•  ê²ƒì´ë‹¤.
```yml
server:
  port: 8761

spring:
  application:
    name: discoveryservice
  cloud:
    config:
      uri: http://127.0.0.1:8888 # ğŸŒŸ ì¶”ê°€
      name: ecommerce # ğŸŒŸ ì¶”ê°€

eureka:
  client:
    register-with-eureka: false
    fetch-registry: false
```

### 2) Dockerfileì„ í†µí•´ ì´ë¯¸ì§€ ë§Œë“¤ê¸°
ì´ë²ˆì—ëŠ” `service-discovery`ë¥¼ Dockerfileì„ í†µí•´ ì´ë¯¸ì§€í™” í•´ë³´ì.
`Dockerfile`
```Dockerfile
FROM openjdk:17-ea-11-jdk-slim

VOLUME /tmp

COPY target/service-discovery-0.0.1-SNAPSHOT.jar ServiceDiscovery.jar

ENTRYPOINT ["java","-jar","ServiceDiscovery.jar"]
```

### 3) ì´ë¯¸ì§€ ë¹Œë“œ ë° ë„ì»¤ í—ˆë¸Œì— ì—…ë¡œë“œ
ì¸í…”ë¦¬ì œì´ í„°ë¯¸ë„ì„ ì‚¬ìš©í•´ë„ ë˜ê³ , iTermì„ ì‚¬ìš©í•´ë„ ëœë‹¤.
```bash
# ìµœì‹  ë²„ì „ìœ¼ë¡œ ì»´íŒŒì¼
$ mvn clean compile package -DskipTests=true 
# cleanì€ ê¸°ì¡´ íŒŒì¼ì„ ì§€ìš´ë‹¤.
# package ì˜µì…˜ìœ¼ë¡œ jar íŒŒì¼ê¹Œì§€ ìƒì„±í•  ìˆ˜ ìˆë‹¤.
# í…ŒìŠ¤íŠ¸ ì½”ë“œëŠ” skip

# ì´ë¯¸ì§€ íŒŒì¼ ë¹Œë“œ
$ docker build -t ln8847/service-discovery:1.0  .

# ìƒì„±ëœ ì´ë¯¸ì§€ í™•ì¸
$ docker images | grep service-discovery

# ë„ì»¤ í—ˆë¸Œì— ì—…ë¡œë“œ
$ docker push ln8847/service-discovery:1.0
```

### 4) ë„ì»¤ ì»¨í…Œì´ë„ˆ ì‹¤í–‰
```bash
# ì»¨í…Œì´ë„ˆ ì‹¤í–‰
$ docker run -d -p 8761:8761 --network ecommerce-network \
-e "spring.cloud.config.uri=http://config-service:8888" \
--name service-discovery \
ln8847/service-discovery:1.0

# ë¡œê·¸ í™•ì¸
$ docker logs service-discovery
```
ì´ì „ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ ë„¤íŠ¸ì›Œí¬ë¥¼ í™•ì¸í•´ë³´ì.
```bash
$ docker network inspect ecommerce-network
```
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-17 á„‹á…©á„’á…® 9 37 53](https://user-images.githubusercontent.com/59405576/196178874-be84efa5-64a8-4e35-a555-1904d763b3e2.png)<br><br>
ì›¹ ë¸Œë¼ìš°ì €ì—ì„œë„ í™•ì¸í•´ë³´ë©´, ë„ì»¤ë¡œ ì˜ ì‹¤í–‰ë˜ê³  ìˆìŒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-17 á„‹á…©á„’á…® 9 39 20](https://user-images.githubusercontent.com/59405576/196179207-28b50d39-432b-44cb-bd4f-dab369df19ad.png)

## 4. Gateway Service
### 1) Dockerfileì„ í†µí•´ ì´ë¯¸ì§€ ë§Œë“¤ê¸°
`Dockerfile`
```Dockerfile
FROM openjdk:17-ea-11-jdk-slim

VOLUME /tmp

COPY target/gateway-service-0.0.1-SNAPSHOT.jar GatewayService.jar

ENTRYPOINT ["java","-jar","GatewayService.jar"]
```

### 2) ì´ë¯¸ì§€ ë¹Œë“œ ë° ë„ì»¤ í—ˆë¸Œì— ì—…ë¡œë“œ
ì¸í…”ë¦¬ì œì´ í„°ë¯¸ë„ì„ ì‚¬ìš©í•´ë„ ë˜ê³ , iTermì„ ì‚¬ìš©í•´ë„ ëœë‹¤.
```bash
# ìµœì‹  ë²„ì „ìœ¼ë¡œ ì»´íŒŒì¼
$ mvn clean compile package -DskipTests=true
# cleanì€ ê¸°ì¡´ íŒŒì¼ì„ ì§€ìš´ë‹¤.
# package ì˜µì…˜ìœ¼ë¡œ jar íŒŒì¼ê¹Œì§€ ìƒì„±í•  ìˆ˜ ìˆë‹¤.
# í…ŒìŠ¤íŠ¸ ì½”ë“œëŠ” skip

# ì´ë¯¸ì§€ íŒŒì¼ ë¹Œë“œ
$ docker build -t ln8847/gateway-service:1.0  .

# ìƒì„±ëœ ì´ë¯¸ì§€ í™•ì¸
$ docker images | grep gateway-service

# ë„ì»¤ í—ˆë¸Œì— ì—…ë¡œë“œ
$ docker push ln8847/gateway-service:1.0
```

### 3) ë„ì»¤ ì»¨í…Œì´ë„ˆ ì‹¤í–‰
```bash
# ì»¨í…Œì´ë„ˆ ì‹¤í–‰
$ docker run -d -p 8000:8000 --network ecommerce-network \
-e "spring.cloud.config.uri=http://config-service:8888" \
-e "spring.rabbitmq.host=rabbitmq" \
-e "eureka.client.serviceUrl.defaultZone=http://service-discovery:8761/eureka/" \
--name gateway-service \
ln8847/gateway-service:1.0

# ë¡œê·¸ í™•ì¸
$ docker logs gateway-service
```
`application.yml` í˜¹ì€ `bootstrap.yml` íŒŒì¼ì„ í™•ì¸í•´ë³´ë©´,<br>
ê²Œì´íŠ¸ì›¨ì´ ì„œë¹„ìŠ¤ëŠ” ë‘ ê°€ì§€ ë‹¤ë¥¸ ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.<br><br>
í•˜ë‚˜ëŠ” configuration serviceì˜ ì •ë³´ë¥¼ ì‚¬ìš©í•˜ëŠ” ë¶€ë¶„ì´ê³ ,<br>
ë‹¤ë¥¸ í•˜ë‚˜ëŠ” ìœ ë ˆì¹´ ì„œë²„ì— ìê¸° ìì‹ ì„ ë“±ë¡í•˜ê¸° ìœ„í•´ ìœ ë ˆì¹´ ì„œë¹„ìŠ¤ì˜ urlì„ ì§€ì •í•˜ëŠ” ë¶€ë¶„ì´ë‹¤.<br><br>
ê°ê°ì˜ ì •ë³´ë¥¼ `docker run` ëª…ë ¹ì„ ì‹¤í–‰í•  ë•Œ ì˜µì…˜ìœ¼ë¡œ ë¶€ì—¬í•œë‹¤.<br><br>
ë„ì»¤ ì»¨í…Œì´ë„ˆ ê¸°ë™ í›„, ë„¤íŠ¸ì›Œí¬ë¥¼ í™•ì¸í•´ë³´ì.
```bash
$ docker network inspect ecommerce-network
```
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-17 á„‹á…©á„’á…® 9 54 34](https://user-images.githubusercontent.com/59405576/196182269-dc183a0a-cb1e-41b4-ac51-2f0128d9c736.png)<br><br>
ê·¸ë¦¬ê³  ìœ ë ˆì¹´ ëŒ€ì‹œë³´ë“œì—ì„œ ìƒˆë¡œê³ ì¹¨ì„ í•´ë³´ì.<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-17 á„‹á…©á„’á…® 9 55 58](https://user-images.githubusercontent.com/59405576/196182578-a2a2b2ff-4c0c-46e8-ad26-d67e899f2069.png)<br>
ê²Œì´íŠ¸ì›¨ì´ ì„œë¹„ìŠ¤ê¹Œì§€ ì˜ ë“±ë¡ë˜ì—ˆë‹¤.








***
<br>


    ğŸ’› ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ğŸ‘»

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}