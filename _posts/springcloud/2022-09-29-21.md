---
title:  "[E-commerce App] Users Microservice "

categories:
  - SpringCloud
tags:
  - [SpringCloud]

toc: true
toc_sticky: true
 
date: 2022-09-29 00:25:29
last_modified_at: 2022-09-29 00:25:33
---

# 개요
![스크린샷 2022-09-29 오전 12 01 54](https://user-images.githubusercontent.com/59405576/192814194-cb5977c6-04a5-4d24-9d1b-680805ef3f7e.png){: width="800" height="800"}<br>
`user-microservice`는 UI는 없이 REST API 형식으로 구현할 것이다.<br>
그리고 위 사진에서 보이는 기능들을 개발할 것이다.

## APIs
![스크린샷 2022-09-29 오전 12 04 31](https://user-images.githubusercontent.com/59405576/192814869-ed4ee880-fd85-4627-a3fc-d3e82d96269d.png){: width="800" height="800"}<br>
API Gateway 사용 시에는 uri에 `/user-service`라는 prefix가 붙어야하며, 모든 마이크로 서비스에 대해 같은 포트(ex.`8000`)로 호출할 수 있다.<br>
미사용 시 prefix 없이 호출하고자하는 end point만 입력하면 되고, 해당하는 마이크로 서비스의 포트(ex.`8081`)로 호출해야 한다.<br><br>


# Users Microservice - 기본적인 사용자 가입과 전체 회원 목록 조회
## 프로젝트 생성
- Dependencies<br>- DevTools, Lombok, Spring Web, Eureka Discovery Client

## 실행
### 서비스 디스커버리(= 유레카 서버) 실행
인텔리제이에서 실행하는 것 자체가 부하가 크기 때문에 터미널로 실행하자.<br>
먼저, 터미널 상에서 유레카 서버가 있는 곳으로 이동하자.
```
$ cd service-discovery
$ mvn spring-boot:run # 유레카 서버 실행
```
<br>

### `user-service` 실행
터미널을 이용해 유레카 서버를 먼저 실행한 뒤,<br>
인텔리제이에서 `user-service`를 실행한다.<br>
그 다음, `http://localhost:8761`에 접속하면 아래와 같이 서비스 디스커버리에 `user-service`가 등록된 것을 확인할 수 있다.<br>
<img width="1061" alt="스크린샷 2022-09-29 오전 12 54 09" src="https://user-images.githubusercontent.com/59405576/192827115-b66337be-6943-4119-bfbb-d42a9d50a9bb.png"><br><br>
해당 url을 클릭하여 포트번호를 확인한 뒤, end point를 `/health-check`로 바꾼다.<br>
<img width="477" alt="스크린샷 2022-09-29 오전 12 52 44" src="https://user-images.githubusercontent.com/59405576/192826785-6716ccfa-daab-47df-9623-902b76c00f9b.png"><br>
위와 같이 잘 실행되는 것을 확인할 수 있다.<br>
참고로, 마이크로 서비스를 재시동 할 때 마다 포트번호는 바뀐다.<br><br>

## `welcome()` 메서드 생성
이번에는 화면에 간단한 인사말을 띄워볼 것이다.<br>
`application.yml`에 인사말을 정의할건데, 이를 가져오는 방법에는 두 가지가 있다.<br>
우선 `application.yml`의 맨 아래에 아래 코드를 추가하자.
```yml
greeting:
  message: Welcome to the Simple E-commerce.
```

### 방법 1. Environment 이용
`controller/UserController.java`
```java
@RestController
@RequestMapping("/")
public class UserController {

    private Environment env;

    @Autowired
    public UserController(Environment env) {
        this.env = env;
    }

    @GetMapping("welcome")
    public String welcome() {
        return env.getProperty("greeting.message");
    }
}
```

### 방법 2. `@Value` 이용
`vo/Greeting.java`
```java
@Component
@Data
public class Greeting {

    @Value("${greeting.message}")
    private String message;
}
```

`controller/UserController.java`
```java
@RestController
@RequestMapping("/")
public class UserController {

    @Autowired // 이처럼 직접 주입 받는 것은 권장하지 않는다.
    private Greeting greeting;

    @GetMapping("welcome")
    public String welcome() {
        return greeting.getMessage();
    }
}
```





***
<br>


    💛 개인 공부 기록용 블로그입니다. 👻

[맨 위로 이동하기](#){: .btn .btn--primary }{: .align-right}