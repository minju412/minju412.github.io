---
title:  "[E-commerce App] Apache Kafka ì‚¬ìš©(Kafka Connect) "

categories:
  - SpringCloud
tags:
  - [SpringCloud]

toc: true
toc_sticky: true
 
date: 2022-10-09 17:26:13
last_modified_at: 2022-10-09 17:26:16
---

ì´ ì „ ê¸€ì—ëŠ” Kafkaë¥¼ ì´ìš©í•´ Producerì™€ Consumerë¥¼ ì‚¬ìš©í•´ë³´ì•˜ë‹¤.<br>
ì´ë²ˆì—ëŠ” ì´ì–´ì„œ Kafka Connectë¥¼ ì‚¬ìš©í•´ë³´ì.<br><br>
ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥ëœ ê°’ì„ ë˜ë‹¤ë¥¸ ë°ì´í„°ë² ì´ìŠ¤ì— ì´ë™í•˜ëŠ” ì˜ˆì œë¥¼ í…ŒìŠ¤íŠ¸í•´ë³´ê¸° ìœ„í•´, MariaDBë¶€í„° ì„¤ì¹˜í•˜ì.

# MariaDB 
## ì„¤ì¹˜ ë° í…Œì´ë¸” ìƒì„±
ìœ„ ëª…ë ¹ì–´ë¡œ mariadb ì„¤ì¹˜ í›„ ì‹œì‘í•´ë³´ì.
```bash
# mariadb ì„¤ì¹˜
$ brew install mariadb

# ì‹œì‘
$ mysql.server start

# ì¢…ë£Œ
$ mysql.server stop

# ìƒíƒœ í™•ì¸
$ mysql.server status
```
ì´ì œ mysql ì ‘ì†í•´ë³´ì.<br>
ì ‘ì†í•  ë•Œ usernameì€ ë‚´ê°€ ë”°ë¡œ ë³€ê²½í–ˆê¸° ë•Œë¬¸ì— `admin`ìœ¼ë¡œ ì§€ì •í•œ ê²ƒì´ë‹¤. ë³´í†µì€ `root`ì¼ ê²ƒì´ë‹¤.
```bash
# ì ‘ì†
$ mysql -u admin -p

# í˜„ì¬ ì–´ë–¤ ë°ì´í„°ë² ì´ìŠ¤(ìŠ¤í‚¤ë§ˆ)ë“¤ì´ ìˆëŠ”ì§€ í™•ì¸
$ show databases;
```
ì ‘ì†í–ˆìœ¼ë©´, `mydb`ë¼ëŠ” ì´ë¦„ì˜ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ìƒˆë¡œ ìƒì„±í•˜ì.<br>
`mydb`ê°€ ê°€ì§€ê³  ìˆëŠ” í…Œì´ë¸”ë“¤ì„ í™•ì¸í•´ë³´ë©´, ì•„ì§ ì•„ë¬´ê²ƒë„ ì—†ì„ ê²ƒì´ë‹¤.
```bash
# ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±
mysql> create database mydb;

# ë°©ê¸ˆ ìƒì„±í•œ mydb ì‚¬ìš©
mysql> use mydb;

# í˜„ì¬ ì‚¬ìš© ì¤‘ì¸ ë°ì´í„°ë² ì´ìŠ¤ê°€ ê°€ì§€ê³  ìˆëŠ” í…Œì´ë¸”ë“¤ í™•ì¸
mysql> show tables;
```
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-09 á„‹á…©á„’á…® 6 05 45](https://user-images.githubusercontent.com/59405576/194748017-11968149-52a3-4807-85b5-2a7cc5f0843f.png)

## `order-service`
`order-service`ì—ì„œ ê¸°ì¡´ì— ì‚¬ìš©í•˜ë˜ h2 ë°ì´í„°ë² ì´ìŠ¤ ëŒ€ì‹ , MariaDBë¥¼ ì—°ë™í•´ë³´ì.

### `pom.xml`
```xml
<!-- MariaDB -->
<dependency>
    <groupId>org.mariadb.jdbc</groupId>
    <artifactId>mariadb-java-client</artifactId>
    <version>2.7.2</version>
</dependency>
```

ì´ì œ `user-service`ë¥¼ ê¸°ë™í•´ë³´ì. <br>
(ìœ ë ˆì¹´ ì„œë²„->`config-service`->`gateway-service`->`order-service` ìˆœìœ¼ë¡œ ê¸°ë™ë˜ì–´ ìˆì–´ì•¼ í•œë‹¤.)

## h2-console ì ‘ì†
ìœ ë ˆì¹´ ì„œë²„ì— ë“¤ì–´ê°€ì„œ `order-service`ì˜ í¬íŠ¸ ë²ˆí˜¸ ë’¤ë¥¼ `/h2-console`ë¡œ ë°”ê¿” h2 ì½˜ì†”ì— ì ‘ì†í•´ë³´ì.<br>
ê·¸ëŸ¼ ê¸°ì¡´ì— ì•„ë˜ ì‚¬ì§„ì²˜ëŸ¼ ë˜ì–´ìˆì„í…ë°, ê·¸ ì•„ë˜ ì‚¬ì§„ì²˜ëŸ¼ ë³€ê²½í•˜ì.<br><br>
ë³€ê²½ ì „<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-09 á„‹á…©á„’á…® 6 17 09](https://user-images.githubusercontent.com/59405576/194748550-facbddad-40d0-4efb-9e45-5e2d8a18241d.png)<br><br>
ë³€ê²½ í›„<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-09 á„‹á…©á„’á…® 6 22 06](https://user-images.githubusercontent.com/59405576/194748767-5812aa4b-d27f-46bf-b74b-0938a59258a9.png)
```
Saved Settings: Generic MySQL
Setting Name: Generic MySQL

Driver Class: org.mariadb.jdbc.Driver
JDVC URL: jdbc:mysql://localhost:3306/mydb
User Name: admin    # ë³¸ì¸ì´ ì„¤ì •í•œ username
Password: ***    # ë³¸ì¸ì´ ì„¤ì •í•œ password
```

### í…Œì´ë¸” ìƒì„±
ì•„ë˜ ì¿¼ë¦¬ë¬¸ìœ¼ë¡œ `users` í…Œì´ë¸”ì„ ìƒì„±í•´ë³´ì.
```
create table users(
    id int auto_increment primary key,
    user_id varchar(20),
    pwd varchar(20),
    name varchar(20),
    created_at datetime default NOW()
);
```
ìš°ë¦¬ê°€ Kafka Connectë¥¼ í†µí•´ í•˜ê³ ì‹¶ì€ ì‘ì—…ì€,<br>
`users` í…Œì´ë¸”ì— ìƒˆë¡œìš´ ë°ì´í„°ê°€ insert ë  ë•Œ,<br>
ê·¸ ë°ì´í„°ë¥¼ ê°ì§€í–ˆë‹¤ê°€, ê³ ìŠ¤ë€íˆ ìƒˆë¡œìš´ ë°ì´í„°ë² ì´ìŠ¤ì— ì˜®ê¸°ëŠ” ê²ƒì´ë‹¤.<br><br>
ì´ì–´ì„œ `orders` í…Œì´ë¸”ì„ ìƒì„±í•´ë³´ì.
```
create table orders (
    id int auto_increment primary key,
    product_id varchar(20) not null,
    qty int default 0,
    unit_price int default 0,
    total_price int default 0,
    user_id varchar(50) not null,
    order_id varchar(50) not null,
    created_at datetime default NOW()
);
```

# Apache Kafka ì‚¬ìš©
## Ecosystem - 2. Kafka Connect
- Kafka Connectë¥¼ í†µí•´ Dataë¥¼ Import/Export ê°€ëŠ¥
- í”„ë¡œê¸°ë˜ë° ì—†ì´ Configuration íŒŒì¼ë§Œìœ¼ë¡œ ë°›ì•„ì˜¨ ë°ì´í„°ë¥¼ ë‹¤ë¥¸ìª½ìœ¼ë¡œ ì´ë™ ê°€ëŠ¥
- Standalone mode, Distribution mode ì§€ì›<br>- RESTful APIë¥¼ í†µí•´ ì§€ì›<br>- Stream ë˜ëŠ” Batch í˜•íƒœë¡œ ë°ì´í„° ì „ì†¡ ê°€ëŠ¥<br>- ì»¤ìŠ¤í…€ Connectorë¥¼ í†µí•œ ë‹¤ì–‘í•œ Plugin ì œê³µ (File, S3, Hive, Mysql, etc ...)
- ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ìª½ì„ Connect Sourceë¼ í•˜ê³ , ë°ì´í„°ë¥¼ ë°›ëŠ” ìª½ì„ Connect Sinkë¼ í•œë‹¤.

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-09 á„‹á…©á„’á…® 5 24 09](https://user-images.githubusercontent.com/59405576/194746060-af7bd461-a1e0-4d15-a4ec-668d55a930de.png){: width="700" height="700"}

### Kafka Connect ì„¤ì¹˜ ë° ì‹¤í–‰
```bash
# Kafka Connect ì„¤ì¹˜
$ curl -O http://packages.confluent.io/archive/6.1/confluent-community-6.1.0.tar.gz

# ì••ì¶• í•´ì œ
$ tar xvf confluent-community-6.1.0.tar.gz

# ì••ì¶• í•´ì œí•œ ë””ë ‰í† ë¦¬ë¡œ ì´ë™
$ cd confluent-6.1.0
```
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-09 á„‹á…©á„’á…® 7 28 42](https://user-images.githubusercontent.com/59405576/194751764-f3c29503-ef7b-480a-bf8d-d5eb35e70795.png)


ì´ì œ Kafka Connectë¥¼ ì‹¤í–‰í• ê±´ë°, ê·¸ ì „ì— zookeeper ì„œë²„ì™€ kafka ì„œë²„ê°€ ê¸°ë™ë˜ê³  ìˆì–´ì•¼ í•œë‹¤!
```bash
# Kafka Connect ì‹¤í–‰
$ ./bin/connect-distributed ./etc/kafka/connect-distributed.properties
```
Kafka Connectë¥¼ ì‹¤í–‰í•˜ê¸° ì „ì— kafka ì„œë²„ì—ì„œ í† í”½ ë¦¬ìŠ¤íŠ¸ë¥¼ ì¡°íšŒí•˜ê³ ,<br>
Kafka Connectë¥¼ ì‹¤í–‰í•œ ë’¤ì— kafka ì„œë²„ì—ì„œ í† í”½ ë¦¬ìŠ¤íŠ¸ë¥¼ ì¡°íšŒí•´ë³´ë©´ ì•„ë˜ì™€ ê°™ë‹¤.<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-09 á„‹á…©á„’á…® 7 41 46](https://user-images.githubusercontent.com/59405576/194752254-771ad191-3b10-46c4-998e-11400442481b.png)<br>
ì´ ë•Œ ìƒˆë¡œ ìƒê¸´ ê²ƒë“¤ì€, <br>
kafka connectê°€ sourceì—ì„œ ì½ì–´ì˜¨ ë°ì´í„°ë“¤ì„ ê´€ë¦¬í•˜ê¸° ìœ„í•œ í† í”½ë“¤ì´ë©°, kafka connectë¥¼ ì‹¤í–‰í•¨ìœ¼ë¡œì¨ ìë™ìœ¼ë¡œ ìƒê¸´ ê²ƒì´ë‹¤.

### JDBC Connector
Kafka Connectë¥¼ í†µí•´ í•œìª½ì—ì„œ ë°ì´í„°ë¥¼ ì½ì–´ì™€ì„œ ë‹¤ë¥¸ìª½ìœ¼ë¡œ ì „ë‹¬í•˜ê¸° ìœ„í•´ì„œ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì‚¬ìš©í•  ê²ƒì´ë‹¤.<br>
javaì—ì„œ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” JDBC ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì´ìš©í•´ì•¼ í•œë‹¤.<br>
ë§ˆì°¬ê°€ì§€ë¡œ Kafka Connectì—ì„œë„ ì‚¬ìš©í•˜ë ¤ê³  í•˜ëŠ” ì†ŒìŠ¤ì— ë§ëŠ” JDBC Connectorë¼ëŠ” ê²ƒì„ ì„¤ì¹˜í•´ì•¼ í•œë‹¤.

#### 1) JDBC Connector ì„¤ì¹˜
[https://docs.confluent.io/5.5.1/connect/kafka-connect-jdbc/index.html](https://docs.confluent.io/5.5.1/connect/kafka-connect-jdbc/index.html)<br>
ìœ„ ì‚¬ì´íŠ¸ì— ë“¤ì–´ê°€ ì•„ë˜ ì‚¬ì§„ì— ë³´ì´ëŠ” `Download and extract the ZIP file`ì„ í´ë¦­í•œ ë’¤, `Downlod` í•œë‹¤.<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-09 á„‹á…©á„’á…® 7 06 49](https://user-images.githubusercontent.com/59405576/194750715-d4a460e4-04e1-4a6d-89d7-a7a945ffa2b6.png)<br><br>
ê·¸ë¦¬ê³  ë‹¤ìš´ë°›ì€ ì••ì¶•íŒŒì¼ì„ kafkaê°€ ìˆëŠ” ì‘ì—… ë””ë ‰í† ë¦¬ë¡œ ì´ë™í•œë‹¤. (íƒìƒ‰ê¸°ì—ì„œ ì´ë™í•´ë„ ìƒê´€ì—†ë‹¤.)
```bash
# ì••ì¶•íŒŒì¼ì´ ì €ì¥ëœ ìœ„ì¹˜ë¡œ ì´ë™
$ cd Downloads

# ì••ì¶•íŒŒì¼ì„ ì‘ì—… ë””ë ‰í† ë¦¬ë¡œ ì´ë™
$ mv confluentinc-kafka-connect-jdbc-10.5.4.zip ~/study/msa/kafka-demo

# ì••ì¶• í•´ì œ
$ tar xvf confluentinc-kafka-connect-jdbc-10.5.4.zip

# lib ì•ˆì— kafka-connect-jdbc-10.5.4.jar íŒŒì¼ì´ ìœ„ì¹˜í•´ìˆë‹¤.
$ cd confluentinc-kafka-connect-jdbc-10.5.4/lib/

# í˜„ì¬ ìœ„ì¹˜ë¥¼ ì½ì–´ì˜¤ê¸°
$ pwd
```
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-09 á„‹á…©á„’á…® 8 12 18](https://user-images.githubusercontent.com/59405576/194753704-e02ab6d2-2203-463f-9ba4-8f6a551ef5df.png)<br><br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-09 á„‹á…©á„’á…® 8 17 30](https://user-images.githubusercontent.com/59405576/194753901-d040ffb7-f462-4087-8b53-46c62ee753a0.png)<br>
`kafka-connect-jdbc-10.5.4.jar` íŒŒì¼ì´ ìš°ë¦¬ê°€ í•„ìš”í•œ íŒŒì¼ì´ë‹¤.<br>
`pwd` ì»¤ë§¨ë“œë¥¼ í†µí•´ í•´ë‹¹ íŒŒì¼ì˜ ê²½ë¡œë¥¼ ë³µì‚¬í•œë‹¤.

#### 2) JDBC Connector ì—°ë™
ì´ì œ ì„¤ì •íŒŒì¼ì„ ë°”ê¿€ ê²ƒì´ê¸° ë•Œë¬¸ì— Kafka ConnectëŠ” `ctrl`+`c`ë¡œ ì ì‹œ ì¤‘ì§€í•˜ì.<br>
ê·¸ë¦¬ê³  JDBC Connectorë¥¼ ì—°ë™í•˜ê¸° ìœ„í•´ì„œ vim ë˜ëŠ” codeë¥¼ í†µí•´ `etc/kafka/connect-distributed.properties` íŒŒì¼ì„ ìˆ˜ì •í•  ê²ƒì´ë‹¤.<br>
```bash
$ code ./etc/kafka/connect-distributed.properties
```
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-09 á„‹á…©á„’á…® 8 23 14](https://user-images.githubusercontent.com/59405576/194754126-238493cd-4a1f-4993-ae6b-810b3a238ccf.png)<br><br>
`etc/kafka/connect-distributed.properties` íŒŒì¼ ë§¨ ì•„ë˜ `plugin.path`ì— ì´ì „ì— `pwd`ë¡œ í™•ì¸í•œ ê²½ë¡œë¥¼ ì ì–´ì£¼ë©´ ëœë‹¤.<br><br>
ë³€ê²½ ì „<br>
<img width="769" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-09 á„‹á…©á„’á…® 8 21 30" src="https://user-images.githubusercontent.com/59405576/194754054-be14293b-d5bc-400b-932b-ba1a96766a9a.png"><br><br>
ë³€ê²½ í›„<br>
<img width="765" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-09 á„‹á…©á„’á…® 8 21 55" src="https://user-images.githubusercontent.com/59405576/194754065-1161c596-699f-4385-afa0-6c011b5887a1.png">


#### 3) JdbcSourceConnectorì—ì„œ MariaDB ì‚¬ìš©
ë§ˆì§€ë§‰ìœ¼ë¡œ, JdbcSourceConnectorì—ì„œ MariaDBë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ mariadb ë“œë¼ì´ë²„ë¥¼ ë³µì‚¬í•œë‹¤.<br>
- `./share/java/kafka/` í´ë”ì— `mariadb-java-client-2.7.2.jar` íŒŒì¼ ë³µì‚¬

```bash
# í™ˆ ë””ë ‰í† ë¦¬ë¡œ ì´ë™
$ cd

$ cd .m2/repository/org/mariadb/jdbc/mariadb-java-client/2.7.2

$ cp ./mariadb-java-client-2.7.2.jar /Users/minju/study/msa/kafka-demo/confluent-6.1.0/share/java/kafka
```

ì•„ë˜ ì‚¬ì§„ì— ë³´ì´ëŠ” `mariadb-java-client-2.7.2.jar` íŒŒì¼ì„ kafka connect ë””ë ‰í† ë¦¬(= `confluent-6.1.0`) ì•ˆì— ìˆëŠ” `/share/java/kafka/`ì— ë³µì‚¬í•  ê²ƒì´ë‹¤.<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-09 á„‹á…©á„’á…® 8 29 25](https://user-images.githubusercontent.com/59405576/194754406-42826e34-5bb5-4ad2-8e8d-1aa064aafe04.png)<br><br>
`cp` ì»¤ë§¨ë“œ ì‹¤í–‰ í›„, ì •ìƒì ìœ¼ë¡œ copyê°€ ë˜ì—ˆëŠ”ì§€ í™•ì¸í•´ë³´ì.<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-09 á„‹á…©á„’á…® 8 35 02](https://user-images.githubusercontent.com/59405576/194754666-eb23a01b-585c-41cb-97bb-0fe2b4406c44.png)<br>
ì•„ë˜ ì‚¬ì§„ì„ ë³´ë©´, ì •ìƒì ìœ¼ë¡œ copyê°€ ë˜ì—ˆìŒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-09 á„‹á…©á„’á…® 8 35 16](https://user-images.githubusercontent.com/59405576/194754670-7c41d9c1-a131-46a9-a563-b2f1bfa79c11.png)






***
<br>


    ğŸ’› ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ğŸ‘»

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}