---
title:  "[E-commerce App] Kafka Source Connect ì‚¬ìš© "

categories:
  - SpringCloud
tags:
  - [SpringCloud]

toc: true
toc_sticky: true
 
date: 2022-10-09 20:40:24
last_modified_at: 2022-10-09 20:40:26
---
ë©”ì„¸ì§€ë¥¼ ë³´ë‚´ê³ , ê°€ì ¸ì˜¤ëŠ” ì‘ì—…ì— ìˆì–´ì„œ Kafka Connectê°€ ì‚¬ìš©ë˜ê³ , <br>
Sourceì™€ Sinkê°€ ì“°ì¼ ê²ƒì´ë‹¤.

# Kafka Source Connect ë“±ë¡
í¬ìŠ¤íŠ¸ë§¨ì„ ì´ìš©í•´ MariaDB ê´€ë ¨ë˜ì–´ìˆëŠ” Sourceë¥¼ ë“±ë¡í•´ë³´ë„ë¡ í•˜ì.<br><br>
í¬ìŠ¤íŠ¸ë§¨ì„ ì¼œì„œ ì•„ë˜ ë°ì´í„°ë¥¼ bodyì— ë‹´ì•„ `http://localhost:8083/connectors`ì— ìš”ì²­í•´ë³´ì.<br>

> ğŸŒŸ ì£¼ì˜<br>
ê·¸ ì „ì— zookeeper ì„œë²„ & kafka ì„œë²„ & Kafka Connectê°€ ê¸°ë™ë˜ê³  ìˆì–´ì•¼ í•œë‹¤!

```bash
# í˜„ì¬ ìœ„ì¹˜: /Users/minju/study/msa/kafka-demo/kafka_2.13-2.7.0
# zookeeper ì‹¤í–‰ 
$ ./bin/zookeeper-server-start.sh ./config/zookeeper.properties

# í˜„ì¬ ìœ„ì¹˜: /Users/minju/study/msa/kafka-demo/kafka_2.13-2.7.0
# kafka ì‹¤í–‰ 
$ ./bin/kafka-server-start.sh ./config/server.properties

# í˜„ì¬ ìœ„ì¹˜: /Users/minju/study/msa/kafka-demo/confluent-6.1.0
# Kafka Connect ì‹¤í–‰ 
$ ./bin/connect-distributed ./etc/kafka/connect-distributed.properties
```

<br>

ğŸš¨ ì•„ë˜ì—ì„œ `connection.user`ì™€ `connection.password`ëŠ” ë³¸ì¸ì˜ mysql ì„¤ì •ì— ë§ê²Œ ë³€ê²½í•´ì£¼ì–´ì•¼ í•œë‹¤!
```json
{
  "name" : "my-source-connect",
  "config" : {
  "connector.class" : "io.confluent.connect.jdbc.JdbcSourceConnector",
  "connection.url":"jdbc:mysql://localhost:3306/mydb",
  "connection.user":"admin",
  "connection.password":"***", 
  "mode": "incrementing",
  "incrementing.column.name" : "id",
  "table.whitelist":"users",
  "topic.prefix" : "my_topic_",
  "tasks.max" : "1"
  }
}
```
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-09 á„‹á…©á„’á…® 9 15 48](https://user-images.githubusercontent.com/59405576/194756350-e9baa94c-b3d7-4a44-90ef-5142d4825e48.png)<br>

> ì°¸ê³ <br>
í¬ìŠ¤íŠ¸ë§¨ì´ ì•„ë‹Œ, í„°ë¯¸ë„ì—ì„œëŠ” ì•„ë˜ ì»¤ë§¨ë“œë¥¼ ì‹¤í–‰í•˜ë©´ ëœë‹¤.
```bash
echo '
{
  "name" : "my-source-connect",
  "config" : {
  "connector.class" : "io.confluent.connect.jdbc.JdbcSourceConnector",
  "connection.url":"jdbc:mysql://localhost:3306/mydb",
  "connection.user":"admin",
  "connection.password":"***", 
  "mode": "incrementing",
  "incrementing.column.name" : "id",
  "table.whitelist":"users",
  "topic.prefix" : "my_topic_",
  "tasks.max" : "1"
  }
}
' | curl -X POST -d @- http://localhost:8083/connectors --header "content-Type:application/json"
```

# í…ŒìŠ¤íŠ¸
## connector í™•ì¸
í¬ìŠ¤íŠ¸ë§¨ì„ ì´ìš©í•´ í˜„ì¬ ë“±ë¡ë˜ì–´ì§„ connectorë¥¼ í™•ì¸í•´ë³´ì.<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-09 á„‹á…©á„’á…® 9 18 43](https://user-images.githubusercontent.com/59405576/194756437-0788e4ac-5861-49b2-a3ce-3a0d71bae2f3.png)<br>
íŠ¹ì • connectorì— ëŒ€í•œ ìƒì„¸ì •ë³´ë¥¼ ë³´ê³  ì‹¶ë‹¤ë©´, ì•„ë˜ì™€ ê°™ì´ ìš”ì²­í•˜ì.<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-09 á„‹á…©á„’á…® 9 20 08](https://user-images.githubusercontent.com/59405576/194756501-6751bf9c-7d3f-4b5b-b4a7-5a7dc6570d5d.png)

## Topic í™•ì¸
ë°ì´í„° ì†ŒìŠ¤ë¥¼ ë“±ë¡í•´ë‘ì—ˆìœ¼ë‹ˆ, ë°ì´í„°ê°€ ë³€ê²½ë˜ì—ˆì„ ë•Œ í† í”½ì— ì˜ ìŒ“ì´ëŠ”ì§€ í† í”½ì„ í™•ì¸í•´ë³´ì.
```bash
# kafka ë””ë ‰í† ë¦¬ë¡œ ì´ë™
$ cd ~/study/msa/kafka-demo/kafka_2.13-2.7.0

# Topic ëª©ë¡ í™•ì¸
$ ./bin/kafka-topics.sh --bootstrap-server localhost:9092 --list
```
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-09 á„‹á…©á„’á…® 9 23 23](https://user-images.githubusercontent.com/59405576/194756603-b933c949-0d5f-4ed0-b4be-6ad8e907c7c2.png)<br>
ìƒˆë¡œìš´ í† í”½ì´ ì•„ì§ ìƒì„±ë˜ì§€ ì•Šì€ ì´ìœ ëŠ”, ë°ì´í„°ì˜ ë³€ê²½ì‚¬í•­ì´ ì—†ê¸° ë•Œë¬¸ì´ë‹¤.<br><br>
ê·¸ë ‡ë‹¤ë©´ ë°ì´í„°ë¥¼ ë³€ê²½í•´ë³´ì.<br>
```bash
# í™ˆ ë””ë ‰í† ë¦¬ë¡œ ì´ë™
$ cd

# mysql ì ‘ì†
$ mysql -u admin -p

mysql> use mydb;

# ë°ì´í„° insert
mysql> insert into users(user_id, pwd, name) values('user1', 'test1111', 'User name');
```
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-09 á„‹á…©á„’á…® 9 26 51](https://user-images.githubusercontent.com/59405576/194756750-dd11f20c-af9f-46cd-8dee-3f42095f9a3b.png)<br><br>
ì´ì œ ë‹¤ì‹œ í† í”½ì„ í™•ì¸í•´ë³´ì.<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-09 á„‹á…©á„’á…® 9 27 19](https://user-images.githubusercontent.com/59405576/194756804-5bf02fab-4d77-4773-ad4c-b2c7499ad754.png)<br>
`my_topic_users`ë¼ëŠ” ìƒˆë¡œìš´ í† í”½ì´ ìƒì„±ë˜ì—ˆë‹¤.

## consumer - í† í”½ ì •ë³´ í™•ì¸
consumerì—ì„œ ìƒì„±ëœ í† í”½ì˜ ì •ë³´ë¥¼ í™•ì¸í•´ë³´ì.
```bash
# ë©”ì‹œì§€ ì†Œë¹„(consume)
$ ./bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic my_topic_users --from-beginning
```
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-09 á„‹á…©á„’á…® 9 31 25](https://user-images.githubusercontent.com/59405576/194756960-a0c9b12f-c70e-4cf0-a561-e7f583f3270c.png)<br>
ì´ì „ì— mysqlì—ì„œ ì¿¼ë¦¬ë¬¸ìœ¼ë¡œ ì‚½ì…í•œ ë°ì´í„°ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.<br><br>
ë°ì´í„°ë¥¼ í•˜ë‚˜ ë” ë„£ì–´ë³´ì. (ì´ insert í•œ ë°ì´í„°ëŠ” ë‘ ê°œì´ë‹¤.)<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-09 á„‹á…©á„’á…® 9 37 40](https://user-images.githubusercontent.com/59405576/194757220-8666f8f0-ec41-40b8-8f16-ab000799f43d.png)<br><br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-09 á„‹á…©á„’á…® 9 39 37](https://user-images.githubusercontent.com/59405576/194757305-8143a7d7-641d-4b55-a314-9c7045558c42.png)<br>
consumerë¥¼ ê¸°ë™ì‹œì¼œë†“ì€ ìƒíƒœì´ê¸° ë•Œë¬¸ì—, ì–´ë– í•œ ë©”ì‹œì§€ê°€ ë“±ë¡ë˜ê²Œ ë˜ë©´ consumerê°€ ê·¸ê²ƒì„ ê°ì§€í•´ì„œ í™”ë©´ì— ë¿Œë ¤ì¤€ë‹¤.<br>
ìœ„ ë°ì´í„°ë¥¼ JSON í¬ë©§ì— ë§ì¶° í™•ì¸í•´ë³´ë©´ ì•„ë˜ì™€ ê°™ë‹¤.<br>
<img width="907" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-09 á„‹á…©á„’á…® 9 41 19" src="https://user-images.githubusercontent.com/59405576/194757415-55a21a26-8de2-4c61-8586-d85d52cd7c7e.png"><br>
ë‚˜ì¤‘ì— í† í”½ì„ ì´ìš©í•´ ë°ì´í„°ë² ì´ìŠ¤ì— ìë£Œë¥¼ ì €ì¥í•˜ê³  ì‹¶ë‹¤ë©´, ìœ„ì— ë³´ì´ëŠ” í¬ë§·ìœ¼ë¡œ ì „ë‹¬í•´ì•¼ í•œë‹¤.<br><br>
source connectì—ì„œ topicì— ë°ì´í„°ë¥¼ ì „ë‹¬í•˜ë©´, topicì— í•´ë‹¹ ë°ì´í„°ê°€ ìŒ“ì´ëŠ” ê²ƒê¹Œì§€ í™•ì¸í–ˆë‹¤.<br>
ë‹¤ìŒ ê¸€ì—ì„œ ë‹¤ë£° sink connectê°€ í•˜ëŠ” ì—­í• ì€, topicì— ì „ë‹¬ëœ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ì„œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ë‹¤.<br>
source connectë¥¼ í†µí•´, ì§ì ‘ dbì— ë°ì´í„°ë¥¼ insert í•˜ì§€ ì•Šì•„ë„ í† í”½ì— ìë£Œë¥¼ ì „ë‹¬í•˜ë©´, dbì— insert í•  ìˆ˜ ìˆë‹¤.





***
<br>


    ğŸ’› ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ğŸ‘»

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}