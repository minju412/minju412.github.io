---
title:  "[E-commerce App] Microservice ê°„ í†µì‹  - FeignClient ì´ìš© "

categories:
  - SpringCloud
tags:
  - [SpringCloud]

toc: true
toc_sticky: true
 
date: 2022-10-07 14:33:31
last_modified_at: 2022-10-07 14:33:34
---

# FeignClient
- FeignClient -> HTTP Client<br>- REST Callì„ ì¶”ìƒí™”í•œ Spring Cloud Netflix ë¼ì´ë¸ŒëŸ¬ë¦¬
- ì‚¬ìš© ë°©ë²•<br>- í˜¸ì¶œí•˜ë ¤ëŠ” HTTP Endpointì— ëŒ€í•œ Interfaceë¥¼ ìƒì„±<br>- `@FeignClient` ì„ ì–¸
- Load balanced ì§€ì›

## `user-service`
### `pom.xml`
```xml
<!-- Feign Client -->
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-openfeign</artifactId>
</dependency>
```

### `UserServiceApplication.java`
```java
@SpringBootApplication
@EnableDiscoveryClient
@EnableFeignClients // ğŸŒŸ ì¶”ê°€
public class UserServiceApplication {
    ...
}
```


### `OrderServiceClient.java` - ì¸í„°í˜ì´ìŠ¤ ìƒì„±
```java
@FeignClient(name = "order-service") // í˜¸ì¶œí•˜ë ¤ëŠ” ë§ˆì´í¬ë¡œ ì„œë¹„ìŠ¤ ì´ë¦„
public interface OrderServiceClient {

    @GetMapping("/order-service/{userId}/orders") // prefix + uri
    List<ResponseOrder> getOrders(@PathVariable String userId);
}
```

### `UserServiceImpl.java`
`UserServiceImpl`ì—ì„œ Feign Clientë¥¼ ì‚¬ìš©í•œë‹¤.<br>
ì½”ë“œì—ì„œëŠ” ìƒëµí–ˆì§€ë§Œ, `OrderServiceClient`ëŠ” ìƒì„±ì ì£¼ì…ì„ í†µí•´ ì£¼ì…ë°›ì•˜ë‹¤.
```java
@Service
public class UserServiceImpl implements UserService {
    ...
    @Override
    public UserDto getUserByUserId(String userId) {

        UserEntity userEntity = userRepository.findByUserId(userId);
        UserDto userDto = new ModelMapper().map(userEntity, UserDto.class);

        // ì£¼ë¬¸ ìƒì„±
        /* Using RestTemplate */
        // String orderUrl = String.format(env.getProperty("order-service.url"), userId);
        // ResponseEntity<List<ResponseOrder>> orderListResponse =
        //     restTemplate.exchange(orderUrl, HttpMethod.GET, null,
        //                           new ParameterizedTypeReference<List<ResponseOrder>>() {});
        // List<ResponseOrder> orderList = orderListResponse.getBody();

        /* ğŸŒŸ Using FeignClient */
        List<ResponseOrder> orderList = orderServiceClient.getOrders(userId);

        userDto.setOrders(orderList);

        return userDto;
    }
}
```
RestTemplateë¥¼ ì‚¬ìš©í•  ë•Œ ë³´ë‹¤ ì½”ë“œ ì–‘ì´ í›¨ì”¬ ì¤„ì–´ë“¤ê³ , ì§ê´€ì ì´ë‹¤.

## í…ŒìŠ¤íŠ¸
ì´ì „ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ, ìœ ë ˆì¹´ ì„œë²„ -> `config-service` -> `gateway-service` -> `user-service` -> `order-service` ìˆœìœ¼ë¡œ ê¸°ë™í•˜ì.<br>
ì‚¬ìš©ì íšŒì›ê°€ì…ë¶€í„° ë§ˆì¹œ í›„ í…ŒìŠ¤íŠ¸í•´ë³´ì.<br><br>
ì•„ê¹Œì²˜ëŸ¼ ì£¼ë¬¸ì„ í•œ ë’¤ì— ì‚¬ìš©ì ë‹¨ê±´ ì¡°íšŒë¥¼ í•´ë³´ë©´, ì•„ë˜ì™€ ê°™ì´ `orderList`ì˜ 1ê°œì˜ ë°ì´í„°ë¥¼ ê°€ì§€ê³  ì˜¤ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-07 á„‹á…©á„’á…® 5 02 00](https://user-images.githubusercontent.com/59405576/194503796-7f13a32d-b0b6-4f0d-a8ad-33a87a5631be.png)<br>
resume ë²„íŠ¼ì„ í´ë¦­í•˜ê²Œ ë˜ë©´ "ì‚¬ìš©ì ë‹¨ê±´ ì¡°íšŒ" ì‹œì—ë„ ì‚¬ìš©ìì˜ "ì£¼ë¬¸ ì •ë³´"ê¹Œì§€ ê°€ì ¸ì™”ìŒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-07 á„‹á…©á„’á…® 5 03 24](https://user-images.githubusercontent.com/59405576/194504075-7c3e87bd-5931-4806-aa17-0095cd2bb529.png)

# ğŸ¤” RestTemplateê³¼ FeignClient ì¤‘ ì–´ë–¤ ê²ƒì„ ì‚¬ìš©í•˜ëŠ”ê²Œ ì¢‹ì„ê¹Œ?
ë‹¹ì—°í•˜ê² ì§€ë§Œ, ê°ê° ì¥ë‹¨ì ì´ ì¡´ì¬í•œë‹¤.<br><br>
FeignClient ë°©ì‹ì„ ì‚¬ìš©í–ˆì„ ë•Œ, ì½”ë“œê°€ ê°„ê²°í•´ì§€ëŠ” ê²ƒì€ ë§ì§€ë§Œ ê·¸ë ‡ë‹¤ê³  ë¬´ì¡°ê±´ FeignClient ë°©ì‹ì´ ì¢‹ì€ ê²ƒì€ ì•„ë‹ˆë‹¤.<br>
ì™œëƒí•˜ë©´ FeignClient ë°©ì‹ì„ ì‚¬ìš©í•˜ê²Œë˜ë©´, <br>
`user-service`ì™€ `order-service`ë¥¼ ê°œë°œí•œ ì‚¬ëŒì´ ì•„ë‹ˆë¼ë©´, ë‹¤ë¥¸ ë§ˆì´í¬ë¡œ ì„œë¹„ìŠ¤ì™€ í†µì‹ ì„ í•˜ê³  ìˆë‹¤ëŠ” ê²ƒì„ íŒŒì•…í•˜ê¸° ì–´ë ¤ìš¸ ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ë‹¤.<br><br>
ë°˜ë©´ RestTemplate ë°©ì‹ì€ httpì˜ ip, í¬íŠ¸ë²ˆí˜¸, uri, end point, http method, parameter ë“±ë“±ì„ ê°€ì§€ê³  ì „ë‹¬í•˜ê¸° ë•Œë¬¸ì—<br>
ì „í†µì ìœ¼ë¡œ ë§ì´ ì‚¬ìš©í•´ì˜¤ê³  ìˆì§€ë§Œ, ì½”ë“œê°€ ë³µì¡í•´ì§„ë‹¤ëŠ” ë‹¨ì ì´ ìˆë‹¤.



***
<br>


    ğŸ’› ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ğŸ‘»

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}