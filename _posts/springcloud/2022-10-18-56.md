---
title:  "[E-commerce App] Docker Containerë¥¼ ì´ìš©í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬ - 4. Kafka & Zipkin "

categories:
  - SpringCloud
tags:
  - [SpringCloud]

toc: true
toc_sticky: true
 
date: 2022-10-18 17:46:52
last_modified_at: 2022-10-18 17:46:55
---

ì´ì „ ê¸€ì— ì´ì–´ì„œ ì§„í–‰í•´ë³´ì.

# Docker Container
## 6. Kafka 
### zookeeper & kafka broker
ì¹´í”„ì¹´ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œ, zookeeper ì„œë²„ì™€ kafka ì„œë²„ë¥¼ í•œ ëŒ€ì”© ê¸°ë™í–ˆì—ˆë‹¤.<br>
(ì›ë˜ ì •ìƒì ìœ¼ë¡œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” zookeeper ì„œë²„ 3ëŒ€ ì´ìƒ, kafka ì„œë²„ 3ëŒ€ ì´ìƒ ê¸°ë™í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•œë‹¤.)<br><br>
ì´ë²ˆì—ëŠ” zookeeper ì™€ kafkaë¥¼ í•œë° ë¬¶ì–´ì„œ ê¸°ë™í•˜ê¸° ìœ„í•´ì„œ docker-composeë¥¼ ì‚¬ìš©í•´ë³¼ ê²ƒì´ë‹¤.

> [ê¹ƒ í—ˆë¸Œ](https://github.com/wurstmeister/kafka-docker) ì‚¬ì´íŠ¸ì—ì„œ `docker-compose.yml` íŒŒì¼ì„ ë°›ì•„ì˜¤ì.


```bash
$ git clone https://github.com/wurstmeister/kafka-docker.git

$ cd kafka-docker

$ code docker-compose-single-broker.yml
```
<img width="680" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-18 á„‹á…©á„’á…® 5 59 23" src="https://user-images.githubusercontent.com/59405576/196385785-2a047237-2797-4720-86a1-57883d3bcb58.png">

`docker-compose-single-broker.yml`ì„ ì•„ë˜ì™€ ê°™ì´ ìˆ˜ì •í•œë‹¤.
```yml
version: '2'
services:
  zookeeper:
    image: wurstmeister/zookeeper
    ports:
      - "2181:2181"
    networks:
      my-network:
        ipv4_address: 172.18.0.100

  kafka:
    image: wurstmeister/kafka
    ports:
      - "9092:9092"
    environment:
      KAFKA_ADVERTISED_HOST_NAME: 172.18.0.101
      KAFKA_CREATE_TOPICS: "test:1:1"
      KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    depends_on:
      - zookeeper
    networks:
      my-network:
        ipv4_address: 172.18.0.101

networks:
  my-network:
    name: ecommerce-network # 172.18.0.1 ~

```
> ì°¸ê³ <br>
ì´ì „ì—ëŠ” ìë™ìœ¼ë¡œ í• ë‹¹ë˜ëŠ” IP Addressë¥¼ ì‚¬ìš©í–ˆë‹¤ë©´, zookeeperì™€ kafkaëŠ” ì§ì ‘ IP Addressë¥¼ í• ë‹¹í–ˆë‹¤.<br>
ì´ëŠ” ë‚˜ì¤‘ì— `order-service`ì˜ `KafkaProducerConfig`ì—ì„œ, <br>
ê¸°ì¡´ì˜ `127.0.0.1` ëŒ€ì‹  kafka ì»¨í…Œì´ë„ˆì˜ IP Addressë¥¼ ëª…ì‹œí•˜ê¸° ìœ„í•´ì„œì´ë‹¤.<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-18 á„‹á…©á„’á…® 6 14 33](https://user-images.githubusercontent.com/59405576/196389331-75fa7f13-17b9-41db-8193-8933244e9c2d.png){: width="500" height="500"}

ì €ì¥ í›„, `docker-compose`ë¥¼ ì´ìš©í•´ ê¸°ë™í•´ë³´ì.
```
$ docker-compose -f docker-compose-single-broker.yml up -d
```
<img width="1414" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-18 á„‹á…©á„’á…® 6 08 31" src="https://user-images.githubusercontent.com/59405576/196387943-96be151a-8c2a-4217-a8ef-29f97fde7705.png">

ì´ì „ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ ë„¤íŠ¸ì›Œí¬ë¥¼ í™•ì¸í•´ë³´ì.
```bash
$ docker network inspect ecommerce-network
```
<img width="652" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-18 á„‹á…©á„’á…® 6 09 20" src="https://user-images.githubusercontent.com/59405576/196388138-ac0d15d4-7bf5-4b8d-9029-2580eb1b9582.png">

## 7. Zipkin

> [zipkin í™ˆí˜ì´ì§€](https://zipkin.io/pages/quickstart)ì—ì„œ ì™¼ìª½ [Quickstart]ì— ë³´ë©´ Docker ì»¤ë§¨ë“œê°€ ìˆë‹¤.<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-18 á„‹á…©á„’á…® 6 25 09](https://user-images.githubusercontent.com/59405576/196391783-4e6c7d7b-76e4-4c74-a6a6-5c064a1d4536.png){: width="500" height="500"}

zipkin ì»¨í…Œì´ë„ˆëŠ” ê°„ë‹¨íˆ ì•„ë˜ ì»¤ë§¨ë“œë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤. (ì´ë¯¸ì§€ê¹Œì§€ pull ë°›ì•„ì˜¨ë‹¤.)
```bash
$ docker run -d -p 9411:9411 \
--network ecommerce-network \
--name zipkin \
openzipkin/zipkin 
```
<img width="1426" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-18 á„‹á…©á„’á…® 6 28 47" src="https://user-images.githubusercontent.com/59405576/196392699-030b075b-57f5-4a46-9e03-575aa62a4511.png">

ë§ˆì°¬ê°€ì§€ë¡œ ë„¤íŠ¸ì›Œí¬ë¥¼ í™•ì¸í•´ë³´ì.
```bash
$ docker network inspect ecommerce-network
```
<img width="649" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-18 á„‹á…©á„’á…® 6 29 48" src="https://user-images.githubusercontent.com/59405576/196392946-8cdb7a4e-42e3-43d0-a6ed-34b81ac6e328.png"><br>
`172.18.0.6`ê¹Œì§€ í• ë‹¹ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— zipkinì€ `172.18.0.7`ì´ í• ë‹¹ëœë‹¤.<br><br>
ì´ë²ˆì—ëŠ” ë¡œê·¸ë¥¼ í™•ì¸í•´ë³´ì.
```bash
# docker logs [ì»¨í…Œì´ë„ˆ ì´ë¦„]
$ docker logs zipkin
```
<img width="1135" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-18 á„‹á…©á„’á…® 6 32 31" src="https://user-images.githubusercontent.com/59405576/196393583-552b2af4-d262-4461-a0c2-643ab29ba46c.png">

ì•„ë˜ì™€ ê°™ì´ ì›¹ ë¸Œë¼ìš°ì €ë„ ì ‘ì† ê°€ëŠ¥í•˜ë‹¤.<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-18 á„‹á…©á„’á…® 6 33 41](https://user-images.githubusercontent.com/59405576/196393938-1f2eaba0-f647-4f14-bee7-466296c9a4b5.png){: width="500" height="500"}





***
<br>


    ğŸ’› ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ğŸ‘»

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}