---
title:  "[E-commerce App] Multiple order-serviceì—ì„œ Kafka Connectë¥¼ í™œìš©í•´ ë‹¨ì¼ DB ì‚¬ìš©í•˜ê¸° - 1. MariaDB ì—°ë™ "

categories:
  - SpringCloud
tags:
  - [SpringCloud]

toc: true
toc_sticky: true
 
date: 2022-10-10 21:25:30
last_modified_at: 2022-10-10 21:25:32
---

# Multi Orders Microservice ì‚¬ìš©ì— ëŒ€í•œ ë°ì´í„° ë™ê¸°í™” ë¬¸ì œ
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-10 á„‹á…©á„’á…® 9 34 50](https://user-images.githubusercontent.com/59405576/194867412-4f8da6b3-3c67-4c09-ac95-137201864c52.png){: width="700" height="700"}<br>
`order-service`ë¥¼ ë‘ ê°œ ê¸°ë™í•œë‹¤ê³  í–ˆì„ ë•Œ, ê°ê°ì˜ `order-service`ê°€ ë…ë¦½ì ì¸ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ê°€ì§€ê³  ìˆë‹¤.<br>
ë”°ë¼ì„œ ì‚¬ìš©ìì˜ ìš”ì²­ ì •ë³´ê°€ ì²« ë²ˆì§¸ `order-service`ì˜ ì¸ìŠ¤í„´ìŠ¤ë¡œ ê°ˆ ìˆ˜ë„ ìˆê³ ,<br>
ë‘ ë²ˆì§¸ `order-service`ì˜ ì¸ìŠ¤í„´ìŠ¤ë¡œ ê°ˆ ìˆ˜ë„ ìˆë‹¤ëŠ” ë¬¸ì œì ì´ ìˆì—ˆë‹¤.<br><br>
Kafka Connectë¥¼ ì´ìš©í•´ ì´ëŸ¬í•œ ë¬¸ì œë¥¼ í•´ê²°í•´ë³´ì.

# Kafka Connectë¥¼ í™œìš©í•œ ë‹¨ì¼ ë°ì´í„°ë² ì´ìŠ¤ ì‚¬ìš©
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-10 á„‹á…©á„’á…® 9 41 51](https://user-images.githubusercontent.com/59405576/194868687-1f1f4518-5369-47ed-ada2-1bb23d219908.png){: width="700" height="700"}
- `order-service`ì— ìš”ì²­ëœ ì£¼ë¬¸ ì •ë³´ë¥¼ DBê°€ ì•„ë‹ˆë¼ Kafka Topicìœ¼ë¡œ ì „ì†¡
- Kafka Topicì— ì„¤ì •ëœ Kafka Sink Connectë¥¼ ì‚¬ìš©í•´ ë‹¨ì¼ DBì— ì €ì¥ -> ë°ì´í„° ë™ê¸°í™”

> review<br>
Kafka Serviceì—ì„œ ë©”ì‹œì§€ë¥¼ í† í”½ì— ì „ë‹¬í•´ì£¼ëŠ” ì—­í• ì„ í•˜ëŠ” ê²ƒì´ Source Connect ì˜€ê³ , <br>
í† í”½ì— ì €ì¥ë˜ìˆë˜ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ ì‚¬ìš©í•˜ëŠ” ìª½ì´ Sink Connect ì˜€ë‹¤.

ì´ì „ ê¸€ì—ì„œ `order-service`ì—ì„œ Producerë¥¼ ë§Œë“¤ì–´, ì£¼ë¬¸ì„ í–ˆì„ ë•Œ ë©”ì‹œì§€ë¥¼ í† í”½ì— ì „ë‹¬í•´ë³´ì•˜ë‹¤.<br>
ì´ë²ˆ ê¸€ì—ì„œëŠ” Sink Connectë¥¼ í†µí•´ í† í”½ì— ì €ì¥ëœ ë°ì´í„° ê°’ì„ ì¸ì§€í•´ ë‹¨ì¼ ë°ì´í„°ë² ì´ìŠ¤ì— ë‹´ì•„ë³´ì.<br>
(ì´ ì‘ì—…ì„ ìœ„í•´ì„œ, ì´ì „ì— Sink Connectë¥¼ ë“±ë¡í–ˆê³ , MariaDBë„ ì„¤ì •í•´ë†’ì€ ìƒíƒœì´ë‹¤.)


## ìƒˆë¡œìš´ í…Œì´ë¸” ìƒì„±
í„°ë¯¸ë„ì—ì„œ ì•„ë˜ ì»¤ë§¨ë“œë¥¼ í†µí•´ ìƒˆë¡œìš´ í…Œì´ë¸”ì„ ìƒì„±í•˜ì.
```bash
$ mysql -u admin -p # admin ìë¦¬ì—ëŠ” mariadbì˜ usernameì„ ë„£ìœ¼ë©´ ëœë‹¤.

# ë°ì´í„°ë² ì´ìŠ¤ í™•ì¸
mysql> show databases;

# mydb ë¼ëŠ” ë°ì´í„°ë² ì´ìŠ¤ ì‚¬ìš©
mysql> use mydb;

# mydb ë°ì´í„°ë² ì´ìŠ¤ ì•ˆì— ìˆëŠ” í…Œì´ë¸” í™•ì¸
mysql> show tables;

mysql> create table orders (
  id int auto_increment primary key,
  user_id varchar(50) not null,
  product_id varchar(20) not null,
  order_id varchar(50) not null,
  qty int default 0,
  unit_price int default 0,
  total_price int default 0,
  created_at datetime default now()
);

# ë°©ê¸ˆ ìƒì„±í•œ í…Œì´ë¸” í™•ì¸
mysql> show tables;
```
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-11 á„‹á…©á„’á…® 11 11 38](https://user-images.githubusercontent.com/59405576/195114740-9301934f-aa86-429d-8dc5-5eff9c967b8f.png)


## `order-service` ìˆ˜ì •
ê¸°ì¡´ì˜ H2 ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ MariaDBë¡œ ë³€ê²½í•´ë³´ì.

### `pom.xml`
`pom.xml`ì—ëŠ” ì´ë¯¸ Mariadb ê´€ë ¨ dependencyê°€ ì¶”ê°€ë˜ì–´ ìˆì„ ê²ƒì´ë‹¤.
```xml
<!-- MariaDB -->
<dependency>
    <groupId>org.mariadb.jdbc</groupId>
    <artifactId>mariadb-java-client</artifactId>
    <version>2.7.2</version>
</dependency>
```

### `application.yml`
```yml
spring:
  datasource:
    url: jdbc:mariadb://localhost:3306/mydb
```

## í…ŒìŠ¤íŠ¸
ì•„ë˜ ìˆœì„œë¡œ ì„œë²„ë¥¼ ê¸°ë™í•˜ì.
- zookeeper ì„œë²„
- kafka ì„œë²„
- eureka ì„œë²„
- `config-service`
- `gateway-service`
- `user-service`
- `order-service`

### ìƒí’ˆ ì£¼ë¬¸
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-11 á„‹á…©á„’á…® 11 21 35](https://user-images.githubusercontent.com/59405576/195117326-d07ffb35-070c-42e5-8450-ea810c5bd18c.png)


### mariadb í™•ì¸
ë‘ ê°œì˜ ìƒí’ˆì„ ì£¼ë¬¸í–ˆì„ ë•Œ, ì•„ë˜ì²˜ëŸ¼ h2ê°€ ì•„ë‹Œ mariadbì— ì˜ ë“¤ì–´ê°€ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-11 á„‹á…©á„’á…® 11 22 06](https://user-images.githubusercontent.com/59405576/195117452-b44e9020-738b-4fcf-98c3-8c86af52193d.png)<br><br>
ë‹¤ìŒ ê¸€ì—ì„œëŠ”, ì‚¬ìš©ìê°€ ìƒí’ˆì„ ì£¼ë¬¸í–ˆì„ ë•Œ `OrderController`ì—ì„œ ë°”ë¡œ `order-service`ë¥¼ í˜¸ì¶œí•´ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ìƒì„±í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼.<br>
kafka message ìª½ìœ¼ë¡œ ì „ë‹¬í•˜ë„ë¡ ìˆ˜ì •í•´ë³´ì.


***
<br>


    ğŸ’› ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ğŸ‘»

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}