---
title:  "[Spring Cloud Gateway] Load Balancer "

categories:
  - SpringCloud
tags:
  - [SpringCloud]

toc: true
toc_sticky: true
 
date: 2022-09-28 01:34:36
last_modified_at: 2022-09-28 01:34:40
---
ì´ë²ˆì—ëŠ” Spring Cloud Gatewayì™€ Eureka ì„œë²„ë¥¼ ì—°ë™í•´ë³´ì.<br>
ìœ ë ˆì¹´ë¼ëŠ” ë„¤ì´ë° ì„œë¹„ìŠ¤ì— ìŠ¤í”„ë§ ê²Œì´íŠ¸ì›¨ì´ë¥¼ ë“±ë¡í•˜ê³ ,<br>
`first-service`ì™€ `second-service`ê¹Œì§€ ë“±ë¡í•´ë³´ì.

# `Spring Cloud Gateway` - `Eureka` ì—°ë™
## ê°œìš”
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-09-28 á„‹á…©á„Œá…¥á†« 1 52 16](https://user-images.githubusercontent.com/59405576/192588129-93709ad2-9b04-434f-8cfd-9eac43d69eb8.png){: width="800" height="800"}

1. ì˜ˆë¥¼ ë“¤ì–´, í´ë¼ì´ì–¸íŠ¸ê°€ `http://localhost:8000/first-service/**`ì— ìš”ì²­í•  ë•Œ
2. ì´ ìš”ì²­ì •ë³´ê°€ ìœ ë ˆì¹´ ì„œë²„ì— ì „ë‹¬ë˜ê³ 
3. ìœ ë ˆì¹´ë¡œë¶€í„° ê·¸ ìš”ì²­ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” ë§ˆì´í¬ë¡œ ì„œë¹„ìŠ¤ì˜ ìœ„ì¹˜ ì •ë³´ë¥¼ ì „ë‹¬ ë°›ê³ 
4. ê²Œì´íŠ¸ì›¨ì´ ì„œë¹„ìŠ¤ê°€ í•´ë‹¹ ìš”ì²­ì„ í•´ë‹¹ ë§ˆì´í¬ë¡œ ì„œë¹„ìŠ¤ë¡œ í¬ì›Œë”©í•œë‹¤.


## ì½”ë“œ
### 1) apigateway-service
#### `pom.xml`
ìœ ë ˆì¹´ í´ë¼ì´ì–¸íŠ¸ë¥¼ ë“±ë¡í•˜ì.
```xml
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>
</dependency>
```
ìœ ë ˆì¹´ í´ë¼ì´ì–¸íŠ¸ëŠ” `first-service`ì™€ `second-service` ëª¨ë‘ ì¶”ê°€í•´ì¤€ë‹¤.

#### `application.yml`
ìœ ë ˆì¹´ í´ë¼ì´ì–¸íŠ¸ ì„¤ì •ì„ `true`ë¡œ ë³€ê²½í•˜ì.<br>
ì´ëŠ” "8761ë²ˆ í¬íŠ¸(`discovery-service`)ì— ìœ ë ˆì¹´ í´ë¼ì´ì–¸íŠ¸ë¡œ ë“±ë¡í•˜ê² ë‹¤"ëŠ” ì˜ë¯¸ì´ë‹¤.
```yml
...
eureka:
  client:
    register-with-eureka: true # ğŸŒŸ ë³€ê²½
    fetch-registry: true # ğŸŒŸ ë³€ê²½
    service-url:
      defaultZone: http://localhost:8761/eureka

spring:
  application:
    name: apigateway-service
  cloud:
    gateway:
      default-filters:
        - name: GlobalFilter
          args:
            baseMessage: Spring Cloud Gateway Global Filter
            preLogger: true
            postLogger: true
      routes:
        - id: first-service
          uri: lb://MY-FIRST-SERVICE # ğŸŒŸ uri ë³€ê²½
          predicates:
            - Path=/first-service/** 
          filters:
            - CustomFilter
        - id: second-service
          uri: lb://MY-SECOND-SERVICE # ğŸŒŸ uri ë³€ê²½
          predicates:
            - Path=/second-service/**
          filters:
            - name: CustomFilter
            - name: LoggingFilter
              args:
                baseMessage: Hi, there.
                preLogger: true
                postLogger: true
```
`spring.cloud.gateway.routes`ì—ì„œ,<br>
`first-service`ì˜ `uri`ëŠ” ì›ë˜ `http://localhost:8081/` ì´ì—ˆê³ ,<br>
`second-service`ì˜ `uri`ëŠ” ì›ë˜ `http://localhost:8082/` ì´ì—ˆë‹¤.<br><br>
ì´ê²ƒì„ `lb://MY-FIRST-SERVICE`ì™€ `lb://MY-SECOND-SERVICE`ë¡œ ë°”ê¿ˆìœ¼ë¡œì¨,<br>
ê¸°ì¡´ì²˜ëŸ¼ http í”„ë¡œí† ì½œì„ ì´ìš©í•´ `localhost:8081` í˜¹ì€ `localhost:8082`ë¡œ ê°€ëŠ”ê²Œ ì•„ë‹ˆë¼,<br>
í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ ì •ë³´ë¥¼ ìœ ë ˆì¹´ ì„œë²„ì—ê²Œ ì „ë‹¬í•˜ê² ë‹¤ëŠ” ì˜ë¯¸ì´ë‹¤.<br><br>

### 2) first-service
#### `pom.xml`
```xml
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>
</dependency>
```

#### `application.yml`
```yml
...
eureka:
  client:
    register-with-eureka: true # ğŸŒŸ ë³€ê²½
    fetch-registry: true # ğŸŒŸ ë³€ê²½
    service-url:
      defaultZone: http://localhost:8761/eureka
```


### 3) second-service
#### `pom.xml`
```xml
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>
</dependency>
```

#### `application.yml`
```yml
...
eureka:
  client:
    register-with-eureka: true # ğŸŒŸ ë³€ê²½
    fetch-registry: true # ğŸŒŸ ë³€ê²½
    service-url:
      defaultZone: http://localhost:8761/eureka
```
ì´ë¡œì¨ ì´ 3ê°œì˜ ì„œë¹„ìŠ¤ê°€ ìœ ë ˆì¹´ ì„œë²„(`discovery-service`)ì— ë“±ë¡ëœ ê²ƒì´ë‹¤.<br>
- `apigateway-service`: 8000ë²ˆ í¬íŠ¸
- `first-service`: 8001ë²ˆ í¬íŠ¸
- `second-service`: 8002ë²ˆ í¬íŠ¸

## ì„œë²„ ê¸°ë™
ìœ ë ˆì¹´ ì„œë²„(`discovery-service`)ë¥¼ ë¨¼ì € ê¸°ë™ì‹œí‚¨ í›„,<br>
ê²Œì´íŠ¸ì›¨ì´(`apigateway-service`), `first-service`, `second-service` ìˆœìœ¼ë¡œ ê¸°ë™ì‹œí‚¤ì.<br><br>
ì´ì œ `http://localhost:8761`(= ìœ ë ˆì¹´ ì„œë²„)ì— ì ‘ì†í•˜ë©´ 3ê°œì˜ ì„œë¹„ìŠ¤ê°€ ë“±ë¡ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-09-28 á„‹á…©á„Œá…¥á†« 2 14 06](https://user-images.githubusercontent.com/59405576/192592524-6b693496-7258-40d0-a1b3-24d7bf627807.png){: width="800" height="800"}

## í¬ìŠ¤íŠ¸ë§¨ ê²°ê³¼
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-09-28 á„‹á…©á„Œá…¥á†« 2 26 39](https://user-images.githubusercontent.com/59405576/192594993-598edd8f-759c-477c-b884-56786594772d.png){: width="400" height="400"}<br><br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-09-28 á„‹á…©á„Œá…¥á†« 2 26 26](https://user-images.githubusercontent.com/59405576/192594958-5e522a9f-66e9-403e-9bad-468caeb44454.png){: width="400" height="400"}<br>
ì´ë¥¼ í†µí•´, ê¸°ì¡´ì— `http://localhost:8081` í˜¹ì€ `http://localhost:8082`ë¡œ í˜¸ì¶œí–ˆë˜ ì •ë³´ë“¤ì„<br>
ìœ ë ˆì¹´ ì„œë²„ì— ìˆëŠ” ìœ„ì¹˜ë¡œ ì •ë³´ë¥¼ ë³€ê²½í•˜ë”ë¼ë„ (`lb://MY-FIRST-SEVICE`, `lb://MY-SECOND-SEVICE`)<br>
ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.<br><br>
ì—¬ê¸°ê¹Œì§€ í•˜ë©´, ì´ì œ í•˜ë‚˜ ì´ìƒì˜ ë§ˆì´í¬ë¡œ ì„œë¹„ìŠ¤ë¥¼ ê¸°ë™í•´ì„œ ë¡œë“œ ë°¸ëŸ°ì„œì˜ ê¸°ëŠ¥ì„ êµ¬í˜„í•  ìˆ˜ ìˆëŠ” ê²ƒì´ë‹¤.<br>
ì´ì œ ì´ê²ƒì„ í…ŒìŠ¤íŠ¸í•´ë³´ì.

# dd




***
<br>


    ğŸ’› ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ğŸ‘»

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}