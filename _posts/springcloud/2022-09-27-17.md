---
title:  "[Spring Cloud Gateway] Global Filter "

categories:
  - SpringCloud
tags:
  - [SpringCloud]

toc: true
toc_sticky: true
 
date: 2022-09-27 23:27:13
last_modified_at: 2022-09-27 23:27:19
---
Global Filterë„ ì´ì „ ê¸€ì—ì„œ ë§Œë“  Custom Filterì™€ ë¹„ìŠ·í•œ ë°©ì‹ìœ¼ë¡œ ë§Œë“¤ ìˆ˜ ìˆë‹¤. (`apply()` ë©”ì„œë“œ ì§€ì •)<br>
í•˜ì§€ë§Œ Global FilterëŠ” "ê³µí†µ" í•„í„°ë¼ëŠ” ì ì—ì„œ Custom Filterì™€ ì°¨ì´ê°€ ìˆë‹¤.<br>
Custom FilterëŠ” ì•„ë˜ì™€ ê°™ì´ ë¼ìš°íŒ… ì •ë³´ë§ˆë‹¤, í•„ìš”í•œ í•„í„°ê°€ ìˆì„ ê²½ìš°ì—ëŠ” ì§€ì •í•´ì£¼ì–´ì•¼ í–ˆë‹¤.
```yml
spring:
  application:
    name: apigateway-service
  cloud:
    gateway:
      routes:
        - id: first-service
          uri: http://localhost:8081/
          predicates:
            - Path=/first-service/**
          filters:
            - CustomFilter  # ğŸŒŸ CustomFilter ë“±ë¡
        - id: second-service
          uri: http://localhost:8082/
          predicates:
            - Path=/second-service/**
          filters:
            - CustomFilter  # ğŸŒŸ CustomFilter ë“±ë¡
```
í•˜ì§€ë§Œ, ê³µí†µì ì¸ í•„í„°ê°€ ìˆë‹¤ê³  í•˜ë©´ ë§¤ë²ˆ ì´ë ‡ê²Œ ì§€ì •í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼<br>
Global Filterë¥¼ í†µí•´ í•œë²ˆì— ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.

# ì½”ë“œ
## apigateway-service
### `filter/GlobalFilter.java`
ì´ ì „ì— ë§Œë“  `CustomFilter`ì™€ ê°™ì€ ìœ„ì¹˜ì— `GlobalFilter`ë¥¼ ìƒì„±í•œë‹¤.
```java
@Component
@Slf4j
public class GlobalFilter extends AbstractGatewayFilterFactory<GlobalFilter.Config> {

    public GlobalFilter() {
        super(Config.class);
    }

    @Override
    public GatewayFilter apply(Config config) {
        return ((exchange, chain) -> {
            ServerHttpRequest request = exchange.getRequest();
            ServerHttpResponse response = exchange.getResponse();

            log.info("Global Filter baseMessage: {}", config.getBaseMessage());

            if (config.getPreLogger()) {
                log.info("Global Filter Start: request id -> {}", request.getId());
            }

            return chain.filter(exchange)
                .then(Mono.fromRunnable(() -> {
                    if (config.getPostLogger()) {
                        log.info("Global Filter End: response id -> {}", response.getStatusCode());
                    }
                }));
        });
    }

    @Data
    public static class Config {
        // configuration ì •ë³´ë¥¼ ë„£ê¸°
        private String baseMessage;
        private Boolean preLogger;
        private Boolean postLogger;
    }
}
```
ì´ë²ˆì—ëŠ” `first-service`ì™€ `second-service`ëŠ” ê±´ë“¤ì§€ ì•ŠëŠ”ë‹¤.

# í¬ìŠ¤íŠ¸ë§¨ ê²°ê³¼
í¬ìŠ¤íŠ¸ë§¨ì„ í†µí•´ `http://localhost:8000/first-service/check`ì— ì ‘ì†í•´ë³´ì.<br>
`apigateway-service`ì˜ ì½˜ì†”ì— ì•„ë˜ì™€ ê°™ì€ ë¡œê·¸ê°€ ì°íŒë‹¤.<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-09-28 á„‹á…©á„Œá…¥á†« 12 52 35](https://user-images.githubusercontent.com/59405576/192575191-09723d3e-aa2c-4ecc-9bf9-ffa92751618f.png){: width="800" height="800"}<br>
ìœ„ ì‚¬ì§„ì„ ë³´ë©´ `Global Filter Start`ì™€ `Global Filter End` ì‚¬ì´ì—,<br>
`Custom Pre Filter`ì™€ `Custom Post Filter`ê°€ ì‹¤í–‰ ë˜ì—ˆìŒì„ ì•Œ ìˆ˜ ìˆë‹¤.<br><br>
ì»¤ìŠ¤í…€ í•„í„°ëŠ” ê°ê°ì˜ ë¼ìš°í„° ì •ë³´ë§ˆë‹¤ ì¶”ê°€í•´ ì£¼ì–´ì•¼ í•˜ëŠ” í•„í„°ì´ê³ ,<br>
ì»¤ìŠ¤í…€ í•„í„°ê°€ ì‹¤í–‰ë˜ê¸° ì „ì— ê¸€ë¡œë²Œ í•„í„°ê°€ ì‹¤í–‰ëœë‹¤.<br><br>
ì´ë²ˆì—ëŠ”, ì´ì–´ì„œ `http://localhost:8000/second-service/check`ì— ì ‘ì†í•´ë³´ì.
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-09-28 á„‹á…©á„Œá…¥á†« 12 46 09](https://user-images.githubusercontent.com/59405576/192573472-bcec53ba-b118-4edc-8d15-985493c07d06.png){: width="800" height="800"}<br>









***
<br>


    ğŸ’› ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ğŸ‘»

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}