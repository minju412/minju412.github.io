---
title:  "[E-commerce App] FeignClient - ë¡œê·¸ ê´€ë¦¬ ë° ì˜ˆì™¸ ì²˜ë¦¬ "

categories:
  - SpringCloud
tags:
  - [SpringCloud]

toc: true
toc_sticky: true
 
date: 2022-10-07 17:11:45
last_modified_at: 2022-10-07 17:11:47
---

FeignClientë¥¼ ì‚¬ìš©í•˜ë©´ì„œ ìœ ìš©í•œ ê¸°ëŠ¥(ë¡œê·¸, ì˜ˆì™¸ì²˜ë¦¬)ë“¤ì— ëŒ€í•´ ì‚´í´ë³´ì.

# Logging
## `user-service`
### `application.yml`
```yml
logging:
  level:
    com.example.userservice.client: DEBUG
```

### `UserServiceApplication.java`
```java
import feign.Logger;

@SpringBootApplication
@EnableDiscoveryClient
@EnableFeignClients
public class UserServiceApplication {
    ...
    @Bean
    public Logger.Level feignLoggerLevel() {
        return Logger.Level.FULL;
    }
}
```

## í…ŒìŠ¤íŠ¸
`OrderServiceClient`ì—ì„œ `@GetMapping()`ì˜ ì£¼ì†Œë¥¼ ì˜ëª»ëœ ì£¼ì†Œì¸ `/order-service/{userId}/orders_ng`ìœ¼ë¡œ ë³€ê²½í•´ë³´ì.<br>
(ì›ë˜ëŠ” ë§¨ ë§ˆì§€ë§‰ `_ng`ë¥¼ ëº€, `/order-service/{userId}/orders` ì´ì—ˆë‹¤!)<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-07 á„‹á…©á„’á…® 5 41 01](https://user-images.githubusercontent.com/59405576/194511520-484c2d1f-85be-40b1-ae48-b1a0b08ced4e.png)<br><br>
`user-service` ì¬ê¸°ë™ í›„, íšŒì›ê°€ì… -> ìƒí’ˆ ì£¼ë¬¸ -> íšŒì› ë‹¨ê±´ ì¡°íšŒ ìˆœìœ¼ë¡œ ì‹¤í–‰í•˜ì.<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-07 á„‹á…©á„’á…® 5 32 43](https://user-images.githubusercontent.com/59405576/194509946-7aaa87af-b62b-40f6-9047-fc54103b7979.png)<br>
ìœ„ì™€ ê°™ì€ ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤.<br>
ì´ë•Œ, 500 Unternal Server Errorê°€ ë°œìƒí•˜ëŠ”ë°, ì´ê²ƒì€ ì‚¬ìš©ìì˜ ìš”ì²­ì´ ì˜ëª»ëœ ê²ƒì´ê¸° ë•Œë¬¸ì— 4xx ì—ëŸ¬ë¡œ ì‘ë‹µí•˜ëŠ”ê²Œ ë§ì„ ê²ƒì´ë‹¤.<br>
ì´ëŠ” ì•„ë˜ `Exception` íŒŒíŠ¸ì—ì„œ í•´ê²°í•´ë³´ë„ë¡ í•  ê²ƒì´ë‹¤.<br><br>
ì´ì œ `user-service`ì˜ ì¸í…”ë¦¬ì œì´ ì½˜ì†”ì—ì„œ ë¡œê·¸ë¥¼ í™•ì¸í•´ë³´ì.<br>
<img width="1320" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-07 á„‹á…©á„’á…® 5 36 23" src="https://user-images.githubusercontent.com/59405576/194510623-68f3a7e8-85d9-4921-85fd-5d6b39e494a0.png"><br>
ìœ„ì™€ ê°™ì´ ë¡œê·¸ë¥¼ í†µí•´ ìš”ì²­í•œ ì£¼ì†Œ, í—¤ë”ê°’, ë°˜í™˜ ë°›ì€ í˜ì´ë¡œë“œ ê°’ë“¤ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

# Exception
í˜„ì¬, [íšŒì› ë‹¨ê±´ ì¡°íšŒ]ì—ì„œ íšŒì›ì˜ [ì£¼ë¬¸ ë‚´ì—­]ê¹Œì§€ ë³´ì—¬ì¤„ ìˆ˜ ìˆë„ë¡ ë˜ì–´ìˆë‹¤.<br><br>
ê·¸ëŸ°ë° `user-service`ì—ì„œ [ì£¼ë¬¸ ë‚´ì—­]ì„ í˜¸ì¶œí•˜ëŠ” `order-service`ì˜ url ì´ ì˜ëª» ì„¤ì •ë˜ì–´ìˆì„ ë•Œ,<br>
ìœ„ì—ì„œ í…ŒìŠ¤íŠ¸ í•´ ë³¸ ê²ƒê³¼ ê°™ì´ [íšŒì› ë‹¨ê±´ ì¡°íšŒ] ìì²´ê°€ ì‹¤íŒ¨í•´ë²„ë¦°ë‹¤.<br><br>
ê·¸ëŸ°ë° ì´ë ‡ê²Œ í•˜ì§€ ë§ê³ ,<br>
Exception Handlingì„ í†µí•´, [íšŒì› ë‹¨ê±´ ì¡°íšŒ] ì‹œ `order-service` ì„¤ì •ì´ ì˜ëª»ë˜ì–´ìˆë‹¤ë©´,<br>
[ì£¼ë¬¸ ë‚´ì—­]ì€ ì œì™¸í•˜ê³ , íšŒì›ì˜ ê¸°ë³¸ ì •ë³´ì¸ `email`, `name`, `userId`ì— ëŒ€í•´ì„œëŠ” ì‘ë‹µí•  ìˆ˜ ìˆë„ë¡ ì½”ë“œë¥¼ ë³€ê²½í•˜ì.

## `user-service`
### `UserServiceImpl.java`
```java
@Service
@Slf4j
public class UserServiceImpl implements UserService {

    @Override
    public UserDto getUserByUserId(String userId) {

        UserEntity userEntity = userRepository.findByUserId(userId);
        UserDto userDto = new ModelMapper().map(userEntity, UserDto.class);

        // ì£¼ë¬¸ ìƒì„±
        /* Using FeignClient */
        /* ğŸŒŸ Feign exception handling */
        List<ResponseOrder> orderList = null;
        try{
            orderList = orderServiceClient.getOrders(userId);
        } catch (FeignException ex) {
            log.error(ex.getMessage());
        }

        userDto.setOrders(orderList);

        return userDto;
    }
    ...
}
```

## í…ŒìŠ¤íŠ¸
`user-service` ì¬ê¸°ë™ í›„, íšŒì›ê°€ì… -> ìƒí’ˆ ì£¼ë¬¸ -> íšŒì› ë‹¨ê±´ ì¡°íšŒ ìˆœìœ¼ë¡œ ì‹¤í–‰í•˜ì.<br>
(ì•„ì§ `OrderServiceClient`ì˜ `@GetMapping()`ì—ëŠ” ì˜ëª»ëœ ì£¼ì†Œì¸ `/order-service/{userId}/orders_ng`ê°€ ë“¤ì–´ìˆë‹¤.)<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-07 á„‹á…©á„’á…® 5 48 10](https://user-images.githubusercontent.com/59405576/194513087-06cf03c7-0cbe-446b-b42f-9976a1f05c53.png)<br>
ì´ë²ˆì—ëŠ” `200 OK` ì´ë‹¤.<br>
ê·¸ë¦¬ê³  íšŒì› ì •ë³´ì— ëŒ€í•´ì„œëŠ” ì •ìƒì ìœ¼ë¡œ ì‘ë‹µí•˜ê³ , [ì£¼ë¬¸ ë‚´ì—­]ì— ëŒ€í•´ì„œë§Œ ì‘ë‹µí•˜ì§€ ì•Šì€ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.



***
<br>


    ğŸ’› ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ğŸ‘»

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}