---
title:  "[E-commerce App] Docker Containerë¥¼ ì´ìš©í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬ - 3. MariaDB & Kafka & Zipkin "

categories:
  - SpringCloud
tags:
  - [SpringCloud]

toc: true
toc_sticky: true
 
date: 2022-10-18 00:49:03
last_modified_at: 2022-10-18 00:49:05
---

ì´ì „ ê¸€ì— ì´ì–´ì„œ ì§„í–‰í•´ë³´ì.

# Docker Container
## 5. MariaDB
`order-service`ì—ì„œ ì‚¬ìš©í•  MariaDBë¥¼ ì»¨í…Œì´ë„ˆí™” ì‹œì¼œë³´ì.
### 1) ë¡œì»¬ mysqlì—ì„œ ìƒì„±í•œ í…Œì´ë¸” ë°ì´í„°ë¥¼ ì˜®ê¸°ê¸°
ë¡œì»¬ì—ì„œ ì‚¬ìš©í•˜ë˜ DATABASEê°€ ì €ì¥ë˜ì–´ìˆëŠ” ìœ„ì¹˜ë¡œ ì´ë™í•œ ë’¤, í•´ë‹¹ ë°ì´í„° íŒŒì¼ë“¤ì„ `Dockerfile`ì„ ìƒì„±í•  ìœ„ì¹˜ì— ë¯¸ë¦¬ ë³µì‚¬í•´ ë‘ì!

#### MySQLì—ì„œ ì €ì¥ëœ DATABASEì˜ ê²½ë¡œë¥¼ í™•ì¸í•˜ëŠ” ë°©ë²•
> [ì´ ê¸€](http://gnujava.com/board/article_view.jsp?board_no=16&article_no=1833)ì„ ì°¸ê³ í–ˆë‹¤.<br>
(ë³´í†µ `/usr/local/mysql/bin` ìœ„ì¹˜ì— ìˆë‹¤ëŠ”ë° ë‚˜ëŠ” ì—†ì—ˆë‹¤..ã…œã…œ)

```bash
$ mysql -u admin -p

# DATABASE ê²½ë¡œ í™•ì¸
mysql> show variables like 'datadir';
```
<img width="564" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-18 á„‹á…©á„Œá…¥á†« 12 37 09" src="https://user-images.githubusercontent.com/59405576/196221080-fc39987b-e6ef-490e-b68a-0ef81b722c6d.png"><br><br>
<img width="583" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-18 á„‹á…©á„Œá…¥á†« 12 34 19" src="https://user-images.githubusercontent.com/59405576/196220466-7d747c52-a519-4acd-90f8-0a0e4ea89d7c.png"><br><br>
<img width="477" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-18 á„‹á…©á„Œá…¥á†« 12 38 15" src="https://user-images.githubusercontent.com/59405576/196221232-d108aa93-457a-412b-a339-647fb909cc74.png"><br><br>

ì´ì œ ì´ ë°ì´í„°ë“¤ì„ ìš°ë¦¬ê°€ ì›í•˜ëŠ” í´ë”ë¡œ ì˜®ê²¨ë³´ì.
```bash
# í´ë” ìƒì„±
$ mkdir docker-files
$ cd docker-files

$ mkdir mysql-data
$ cd mysql-data

# mysql ë°ì´í„° copy
$ cp -R /opt/homebrew/var/mysql .
```
<img width="631" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-18 á„‹á…©á„Œá…¥á†« 12 43 53" src="https://user-images.githubusercontent.com/59405576/196222530-541360cd-9f36-45d3-b1b8-45dc0b201b52.png">


### 2) Dockerfileì„ í†µí•´ ì´ë¯¸ì§€ ë§Œë“¤ê¸°
`Dockerfile`ì€ ì•„ê¹Œ ë³µì‚¬í•´ë‘” `mysql-data` ë””ë ‰í† ë¦¬ì™€ ê°™ì€ ìœ„ì¹˜ì— ìƒì„±í•˜ì.
```Dockerfile
FROM mariadb

ENV MYSQL_ROOT_PASSWORD test1234

ENV MYSQL_DATABASE mydb

COPY ./mysql-data/mysql /var/lib/mysql

EXPOSE 3306

ENTRYPOINT ["mysqld","--user=root"]

```
<img width="412" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-18 á„‹á…©á„Œá…¥á†« 1 35 31" src="https://user-images.githubusercontent.com/59405576/196233626-f50ff8f0-8363-4d4f-a1b5-e13b22b74aa7.png">

- `COPY ./mysql-data/mysql /var/lib/mysql`<br>- ë°ì´í„° ë² ì´ìŠ¤ë¥¼ ë§Œë“¤ ë•Œ, ì´ˆê¸°ì— ìƒì„±í•  í…Œì´ë¸” ì •ë³´ë¥¼ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì´ìš©í•´ ìƒì„±í•´ë„ ê´œì°®ì§€ë§Œ, <br>ì§€ê¸ˆì€ ë¡œì»¬ dbì—ì„œ ë§Œë“¤ì–´ë‘” í…Œì´ë¸”ì„ ì»¨í…Œì´ë„ˆ ì•ˆìœ¼ë¡œ ë³µì‚¬í•˜ì—¬ ì‚¬ìš©í•´ë³¼ ê²ƒì´ë‹¤.<br>- ì´ ë•Œ, `COPY ./mysql-data/mysql` ìë¦¬ì—ëŠ” ë¡œì»¬ì—ì„œ ê¸°ë™ì‹œí‚¨ mariadbì˜ ë°ì´í„°ë“¤ì´ ì €ì¥ë˜ì–´ ìˆëŠ” ìœ„ì¹˜ë¥¼ ëª…ì‹œí•´ì£¼ë©´ ëœë‹¤.

### 3) ì´ë¯¸ì§€ ë¹Œë“œ
```bash
# ì´ë¯¸ì§€ íŒŒì¼ ë¹Œë“œ
$ docker build -t ln8847/my_mariadb:1.0 .

# ìƒì„±ëœ ì´ë¯¸ì§€ í™•ì¸
$ docker images | grep my_mariadb
```
<img width="1246" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-18 á„‹á…©á„Œá…¥á†« 1 49 32" src="https://user-images.githubusercontent.com/59405576/196236579-e1589398-967e-4ff1-a9d9-c6288eed29e1.png">

### 4) ë„ì»¤ ì»¨í…Œì´ë„ˆ ì‹¤í–‰
ì‹¤í–‰ ì „ì— ê¸°ì¡´ì— ë¡œì»¬ì—ì„œ ê¸°ë™ ì¤‘ì¸ mysqlì´ ìˆë‹¤ë©´ ë¨¼ì € ì¤‘ì§€í•˜ì! (í¬íŠ¸ê°€ ê²¹ì¹˜ë©´ ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤.)
```bash
# mysql ì •ì§€ (ê¸°ë™ ì¤‘ì´ë¼ë©´..)
$ brew services stop mysql

# ì»¨í…Œì´ë„ˆ ì‹¤í–‰
$ docker run -d -p 3306:3306 --network ecommerce-network \
--name mariadb \
ln8847/my_mariadb:1.0

# ë¡œê·¸ í™•ì¸
$ docker logs mariadb
```
<img width="475" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-18 á„‹á…©á„Œá…¥á†« 1 53 42" src="https://user-images.githubusercontent.com/59405576/196237367-6cb89f67-0e3a-4c4e-bf0e-c687b40fda0c.png"><br>

ì´ì „ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ ë„¤íŠ¸ì›Œí¬ë¥¼ í™•ì¸í•´ë³´ì.
```bash
$ docker network inspect ecommerce-network
```

> ë§Œì•½ Dockerfileì„ ìˆ˜ì •í•˜ê³  ì‹¶ë‹¤ë©´?
Dockerfileì„ ìˆ˜ì •í•œ ë’¤ì—, <br>
ì•„ë˜ ì»¤ë§¨ë“œë¥¼ ìˆœì„œëŒ€ë¡œ ì…ë ¥í•´ ë‹¤ì‹œ ë„ì»¤ ì»¨í…Œì´ë„ˆë¥¼ ê¸°ë™í•˜ì.

```bash
$ docker stop mariadb

$ docker system prune

$ docker build -t ln8847/my_mariadb:1.0 .

$ docker run -d -p 3306:3306 --network ecommerce-network \
--name mariadb \
ln8847/my_mariadb:1.0
```
ì‹¤í–‰ì„ í™•ì¸í•´ë³´ê³ , ì •ìƒì ìœ¼ë¡œ ê¸°ë™ë˜ì§€ ì•Šì•˜ë‹¤ë©´ ë¡œê·¸ê¹Œì§€ í™•ì¸í•´ë³´ì.
```bash
$ docker ps -a

$ docker logs mariadb
```













***
<br>


    ğŸ’› ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ğŸ‘»

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}