---
title:  "[Spring Cloud Gateway] Custom Filter ì ìš© "

categories:
  - SpringCloud
tags:
  - [SpringCloud]

toc: true
toc_sticky: true
 
date: 2022-09-27 01:17:28
last_modified_at: 2022-09-27 01:17:31
---
Custom FilterëŠ” ì‚¬ìš©ì ì •ì˜ í•„í„°ë¡œ <br>
ë¡œê·¸ë¥¼ ì¶œë ¥í•˜ê±°ë‚˜, ì¸ì¦ì„ ì²˜ë¦¬í•˜ê±°ë‚˜, ë¡œì¼€ì¼ì„ ë°”ê¿€ ìˆ˜ ìˆë‹¤.<br><br>
ì´ë²ˆì—ëŠ” ì§ì ‘ Custom Filterë¥¼ ì •ì˜í•´ ë“±ë¡í•´ë³´ì.

# ì½”ë“œ
## apigateway-service
### `filter/CustomFilter.java`
```java
@Component
@Slf4j
public class CustomFilter extends AbstractGatewayFilterFactory<CustomFilter.Config> {

    public CustomFilter() {
        super(Config.class);
    }

    @Override
    public GatewayFilter apply(Config config) {
        // Custom Pre Filter
        return ((exchange, chain) -> {
            ServerHttpRequest request = exchange.getRequest();
            ServerHttpResponse response = exchange.getResponse();

            log.info("Custom Pre Filter: request id -> {}", request.getId());

            // Custom Post Filter
            return chain.filter(exchange)
                .then(Mono.fromRunnable(() -> {
                    log.info("Custom Post Filter: response status code -> {}", response.getStatusCode());
                }));
        });
    }

    public static class Config {
        // configuration ì •ë³´ë¥¼ ë„£ê¸°
    }
}
```

### `application.yml`
```yml
...
spring:
  application:
    name: apigateway-service
  cloud:
    gateway:
      routes:
        - id: first-service
          uri: http://localhost:8081/ 
          predicates:
            - Path=/first-service/** 
          filters:
            - CustomFilter  # ğŸŒŸ CustomFilter ì ìš©
        - id: second-service
          uri: http://localhost:8082/
          predicates:
            - Path=/second-service/**
          filters:
            - CustomFilter  # ğŸŒŸ CustomFilter ì ìš©
```

## first-service
### `FirstServiceController.java`
```java
@RestController
@RequestMapping("/first-service")
@Slf4j
public class FirstServiceController {
    ...
    @GetMapping("/check")
    public String check() {
        return "Check First Service";
    }
}
```

## second-service
### `SecondServiceController.java`
```java
@RestController
@RequestMapping("/second-service")
@Slf4j
public class SecondServiceController {
    ...
    @GetMapping("/check")
    public String check() {
        return "Check Second Service";
    }
}
```

# í¬ìŠ¤íŠ¸ë§¨ í…ŒìŠ¤íŠ¸ ê²°ê³¼
í¬ìŠ¤íŠ¸ë§¨ì„ í†µí•´ `http://localhost:8000/first-service/check`ì™€ `http://localhost:8000/second-service/check`ì— ì ‘ì†í•˜ë©´,<br>
`apigateway-service`ì˜ ì½˜ì†”ì— ì•„ë˜ì™€ ê°™ì€ ë¡œê·¸ê°€ ì°íŒë‹¤.<br>
![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-09-27 á„‹á…©á„’á…® 11 13 13](https://user-images.githubusercontent.com/59405576/192550529-dc98fac7-e25e-444e-8600-34f3c97e0a05.png){: width="800" height="800"}<br>












***
<br>


    ğŸ’› ê°œì¸ ê³µë¶€ ê¸°ë¡ìš© ë¸”ë¡œê·¸ì…ë‹ˆë‹¤. ğŸ‘»

[ë§¨ ìœ„ë¡œ ì´ë™í•˜ê¸°](#){: .btn .btn--primary }{: .align-right}